<!DOCTYPE html>
<html lang="fr" data-theme="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,maximum-scale=1">
<meta name="theme-color" content="#06060b">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>COGWAR</title>
<link rel="manifest" href="manifest.json">
<link href="https://fonts.googleapis.com/css2?family=VT323&family=Fira+Code:wght@300;400;500&family=Silkscreen&family=Share+Tech+Mono&display=swap" rel="stylesheet">
<style>
:root,[data-theme="dark"]{--b0:#06060b;--b1:#0a0a12;--b2:#10101c;--b3:#1a1a2e;--bc:#121220;--g1:#7fcea0;--g2:#5ab882;--g3:#a8e6c3;--gd:#1a3a28;--l1:#c4a8e6;--l2:#a87fd4;--l3:#d4b8f0;--ld:#2a1a40;--pk:#e6a8c4;--wm:#f0d4b8;--rd:#e64a4a;--am:#f0a830;--t1:#e8e6f0;--t2:#a8a6b4;--t3:#58566a;--bd:#222238;--gg:0 0 12px #7fcea030;--gl:0 0 12px #c4a8e630;--sc:repeating-linear-gradient(0deg,transparent,transparent 2px,#0001 2px,#0001 4px);--ff:'VT323',monospace;--fm:'Fira Code',monospace;--fp:'Silkscreen',monospace;--fs:'Share Tech Mono',monospace;--r:4px;--tr:.2s ease}
[data-theme="eighties"]{--b0:#12042a;--b1:#180838;--b2:#220e48;--b3:#301860;--bc:#1c0a40;--g1:#00ffaa;--g2:#00cc88;--g3:#66ffcc;--gd:#082a1e;--l1:#ff6ef9;--l2:#cc44cc;--l3:#ff99ff;--ld:#3a0840;--pk:#ff2d95;--wm:#ffaa00;--rd:#ff0055;--am:#ff6600;--t1:#f0e6ff;--t2:#b8a0d8;--t3:#7050a0;--bd:#3a1a60;--gg:0 0 16px #00ffaa40;--gl:0 0 16px #ff6ef940;--sc:repeating-linear-gradient(0deg,transparent,transparent 1px,#ff6ef904 1px,#ff6ef904 2px)}
[data-theme="disco"]{--b0:#08000a;--b1:#100014;--b2:#1c0020;--b3:#2a0034;--bc:#180020;--g1:#ffd700;--g2:#ccaa00;--g3:#ffe44d;--gd:#2a2400;--l1:#ff4da6;--l2:#e6007a;--l3:#ff80c0;--ld:#3a0020;--pk:#ff1493;--wm:#ff8c00;--rd:#ff0040;--am:#ff6633;--t1:#ffe6f4;--t2:#c890b0;--t3:#885070;--bd:#3a0830;--gg:0 0 16px #ffd70040;--gl:0 0 16px #ff4da640;--sc:none}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html{scroll-behavior:smooth;scrollbar-width:thin;scrollbar-color:var(--gd) var(--b1);-webkit-tap-highlight-color:transparent}
body{font-family:var(--fm);font-size:13px;line-height:1.6;color:var(--t1);background:var(--b0);min-height:100dvh;overflow-x:hidden;-webkit-font-smoothing:antialiased}
body::after{content:'';position:fixed;inset:0;background:var(--sc);pointer-events:none;z-index:9999;opacity:.3}
::-webkit-scrollbar{width:4px}::-webkit-scrollbar-track{background:var(--b0)}::-webkit-scrollbar-thumb{background:var(--gd);border-radius:2px}
::selection{background:var(--l2);color:var(--b0)}
input,textarea,select,button{font-family:inherit}
#boot{position:fixed;bottom:0;left:0;right:0;z-index:10000;background:var(--b0);border-top:1px solid var(--g2);padding:8px 12px;display:flex;align-items:center;gap:8px;font-family:var(--ff);font-size:16px;color:var(--g1);transition:transform .5s,opacity .5s}
#boot.done{transform:translateY(100%);opacity:0;pointer-events:none}
#boot-l{flex:1;white-space:nowrap;overflow:hidden}
.cur{display:inline-block;width:8px;height:14px;background:var(--g1);animation:bl .7s step-end infinite;vertical-align:text-bottom;margin-left:2px}
#boot-bar{width:60px;height:3px;background:var(--b3);border-radius:2px;flex-shrink:0}
#boot-f{height:100%;background:var(--g1);width:0%;transition:width .12s;border-radius:2px;box-shadow:var(--gg)}
@keyframes bl{50%{opacity:0}}
#app{display:none}#app.on{display:block}
.top{position:fixed;top:0;left:0;right:0;height:48px;background:var(--b1);border-bottom:1px solid var(--bd);display:flex;align-items:center;padding:0 10px;z-index:100;gap:6px}
.tl{font-family:var(--fp);font-size:11px;color:var(--g1);letter-spacing:1px;text-shadow:var(--gg);white-space:nowrap}.tl b{color:var(--l1)}
.tr{margin-left:auto;display:flex;align-items:center;gap:5px}
.xpp{display:flex;align-items:center;gap:3px;font-family:var(--ff);font-size:14px;color:var(--wm)}
.xpt{width:40px;height:4px;background:var(--b3);border-radius:2px;overflow:hidden}
.xpfl{height:100%;background:var(--g1);border-radius:2px;transition:width .4s}
.lv{font-family:var(--fp);font-size:8px;color:var(--l1);border:1px solid var(--ld);padding:1px 5px;border-radius:var(--r)}
.dots{display:flex;gap:2px}.dot{width:14px;height:14px;border-radius:50%;border:2px solid var(--bd);cursor:pointer;transition:var(--tr)}.dot.on{border-color:var(--g1);box-shadow:var(--gg)}
.dot[data-t="dark"]{background:linear-gradient(135deg,#7fcea0,#0a0a12)}.dot[data-t="eighties"]{background:linear-gradient(135deg,#ff6ef9,#00ffaa)}.dot[data-t="disco"]{background:linear-gradient(135deg,#ffd700,#ff1493)}
.bi{width:32px;height:32px;display:flex;align-items:center;justify-content:center;background:none;border:1px solid var(--bd);color:var(--t2);border-radius:var(--r);cursor:pointer;font-size:14px;transition:var(--tr);flex-shrink:0}.bi:active{border-color:var(--g1);color:var(--g1)}
.bn{position:fixed;bottom:0;left:0;right:0;height:56px;background:var(--b1);border-top:1px solid var(--bd);display:flex;z-index:100;padding-bottom:env(safe-area-inset-bottom)}
.nb{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:1px;color:var(--t3);font-family:var(--fp);font-size:7px;letter-spacing:.5px;cursor:pointer;border:none;background:none}.nb .ic{font-size:17px}.nb.on{color:var(--g1)}.nb.on .ic{text-shadow:var(--gg)}
.mn{padding:56px 12px 72px;max-width:620px;margin:0 auto}
.s{display:none;animation:fu .2s ease}.s.on{display:block}
@keyframes fu{from{opacity:0;transform:translateY(4px)}to{opacity:1;transform:none}}
.sh{font-family:var(--ff);font-size:28px;color:var(--g1);text-shadow:var(--gg);margin-bottom:2px}
.ss2{font-family:var(--fs);font-size:10px;color:var(--t3);margin-bottom:12px;padding-bottom:8px;border-bottom:1px solid var(--bd);font-style:italic}
.wb{background:var(--bc);border:1px solid var(--bd);border-radius:6px;padding:14px;margin-bottom:10px;text-align:center;overflow:hidden;position:relative}
.wb::before{content:'';position:absolute;inset:0;background:radial-gradient(ellipse at 50% 0%,var(--gd) 0%,transparent 70%);pointer-events:none}
.wp{font-family:var(--ff);font-size:24px;color:var(--g1);text-shadow:var(--gg);position:relative}.wsb{font-family:var(--fs);font-size:10px;color:var(--t3);margin-top:3px;position:relative}
.sr{display:grid;grid-template-columns:repeat(4,1fr);gap:6px;margin-bottom:10px}
.sc{background:var(--bc);border:1px solid var(--bd);border-radius:var(--r);padding:8px 4px;text-align:center}
.sv{font-family:var(--ff);font-size:22px;color:var(--g1)}.sv.l{color:var(--l1)}.sv.w{color:var(--wm)}.sv.r{color:var(--am)}
.sl{font-family:var(--fp);font-size:6px;color:var(--t3);letter-spacing:.5px;margin-top:1px}
.qt{background:var(--b2);border-left:3px solid var(--l1);padding:8px 10px;margin:8px 0;font-family:var(--fs);font-size:11px;color:var(--t2);font-style:italic}.qt cite{display:block;font-size:9px;color:var(--t3);margin-top:2px;font-style:normal}
.qf{background:var(--bc);border:1px solid var(--g2);border-radius:6px;margin-bottom:10px;cursor:pointer;overflow:hidden;position:relative}
.qf::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,var(--g1),var(--l1));z-index:1}
.qfi{min-height:130px;display:flex;align-items:center;justify-content:center;text-align:center;padding:16px 14px;transition:transform .4s cubic-bezier(.4,0,.2,1);transform-style:preserve-3d}
.qfi.fl{transform:rotateX(180deg)}
.qffr,.qfbk{backface-visibility:hidden;width:100%}
.qfbk{transform:rotateX(180deg);position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:16px 14px}
.qfl{font-family:var(--fp);font-size:7px;color:var(--l1);letter-spacing:1px;margin-bottom:5px}
.qfq{font-family:var(--ff);font-size:18px;color:var(--g1);line-height:1.3}
.qfa{font-size:12px;color:var(--l3);line-height:1.5}
.qfh{font-family:var(--fp);font-size:7px;color:var(--t3);margin-top:6px;letter-spacing:1px}
/* Play */
.dtabs{display:flex;gap:5px;margin-bottom:8px;overflow-x:auto;scrollbar-width:none;-webkit-overflow-scrolling:touch;padding-bottom:2px}.dtabs::-webkit-scrollbar{display:none}
.dt{flex-shrink:0;padding:6px 11px;background:var(--bc);border:1px solid var(--bd);border-radius:16px;font-size:10px;color:var(--t2);cursor:pointer;transition:var(--tr);white-space:nowrap;display:flex;align-items:center;gap:4px}
.dt.on{border-color:var(--g1);color:var(--g1);background:var(--gd)}
.dd{display:inline-block;width:7px;height:7px;border-radius:50%}.d1{background:var(--g1)}.d2{background:var(--am)}.d3{background:var(--rd)}
.fp3{display:flex;align-items:center;gap:6px;margin-bottom:6px;font-family:var(--ff);font-size:13px;color:var(--t2)}
.fpb{flex:1;height:3px;background:var(--b3);border-radius:2px;overflow:hidden}
.fpf{height:100%;background:linear-gradient(90deg,var(--g2),var(--l1));transition:width .4s;border-radius:2px}
.fc{background:var(--bc);border:1px solid var(--bd);border-radius:8px;min-height:170px;display:flex;align-items:center;justify-content:center;text-align:center;padding:20px 14px;cursor:pointer;user-select:none}
.fi{width:100%;transition:transform .4s cubic-bezier(.4,0,.2,1);transform-style:preserve-3d}
.fi.fl{transform:rotateX(180deg)}
.ffr,.fbk{backface-visibility:hidden}
.fbk{transform:rotateX(180deg);position:absolute;inset:0;display:flex;align-items:center;justify-content:center;padding:20px 14px}
.fqt{font-family:var(--ff);font-size:18px;color:var(--g1);line-height:1.3}
.fat{font-size:12px;color:var(--l3);line-height:1.5}
.ftp{font-family:var(--fp);font-size:7px;color:var(--t3);letter-spacing:1px;margin-top:6px}
.fbs{display:flex;gap:6px;margin-top:8px}
.fb{flex:1;padding:10px;border:1px solid var(--bd);border-radius:var(--r);background:var(--bc);color:var(--t2);font-size:12px;cursor:pointer;transition:var(--tr)}.fb:active{transform:scale(.96)}
.fb.ok{border-color:var(--g1);color:var(--g1)}.fb.ko{border-color:var(--rd);color:var(--rd)}.fb.sk{border-color:var(--t3)}
.fss{display:grid;grid-template-columns:repeat(3,1fr);gap:6px;margin-top:10px}
.fst{text-align:center;padding:6px;background:var(--bc);border:1px solid var(--bd);border-radius:var(--r)}
.fsv{font-family:var(--ff);font-size:18px}.fsv.g{color:var(--g1)}.fsv.r2{color:var(--rd)}.fsv.a{color:var(--am)}
.fsl{font-size:7px;color:var(--t3);font-family:var(--fp);letter-spacing:.5px}
.dk-play-info{font-size:11px;color:var(--t3);margin-bottom:10px;text-align:center}
/* Library */
.toolbar{display:flex;gap:5px;margin-bottom:10px;flex-wrap:wrap}
.tbtn{padding:6px 12px;background:var(--gd);border:1px solid var(--g2);color:var(--g1);font-family:var(--fp);font-size:8px;letter-spacing:.5px;border-radius:var(--r);cursor:pointer;transition:var(--tr);display:flex;align-items:center;gap:3px}
.tbtn:active{box-shadow:var(--gg)}.tbtn.sec{background:var(--ld);border-color:var(--l2);color:var(--l1)}.tbtn.danger{background:#1a0808;border-color:var(--rd);color:var(--rd)}
.dki{background:var(--bc);border:1px solid var(--bd);border-radius:6px;padding:10px;display:flex;flex-direction:column;gap:8px;margin-bottom:8px;transition:var(--tr)}
.dki-top{display:flex;align-items:center;gap:8px}
.dki-ico{font-size:24px;width:36px;text-align:center;flex-shrink:0}
.dki-t{font-family:var(--ff);font-size:15px;color:var(--g1);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.dki-m{font-size:9px;color:var(--t3);margin-top:1px}
.dki-acts{display:flex;gap:4px;flex-wrap:wrap}
.dki-acts button{flex:1;min-width:60px;padding:6px 0;display:flex;align-items:center;justify-content:center;gap:3px;background:var(--b3);border:1px solid var(--bd);color:var(--t2);border-radius:var(--r);cursor:pointer;font-size:10px;font-family:var(--fp);letter-spacing:.3px;transition:var(--tr)}
.dki-acts button:active{border-color:var(--g1);color:var(--g1);background:var(--gd)}
.dki-acts .del{color:var(--rd)}.dki-acts .del:active{border-color:var(--rd);background:rgba(255,59,48,.1)}
/* old dki overrides removed */
/* Store */
.sti{background:var(--bc);border:1px solid var(--bd);border-radius:6px;padding:12px;margin-bottom:8px;display:flex;gap:10px;align-items:flex-start}
.sti-ico{font-size:26px;width:40px;height:40px;display:flex;align-items:center;justify-content:center;background:var(--b3);border-radius:var(--r);flex-shrink:0}
.sti-t{font-family:var(--ff);font-size:17px;color:var(--g1)}
.sti-d{font-size:10px;color:var(--t2);margin:2px 0 4px;line-height:1.4}
.sti-meta{font-size:8px;color:var(--t3);display:flex;gap:6px;align-items:center;margin-bottom:4px}
.sti-btn{padding:4px 10px;font-family:var(--fp);font-size:8px;letter-spacing:.5px;border-radius:var(--r);cursor:pointer;border:1px solid var(--g2);background:var(--gd);color:var(--g1)}.sti-btn:active{box-shadow:var(--gg)}
.sti-btn.done{border-color:var(--t3);color:var(--t3);background:var(--b2);cursor:default}
/* Modals */
.mo{position:fixed;inset:0;background:rgba(4,4,10,.97);z-index:200;display:none;overflow-y:auto;-webkit-overflow-scrolling:touch}
.mo.open{display:flex;flex-direction:column;animation:fu .15s ease}
.mo-in{background:var(--b1);flex:1;display:flex;flex-direction:column;max-width:600px;width:100%;margin:0 auto}
.mo-hd{padding:12px 14px;border-bottom:2px solid var(--g2);display:flex;align-items:center;gap:8px;position:sticky;top:0;background:var(--b1);z-index:10;min-height:48px}
.mo-t{font-family:var(--ff);font-size:18px;color:var(--g1);text-shadow:var(--gg)}
.mo-x{background:none;border:1px solid var(--bd);color:var(--t2);font-size:18px;cursor:pointer;width:36px;height:36px;border-radius:var(--r);display:flex;align-items:center;justify-content:center;margin-left:auto;transition:var(--tr)}
.mo-x:active{border-color:var(--rd);color:var(--rd)}
.mo-bd{padding:14px;flex:1;overflow-y:auto}
.fg{margin-bottom:10px}
.fl{display:block;font-family:var(--fp);font-size:7px;letter-spacing:1px;color:var(--t3);margin-bottom:3px}
.fin{width:100%;padding:8px;background:var(--b2);border:1px solid var(--bd);border-radius:var(--r);color:var(--t1);font-family:var(--fm);font-size:12px;outline:none;transition:var(--tr)}.fin:focus{border-color:var(--g1)}
textarea.fin{min-height:50px;resize:vertical}
select.fin{-webkit-appearance:none;appearance:none}
.ce{background:var(--b2);border:1px solid var(--bd);border-radius:var(--r);padding:10px;margin-bottom:6px;display:flex;flex-direction:column;gap:6px}
.ce-bd{flex:1;min-width:0}.ce-q{font-family:var(--ff);font-size:13px;color:var(--g1);word-break:break-word;line-height:1.3}.ce-a{font-size:11px;color:var(--t2);margin-top:3px;word-break:break-word;padding:4px 6px;background:var(--b3);border-radius:3px;border-left:2px solid var(--g2)}
.ce-ac{display:flex;gap:4px}
.ce-ac button{flex:1;padding:5px 0;display:flex;align-items:center;justify-content:center;gap:2px;background:var(--b3);border:1px solid var(--bd);color:var(--t2);border-radius:var(--r);cursor:pointer;font-size:10px;font-family:var(--fp);letter-spacing:.3px;transition:var(--tr)}
.ce-ac button:active{border-color:var(--g1);color:var(--g1)}
/* Ency */
.esw{position:relative}.esw::before{content:'‚åï';position:absolute;left:8px;top:50%;transform:translateY(-50%);color:var(--t3);font-size:12px}
.esr{width:100%;padding:8px 8px 8px 26px;background:var(--bc);border:1px solid var(--bd);border-radius:var(--r);color:var(--t1);font-family:var(--fm);font-size:12px;outline:none;margin-bottom:6px}.esr:focus{border-color:var(--g1)}
.etg{display:flex;gap:4px;overflow-x:auto;margin-bottom:8px;scrollbar-width:none}.etg::-webkit-scrollbar{display:none}
.et{flex-shrink:0;padding:3px 8px;font-size:9px;background:var(--b2);border:1px solid var(--bd);border-radius:12px;color:var(--t2);cursor:pointer;white-space:nowrap}.et.on{border-color:var(--g1);color:var(--g1);background:var(--gd)}
.eg{display:flex;flex-direction:column;gap:6px}
.ec{background:var(--bc);border:1px solid var(--bd);border-radius:6px;padding:10px;cursor:pointer;position:relative}.ec:active{transform:scale(.98);border-color:var(--g1)}
.ecc{font-family:var(--fp);font-size:7px;letter-spacing:.5px;color:var(--l1)}.ect{font-family:var(--ff);font-size:17px;color:var(--g1)}.ecd{font-size:10px;color:var(--t2);display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
.ecx{position:absolute;top:8px;right:8px;font-family:var(--fp);font-size:7px;color:var(--wm);background:var(--b0);padding:1px 4px;border-radius:var(--r);border:1px solid var(--wm)}.ecx.done{color:var(--g1);border-color:var(--g1)}
.emo h3{font-family:var(--ff);font-size:17px;color:var(--l1);margin:14px 0 4px}.emo h3:first-child{margin-top:0}
.emo strong{color:var(--g1)}.emo ul{padding-left:14px;margin:4px 0}.emo li{margin-bottom:3px;list-style-type:'‚ñ∏ '}.emo li::marker{color:var(--gd)}
.formula{background:var(--b0);border:1px solid var(--bd);padding:6px;border-radius:var(--r);font-family:var(--fs);font-size:12px;color:var(--g1);text-align:center;margin:6px 0}
.emo table{width:100%;border-collapse:collapse;margin:6px 0;font-size:10px}
.emo th{background:var(--b3);padding:3px 5px;text-align:left;color:var(--l1);font-family:var(--fp);font-size:7px;letter-spacing:.5px;border-bottom:1px solid var(--bd)}.emo td{padding:3px 5px;border-bottom:1px solid var(--b3)}
.emo-ft{padding:8px 12px;border-top:1px solid var(--bd);display:flex;justify-content:space-between;align-items:center;background:var(--b1)}
/* Achievements */
.ag{display:grid;grid-template-columns:repeat(3,1fr);gap:6px}
.ac{background:var(--bc);border:1px solid var(--bd);border-radius:var(--r);padding:8px;text-align:center}.ac.lk{opacity:.25;filter:grayscale(1)}.ac.gt{border-color:var(--wm)}
.aci{font-size:20px;margin-bottom:2px}.acn{font-family:var(--ff);font-size:12px;color:var(--g1)}.acd{font-size:7px;color:var(--t3)}
/* Toast */
.tc{position:fixed;top:52px;left:50%;transform:translateX(-50%);z-index:300;display:flex;flex-direction:column;align-items:center;gap:3px;pointer-events:none;width:88%;max-width:300px}
.toast{background:var(--bc);border:1px solid var(--g1);border-radius:var(--r);padding:5px 10px;font-family:var(--ff);font-size:13px;color:var(--g1);box-shadow:var(--gg);animation:ti .15s ease,to .15s ease 1.6s forwards;text-align:center;width:100%}
.toast.xp{border-color:var(--wm);color:var(--wm)}.toast.ach{border-color:var(--l1);color:var(--l1)}.toast.lv{border-color:var(--pk);color:var(--pk)}.toast.err{border-color:var(--rd);color:var(--rd)}
@keyframes ti{from{opacity:0;transform:translateY(-10px)}}@keyframes to{to{opacity:0;transform:translateY(-10px)}}
.empty{text-align:center;padding:24px;color:var(--t3);font-size:11px}.empty-i{font-size:28px;margin-bottom:6px;opacity:.4}
.ft{text-align:center;padding:14px 10px;border-top:1px solid var(--bd);margin-top:16px;font-size:9px;color:var(--t3);font-family:var(--fs)}
@media(min-width:640px){.mn{max-width:640px}.eg{display:grid;grid-template-columns:repeat(2,1fr);gap:7px}.ag{grid-template-columns:repeat(4,1fr)}}
@media(min-width:900px){.mn{max-width:860px}.bn{display:none}.mn{padding-bottom:20px}}
[data-theme="disco"] .tl{animation:dp 2s ease infinite alternate}@keyframes dp{0%{text-shadow:0 0 8px #ffd700,0 0 18px #ff1493}100%{text-shadow:0 0 10px #ff1493,0 0 20px #ffd700}}

/* ‚ïê‚ïê‚ïê PROFILE & CHARACTER SHEET ‚ïê‚ïê‚ïê */
.avatar-btn{width:32px;height:32px;display:flex;align-items:center;justify-content:center;background:var(--b3);border:1px solid var(--bd);border-radius:50%;cursor:pointer;font-size:16px;flex-shrink:0;transition:var(--tr);position:relative;overflow:hidden}
.avatar-btn img{width:100%;height:100%;object-fit:cover;border-radius:50%}
.avatar-btn:active{border-color:var(--g1);box-shadow:var(--gg)}
.avatar-btn .notif{position:absolute;top:-2px;right:-2px;width:8px;height:8px;background:var(--rd);border-radius:50%;border:1px solid var(--b1);animation:notifPulse 2s ease infinite}
@keyframes notifPulse{0%,100%{transform:scale(1)}50%{transform:scale(1.3)}}

/* Character Card */
.char-card{background:var(--bc);border:1px solid var(--bd);border-radius:8px;overflow:hidden;position:relative;margin-bottom:14px}
.char-card::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,var(--g1),var(--l1),var(--am),var(--g1));background-size:300% 100%;animation:cardShine 4s linear infinite}
@keyframes cardShine{0%{background-position:0%}100%{background-position:300%}}
.char-top{display:flex;gap:12px;padding:14px;align-items:flex-start}
.char-photo-wrap{width:90px;height:90px;border-radius:6px;border:2px solid var(--g1);overflow:hidden;flex-shrink:0;position:relative;cursor:pointer;background:var(--b3);display:flex;align-items:center;justify-content:center;box-shadow:var(--gg);transition:var(--tr)}
.char-photo-wrap:active{transform:scale(.96);box-shadow:0 0 20px var(--g1)}
.char-photo-wrap img{width:100%;height:100%;object-fit:cover}
.char-photo-wrap .ph-placeholder{font-size:36px;color:var(--t3);transition:var(--tr)}
.char-photo-wrap:hover .ph-placeholder{color:var(--g1)}
.char-photo-wrap .ph-edit{position:absolute;bottom:0;left:0;right:0;background:linear-gradient(transparent,#000c);padding:2px 0;font-family:var(--fp);font-size:6px;color:var(--g1);text-align:center;letter-spacing:1px;opacity:0;transition:var(--tr)}
.char-photo-wrap:hover .ph-edit{opacity:1}
.char-id{flex:1;min-width:0}
.char-class{font-family:var(--fp);font-size:7px;letter-spacing:1.5px;color:var(--am);padding:2px 8px;background:var(--b2);border:1px solid var(--am);border-radius:10px;display:inline-block;margin-bottom:4px}
.char-name{font-family:var(--ff);font-size:26px;color:var(--g1);text-shadow:var(--gg);line-height:1.1;margin-bottom:2px;position:relative}
.char-name .glitch{position:absolute;top:0;left:0;color:var(--l1);clip-path:inset(0 0 65% 0);transform:translateX(2px);opacity:0;animation:glitch1 4s ease infinite}
@keyframes glitch1{0%,92%,100%{opacity:0}93%{opacity:.8;transform:translateX(2px)}94%{opacity:0}95%{opacity:.6;transform:translateX(-1px)}96%{opacity:0}}
.char-title{font-family:var(--fs);font-size:10px;color:var(--l1);font-style:italic}
.char-serial{font-family:var(--fm);font-size:8px;color:var(--t3);margin-top:3px;letter-spacing:1px}
.char-lv-badge{display:flex;align-items:center;gap:6px;margin-top:5px}
.char-lv-ring{width:32px;height:32px;border-radius:50%;border:2px solid var(--g1);display:flex;align-items:center;justify-content:center;font-family:var(--ff);font-size:16px;color:var(--g1);text-shadow:var(--gg);background:var(--b0);position:relative}
.char-lv-ring::after{content:'';position:absolute;inset:-3px;border-radius:50%;border:1px solid transparent;border-top-color:var(--am);animation:lvSpin 3s linear infinite}
@keyframes lvSpin{to{transform:rotate(360deg)}}
.char-xp-mini{flex:1}
.char-xp-label{font-family:var(--fp);font-size:6px;color:var(--t3);letter-spacing:.5px}
.char-xp-bar{height:4px;background:var(--b3);border-radius:2px;overflow:hidden;margin-top:2px}
.char-xp-fill{height:100%;background:linear-gradient(90deg,var(--g2),var(--g1));border-radius:2px;transition:width .5s}
.char-xp-txt{font-family:var(--fm);font-size:8px;color:var(--t3);margin-top:1px}

/* Stats Hexagon Row */
.char-stats{display:grid;grid-template-columns:repeat(3,1fr);gap:1px;background:var(--bd);border-top:1px solid var(--bd)}
.cs{background:var(--bc);padding:10px 6px;text-align:center;position:relative;overflow:hidden}
.cs::after{content:'';position:absolute;bottom:0;left:0;height:2px;background:var(--g1);transition:width .8s ease}
.cs-v{font-family:var(--ff);font-size:22px;color:var(--g1);text-shadow:var(--gg);position:relative}
.cs-v.am{color:var(--am)}.cs-v.l{color:var(--l1)}.cs-v.rd{color:var(--rd)}.cs-v.wm{color:var(--wm)}
.cs-l{font-family:var(--fp);font-size:6px;color:var(--t3);letter-spacing:.5px;margin-top:1px}
.cs-bar{height:2px;background:var(--b3);border-radius:1px;margin-top:3px;overflow:hidden}
.cs-bar-f{height:100%;border-radius:1px;transition:width .8s ease}

/* Augmentations */
.char-augs{padding:10px 14px;border-top:1px solid var(--bd)}
.aug-label{font-family:var(--fp);font-size:7px;color:var(--t3);letter-spacing:1px;margin-bottom:6px}
.aug-grid{display:flex;flex-wrap:wrap;gap:4px}
.aug{padding:3px 8px;background:var(--b2);border:1px solid var(--bd);border-radius:12px;font-size:9px;color:var(--t2);display:flex;align-items:center;gap:3px;transition:var(--tr)}
.aug.active{border-color:var(--g1);color:var(--g1);background:var(--gd)}
.aug.legendary{border-color:var(--am);color:var(--am);background:rgba(240,168,48,.08);animation:augGlow 2s ease infinite alternate}
@keyframes augGlow{from{box-shadow:none}to{box-shadow:0 0 8px #f0a83022}}

/* Photo Upload Overlay */
.photo-modal-bd{display:flex;flex-direction:column;align-items:center;gap:12px;padding:20px}
.photo-preview{width:160px;height:160px;border-radius:8px;border:2px solid var(--bd);overflow:hidden;background:var(--b3);display:flex;align-items:center;justify-content:center}
.photo-preview img{width:100%;height:100%;object-fit:cover}
.photo-preview canvas{width:100%;height:100%;object-fit:contain}
.photo-filters{display:flex;gap:4px;flex-wrap:wrap;justify-content:center}
.pf-btn{padding:4px 10px;font-size:9px;background:var(--b2);border:1px solid var(--bd);border-radius:10px;color:var(--t2);cursor:pointer;transition:var(--tr)}
.pf-btn.on{border-color:var(--g1);color:var(--g1);background:var(--gd)}
.photo-upload-btn{padding:8px 20px;background:var(--gd);border:1px solid var(--g2);border-radius:var(--r);color:var(--g1);font-family:var(--fp);font-size:8px;letter-spacing:1px;cursor:pointer}

/* Settings */
.setting-group{margin-bottom:14px}
.setting-row{display:flex;align-items:center;justify-content:space-between;padding:7px 0;border-bottom:1px solid var(--b2)}
.setting-label{font-size:11px;color:var(--t2)}.setting-sub{font-size:8px;color:var(--t3)}
.toggle{width:36px;height:20px;background:var(--b3);border-radius:10px;cursor:pointer;position:relative;transition:var(--tr);border:1px solid var(--bd);flex-shrink:0}
.toggle.on{background:var(--gd);border-color:var(--g2)}
.toggle::after{content:'';position:absolute;top:2px;left:2px;width:14px;height:14px;background:var(--t2);border-radius:50%;transition:var(--tr)}
.toggle.on::after{left:18px;background:var(--g1)}
.range-wrap{display:flex;align-items:center;gap:6px}
.range-wrap input[type="range"]{-webkit-appearance:none;width:70px;height:3px;background:var(--b3);border-radius:2px;outline:none}
.range-wrap input[type="range"]::-webkit-slider-thumb{-webkit-appearance:none;width:12px;height:12px;background:var(--g1);border-radius:50%;cursor:pointer}
.range-val{font-family:var(--ff);font-size:13px;color:var(--g1);width:24px;text-align:right}
.emoji-grid{display:grid;grid-template-columns:repeat(8,1fr);gap:4px;max-height:160px;overflow-y:auto;padding:6px;background:var(--b2);border:1px solid var(--bd);border-radius:var(--r);margin-top:4px}
.emoji-opt{font-size:18px;text-align:center;cursor:pointer;padding:3px;border-radius:var(--r);transition:var(--tr)}.emoji-opt:hover{background:var(--gd)}

/* ‚ïê‚ïê‚ïê TOXIC GAMIFICATION ‚ïê‚ïê‚ïê */

/* ‚ïê‚ïê‚ïê SEARCH ENGINE ‚ïê‚ïê‚ïê */
.search-fab{position:fixed;bottom:68px;right:12px;width:44px;height:44px;background:var(--b2);border:1px solid var(--g2);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:20px;cursor:pointer;z-index:80;box-shadow:0 2px 12px #00000066;transition:var(--tr)}
.search-fab:active{transform:scale(.9);box-shadow:var(--gg)}
.search-overlay{position:fixed;inset:0;background:rgba(0,0,0,.85);z-index:200;display:none;flex-direction:column;animation:fu .2s ease}
.search-overlay.show{display:flex}
.search-top{padding:10px 12px;display:flex;gap:8px;align-items:center;border-bottom:1px solid var(--bd);background:var(--b1)}
.search-input{flex:1;background:var(--b2);border:1px solid var(--bd);border-radius:var(--r);padding:10px 12px;color:var(--t1);font-family:var(--fm);font-size:14px;outline:none}
.search-input:focus{border-color:var(--g1);box-shadow:0 0 8px #a3d9a540}
.search-input::placeholder{color:var(--t3)}
.search-close{background:none;border:none;color:var(--t2);font-size:20px;cursor:pointer;padding:4px 8px}
.search-filters{display:flex;gap:4px;padding:6px 12px;background:var(--b0)}
.sf-btn{padding:3px 10px;font-size:9px;font-family:var(--fp);letter-spacing:.5px;background:var(--b2);border:1px solid var(--bd);border-radius:10px;color:var(--t3);cursor:pointer}
.sf-btn.on{border-color:var(--g1);color:var(--g1);background:var(--gd)}
.search-results{flex:1;overflow-y:auto;padding:8px 12px}
.search-results::-webkit-scrollbar{width:4px}.search-results::-webkit-scrollbar-thumb{background:var(--bd);border-radius:2px}
.sr-item{padding:10px;background:var(--bc);border:1px solid var(--bd);border-radius:var(--r);margin-bottom:6px;cursor:pointer;transition:var(--tr)}
.sr-item:active{border-color:var(--g1)}
.sr-type{font-family:var(--fp);font-size:7px;letter-spacing:1px;color:var(--l1);margin-bottom:2px}
.sr-title{font-family:var(--ff);font-size:14px;color:var(--g1);margin-bottom:2px}
.sr-excerpt{font-size:10px;color:var(--t2);line-height:1.4}
.sr-excerpt mark{background:transparent;color:var(--am);font-weight:700}
.sr-empty{text-align:center;padding:40px 20px;color:var(--t3);font-size:12px}
.sr-empty .sr-e-ico{font-size:32px;margin-bottom:8px;opacity:.5}
.sr-count{font-size:9px;color:var(--t3);padding:4px 0;font-family:var(--fp);letter-spacing:.5px}

/* ‚ïê‚ïê‚ïê CONSOLE TERMINAL ‚ïê‚ïê‚ïê */
.console-wrap{background:var(--b0);border:1px solid var(--g2);border-radius:6px;overflow:hidden;margin-bottom:12px}
.console-bar{display:flex;align-items:center;gap:6px;padding:5px 10px;background:var(--b2);border-bottom:1px solid var(--bd)}
.console-dots{display:flex;gap:4px}
.console-dot{width:8px;height:8px;border-radius:50%}
.console-dot.r{background:#ff5f57}.console-dot.y{background:#ffbd2e}.console-dot.g{background:#28c840}
.console-title{font-family:var(--fm);font-size:9px;color:var(--t3);flex:1;text-align:center}
.console-body{height:320px;overflow-y:auto;padding:8px 10px;font-family:var(--fm);font-size:11px;line-height:1.6;color:var(--g1)}
.console-body::-webkit-scrollbar{width:3px}.console-body::-webkit-scrollbar-thumb{background:var(--g2);border-radius:2px}
.console-body .c-line{margin-bottom:2px;word-break:break-word}
.c-line .prompt{color:var(--l1)}.c-line .cmd{color:var(--g1)}.c-line .out{color:var(--t2)}.c-line .err{color:var(--rd)}.c-line .hl{color:var(--am)}.c-line .ok{color:#28c840}.c-line .info{color:var(--l1)}
.c-line .ascii{color:var(--g2);font-size:9px;line-height:1.2}
.console-input-row{display:flex;align-items:center;padding:4px 10px;background:var(--b1);border-top:1px solid var(--bd)}
.console-prompt{color:var(--l1);font-family:var(--fm);font-size:11px;margin-right:4px;flex-shrink:0}
.console-in{flex:1;background:transparent;border:none;color:var(--g1);font-family:var(--fm);font-size:11px;outline:none;caret-color:var(--g1)}
.streak-bar{background:var(--bc);border:1px solid var(--bd);border-radius:6px;padding:10px 12px;margin-bottom:10px;display:flex;align-items:center;gap:10px;position:relative;overflow:hidden}
.streak-bar::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,var(--am),var(--rd),var(--am));background-size:200% 100%;animation:streakShimmer 2s linear infinite}
@keyframes streakShimmer{0%{background-position:0%}100%{background-position:200%}}
.streak-fire{font-size:24px;animation:firePulse 1s ease infinite alternate}
@keyframes firePulse{from{transform:scale(1)}to{transform:scale(1.15)}}
.streak-num{font-family:var(--ff);font-size:28px;color:var(--am);text-shadow:0 0 10px #f0a83044}
.streak-txt{font-size:10px;color:var(--t2);flex:1}
.streak-warn{font-size:9px;color:var(--rd);font-family:var(--fp);letter-spacing:.5px}
.streak-bar .disc-btn{margin-left:auto}

.combo-overlay{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%) scale(0);font-family:var(--ff);font-size:60px;color:var(--am);text-shadow:0 0 30px #f0a83088,0 0 60px #f0a83044;z-index:250;pointer-events:none;transition:transform .15s cubic-bezier(.4,0,.2,1),opacity .3s}
.combo-overlay.show{transform:translate(-50%,-50%) scale(1);animation:comboPop .5s ease forwards}
@keyframes comboPop{0%{transform:translate(-50%,-50%) scale(.3);opacity:1}50%{transform:translate(-50%,-50%) scale(1.2)}70%{transform:translate(-50%,-50%) scale(1)}100%{transform:translate(-50%,-50%) scale(1);opacity:0}}

.daily-challenge{background:linear-gradient(135deg,var(--bc),var(--b2));border:1px solid var(--am);border-radius:6px;padding:12px;margin-bottom:10px;position:relative;overflow:hidden}
.daily-challenge::before{content:'';position:absolute;inset:0;background:linear-gradient(135deg,transparent 40%,#f0a83008 50%,transparent 60%);background-size:200% 200%;animation:dailyShine 3s ease infinite}
@keyframes dailyShine{0%{background-position:0% 0%}100%{background-position:200% 200%}}
.dc-head{display:flex;align-items:center;gap:6px;margin-bottom:6px}
.dc-label{font-family:var(--fp);font-size:8px;letter-spacing:1px;color:var(--am)}
.dc-timer{margin-left:auto;font-family:var(--ff);font-size:14px;color:var(--rd);animation:timerPulse 1s ease infinite alternate}
@keyframes timerPulse{from{opacity:1}to{opacity:.6}}
.dc-q{font-family:var(--ff);font-size:16px;color:var(--g1);line-height:1.3}
.dc-reward{font-size:10px;color:var(--am);margin-top:4px}

.lootbox{background:var(--bc);border:1px solid var(--l1);border-radius:6px;padding:14px;text-align:center;cursor:pointer;transition:var(--tr);animation:lootGlow 2s ease infinite alternate;margin-bottom:10px}
@keyframes lootGlow{0%{box-shadow:0 0 8px #c4a8e620}100%{box-shadow:0 0 20px #c4a8e644}}
.lootbox:active{transform:scale(.96)}
.lootbox.opened{animation:none;border-color:var(--bd);cursor:default}
.loot-ico{font-size:32px;margin-bottom:4px}
.loot-label{font-family:var(--fp);font-size:8px;color:var(--l1);letter-spacing:1px}
.loot-result{font-family:var(--ff);font-size:20px;color:var(--am);margin-top:6px}

.social-proof{font-size:10px;color:var(--t3);text-align:center;padding:6px;display:flex;align-items:center;justify-content:center;gap:4px;margin-bottom:10px}
.sp-num{color:var(--g1);font-family:var(--ff);font-size:14px}
.sp-dot{width:6px;height:6px;background:var(--g1);border-radius:50%;animation:spBlink 2s ease infinite}
@keyframes spBlink{0%,100%{opacity:1}50%{opacity:.3}}

/* ‚ïê‚ïê‚ïê DISCLAIMERS ‚ïê‚ïê‚ïê */
.disc-btn{width:18px;height:18px;display:inline-flex;align-items:center;justify-content:center;background:var(--rd);border:none;color:#fff;border-radius:50%;cursor:pointer;font-size:9px;font-weight:700;flex-shrink:0;transition:var(--tr);vertical-align:middle;font-family:var(--fm)}
.disc-btn:active{transform:scale(1.2)}
.disc-pop{display:none;background:var(--b0);border:1px solid var(--rd);border-radius:6px;padding:10px 12px;margin-top:6px;position:relative;animation:fu .2s ease}
.disc-pop.show{display:block}
.disc-pop::before{content:'‚ö†Ô∏è ATTENTION ECONOMY';display:block;font-family:var(--fp);font-size:7px;letter-spacing:1px;color:var(--rd);margin-bottom:4px}
.disc-title{font-family:var(--ff);font-size:15px;color:var(--rd);margin-bottom:3px}
.disc-text{font-size:10px;color:var(--t2);line-height:1.5}
.disc-ref{font-size:9px;color:var(--t3);margin-top:4px;font-style:italic}
.disc-toggle-row{display:flex;align-items:center;justify-content:center;gap:6px;padding:8px;font-size:10px;color:var(--t3)}
</style>
</head>
<body>
<div id="boot"><span id="boot-l">WOPR ONLINE...</span><span class="cur"></span><div id="boot-bar"><div id="boot-f"></div></div></div>
<div id="app">
<header class="top">
  <button class="bi" onclick="go('home')">‚¨°</button>
  <div class="tl">COGWAR <b>//</b> WOPR</div>
  <div class="tr">
    <div class="dots"><div class="dot on" data-t="dark" onclick="setT('dark')"></div><div class="dot" data-t="eighties" onclick="setT('eighties')"></div><div class="dot" data-t="disco" onclick="setT('disco')"></div></div>
    <div class="xpp"><div class="xpt"><div class="xpfl" id="xpf"></div></div><span id="xpd">0</span></div>
    <div class="lv" id="lvd">LV1</div>
    <div class="avatar-btn" id="av-btn" onclick="go('profile')"><span id="av-ico">ü§ñ</span><div class="notif" id="notif-dot" style="display:none"></div></div>
  </div>
</header>
<main class="mn">

<section class="s on" id="s-home">
  <div class="wb"><div class="wp">SHALL WE PLAY A GAME?</div><div class="wsb">WOPR // War Operation Plan Response</div></div>

  <!-- Streak -->
  <div class="streak-bar" id="streak-bar" style="display:none">
    <div class="streak-fire">üî•</div>
    <div class="streak-num" id="streak-num">0</div>
    <div style="flex:1">
      <div class="streak-txt" id="streak-txt">Jouez pour d√©marrer votre s√©rie!</div>
      <div class="streak-warn" id="streak-warn" style="display:none">‚ö† VOUS ALLEZ PERDRE VOTRE STREAK!</div>
    </div>
    <button class="disc-btn" onclick="toggleDisc('disc-streak')">!</button>
  </div>
  <div class="disc-pop" id="disc-streak">
    <div class="disc-title">Aversion √† la Perte</div>
    <div class="disc-text">Ce compteur de streak exploite votre <strong style="color:var(--rd)">aversion √† la perte</strong> : vous valorisez davantage ce que vous risquez de perdre que ce que vous pourriez gagner. La peur de ¬´ casser la s√©rie ¬ª vous pousse √† revenir chaque jour ‚Äî m√™me sans envie r√©elle d'apprendre.</div>
    <div class="disc-ref">‚Üí Kahneman & Tversky, Prospect Theory, 1979. Technique utilis√©e par : Duolingo, Snapchat, Wordle.</div>
  </div>

  <!-- Daily Challenge -->
  <div class="daily-challenge" id="daily-ch">
    <div class="dc-head">
      <div class="dc-label">‚è± D√âFI QUOTIDIEN</div>
      <div class="dc-timer" id="dc-timer">23:59:59</div>
      <button class="disc-btn" onclick="toggleDisc('disc-daily')">!</button>
    </div>
    <div class="dc-q" id="dc-q">Chargement...</div>
    <div class="dc-reward">üèÜ +50 XP bonus ¬∑ Dispara√Æt √† minuit</div>
  </div>
  <div class="disc-pop" id="disc-daily">
    <div class="disc-title">Raret√© Artificielle (FOMO)</div>
    <div class="disc-text">Ce compte √† rebours cr√©e un sentiment d'<strong style="color:var(--rd)">urgence artificielle</strong>. L'information que le d√©fi ¬´ dispara√Æt ¬ª active votre Fear Of Missing Out, court-circuitant la r√©flexion rationnelle au profit de l'action impulsive.</div>
    <div class="disc-ref">‚Üí Cialdini, Influence, 1984 (Principe de raret√©). Technique utilis√©e par : Amazon, Booking, TikTok.</div>
  </div>

  <!-- Social Proof -->
  <div class="social-proof" id="social-proof">
    <div class="sp-dot"></div>
    <span class="sp-num" id="sp-num">0</span> utilisateurs ont √©tudi√© aujourd'hui
    <button class="disc-btn" onclick="toggleDisc('disc-social')" style="margin-left:4px">!</button>
  </div>
  <div class="disc-pop" id="disc-social">
    <div class="disc-title">Preuve Sociale</div>
    <div class="disc-text">Ce compteur est <strong style="color:var(--rd)">enti√®rement fabriqu√©</strong>. Il n'y a aucun serveur qui compte les utilisateurs. Mais sa simple pr√©sence vous pousse √† agir par conformisme : ¬´ Si d'autres le font, je devrais aussi. ¬ª L'homophilie de r√©seau amplifie cet effet.</div>
    <div class="disc-ref">‚Üí Asch, Conformity Experiments, 1951. Technique utilis√©e par : Booking ("17 personnes regardent"), Amazon, Trustpilot.</div>
  </div>
  <div class="qf" id="qf" onclick="qfTap()"><div class="qfi" id="qfi"><div class="qffr"><div class="qfl">‚ö° FLASHCARD ‚Äî TAP</div><div class="qfq" id="qfq">Chargement...</div><div class="qfh">[ TAP POUR RETOURNER ]</div></div><div class="qfbk"><div class="qfa" id="qfa"></div><div class="qfh">[ TAP ‚Üí NOUVELLE CARTE ]</div></div></div></div>
  <div class="sr"><div class="sc"><div class="sv" id="dh-d">0</div><div class="sl">DECKS</div></div><div class="sc"><div class="sv l" id="dh-c">0</div><div class="sl">CARTES</div></div><div class="sc"><div class="sv w" id="dh-x">0</div><div class="sl">XP</div></div><div class="sc"><div class="sv r" id="dh-s">0</div><div class="sl">SESSIONS</div></div></div>

  <!-- Loot Box -->
  <div class="lootbox" id="lootbox" style="display:none" onclick="openLoot()">
    <div class="loot-ico" id="loot-ico">üéÅ</div>
    <div class="loot-label">R√âCOMPENSE MYST√àRE D√âBLOQU√âE</div>
    <div class="loot-result" id="loot-result"></div>
  </div>
  <div class="disc-pop" id="disc-loot">
    <div class="disc-title">Renforcement √† Ratio Variable</div>
    <div class="disc-text">La ¬´ mystery box ¬ª utilise le <strong style="color:var(--rd)">renforcement intermittent</strong> : des r√©compenses impr√©visibles sont plus addictives que des r√©compenses fixes. C'est le m√™me m√©canisme que les machines √† sous. Votre cerveau lib√®re plus de dopamine pour l'anticipation du r√©sultat que pour le r√©sultat lui-m√™me.</div>
    <div class="disc-ref">‚Üí B.F. Skinner, Schedules of Reinforcement, 1957. Technique utilis√©e par : Loot boxes (Fortnite), Gacha games, slot machines.</div>
  </div>

  <div class="disc-toggle-row"><span>Les boutons</span> <button class="disc-btn" style="width:14px;height:14px;font-size:7px">!</button> <span>r√©v√®lent les techniques de manipulation utilis√©es sur vous en ce moment.</span></div>
  <div class="qt">¬´ A strange game. The only winning move is not to play. ¬ª<cite>‚Äî Joshua/WOPR, WarGames (1983)</cite></div>
</section>

<section class="s" id="s-play">
  <div class="sh">PLAY</div><div class="ss2">"Shall we play a game?" ‚Äî Joshua, WarGames 1983</div>
  <div class="dtabs" id="ptabs"></div>
  <div id="play-empty" class="empty" style="display:none"><div class="empty-i">üÉè</div>Aucun deck disponible.<br>Allez dans le <b>Store</b> pour en installer.</div>
  <div id="play-zone">
    <div class="dk-play-info" id="pinfo"></div>
    <div class="fp3"><span id="pctr">‚Äî</span><div class="fpb"><div class="fpf" id="ppf"></div></div><span id="psc"></span></div>
    <div class="fc" id="pc" onclick="pflip()"><div class="fi" id="pi"><div class="ffr"><div><div class="fqt" id="pq">‚Üê Choisissez un deck</div><div class="ftp">[ TAP POUR R√âV√âLER ]</div></div></div><div class="fbk"><div class="fat" id="pa"></div></div></div></div>
    <div class="fbs" id="pbs" style="display:none"><button class="fb ko" onclick="pans(0)">‚úó Rat√©</button><button class="fb sk" onclick="psk()">‚Üí</button><button class="fb ok" onclick="pans(1)">‚úì Acquis</button></div>
    <div class="fss"><div class="fst"><div class="fsv g" id="ps-ok">0</div><div class="fsl">OK</div></div><div class="fst"><div class="fsv r2" id="ps-ko">0</div><div class="fsl">ERR</div></div><div class="fst"><div class="fsv a" id="ps-st">0</div><div class="fsl">S√âRIE</div></div></div>
    <div class="disc-pop" id="disc-combo" style="margin-top:8px">
      <div class="disc-title">Boucle Dopaminergique</div>
      <div class="disc-text">Le multiplicateur de combo (√ó2, √ó3...) lib√®re de la <strong style="color:var(--rd)">dopamine √† chaque palier</strong>, cr√©ant un √©tat de ¬´ flow ¬ª addictif. La peur de briser le combo inhibe votre cortex pr√©frontal exactement comme d√©crit dans l'entr√©e ¬´ Signal d'Erreur ¬ª. Vous continuez non par d√©sir d'apprendre, mais par d√©pendance au feedback positif.</div>
      <div class="disc-ref">‚Üí Csikszentmihalyi, Flow, 1990. Technique utilis√©e par : Guitar Hero, Candy Crush, tous les jeux comp√©titifs.</div>
    </div>
  </div>
</section>

<section class="s" id="s-lib">
  <div class="sh">Mes Decks</div><div class="ss2">"Knowledge is power." ‚Äî Petyr Baelish</div>
  <div class="toolbar">
    <button class="tbtn" onclick="deckForm()" style="font-size:10px;padding:8px 16px">+ Nouveau Deck</button>
    <button class="tbtn sec" onclick="$('imp-f').click()" style="font-size:10px;padding:8px 16px">‚¨Ü Import JSON</button>
    <input type="file" id="imp-f" accept=".json" style="display:none" onchange="doImport(event)">
  </div>
  <div class="qt" style="margin-bottom:8px;font-size:9px">Chaque deck a 4 actions : üÉè voir/√©diter les cartes ¬∑ ‚úèÔ∏è √©diter le deck ¬∑ ‚¨á exporter ¬∑ ‚úï supprimer</div>
  <div id="lib-list"></div>
  <div id="lib-empty" class="empty"><div class="empty-i">üì¶</div>Biblioth√®que vide.<br>Cr√©ez un deck avec le bouton ci-dessus ou visitez le Store.</div>
</section>

<section class="s" id="s-store">
  <div class="sh">Store</div><div class="ss2">"I'd like to play Global Thermonuclear War." ‚Äî David Lightman</div>
  <div style="display:flex;gap:4px;margin-bottom:10px">
    <div class="et on" id="st-tab-dk" onclick="storeTab('dk')">üì¶ Decks</div>
    <div class="et" id="st-tab-en" onclick="storeTab('en')">‚óà Encyclop√©die</div>
  </div>
  <div class="qt" style="margin-bottom:8px;font-size:9px">Pour ajouter du contenu : d√©posez vos JSON dans <code>decks/</code> ou <code>ency/</code> sur GitHub, mettez √† jour le <code>index.json</code>, et push.</div>
  <div id="store-list"></div>
  <div id="store-load" class="empty" style="display:none"><div class="empty-i">üì°</div>Chargement...</div>
</section>

<section class="s" id="s-profile">
  <div class="sh">Dossier Agent</div><div class="ss2">"Who are you?" ‚Äî The Caterpillar // "I am the One." ‚Äî Neo</div>

  <!-- Character Card -->
  <div class="char-card" id="char-card">
    <div class="char-top">
      <div class="char-photo-wrap" id="photo-wrap" onclick="$('photo-in').click()">
        <span class="ph-placeholder" id="ph-ph">üì∑</span>
        <img id="ph-img" style="display:none">
        <div class="ph-edit">UPLOAD</div>
      </div>
      <input type="file" id="photo-in" accept="image/*" style="display:none" onchange="handlePhoto(event)">
      <div class="char-id">
        <div class="char-class" id="ch-class">RECRUE</div>
        <div class="char-name"><span id="ch-name">OP√âRATEUR</span><span class="glitch" id="ch-glitch">OP√âRATEUR</span></div>
        <div class="char-title" id="ch-title">R√©sistant cognitif en formation</div>
        <div class="char-serial" id="ch-serial">WOPR-0000 ¬∑ COGWAR DIVISION</div>
        <div class="char-lv-badge">
          <div class="char-lv-ring" id="ch-lv">1</div>
          <div class="char-xp-mini">
            <div class="char-xp-label">XP VERS NIVEAU <span id="ch-nxlv">2</span></div>
            <div class="char-xp-bar"><div class="char-xp-fill" id="ch-xpf"></div></div>
            <div class="char-xp-txt"><span id="ch-xp">0</span> / <span id="ch-xpmax">100</span></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Core Stats -->
    <div class="char-stats">
      <div class="cs"><div class="cs-v" id="cs-cog">0</div><div class="cs-l">COGNITION</div><div class="cs-bar"><div class="cs-bar-f" id="csb-cog" style="width:0%;background:var(--g1)"></div></div></div>
      <div class="cs"><div class="cs-v am" id="cs-res">0</div><div class="cs-l">R√âSILIENCE</div><div class="cs-bar"><div class="cs-bar-f" id="csb-res" style="width:0%;background:var(--am)"></div></div></div>
      <div class="cs"><div class="cs-v l" id="cs-cri">0</div><div class="cs-l">ESPRIT CRITIQUE</div><div class="cs-bar"><div class="cs-bar-f" id="csb-cri" style="width:0%;background:var(--l1)"></div></div></div>
      <div class="cs"><div class="cs-v wm" id="cs-pre">0%</div><div class="cs-l">PR√âCISION</div><div class="cs-bar"><div class="cs-bar-f" id="csb-pre" style="width:0%;background:var(--wm)"></div></div></div>
      <div class="cs"><div class="cs-v rd" id="cs-str">0</div><div class="cs-l">STREAK MAX</div><div class="cs-bar"><div class="cs-bar-f" id="csb-str" style="width:0%;background:var(--rd)"></div></div></div>
      <div class="cs"><div class="cs-v" id="cs-ses">0</div><div class="cs-l">SESSIONS</div><div class="cs-bar"><div class="cs-bar-f" id="csb-ses" style="width:0%;background:var(--g1)"></div></div></div>
    </div>

    <!-- Augmentations -->
    <div class="char-augs">
      <div class="aug-label">AUGMENTATIONS COGNITIVES</div>
      <div class="aug-grid" id="aug-grid"></div>
    </div>
  </div>

  <!-- Identity -->
  <div class="setting-group">
    <div class="fl" style="margin-bottom:6px">IDENTIT√â</div>
    <div class="fg"><label class="fl">INDICATIF</label><input class="fin" id="set-name" placeholder="Votre indicatif" maxlength="24" oninput="saveProfile()"></div>
    <div class="fg"><label class="fl">TITRE / BIO</label><input class="fin" id="set-bio" placeholder="Votre titre..." maxlength="48" oninput="saveProfile()"></div>
    <div class="fg"><label class="fl">AVATAR EMOJI (sans photo)</label>
    <div class="emoji-grid" id="emoji-grid"></div></div>
  </div>

  <!-- Photo Filters -->
  <div class="setting-group" id="photo-settings" style="display:none">
    <div class="fl" style="margin-bottom:6px">FILTRE PHOTO</div>
    <div class="photo-filters" id="pf-btns"></div>
    <div style="display:flex;gap:6px;margin-top:8px">
      <button class="tbtn danger" onclick="clearPhoto()">‚úï Supprimer photo</button>
    </div>
  </div>

  <!-- Interface -->
  <div class="setting-group">
    <div class="fl" style="margin-bottom:6px">INTERFACE</div>
    <div class="setting-row"><div><div class="setting-label">Taille texte</div></div><div class="range-wrap"><input type="range" min="11" max="18" value="13" id="set-fs" oninput="applyFS()"><div class="range-val" id="set-fs-val">13</div></div></div>
    <div class="setting-row"><div><div class="setting-label">Vitesse flip</div></div><div class="range-wrap"><input type="range" min="1" max="8" value="4" id="set-flip" oninput="applyFlip()"><div class="range-val" id="set-flip-val">4</div></div></div>
    <div class="setting-row"><div><div class="setting-label">Mode compact</div></div><div class="toggle" id="set-compact" onclick="toggleSet('compact')"></div></div>
    <div class="setting-row"><div><div class="setting-label">Scanlines CRT</div></div><div class="toggle on" id="set-scan" onclick="toggleSet('scan')"></div></div>
  </div>

  <!-- Attention Economy -->
  <div class="setting-group">
    <div class="fl" style="margin-bottom:6px">‚ö†Ô∏è √âCONOMIE DE L'ATTENTION ‚Äî KILLSWITCH</div>
    <div class="setting-row"><div><div class="setting-label">Disclaimers (boutons !)</div><div class="setting-sub">R√©v√®le les techniques toxiques</div></div><div class="toggle on" id="set-disc" onclick="toggleSet('disc')"></div></div>
    <div class="setting-row"><div><div class="setting-label">Notification dot</div><div class="setting-sub">Interruption attentionnelle</div></div><div class="toggle on" id="set-notif" onclick="toggleSet('notif')"></div></div>
    <div class="setting-row"><div><div class="setting-label">Preuve sociale</div><div class="setting-sub">Compteur fabriqu√©</div></div><div class="toggle on" id="set-sp" onclick="toggleSet('sp')"></div></div>
    <div class="setting-row"><div><div class="setting-label">Combo √ó dopamine</div><div class="setting-sub">Boucle de renforcement</div></div><div class="toggle on" id="set-combo" onclick="toggleSet('combo')"></div></div>
    <div class="setting-row"><div><div class="setting-label">Loot boxes</div><div class="setting-sub">Ratio variable (Skinner)</div></div><div class="toggle on" id="set-loot" onclick="toggleSet('loot')"></div></div>
  </div>
  <div class="qt">Chaque m√©canique est document√©e dans l'encyclop√©die. Vous pouvez toutes les couper ‚Äî <strong style="color:var(--rd)">ce que les apps classiques ne vous permettent jamais.</strong><cite>‚Äî COGWAR // La transparence est un acte de r√©sistance</cite></div>
</section>

<section class="s" id="s-more">
  <div class="sh">Plus</div><div class="ss2">"Do you want to play a game?" ‚Äî Jigsaw / Joshua</div>
  <div style="display:flex;flex-direction:column;gap:6px;margin-bottom:12px">
    <div class="dki" style="cursor:pointer" onclick="go('profile')"><div class="dki-ico">ü§ñ</div><div><div class="dki-t">Dossier Agent</div><div class="dki-m">Fiche cyberpunk ¬∑ Photo ¬∑ Augmentations</div></div></div>
    <div class="dki" style="cursor:pointer" onclick="go('console')"><div class="dki-ico">‚å®</div><div><div class="dki-t">Console WOPR</div><div class="dki-m">Terminal de commande hacker</div></div></div>
    <div class="dki" style="cursor:pointer" onclick="openSearch()"><div class="dki-ico">üîç</div><div><div class="dki-t">Recherche Globale</div><div class="dki-m">Cartes, encyclop√©die, decks</div></div></div>
    <div class="dki" style="cursor:pointer" onclick="go('ency')"><div class="dki-ico">‚óà</div><div><div class="dki-t">Encyclop√©die</div><div class="dki-m">30 entr√©es sourc√©es</div></div></div>
    <div class="dki" style="cursor:pointer" onclick="go('ach')"><div class="dki-ico">‚òÖ</div><div><div class="dki-t">Achievements</div><div class="dki-m" id="ach-count">0 d√©bloqu√©s</div></div></div>
  </div>
  <div class="qt">¬´ Comprendre est le premier acte de r√©sistance. ¬ª<cite>‚Äî Manifeste du Prolotariat</cite></div>
  <div style="font-size:9px;color:var(--t3);margin-top:10px">Fork ¬∑ Hack ¬∑ Spread ¬∑ CC BY-NC 4.0<br><em style="color:var(--ld)">¬´ I Amar Prestar Aen ¬ª</em></div>
</section>

<section class="s" id="s-ency">
  <div style="display:flex;align-items:center;gap:6px;margin-bottom:8px"><button class="bi" onclick="go('more')">‚óÄ</button><div class="sh" style="margin:0">Encyclop√©die</div></div>
  <div class="esw"><input type="text" class="esr" id="esr" placeholder="Rechercher..." oninput="fltE()"></div>
  <div class="etg" id="etg"></div><div class="eg" id="eg"></div>
</section>

<section class="s" id="s-console">
  <div class="sh">Console WOPR</div><div class="ss2">"A STRANGE GAME. THE ONLY WINNING MOVE IS NOT TO PLAY." ‚Äî Joshua</div>
  <div class="console-wrap">
    <div class="console-bar">
      <div class="console-dots"><div class="console-dot r"></div><div class="console-dot y"></div><div class="console-dot g"></div></div>
      <div class="console-title">wopr@cogwar:~</div>
    </div>
    <div class="console-body" id="con-out"></div>
    <div class="console-input-row">
      <span class="console-prompt">wopr&gt;</span>
      <input class="console-in" id="con-in" placeholder="help" onkeydown="if(event.key==='Enter')conExec()" autocomplete="off" spellcheck="false">
    </div>
  </div>
</section>

<section class="s" id="s-ach">
  <div style="display:flex;align-items:center;gap:6px;margin-bottom:8px"><button class="bi" onclick="go('more')">‚óÄ</button><div class="sh" style="margin:0">Achievements</div></div>
  <div class="ag" id="ag"></div>
</section>

<footer class="ft">COGWAR // WOPR ULTIMATE // 235 cartes ¬∑ 30 entr√©es ¬∑ Store ¬∑ Console</footer>
</main>

<!-- Search FAB -->
<div class="search-fab" onclick="openSearch()">üîç</div>

<!-- Search Overlay -->
<div class="search-overlay" id="search-ov">
  <div class="search-top">
    <input class="search-input" id="search-in" placeholder="Rechercher cartes, encyclop√©die, decks..." oninput="doSearch()" autocomplete="off" autofocus>
    <button class="search-close" onclick="closeSearch()">‚úï</button>
  </div>
  <div class="search-filters">
    <div class="sf-btn on" data-sf="all" onclick="setSF('all',this)">Tout</div>
    <div class="sf-btn" data-sf="cards" onclick="setSF('cards',this)">Flashcards</div>
    <div class="sf-btn" data-sf="ency" onclick="setSF('ency',this)">Encyclop√©die</div>
    <div class="sf-btn" data-sf="decks" onclick="setSF('decks',this)">Decks</div>
  </div>
  <div class="sr-count" id="sr-count"></div>
  <div class="search-results" id="sr-list">
    <div class="sr-empty"><div class="sr-e-ico">üîç</div>Tapez pour rechercher dans tout COGWAR</div>
  </div>
</div>
<nav class="bn"><button class="nb on" data-s="home" onclick="go('home',this)"><span class="ic">‚¨°</span>HOME</button><button class="nb" data-s="play" onclick="go('play',this)"><span class="ic">‚ö°</span>PLAY</button><button class="nb" data-s="lib" onclick="go('lib',this)"><span class="ic">‚óß</span>DECKS</button><button class="nb" data-s="store" onclick="go('store',this)"><span class="ic">‚¨¢</span>STORE</button><button class="nb" data-s="more" onclick="go('more',this)"><span class="ic">‚ò∞</span>PLUS</button></nav>
</div>

<!-- Modals -->
<div class="mo" id="mo-dk"><div class="mo-in"><div class="mo-hd"><div class="mo-t" id="mdk-t">‚úèÔ∏è Nouveau Deck</div><button class="mo-x" onclick="cmo('mo-dk')">‚úï</button></div><div class="mo-bd">
  <div class="fg"><label class="fl">NOM DU DECK</label><input class="fin" id="dk-n" placeholder="Ex: Biais Cognitifs"></div>
  <div class="fg"><label class="fl">IC√îNE (emoji)</label><input class="fin" id="dk-i" placeholder="üß†" maxlength="4" style="width:60px"></div>
  <div class="fg"><label class="fl">DIFFICULT√â</label><select class="fin" id="dk-d"><option value="1">üü¢ Initiation</option><option value="2">üü† Interm√©diaire</option><option value="3">üî¥ Expert</option></select></div>
  <div class="fg"><label class="fl">DESCRIPTION</label><textarea class="fin" id="dk-desc" rows="2" placeholder="D√©crivez le contenu..."></textarea></div>
  <div class="fg"><label class="fl">TAGS (s√©par√©s par des virgules)</label><input class="fin" id="dk-tg" placeholder="guerre-cognitive, niveau-1"></div>
  <div style="display:flex;gap:8px;margin-top:16px"><button class="tbtn" onclick="saveDk()" style="font-size:11px;padding:10px 24px">üíæ Sauvegarder</button><button class="tbtn sec" onclick="cmo('mo-dk')" style="font-size:11px;padding:10px 24px">Annuler</button></div>
</div></div></div>

<div class="mo" id="mo-cd"><div class="mo-in"><div class="mo-hd"><div class="mo-t" id="mcd-t">üÉè Cartes</div><button class="mo-x" onclick="cmo('mo-cd')">‚úï</button></div><div class="mo-bd">
  <div class="toolbar"><button class="tbtn" onclick="cardForm()" style="font-size:10px;padding:8px 16px">+ Nouvelle Carte</button><button class="tbtn sec" onclick="expDk()" style="font-size:10px;padding:8px 16px">‚¨á Exporter Deck</button></div>
  <div id="cd-list"></div>
  <div id="cd-empty" class="empty" style="display:none"><div class="empty-i">üÉè</div>Aucune carte dans ce deck.<br>Ajoutez-en avec le bouton ci-dessus.</div>
</div></div></div>

<div class="mo" id="mo-cf"><div class="mo-in"><div class="mo-hd"><div class="mo-t" id="mcf-t">‚úèÔ∏è Nouvelle Carte</div><button class="mo-x" onclick="cmo('mo-cf')">‚úï</button></div><div class="mo-bd">
  <div class="fg"><label class="fl">QUESTION</label><textarea class="fin" id="cf-q" rows="4" placeholder="Tapez votre question ici..."></textarea></div>
  <div class="fg"><label class="fl">R√âPONSE</label><textarea class="fin" id="cf-a" rows="4" placeholder="Tapez la r√©ponse ici..."></textarea></div>
  <div style="display:flex;gap:8px;margin-top:16px"><button class="tbtn" onclick="saveCd()" style="font-size:11px;padding:10px 24px">üíæ Sauvegarder</button><button class="tbtn sec" onclick="cmo('mo-cf')" style="font-size:11px;padding:10px 24px">Annuler</button></div>
</div></div></div>

<div class="mo" id="mo-en"><div class="mo-in"><div class="mo-hd"><div class="mo-t" id="me-t"></div><button class="mo-x" onclick="cmo('mo-en')">‚úï</button></div><div class="mo-bd emo" id="me-bd"></div><div class="emo-ft"><div style="display:flex;gap:4px"><button class="bi" onclick="meP()">‚óÄ</button><button class="bi" onclick="meN()">‚ñ∂</button></div><button class="tbtn" id="me-cl" onclick="meC()">+25 XP</button></div></div></div>

<div class="combo-overlay" id="combo-ov"></div>

<div class="tc" id="tc"></div>
<script>
const BUILTIN_DECKS = [{"id": "gc-fondamentaux", "name": "Guerre Cognitive ‚Äî Fondamentaux", "author": "COGWAR", "difficulty": 1, "icon": "üß†", "description": "Concepts fondamentaux de la guerre cognitive : d√©finitions, acteurs, m√©canismes de base.", "tags": ["guerre-cognitive", "niveau-1"], "version": 1, "cards": [{"q": "Quel est le concept d√©signant l'esprit humain comme le nouveau champ de bataille du XXIe si√®cle ?", "a": "Le sixi√®me domaine de la guerre (ou domaine cognitif)."}, {"q": "Quelle est la cible principale de la guerre de l'information par rapport √† la guerre cognitive ?", "a": "L'information cible le flux de donn√©es, tandis que la cognitive cible le traitement de ces donn√©es."}, {"q": "Quel objectif l'OTAN a-t-elle d√©fini dans son 'Innovation Hub' pour prot√©ger les processus d√©mocratiques ?", "a": "La sup√©riorit√© cognitive (Cognitive Superiority)."}, {"q": "L'approche russe de la guerre cognitive privil√©gie la _____ pour paralyser la volont√© politique adverse.", "a": "d√©sinformation syst√©matique"}, {"q": "Quelle puissance g√©opolitique s'oriente vers une 'guerre cognitive algorithmique' utilisant l'IA ?", "a": "La Chine."}, {"q": "Quel est l'effet de la 'stimulation r√©p√©t√©e' sur le cerveau lors du traitement d'une information fausse ?", "a": "Elle r√©duit le co√ªt psychologique du traitement, facilitant son acceptation subconsciente."}, {"q": "Comment appelle-t-on le signal envoy√© par le cerveau lorsqu'une information contredit des croyances profondes ?", "a": "Le signal d'erreur."}, {"q": "Quel organe c√©r√©bral est privil√©gi√© par les narratifs √©motionnels au d√©triment du cortex pr√©frontal ?", "a": "L'amygdale."}, {"q": "Quel est l'objectif d'un 'strat√®ge du chaos' concernant les dirigeants politiques adverses ?", "a": "Les convaincre qu'aucune solution stable ou √©tat final n'est possible."}, {"q": "Le ph√©nom√®ne o√π les individus rejettent toute information contredisant leur narratif de groupe est la _____.", "a": "fermeture √©pist√©mique"}, {"q": "Dans le mod√®le chinois en six √©tapes, que signifie le 'Portrait de l'utilisateur' ?", "a": "L'identification des cibles et l'analyse de leur √©tat psychologique par le Big Data."}, {"q": "Quelle est la quatri√®me √©tape du mod√®le de manipulation chinois ?", "a": "L'induction de r√©action (enfermement dans des chambres d'√©cho)."}, {"q": "Quel est le moteur principal de polarisation dans les plateformes num√©riques selon le texte ?", "a": "Les algorithmes de recommandation."}, {"q": "Selon l'analogie de la th√©orie du chaos, qu'est-ce que l'effet papillon appliqu√© √† l'information ?", "a": "Une simple rumeur inject√©e au bon moment peut d√©clencher une crise nationale."}, {"q": "Dans l'attracteur de Lorenz appliqu√© √† la cognition, que repr√©sente le param√®tre $\\rho$ ?", "a": "Le niveau de m√©fiance publique."}, {"q": "Dans l'attracteur de Lorenz appliqu√© √† la cognition, que repr√©sente le param√®tre $\\sigma$ ?", "a": "La v√©locit√© de l'information."}, {"q": "Quel est le cadre de r√©f√©rence pour la prise de d√©cision militaire vis√© par la guerre cognitive ?", "a": "La boucle OODA (Observation, Orientation, D√©cision, Action)."}, {"q": "Selon Dave Snowden, dans quel √©tat d'environnement la boucle OODA s'effondre-t-elle ?", "a": "L'√©tat chaotique (pas de relation cause-effet visible)."}, {"q": "Dans le mod√®le SIR appliqu√© aux rumeurs, que repr√©sente la cat√©gorie 'P' ?", "a": "Les Propagateurs."}, {"q": "Dans le mod√®le SIR appliqu√© aux rumeurs, que repr√©sente la cat√©gorie 'E' ?", "a": "Les √âtouffeurs (individus ayant cess√© de diffuser l'information)."}, {"q": "Quelle est la formule du nombre de reproduction de base $R_0$ pour une rumeur ?", "a": "$R_0 = \\frac{\\beta N}{\\alpha + \\gamma + \\mu}$"}, {"q": "Que repr√©sente le param√®tre $\\beta$ dans le mod√®le de propagation d'une rumeur ?", "a": "Le taux de transmission (virilit√© de l'information)."}, {"q": "Que repr√©sente le param√®tre $\\gamma$ dans le mod√®le de propagation d'une rumeur ?", "a": "Le taux de r√©cup√©ration suite √† une v√©rification des faits (fact-checking)."}, {"q": "Quel param√®tre induit une instabilit√© chaotique dans la propagation s'il repr√©sente le temps de r√©flexion ?", "a": "Le d√©lai temporel (not√© $\\tau$)."}, {"q": "Comment appelle-t-on la capacit√© d'un syst√®me √† maintenir l'initiative et √† s'adapter pendant une perturbation ?", "a": "La r√©silience dynamique (ou op√©rationnelle)."}, {"q": "Concept : Graceful Extensibility", "a": "D√©finition : Capacit√© d'un syst√®me √† √©tendre ses r√©ponses au-del√† de ses limites normales sous pression."}, {"q": "Quelle strat√©gie consiste √† engager les adversaires dans leurs propres r√©seaux avant qu'ils n'attaquent ?", "a": "La d√©fense avanc√©e (Defend Forward)."}, {"q": "Quel est le pilier de d√©fense cognitive √† long terme bas√© sur la sensibilisation aux biais ?", "a": "L'immunisation mentale (ou √©ducation)."}, {"q": "Dans la th√©orie de Miller, quels sont les deux types de dommages sp√©cifiques √† la guerre cognitive ?", "a": "Les dommages psychologiques aux humains et les dommages aux institutions."}, {"q": "Quelle th√©orie russe vise √† amener l'adversaire √† prendre une d√©cision pr√©d√©termin√©e en croyant agir librement ?", "a": "La th√©orie du contr√¥le r√©flexif (Reflexive Control)."}, {"q": "Les 'Trois Warfares' de la doctrine chinoise incluent la guerre psychologique, la guerre de l'opinion et la _____.", "a": "guerre juridique"}, {"q": "Dans le mod√®le Cynefin, quel m√©canisme correspond √† un environnement 'Complexe' ?", "a": "Sonder - Percevoir - R√©pondre."}, {"q": "Quel est le danger du 'dilemme du prisonnier' appliqu√© √† la censure d'√âtat ?", "a": "Perdre la confiance de la population et la pousser vers des sources radicales."}, {"q": "Qu'est-ce que le 'MRT-C' dans le cadre de la s√©curit√© nationale ?", "a": "Mission-Relevant Terrain in Cyberspace (infrastructures virtuelles critiques)."}, {"q": "Quel syndrome de 2016 illustre l'usage possible de technologies invasives contre le syst√®me nerveux ?", "a": "Le syndrome de La Havane."}, {"q": "Quel est l'objectif des 'Op√©rations bas√©es sur les effets' (EBO) ?", "a": "Paralyser le leadership de l'int√©rieur en attaquant ses structures de commandement."}, {"q": "Comment l'IA transforme-t-elle la manipulation de l'information selon le texte ?", "a": "Elle transforme la manipulation artisanale en une industrie de pr√©cision personnalis√©e."}, {"q": "Quelle est l'√©quation fondamentale du risque de protection ?", "a": "$Risque = \\frac{Menace \\times Vuln√©rabilit√©}{Capacit√©}$"}, {"q": "Dans l'analyse de protection, quel facteur repr√©sente les ressources d'une communaut√© pour pr√©venir une menace ?", "a": "La Capacit√©."}, {"q": "Quelles √©taient les motivations principales de la LRA en Ouganda pour le recrutement d'enfants ?", "a": "Croyances politiques et religieuses du chef (Kony)."}, {"q": "Exemple de 'Vuln√©rabilit√©' dans le cas du recrutement forc√© d'enfants en Ouganda :", "a": "Le manque d'endroits o√π se cacher, particuli√®rement la nuit."}, {"q": "Quelle action de la part des familles ougandaises a augment√© leur 'Capacit√©' face aux enl√®vements ?", "a": "L'envoi des enfants dans des villes √©loign√©es (comme Kampala)."}, {"q": "Quel est l'impact de la guerre cognitive sur la 'personnalit√© cognitive' √† long terme ?", "a": "Elle modifie durablement la mani√®re dont un individu traite l'information."}, {"q": "Pourquoi les √©lecteurs √©motionnellement instables sont-ils plus vuln√©rables aux algorithmes ?", "a": "Ils sont plus r√©ceptifs aux contenus surprenants et n√©gatifs qui les poussent vers les extr√™mes."}, {"q": "Le terme 'Neuro-guerre' est souvent associ√© √† quelle g√©n√©ration de conflits ?", "a": "La sixi√®me g√©n√©ration."}, {"q": "Quel organe de l'OTAN est sp√©cifiquement charg√© du concept de 'Warfighting Capstone Concept' ?", "a": "Le NATO Allied Command Transformation (ACT)."}, {"q": "Quelle est l'√©tape finale du mod√®le de manipulation chinois ?", "a": "La supervision de la gratification (renforcement de l'enfermement cognitif)."}, {"q": "D√©finition : Guerre Cognitive (selon le groupe Gecko)", "a": "Domaine cherchant √† corrompre ou annihiler les m√©canismes de pens√©e et de d√©cision par une approche scientifique."}, {"q": "Dans la dynamique des r√©seaux, qu'est-ce que l'homophilie ?", "a": "La tendance des individus √† se connecter √† ceux qui partagent leurs croyances."}, {"q": "Quel outil math√©matique permet de pr√©dire si une rumeur va saturer une population ?", "a": "Le nombre de reproduction de base $R_0$."}, {"q": "Pourquoi le micro-ciblage psychographique est-il consid√©r√© comme le 'carburant' de la guerre algorithmique ?", "a": "Il permet de g√©n√©rer des messages exploitant les biais et peurs sp√©cifiques d'un individu."}, {"q": "Quelle est la cons√©quence strat√©gique de la 'Weaponization of Identity' ?", "a": "L'√©rosion de l'unit√© nationale et l'exploitation des clivages identitaires."}, {"q": "Que signifie l'attribut 'Technology' dans la d√©finition de la guerre cognitive ?", "a": "L'usage de moyens technologiques (IA, Big Data) pour amplifier les effets des attaques cognitives."}, {"q": "Quel type de r√©silience est d√©fini comme 'l'adaptabilit√© soutenue' ?", "a": "La capacit√© √† ajuster continuellement ses d√©fenses √† travers plusieurs cycles de stress."}, {"q": "Dans le cas de la LRA, quel m√©canisme international a √©t√© mis en place pour surveiller les violations ?", "a": "Le m√©canisme de surveillance et de communication de l'information (MRM) de l'ONU."}, {"q": "Quel est le risque syst√©mique associ√© √† une attaque r√©ussie sur la 'confiance' publique ?", "a": "Une crise de liquidit√© ou un effondrement des services essentiels par effet domino."}, {"q": "Dans le mod√®le SIR, que repr√©sente le param√®tre $\\mu$ ?", "a": "Le taux de sortie naturelle (ou perte d'int√©r√™t) de la population."}, {"q": "Pourquoi est-il difficile de d√©finir juridiquement un 'acte de guerre' cognitive ?", "a": "Parce qu'il s'agit de manipulations psychologiques se situant sous le seuil cin√©tique (zone grise)."}, {"q": "Quelle est l'implication strat√©gique de la 'souverainet√©' dans le domaine neuro-cognitif ?", "a": "La d√©fense de l'√âtat ne se fait plus aux fronti√®res physiques mais dans l'esprit des citoyens."}, {"q": "Le but de la 'Weaponization of Narratives' est d'alt√©rer la perception de la _____ historique.", "a": "m√©moire"}, {"q": "Quel est le r√¥le des 'Usines √† trolls' dans la doctrine russe ?", "a": "Diffuser massivement des narratifs subversifs pour cr√©er une paralysie politique chez l'adversaire."}, {"q": "En environnement 'Ordonn√©', quel est le m√©canisme d√©cisionnel appropri√© ?", "a": "Percevoir - Cat√©goriser - R√©pondre."}, {"q": "Comment la guerre cognitive impacte-t-elle l'√©tape d'Orientation de la boucle OODA ?", "a": "En biaisant la compr√©hension de la situation par des perceptions d√©form√©es."}, {"q": "Qu'est-ce qu'un 'cocon s√©mantique' ?", "a": "Un environnement informationnel ferm√© o√π l'individu n'est expos√© qu'√† des id√©es confirmant ses pr√©jug√©s."}, {"q": "Quelle caract√©ristique de la soci√©t√© ouverte est consid√©r√©e comme son 'talon d'Achille' par le strat√®ge du chaos ?", "a": "La transparence et la libert√© d'expression."}, {"q": "Dans le mod√®le de risque syst√©mique, quelle √©tape suit le 'Choc' initial ?", "a": "L'Amplification (propagation rapide et perte de confiance)."}, {"q": "Quel est le but de la 'Supervision de la gratification' dans la manipulation IA ?", "a": "Utiliser les signaux sociaux (likes, partages) pour valider et renforcer le nouveau cadre de pens√©e."}, {"q": "Quel est le principal d√©fi de la r√©gulation des plateformes num√©riques face √† la d√©sinformation ?", "a": "√âviter de d√©river vers une censure qui reproduirait les tactiques autoritaires."}, {"q": "L'incertitude induite par le stress cognitif pousse l'individu vers des r√©actions _____ plut√¥t que rationnelles.", "a": "√©motionnelles"}, {"q": "Dans le mod√®le SIR, que se passe-t-il si $R_0 < 1$ ?", "a": "La propagation de la rumeur s'√©teint naturellement."}, {"q": "Concept : Reflexive Control", "a": "Strat√©gie russe visant √† influencer les perceptions de l'adversaire pour qu'il agisse volontairement contre ses propres int√©r√™ts."}, {"q": "Quel est le lien entre populisme et guerre cognitive selon le texte de l'OTAN ?", "a": "Le populisme peut √™tre √† la fois un sympt√¥me de m√©contentement et un r√©sultat de succ√®s d'attaques cognitives ennemies."}, {"q": "Pourquoi la 'litt√©ratie informationnelle' est-elle un facteur de protection ?", "a": "Elle permet aux citoyens d'identifier les manipulations et l'inauthenticit√© des sources."}, {"q": "Dans la gestion de crise de la LRA, quelle action a √©t√© men√©e par les chefs religieux ?", "a": "La n√©gociation pour la lib√©ration des enfants de moins de 16 ans."}, {"q": "Quel est l'objectif des 'simulations cognitives' pour les d√©cideurs ?", "a": "Les former √† reconna√Ætre les op√©rations d'influence et √† r√©guler leurs √©motions sous stress."}, {"q": "Comment l'IA g√©n√©rative est-elle utilis√©e dans l'√©tape 'Attraction de l'attention' ?", "a": "Pour cr√©er des deepfakes ou articles qui d√©stabilisent le cadre cognitif existant de la cible."}, {"q": "Quel param√®tre de l'√©quation de Lorenz repr√©sente la variation de la stabilit√© vers le chaos ?", "a": "Une variation infinit√©simale de $\\sigma$, $\\rho$ ou $\\beta$."}, {"q": "La 'Mission-Relevant Terrain in Cyberspace' inclut des infrastructures qui peuvent √™tre _____.", "a": "hors de contr√¥le gouvernemental (priv√©es)"}, {"q": "Quel type de pr√©judice Miller associe-t-il sp√©cifiquement aux institutions ?", "a": "L'√©rosion de la l√©gitimit√© et de la confiance institutionnelle."}, {"q": "Terme : Cognitive Superiority", "a": "Imp√©ratif de l'OTAN visant √† out-think l'adversaire en ma√Ætrisant mieux l'environnement d√©cisionnel."}], "source": "builtin"}, {"id": "gc-doctrines", "name": "Guerre Cognitive ‚Äî Doctrines & Strat√©gies", "author": "COGWAR", "difficulty": 2, "icon": "üåç", "description": "Doctrines g√©opolitiques, mod√©lisation math√©matique et m√©canismes avanc√©s.", "tags": ["guerre-cognitive", "niveau-2"], "version": 1, "cards": [{"q": "Quel est le concept d√©signant l'esprit humain comme nouvel espace de conflictualit√© ?", "a": "Le \"sixi√®me domaine de la guerre\"."}, {"q": "Quelle est la diff√©rence fondamentale entre la guerre de l'information et la guerre cognitive ?", "a": "L'information cible le flux de donn√©es, tandis que le cognitif cible la mani√®re dont le cerveau traite ces donn√©es."}, {"q": "Selon l'OTAN, quel est l'objectif principal du \"Warfighting Capstone Concept\" de 2021 ?", "a": "Atteindre la \"sup√©riorit√© cognitive\"."}, {"q": "Dans la doctrine russe, quel terme d√©signe la manipulation du processus de d√©cision de l'adversaire ?", "a": "Le \"Reflexive Control\" (Contr√¥le r√©flexif)."}, {"q": "Quel pays privil√©gie la \"guerre cognitive algorithmique\" bas√©e sur l'IA et le Big Data ?", "a": "La Chine."}, {"q": "Expliquez l'effet de la \"stimulation r√©p√©t√©e\" sur le traitement c√©r√©bral d'une information fausse.", "a": "Elle r√©duit le co√ªt psychologique du traitement, facilitant l'acceptation subconsciente de l'erreur."}, {"q": "Quel m√©canisme neurobiologique la guerre cognitive sature-t-elle pour cr√©er une incertitude permanente ?", "a": "Le \"signal d'erreur\"."}, {"q": "Dans le cadre de l'influence √©motionnelle, quelle structure c√©r√©brale est favoris√©e au d√©triment du cortex pr√©frontal ?", "a": "L'amygdale."}, {"q": "Quel est l'objectif ultime du \"strat√®ge du chaos\" dans une guerre asym√©trique ?", "a": "Convaincre les dirigeants adverses qu'aucun √©tat final stable n'est possible."}, {"q": "D√©finissez le concept de \"fermeture √©pist√©mique\" dans les r√©seaux sociaux.", "a": "Le rejet syst√©matique de toute information contredisant le narratif dominant du groupe."}, {"q": "Quelle est la premi√®re √©tape du mod√®le chinois en six √©tapes pour fa√ßonner la cognition ?", "a": "Le portrait de l'utilisateur via l'analyse psychologique par le Big Data."}, {"q": "Dans le mod√®le chinois, quel est le but de la \"supervision de la gratification\" ?", "a": "Renforcer l'enfermement dans un nouveau cadre cognitif via la mesure de la gratification sociale."}, {"q": "Quel est l'impact principal des algorithmes de recommandation sur la diversit√© d'opinion ?", "a": "Ils cr√©ent des \"chambres d'√©cho\" en limitant l'exposition aux points de vue divergents."}, {"q": "Selon la th√©orie du chaos, qu'est-ce que la \"sensibilit√© aux conditions initiales\" ?", "a": "Le fait que de petites perturbations (ex: rumeur) puissent entra√Æner des cons√©quences nationales disproportionn√©es."}, {"q": "Donnez l'√©quation de l'√©volution de la variable $x$ dans l'attracteur de Lorenz.", "a": "$\\frac{dx}{dt} = \\sigma(y - x)$."}, {"q": "Quel param√®tre de l'attracteur de Lorenz symbolise le niveau de m√©fiance publique en guerre cognitive ?", "a": "Le param√®tre $\\rho$."}, {"q": "Quelles sont les quatre √©tapes de la boucle OODA ?", "a": "Observation, Orientation, D√©cision, Action."}, {"q": "Dans quel domaine du cadre de Snowden la boucle OODA s'effondre-t-elle ?", "a": "Dans les domaines \"complexe\" ou \"chaotique\"."}, {"q": "Dans le mod√®le √©pid√©miologique SIR appliqu√© aux rumeurs, que signifie la cat√©gorie 'E' ?", "a": "Les \"√âtouffeurs\" (individus ayant cess√© de diffuser l'information)."}, {"q": "Quelle est la formule du nombre de reproduction de base $R_0$ pour une rumeur ?", "a": "$R_0 = \\frac{\\beta N}{\\alpha + \\gamma + \\mu}$."}, {"q": "Que repr√©sente le param√®tre $\\beta$ dans le mod√®le de propagation des rumeurs ?", "a": "Le taux de transmission ou la viralit√© de l'information."}, {"q": "Quel est l'effet de l'introduction d'un d√©lai temporel $\\tau$ dans les mod√®les de propagation ?", "a": "Il peut induire des oscillations chaotiques et des r√©surgences brutales de rumeurs."}, {"q": "D√©finissez la \"r√©silience dynamique\" (ou op√©rationnelle).", "a": "La capacit√© de combattre √† travers la perturbation et de maintenir l'initiative sous stress."}, {"q": "Qu'est-ce que l'\"extensibilit√© gracieuse\" (Graceful Extensibility) ?", "a": "La capacit√© d'un syst√®me √† √©tendre ses capacit√©s de r√©ponse au-del√† de ses limites normales."}, {"q": "Quel terme d√©signe les infrastructures virtuelles critiques hors contr√¥le gouvernemental ?", "a": "La \"Mission-Relevant Terrain in Cyberspace\" (MRT-C)."}, {"q": "En quoi consiste la strat√©gie de \"d√©fense avanc√©e\" (Defend Forward) ?", "a": "Engager l'adversaire dans ses propres r√©seaux pour perturber ses capacit√©s avant l'attaque."}, {"q": "Quel est le dilemme du prisonnier appliqu√© √† la censure d'√âtat ?", "a": "Une restriction excessive peut entra√Æner la perte de confiance et pousser la population vers la propagande radicale."}, {"q": "Comment Bernard Claverie d√©finit-il les sciences cognitives \"dures\" ?", "a": "Des disciplines non interpr√©tatives qui √©tudient la pens√©e comme un objet mat√©riel (neurosciences, IA, etc.)."}, {"q": "Qu'est-ce que le \"syndrome de La Havane\" ?", "a": "Des sympt√¥mes incapacitants suspects chez des diplomates, attribu√©s √† des rayonnements ciblant le syst√®me nerveux."}, {"q": "Quel est l'objectif du projet Gecko ?", "a": "D√©velopper des dispositifs d'exploration de la guerre cognitive via des crises fictives."}, {"q": "Dans l'√©quation du risque de protection, quels sont les trois facteurs d√©terminants ?", "a": "Les Menaces, les Vuln√©rabilit√©s et les Capacit√©s."}, {"q": "√âquation : Risque de protection", "a": "$Risque = \\frac{Menaces \\times Vuln\\acute{e}rabilit\\acute{e}s}{Capacit\\acute{e}}$."}, {"q": "Quelle est la diff√©rence entre un vecteur traditionnel et un vecteur technologique existant ?", "a": "Le traditionnel utilise les m√©dias de masse (presse, TV), l'existant utilise les r√©seaux sociaux et le Big Data."}, {"q": "Citez deux exemples de vecteurs technologiques \"√©mergents\" en guerre cognitive.", "a": "Les Deepfakes (m√©dias synth√©tiques) et les neuro-armes."}, {"q": "Quels sont les trois d√©clencheurs (triggers) de vuln√©rabilit√© individuelle √† la manipulation ?", "a": "L'inflexibilit√© cognitive, le besoin d'appartenance sociale et l'excitation √©motionnelle."}, {"q": "Comment l'adversaire \"militarise-t-il\" l'identit√© (Weaponize Identity) ?", "a": "En exploitant les affiliations culturelles ou nationales pour cibler des groupes sp√©cifiques."}, {"q": "Quel r√¥le joue la \"m√©moire historique\" dans la guerre cognitive ?", "a": "Elle sert de base √† la cr√©ation de narratifs manipul√©s pour modifier la perception de soi des nations."}, {"q": "Quelle est la d√©finition de la \"menace\" dans l'analyse de protection ?", "a": "Une force externe (autorit√©, groupe arm√©) motiv√©e par des facteurs politiques ou √©conomiques."}, {"q": "Donnez un exemple de \"m√©canisme d'adaptation\" communautaire face √† une menace.", "a": "L'envoi d'enfants vers des villes s√ªres ou la n√©gociation par des chefs religieux."}, {"q": "Quel est le but des \"pare-feu cognitifs\" ?", "a": "Identifier et bloquer les manipulations algorithmiques en temps r√©el au niveau √©tatique."}, {"q": "Dans le cadre de l'analyse de l'OTAN, qu'est-ce que la \"6-Outs\" ?", "a": "Un ensemble de fonctions (out-think, out-fight, etc.) pour maintenir l'avantage militaire."}, {"q": "D√©finition : Guerre hybride (selon Hung & Hung)", "a": "Un cadre global o√π la guerre cognitive est une composante subordonn√©e ax√©e sur les effets mentaux."}, {"q": "Quelle est la caract√©ristique majeure de la \"zone grise\" de conflictualit√© ?", "a": "Elle se situe sous le seuil de l'agression militaire directe et de la l√©galit√© internationale."}, {"q": "Pourquoi la \"fermeture √©pist√©mique\" rend-elle une soci√©t√© ingouvernable ?", "a": "Parce qu'elle emp√™che tout consensus bas√© sur des faits rationnels partag√©s."}, {"q": "Quel est le r√¥le de l'IA g√©n√©rative dans l'√©tape d'attraction de l'attention ?", "a": "Cr√©er des contenus qui d√©sar√ßonnent le cadre cognitif existant de la cible."}, {"q": "Selon Dave Snowden, quelle action doit-on privil√©gier dans un environnement \"chaotique\" ?", "a": "Agir - Percevoir - R√©pondre."}, {"q": "Dans le cadre SIR, que se passe-t-il si $R_0 > 1$ ?", "a": "La rumeur se propage de mani√®re exponentielle au sein de la population."}, {"q": "D√©finissez l'\"homophilie de r√©seau\".", "a": "La tendance des individus √† se connecter uniquement √† ceux qui partagent leurs croyances."}, {"q": "Quel est le risque li√© aux \"syst√®mes h√©rit√©s\" (legacy systems) en p√©riode de crise syst√©mique ?", "a": "Ils sont souvent mal prot√©g√©s et exacerbent la vuln√©rabilit√© globale de l'√âtat."}, {"q": "Pourquoi l'√©ducation est-elle consid√©r√©e comme une \"immunisation mentale\" ?", "a": "Elle sensibilise aux biais cognitifs et aux techniques de manipulation, renfor√ßant la r√©silience √† long terme."}, {"q": "L'analyse int√©gr√©e sugg√®re que la victoire appartiendra √† celui qui saura le mieux _____", "a": "Naviguer et orchestrer le chaos."}, {"q": "Citez une diff√©rence entre la conception de la CW par Miller et celle de l'OTAN.", "a": "Miller la voit sous le seuil de la guerre conventionnelle, tandis que l'OTAN y inclut des activit√©s cin√©tiques."}, {"q": "Qu'est-ce que la \"domination cognitive\" dans la doctrine chinoise ?", "a": "Le contr√¥le des croyances et la reconfiguration des matrices de sens de l'adversaire."}, {"q": "Quel est l'effet des \"contagions cognitives\" sur les r√©seaux sociaux ?", "a": "Elles propagent des id√©ologies charg√©es d'√©motions de mani√®re virale pour polariser la soci√©t√©."}, {"q": "Dans le cadre de Snowden, quel m√©canisme est adapt√© √† un environnement \"ordonn√©/simple\" ?", "a": "Percevoir - Cat√©goriser - R√©pondre."}, {"q": "Pourquoi le micro-ciblage psychographique est-il plus efficace que le marketing traditionnel ?", "a": "Il exploite les peurs et biais sp√©cifiques de chaque individu gr√¢ce aux donn√©es massives."}, {"q": "L'\"effet papillon\" appliqu√© √† l'information signifie qu'une rumeur peut d√©clencher _____", "a": "Une r√©action en cha√Æne aboutissant √† une crise nationale."}, {"q": "Quel est le danger de la \"saturation par le volume de donn√©es\" sur la d√©cision ?", "a": "Elle paralyse le d√©cideur en rendant l'analyse impossible (environnement compliqu√©)."}, {"q": "Comment l'agresseur utilise-t-il le \"cocon s√©mantique\" ?", "a": "En enfermant l'individu dans un flux d'informations qui confirme uniquement ses pr√©jug√©s."}, {"q": "Qu'est-ce qu'une op√©ration cognitive \"√† bas bruit\" ?", "a": "Une op√©ration sur le temps long modifiant les habitudes de pens√©e de mani√®re quasi-irr√©versible."}, {"q": "Quel est le r√¥le des \"usines √† trolls\" dans la strat√©gie russe ?", "a": "Diffuser massivement de la d√©sinformation pour attiser les divisions internes."}, {"q": "Pourquoi la transparence des soci√©t√©s d√©mocratiques est-elle un \"talon d'Achille\" ?", "a": "Elle offre une surface d'attaque maximale pour l'injection de d√©sordre et de paralysie."}, {"q": "Le mod√®le √©pid√©miologique de rumeur divise la population en : I (Ignorants), P (Propagateurs) et _____", "a": "E (√âtouffeurs)."}, {"q": "Qu'implique la \"perte de la souverainet√© cognitive\" d'un √âtat ?", "a": "L'incapacit√© √† prot√©ger l'esprit de ses citoyens contre des influences √©trang√®res hostiles."}, {"q": "Quel est le lien entre instabilit√© √©motionnelle et r√©ceptivit√© algorithmique ?", "a": "L'instabilit√© augmente la r√©ceptivit√© aux contenus n√©gatifs, poussant vers les extr√™mes politiques."}, {"q": "Dans la th√©orie des syst√®mes, que provoque la neutralisation d'un n≈ìud critique ?", "a": "Un effondrement de la r√©troaction et une chute de la structure enti√®re par effet domino."}, {"q": "Quelle est la fonction du param√®tre $\\sigma$ dans l'attracteur de Lorenz appliqu√© √† l'information ?", "a": "La v√©locit√© de l'information."}, {"q": "Comment d√©finit-on un \"risque syst√©mique global\" li√© au cyber ?", "a": "Un incident dont l'amplification par les r√©seaux menace la stabilit√© de l'√âtat ou des finances."}, {"q": "Quel est l'objectif des simulations cognitives pour les d√©cideurs ?", "a": "Apprendre √† maintenir leur r√©gulation √©motionnelle sous stress et reconna√Ætre les manipulations."}, {"q": "La guerre cognitive vise √† alt√©rer non seulement ce que les gens pensent, mais aussi _____", "a": "La fa√ßon dont ils pensent."}, {"q": "Quels types de narratifs la Russie utilise-t-elle en Afrique ?", "a": "Des narratifs historiques et conspirationnistes."}, {"q": "Dans le mod√®le SIR, que repr√©sente le param√®tre $\\gamma$ ?", "a": "Le taux de r√©cup√©ration suite √† une v√©rification des faits (fact-checking)."}, {"q": "Qu'est-ce qu'une bifurcation dans un syst√®me dynamique chaotique ?", "a": "Un basculement d'un √©tat stable vers un comportement oscillatoire ou d√©sordonn√©."}, {"q": "Quel est l'imp√©ratif de d√©fense face √† la menace MRT-C ?", "a": "Prot√©ger les infrastructures virtuelles m√™me si elles appartiennent au secteur priv√©."}, {"q": "Comment la manipulation des √©motions court-circuite-t-elle la raison ?", "a": "En favorisant des comportements impulsifs et pr√©visibles via l'activation de l'amygdale."}, {"q": "Selon le document, la guerre cognitive est une transition vers la _____", "a": "Sixi√®me g√©n√©ration de guerre ou neuro-guerre."}, {"q": "Pourquoi l'incertitude d√©grade-t-elle la capacit√© de d√©cision ?", "a": "Elle sature les capacit√©s cognitives et pousse vers des r√©actions √©motionnelles irrationnelles."}, {"q": "D√©finissez le concept de \"Reflexive Control\" ?", "a": "Transmettre des informations √† l'adversaire pour qu'il prenne volontairement une d√©cision pr√©d√©termin√©e par l'agresseur."}, {"q": "Quel est le danger des \"deepfakes\" dans la phase d'attraction ?", "a": "Ils cr√©ent une confusion imm√©diate en imitant parfaitement la r√©alit√© pour tromper les sens."}, {"q": "Quel est le r√¥le de la \"gratification sociale\" dans l'enfermement cognitif ?", "a": "Elle r√©compense l'adh√©sion au groupe, rendant la sortie du cadre cognitif psychologiquement co√ªteuse."}], "source": "builtin"}, {"id": "gc-expert", "name": "Guerre Cognitive ‚Äî Expert", "author": "COGWAR", "difficulty": 3, "icon": "üìê", "description": "Concepts expert : neurobiologie, mod√©lisation du chaos, d√©fense op√©rationnelle.", "tags": ["guerre-cognitive", "niveau-3"], "version": 1, "cards": [{"q": "Quel est le \"sixi√®me domaine de la guerre\" apparu au XXIe si√®cle ?", "a": "Le cerveau ou l'esprit humain."}, {"q": "Quelle est la diff√©rence fondamentale entre la guerre de l'information et la guerre cognitive ?", "a": "L'information cible le flux de donn√©es, tandis que la cognition cible le traitement de ces donn√©es pour construire la r√©alit√©."}, {"q": "Quel concept l'OTAN a-t-elle d√©sign√© comme imp√©ratif de d√©veloppement √† long terme dans son concept de 2021 ?", "a": "La sup√©riorit√© cognitive (Cognitive Superiority)."}, {"q": "Quelle est la cible principale de la doctrine russe en mati√®re de guerre cognitive ?", "a": "La d√©sinformation syst√©matique pour diviser et paralyser la volont√© politique adverse."}, {"q": "Sur quel outil technologique repose la guerre cognitive chinoise pour fa√ßonner les perceptions ?", "a": "L'intelligence artificielle et les algorithmes (guerre cognitive algorithmique)."}, {"q": "Dans la doctrine chinoise, quels sont les trois piliers de la \"Three Warfares\" ?", "a": "La guerre psychologique, la guerre de l'opinion publique et la guerre juridique."}, {"q": "Pourquoi le principe de \"stimulation r√©p√©t√©e\" facilite-t-il l'acceptation d'une fausse information ?", "a": "Elle r√©duit le co√ªt psychologique du traitement, facilitant l'acceptation subconsciente par le cerveau."}, {"q": "Quel m√©canisme neurobiologique est activ√© lorsqu'une information contredit les croyances profondes d'un individu ?", "a": "Le signal d'erreur."}, {"q": "En guerre cognitive, quel organe limbique est privil√©gi√© par les narratifs √©motionnels au d√©triment du cortex pr√©frontal ?", "a": "L'amygdale."}, {"q": "Quel est l'objectif d'un \"strat√®ge du chaos\" envers les dirigeants politiques adverses ?", "a": "Les convaincre qu'aucune solution claire ou √©tat final stable n'est possible."}, {"q": "Comment appelle-t-on les constructions id√©ologiques √©motionnelles se propageant de mani√®re virale sur les r√©seaux sociaux ?", "a": "Les contagions cognitives."}, {"q": "Quel terme d√©signe l'√©tat o√π des individus rejettent toute information contredisant leur narratif dominant au sein d'une communaut√© ?", "a": "La fermeture √©pist√©mique."}, {"q": "Dans le mod√®le chinois en six √©tapes, quelle est la premi√®re phase de la manipulation cognitive ?", "a": "Le portrait de l'utilisateur via le Big Data."}, {"q": "Quel est l'impact principal des algorithmes de recommandation sur la diversit√© des points de vue ?", "a": "Ils cr√©ent des chambres d'√©cho en limitant l'exposition aux opinions divergentes."}, {"q": "Selon les √©tudes, quel trait psychologique rend les √©lecteurs plus r√©ceptifs aux contenus algorithmiques extr√™mes ?", "a": "L'instabilit√© √©motionnelle."}, {"q": "En th√©orie du chaos, comment appelle-t-on le ph√©nom√®ne o√π une rumeur minime peut d√©clencher une crise nationale ?", "a": "L'effet papillon."}, {"q": "Dans les √©quations de Lorenz, quel param√®tre $\\rho$ peut √™tre manipul√© pour simuler le niveau de m√©fiance publique ?", "a": "Le param√®tre $\\rho$ (rh√¥)."}, {"q": "Que signifie l'acronyme de la boucle d√©cisionnelle corrompue par la guerre cognitive ?", "a": "OODA (Observation, Orientation, D√©cision, Action)."}, {"q": "Selon Dave Snowden, que se passe-t-il pour la boucle OODA dans un environnement \"chaotique\" ?", "a": "Elle s'effondre, entra√Ænant une paralysie ou des erreurs fatales."}, {"q": "Dans le mod√®le SIR appliqu√© aux rumeurs, que repr√©sente la cat√©gorie 'E' ?", "a": "Les √âtouffeurs (individus ayant cess√© de diffuser l'information)."}, {"q": "Quelle est la formule du nombre de reproduction de base $R_0$ dans la propagation d'une rumeur ?", "a": "$R_0 = \\frac{\\beta N}{\\alpha + \\gamma + \\mu}$"}, {"q": "Quel effet l'introduction de d√©lais temporels ($\\tau$) a-t-elle sur un syst√®me de propagation d'information ?", "a": "Elle peut induire une instabilit√© ou des oscillations chaotiques."}, {"q": "Qu'est-ce que l'homophilie de r√©seau dans le contexte de la d√©sinformation ?", "a": "La tendance des individus √† se connecter √† ceux qui partagent leurs croyances, acc√©l√©rant la circulation des rumeurs."}, {"q": "Quelle est la d√©finition de la \"r√©silience dynamique\" ?", "a": "La capacit√© de combattre √† travers la perturbation et de s'adapter au contact de l'ennemi."}, {"q": "Concept : Extensibilit√© gracieuse (Graceful Extensibility)", "a": "D√©finition : Capacit√© d'un syst√®me √† √©tendre ses r√©ponses au-del√† de ses limites normales face √† une pression extr√™me."}, {"q": "Qu'est-ce que la MRT-C dans le domaine de la cyber-r√©silience ?", "a": "Le terrain critique pour la mission dans le cyberespace (Mission-Relevant Terrain in Cyberspace)."}, {"q": "Quelle strat√©gie consiste √† engager l'adversaire dans ses propres r√©seaux avant qu'il ne lance d'attaques massives ?", "a": "La d√©fense avanc√©e (Defend Forward)."}, {"q": "Comment appelle-t-on la protection mentale des populations via la sensibilisation aux biais cognitifs ?", "a": "L'immunisation cognitive."}, {"q": "Quel dilemme guette les √âtats d√©mocratiques lorsqu'ils tentent de r√©guler l'information ?", "a": "Le dilemme du prisonnier appliqu√© √† la censure (risque de perdre la confiance du public)."}, {"q": "Selon Bernard Claverie, que ciblent pr√©cis√©ment les sciences cognitives \"dures\" ?", "a": "La pens√©e comme un objet mat√©riel via les neurosciences et les sciences du num√©rique."}, {"q": "Quel nom porte l'ensemble de sympt√¥mes incapacitants suspect√©s d'√™tre caus√©s par une arme neurobiologique √† Cuba ?", "a": "Le syndrome de La Havane."}, {"q": "Quel projet fran√ßais vise √† d√©velopper des simulations de crises fictives pour la guerre cognitive ?", "a": "Le projet Gecko."}, {"q": "Dans l'analyse des risques de protection, quels sont les trois facteurs de l'√©quation du risque ?", "a": "Menace, Vuln√©rabilit√© et Capacit√©."}, {"q": "Citez un exemple de d√©clencheur de vuln√©rabilit√© au niveau micro (individuel) en guerre cognitive.", "a": "Le besoin d'appartenance sociale (ou l'inflexibilit√© cognitive)."}, {"q": "Quelle technique russe vise √† fournir √† l'adversaire des informations l'amenant √† prendre volontairement une d√©cision pr√©d√©termin√©e ?", "a": "Le contr√¥le r√©flexif (Reflexive Control)."}, {"q": "Dans le mod√®le SIR, que repr√©sente le param√®tre $\\beta$ ?", "a": "Le taux de transmission (virilit√© de l'information)."}, {"q": "Quel organe du cerveau est responsable de la r√©gulation rationnelle et de la planification, souvent court-circuit√© par la peur ?", "a": "Le cortex pr√©frontal."}, {"q": "Pourquoi la zone grise est-elle privil√©gi√©e pour les attaques cognitives ?", "a": "Parce qu'il est difficile de d√©finir un acte de guerre pour des manipulations restant sous le seuil cin√©tique."}, {"q": "Que cherche √† provoquer l'injection de d√©sordre dans le syst√®me adverse par un agresseur ?", "a": "Une paralysie institutionnelle."}, {"q": "Dans le mod√®le de Snowden, quel type d'environnement n√©cessite de \"sonder\" avant de percevoir ?", "a": "L'environnement complexe."}, {"q": "Vrai ou Faux : Les rumeurs peuvent ressurgir brutalement √† cause des non-lin√©arit√©s du syst√®me social.", "a": "Vrai."}, {"q": "Quelle est la quatri√®me √©tape du mod√®le d'analyse du risque syst√©mique global ?", "a": "L'√©v√©nement syst√©mique (crise majeure affectant la stabilit√© de l'√âtat)."}, {"q": "Quel outil permet de cr√©er des contenus audiovisuels ultra-r√©alistes mais faux (Deepfakes) ?", "a": "L'IA g√©n√©rative."}, {"q": "Dans le cadre de l'OTAN, quel est le but de la \"Cognitive Superiority\" pour les d√©cideurs ?", "a": "Mieux comprendre l'environnement op√©rationnel et l'adversaire pour d√©cider plus vite et mieux."}, {"q": "Comment appelle-t-on l'utilisation de l'IA pour enfermer les individus dans des \"cocons\" de sens identiques ?", "a": "Les cocons s√©mantiques."}, {"q": "Quel param√®tre du SIR repr√©sente le taux de passage √† l'√©tat d'√©touffeur par perte d'int√©r√™t ?", "a": "$\\alpha$ (alpha)."}, {"q": "L'√©quation $\\frac{dx}{dt} = \\sigma(y - x)$ fait partie de quel mod√®le math√©matique ?", "a": "L'attracteur de Lorenz (th√©orie du chaos)."}, {"q": "Quel est l'objectif des \"Pools de donn√©es\" dans la cybers√©curit√© moderne ?", "a": "Partager anonymement des menaces en temps r√©el pour anticiper les vagues de d√©sinformation."}, {"q": "Quel risque pose la d√©pendance totale aux technologies de l'information selon le texte ?", "a": "Une vuln√©rabilit√© syst√©mique et interconnect√©e."}, {"q": "En guerre cognitive, comment appelle-t-on le fait d'attaquer le leadership de \"l'int√©rieur vers l'ext√©rieur\" ?", "a": "Le principe des op√©rations bas√©es sur les effets (EBO)."}, {"q": "Pourquoi la v√©rit√© devient-elle une variable secondaire dans une chambre d'√©cho ?", "a": "Parce que l'appartenance au groupe et le renforcement des pr√©jug√©s priment sur les faits rationnels."}, {"q": "Dans le mod√®le de l'OTAN, quel type d'harm Miller identifie-t-il sp√©cifiquement pour la guerre cognitive ?", "a": "Le dommage psychologique aux humains et le dommage aux institutions."}, {"q": "Quel terme d√©signe la manipulation de la viralit√© pour faire para√Ætre un sujet naturellement populaire ?", "a": "La suggestion de r√©f√©rences (dans le mod√®le chinois)."}, {"q": "Quelle discipline √©tudie la sensibilit√© d'un syst√®me aux conditions initiales ?", "a": "La th√©orie du chaos."}, {"q": "Quelle est la fonction du param√®tre $\\gamma$ dans le mod√®le SIR des rumeurs ?", "a": "Le taux de r√©cup√©ration suite √† une v√©rification des faits (fact-checking)."}, {"q": "Quelle est la cons√©quence d'un signal d'erreur satur√© en permanence ?", "a": "Un stress cognitif permanent qui pousse vers des r√©actions √©motionnelles impulsives."}, {"q": "Dans la gestion des risques de protection, que signifie la 'Capacit√©' ?", "a": "Les ressources et tactiques qu'utilisent les communaut√©s pour pr√©venir ou arr√™ter une menace."}, {"q": "Quel vecteur de menace utilise des narratifs historiques pour provoquer un \"chaos environnemental\" en Afrique ?", "a": "La Russie."}, {"q": "Quelle dimension de la cognition concerne l'apport initial d'information ?", "a": "L'input."}, {"q": "Pourquoi les d√©mocraties sont-elles structurellement plus vuln√©rables √† la guerre cognitive ?", "a": "√Ä cause de leur transparence, de la libert√© d'expression et du rejet des m√©thodes de contr√¥le autoritaires."}, {"q": "Quel terme de la boucle OODA est sp√©cifiquement biais√© par les perceptions d√©form√©es en guerre cognitive ?", "a": "L'Orientation."}, {"q": "Dans le mod√®le SIR, que repr√©sente $N$ ?", "a": "La population totale."}, {"q": "Quel est l'effet d'une bifurcation dans un syst√®me de propagation d'information ?", "a": "Un changement brusque de comportement, comme la r√©surgence soudaine d'une rumeur oubli√©e."}, {"q": "Qu'est-ce que le micro-ciblage psychographique ?", "a": "L'utilisation de donn√©es personnelles (likes, intentions) pour cr√©er des messages taill√©s sur mesure pour exploiter les peurs individuelles."}, {"q": "Quelle est la diff√©rence entre un syst√®me \"compliqu√©\" et \"complexe\" selon Snowden ?", "a": "Le compliqu√© n√©cessite une expertise pour l'analyse, le complexe a une causalit√© √©mergente visible seulement a posteriori."}, {"q": "Citez un risque macro-soci√©tal favorisant la guerre cognitive selon l'OTAN.", "a": "Le populisme anti-√©tablissement (ou le manque de litt√©ratie m√©diatique)."}, {"q": "Quel est le but ultime de la \"neuro-guerre\" ?", "a": "Contr√¥ler la souverainet√© d'un √âtat au c≈ìur m√™me de l'esprit de ses citoyens."}, {"q": "Dans l'analyse de cas de l'Ouganda (LRA), quel √©tait l'objectif du recrutement d'enfants ?", "a": "Faire rena√Ætre une nouvelle g√©n√©ration d'Acholis suivant Kony."}, {"q": "Quel m√©canisme permet √† l'IA de superviser la gratification sociale ?", "a": "La mesure des interactions sociales pour renforcer l'enfermement dans un cadre cognitif."}, {"q": "Pourquoi la \"d√©fense en profondeur\" en guerre cognitive n√©cessite-t-elle des partenariats public-priv√© ?", "a": "Parce que les infrastructures et les donn√©es n√©cessaires √† la d√©fense appartiennent majoritairement au secteur priv√©."}, {"q": "Quel impact a la perte de confiance dans les institutions d√©mocratiques selon le texte ?", "a": "Elle rend la soci√©t√© ingouvernable et vuln√©rable aux influences √©trang√®res."}, {"q": "Quel facteur peut neutraliser la force technologique brute dans une guerre asym√©trique ?", "a": "L'exploitation des d√©pendances informationnelles et de la complexit√© sociale."}, {"q": "Que d√©signe le terme \"zone grise\" ?", "a": "L'espace de conflictualit√© situ√© entre la paix et la guerre conventionnelle."}, {"q": "Dans le cadre de l'analyse de protection, quel type de menace est le mariage forc√© ?", "a": "Une menace de coercition."}, {"q": "Quel param√®tre $\\beta$ dans les √©quations de Lorenz influe sur le comportement chaotique ?", "a": "$\\beta$ (b√™ta)."}], "source": "builtin"}];

/* ‚ïê‚ïê‚ïê COGWAR ENGINE ‚Äî ULTIMATE ‚ïê‚ïê‚ïê */
const $=id=>document.getElementById(id);
const esc=s=>{const d=document.createElement('div');d.textContent=s;return d.innerHTML};

/* ‚îÄ‚îÄ‚îÄ IndexedDB ‚îÄ‚îÄ‚îÄ */
const DB='cogwar7';let db;
function idb(){return new Promise((ok,no)=>{const r=indexedDB.open(DB,1);r.onupgradeneeded=e=>{const d=e.target.result;if(!d.objectStoreNames.contains('decks'))d.createObjectStore('decks',{keyPath:'id'});if(!d.objectStoreNames.contains('meta'))d.createObjectStore('meta',{keyPath:'k'})};r.onsuccess=e=>{db=e.target.result;ok(db)};r.onerror=e=>no(e)})}
function put(s,d){return new Promise((ok,no)=>{const t=db.transaction(s,'readwrite');t.objectStore(s).put(d);t.oncomplete=ok;t.onerror=no})}
function get(s,k){return new Promise((ok,no)=>{const t=db.transaction(s);const r=t.objectStore(s).get(k);r.onsuccess=()=>ok(r.result);r.onerror=no})}
function getAll(s){return new Promise((ok,no)=>{const t=db.transaction(s);const r=t.objectStore(s).getAll();r.onsuccess=()=>ok(r.result);r.onerror=no})}
function del(s,k){return new Promise((ok,no)=>{const t=db.transaction(s,'readwrite');t.objectStore(s).delete(k);t.oncomplete=ok;t.onerror=no})}

/* ‚îÄ‚îÄ‚îÄ State ‚îÄ‚îÄ‚îÄ */
let ST={xp:0,lv:1,rd:[],fO:0,fK:0,bS:0,ach:[],sessions:0,dayStreak:0,lastPlay:null};
async function ldST(){const m=await get('meta','st');if(m)ST=m.v}
async function svST(){await put('meta',{k:'st',v:ST})}

/* ‚îÄ‚îÄ‚îÄ XP / Toast / Ach ‚îÄ‚îÄ‚îÄ */
function addXP(n,l){ST.xp+=n;const nl=Math.floor(ST.xp/100)+1;if(nl>ST.lv){ST.lv=nl;toast(`‚¨Ü LVL ${ST.lv}`,'lv');if(ST.lv>=5)achk('l5');if(ST.lv>=10)achk('l10')}upXP();toast(`+${n} XP ‚Äî ${l}`,'xp');svST()}
function upXP(){$('xpf').style.width=(ST.xp%100)+'%';$('xpd').textContent=ST.xp;$('lvd').textContent='LV'+ST.lv;$('dh-x').textContent=ST.xp;$('dh-s').textContent=ST.sessions}
function toast(m,c){const t=document.createElement('div');t.className='toast '+(c||'');t.textContent=m;$('tc').appendChild(t);setTimeout(()=>t.remove(),1800)}
const ACHS=[{id:'1st',i:'üìñ',n:'N√©ophyte',d:'1 entr√©e lue'},{id:'5rd',i:'üß†',n:'√âveill√©',d:'5 entr√©es'},{id:'all',i:'üëÅ',n:'Omniscient',d:'Toutes lues'},{id:'f5',i:'‚ö°',n:'Initi√©',d:'5 flashcards'},{id:'f10',i:'üî•',n:'En feu',d:'S√©rie de 10'},{id:'fdk',i:'üèÜ',n:'WOPR',d:'Finir 1 deck'},{id:'l5',i:'‚≠ê',n:'Sentinelle',d:'Niveau 5'},{id:'l10',i:'üõ°',n:'Pare-feu',d:'Niveau 10'},{id:'cr',i:'‚úèÔ∏è',n:'Cr√©ateur',d:'Cr√©er un deck'},{id:'s100',i:'üíØ',n:'Centurion',d:'100 cartes OK'}];
function achk(id){if(ST.ach.includes(id))return;ST.ach.push(id);const a=ACHS.find(x=>x.id===id);if(a)toast(`üèÜ ${a.n}!`,'ach');rAch();svST()}
function rAch(){$('ag').innerHTML=ACHS.map(a=>`<div class="ac ${ST.ach.includes(a.id)?'gt':'lk'}"><div class="aci">${a.i}</div><div class="acn">${a.n}</div><div class="acd">${a.d}</div></div>`).join('');$('ach-count').textContent=ST.ach.length+' d√©bloqu√©s'}

/* ‚îÄ‚îÄ‚îÄ Theme ‚îÄ‚îÄ‚îÄ */
function setT(t){document.documentElement.setAttribute('data-theme',t);document.querySelectorAll('.dot').forEach(d=>d.classList.toggle('on',d.dataset.t===t));try{localStorage.setItem('cw-t',t)}catch(e){}}

/* ‚îÄ‚îÄ‚îÄ Navigation ‚îÄ‚îÄ‚îÄ */
const SECS=['home','play','lib','store','more','ency','ach','profile','console'];
function go(id,btn){
  SECS.forEach(s=>{const el=$('s-'+s);if(el)el.classList.toggle('on',s===id)});
  document.querySelectorAll('.nb').forEach(b=>b.classList.remove('on'));
  if(btn)btn.classList.add('on');
  else{const map={ency:'more',ach:'more',profile:'more',console:'more'};document.querySelector(`.nb[data-s="${map[id]||id}"]`)?.classList.add('on')}
  window.scrollTo({top:0,behavior:'smooth'});
  if(id==='play')rPlay();if(id==='lib')rLib();if(id==='store')rStore();if(id==='profile')applyProf();if(id==='console'&&!$('con-out').children.length)conBoot();
}

/* ‚îÄ‚îÄ‚îÄ Modals ‚îÄ‚îÄ‚îÄ */
function omo(id){$(id).classList.add('open');document.body.style.overflow='hidden'}
function cmo(id){$(id).classList.remove('open');document.body.style.overflow=''}
document.addEventListener('keydown',e=>{if(e.key==='Escape')document.querySelectorAll('.mo.open').forEach(m=>{m.classList.remove('open');document.body.style.overflow=''})});

/* ‚ïê‚ïê‚ïê BUILTIN INSTALL ‚ïê‚ïê‚ïê */
async function installBuiltins(){
  const ver=await get('meta','builtin_ver');
  const currentVer=2; // bump this to force re-install
  if(ver&&ver.v>=currentVer)return;
  for(const dk of BUILTIN_DECKS){
    const existing=await get('decks',dk.id);
    if(!existing||dk.version>(existing.version||0)){
      await put('decks',{...dk,source:'builtin',installed:Date.now()});
    }
  }
  await put('meta',{k:'builtin_ver',v:currentVer});
  console.log('Builtin decks installed/updated');
}

/* ‚ïê‚ïê‚ïê HOME ‚ïê‚ïê‚ïê */
let qfF=false;
async function rHome(){
  const dks=await getAll('decks');
  const tc=dks.reduce((s,d)=>s+(d.cards?.length||0),0);
  $('dh-d').textContent=dks.length;$('dh-c').textContent=tc;
  // random flashcard
  const all=dks.flatMap(d=>d.cards||[]);
  if(all.length){const c=all[Math.floor(Math.random()*all.length)];$('qfq').textContent=c.q;$('qfa').textContent=c.a}
  else{$('qfq').textContent='Installez des decks dans le Store!'}
  qfF=false;$('qfi').classList.remove('fl');
}
function qfTap(){if(!qfF){qfF=true;$('qfi').classList.add('fl')}else{rHome()}}

/* ‚ïê‚ïê‚ïê PLAY ENGINE ‚ïê‚ïê‚ïê */
let curDk=null,shuf=[],pfi=0,pfl=0,pStr=0,pOk=0,pKo=0;

async function rPlay(){
  const dks=(await getAll('decks')).filter(d=>d.cards&&d.cards.length>0).sort((a,b)=>a.difficulty-b.difficulty||a.name.localeCompare(b.name));
  $('play-empty').style.display=dks.length?'none':'block';
  $('play-zone').style.display=dks.length?'':'none';
  $('ptabs').innerHTML=dks.map(d=>`<div class="dt${curDk===d.id?' on':''}" onclick="selDk('${d.id}')"><span class="dd d${d.difficulty}"></span>${esc(d.name)} <span style="font-size:9px;opacity:.5">(${d.cards.length})</span></div>`).join('');
}

async function selDk(id){
  curDk=id;rPlay();
  const d=await get('decks',id);if(!d)return;
  shuf=[...d.cards].sort(()=>Math.random()-.5);
  pfi=0;pfl=0;pStr=0;pOk=0;pKo=0;
  $('pinfo').textContent=`${d.icon} ${d.name} ‚Äî ${d.cards.length} cartes`;
  $('ps-ok').textContent='0';$('ps-ko').textContent='0';$('ps-st').textContent='0';
  ST.sessions++;svST();upXP();
  pShow();
}

function pShow(){
  if(pfi>=shuf.length){$('pq').textContent='‚úì DECK TERMIN√â!';$('pq').style.fontSize='22px';$('pi').classList.remove('fl');$('pbs').style.display='none';achk('fdk');return}
  pfl=0;$('pi').classList.remove('fl');$('pbs').style.display='none';
  $('pq').textContent=shuf[pfi].q;$('pq').style.fontSize='';$('pa').textContent=shuf[pfi].a;
  $('pctr').textContent=`${pfi+1}/${shuf.length}`;$('ppf').style.width=(pfi/shuf.length*100)+'%';$('psc').textContent=pOk+'‚úì';
}
function pflip(){if(pfl)return;pfl=1;$('pi').classList.add('fl');$('pbs').style.display='flex'}
function pans(ok){
  if(ok){pOk++;ST.fO++;pStr++;if(pStr>ST.bS)ST.bS=pStr;addXP(10,'Flashcard');if(ST.fO>=5)achk('f5');if(pStr>=10)achk('f10');if(ST.fO>=100)achk('s100')}
  else{pKo++;ST.fK++;pStr=0}
  $('ps-ok').textContent=pOk;$('ps-ko').textContent=pKo;$('ps-st').textContent=pStr;
  pfi++;svST();pShow();
}
function psk(){pfi++;pShow()}

/* ‚ïê‚ïê‚ïê LIBRARY CRUD ‚ïê‚ïê‚ïê */
let edDk=null;

async function rLib(){
  const dks=(await getAll('decks')).sort((a,b)=>a.difficulty-b.difficulty||a.name.localeCompare(b.name));
  $('lib-empty').style.display=dks.length?'none':'block';
  $('lib-list').innerHTML=dks.map(d=>`<div class="dki">
    <div class="dki-top"><div class="dki-ico">${d.icon||'üß†'}</div><div style="flex:1;min-width:0"><div class="dki-t">${esc(d.name)}</div><div class="dki-m"><span class="dd d${d.difficulty}"></span>${d.cards?.length||0} cartes ¬∑ ${esc(d.author||'')} ¬∑ ${d.source||'local'}</div></div></div>
    <div class="dki-acts"><button onclick="openCards('${d.id}')">üÉè Cartes</button><button onclick="deckForm('${d.id}')">‚úèÔ∏è √âditer</button><button onclick="expOne('${d.id}')">‚¨á Export</button><button class="del" onclick="delDk('${d.id}')">‚úï Suppr.</button></div>
  </div>`).join('');
}

function deckForm(id){
  edDk=id||null;$('mdk-t').textContent=id?'Modifier Deck':'Nouveau Deck';
  if(id){get('decks',id).then(d=>{if(d){$('dk-n').value=d.name;$('dk-i').value=d.icon||'üß†';$('dk-d').value=d.difficulty||1;$('dk-desc').value=d.description||'';$('dk-tg').value=(d.tags||[]).join(', ')}})}
  else{$('dk-n').value='';$('dk-i').value='üß†';$('dk-d').value='1';$('dk-desc').value='';$('dk-tg').value=''}
  omo('mo-dk');
}

async function saveDk(){
  const nm=$('dk-n').value.trim();if(!nm){toast('Nom requis','err');return}
  const id=edDk||'u-'+Date.now()+'-'+Math.random().toString(36).slice(2,5);
  const ex=edDk?await get('decks',id):null;
  await put('decks',{id,name:nm,icon:$('dk-i').value||'üß†',difficulty:+$('dk-d').value||1,description:$('dk-desc').value,tags:$('dk-tg').value.split(',').map(t=>t.trim()).filter(Boolean),cards:ex?ex.cards:[],author:ex?.author||'Vous',source:ex?.source||'user',version:(ex?.version||0)+1,created:ex?.created||Date.now(),updated:Date.now()});
  if(!edDk)achk('cr');toast(edDk?'Modifi√©':'Cr√©√©!');cmo('mo-dk');rLib();rHome();
}

async function delDk(id){if(!confirm('Supprimer ce deck et ses cartes ?'))return;await del('decks',id);toast('Supprim√©');rLib();rHome();rPlay()}

/* ‚îÄ‚îÄ‚îÄ Card CRUD ‚îÄ‚îÄ‚îÄ */
let edCdDk=null,edCdIdx=-1;

async function openCards(id){
  edCdDk=id;const d=await get('decks',id);
  $('mcd-t').textContent=`${d.icon} ${d.name}`;
  rCards(d.cards||[]);omo('mo-cd');
}

function rCards(cards){
  $('cd-empty').style.display=cards.length?'none':'block';
  $('cd-list').innerHTML=cards.map((c,i)=>`<div class="ce"><div class="ce-bd"><div class="ce-q">Q: ${esc(c.q)}</div><div class="ce-a">R: ${esc(c.a)}</div></div><div class="ce-ac"><button onclick="cardForm(${i})">‚úèÔ∏è √âditer</button><button onclick="delCd(${i})" style="color:var(--rd)">‚úï Suppr.</button>${i>0?`<button onclick="mvCd(${i},-1)">‚Üë Monter</button>`:''}</div></div>`).join('');
}

function cardForm(idx){
  edCdIdx=typeof idx==='number'?idx:-1;$('mcf-t').textContent=edCdIdx>=0?'Modifier':'Nouvelle Carte';
  if(edCdIdx>=0){get('decks',edCdDk).then(d=>{$('cf-q').value=d.cards[edCdIdx].q;$('cf-a').value=d.cards[edCdIdx].a})}
  else{$('cf-q').value='';$('cf-a').value=''}
  omo('mo-cf');
}

async function saveCd(){
  const q=$('cf-q').value.trim(),a=$('cf-a').value.trim();if(!q||!a){toast('Q+R requis','err');return}
  const d=await get('decks',edCdDk);if(!d.cards)d.cards=[];
  if(edCdIdx>=0)d.cards[edCdIdx]={q,a};else d.cards.push({q,a});
  d.updated=Date.now();await put('decks',d);rCards(d.cards);cmo('mo-cf');toast(edCdIdx>=0?'Modifi√©e':'Ajout√©e');rHome();
}

async function delCd(i){
  const d=await get('decks',edCdDk);d.cards.splice(i,1);d.updated=Date.now();await put('decks',d);rCards(d.cards);toast('Supprim√©e');
}

async function mvCd(i,dir){
  const d=await get('decks',edCdDk);const n=i+dir;[d.cards[i],d.cards[n]]=[d.cards[n],d.cards[i]];d.updated=Date.now();await put('decks',d);rCards(d.cards);
}

/* ‚îÄ‚îÄ‚îÄ Import / Export ‚îÄ‚îÄ‚îÄ */
function doImport(e){
  const f=e.target.files[0];if(!f)return;
  const rd=new FileReader();
  rd.onload=async function(){
    try{
      const data=JSON.parse(rd.result);
      // Support single deck or array of decks
      const decks=Array.isArray(data)?data:data.cards?[data]:[];
      if(!decks.length){toast('Format invalide','err');return}
      let count=0;
      for(const dk of decks){
        if(!dk.name||!dk.cards){continue}
        const id=dk.id||'imp-'+Date.now()+'-'+(count++);
        const existing=await get('decks',id);
        const fid=existing?id+'-'+Date.now().toString(36).slice(-4):id;
        await put('decks',{id:fid,name:dk.name,icon:dk.icon||'üì•',difficulty:dk.difficulty||1,description:dk.description||'',tags:dk.tags||[],cards:dk.cards,author:dk.author||'Import',source:'import',version:dk.version||1,created:Date.now(),updated:Date.now()});
      }
      toast(`${decks.length} deck(s) import√©(s)!`,'ach');rLib();rHome();
    }catch(err){toast('Erreur JSON: '+err.message,'err')}
  };rd.readAsText(f);e.target.value='';
}

async function expOne(id){
  const d=await get('decks',id);if(!d)return;
  const out={id:d.id,name:d.name,icon:d.icon,difficulty:d.difficulty,description:d.description,tags:d.tags,author:d.author,version:d.version||1,cards:d.cards};
  dlJSON(out,d.name.replace(/[^a-zA-Z0-9_-]/g,'_')+'.json');
}
function expDk(){expOne(edCdDk)}
function dlJSON(o,fn){const b=new Blob([JSON.stringify(o,null,2)],{type:'application/json'});const a=document.createElement('a');a.href=URL.createObjectURL(b);a.download=fn;a.click();URL.revokeObjectURL(a.href)}

/* ‚ïê‚ïê‚ïê STORE (DECKS + ENCY) ‚ïê‚ïê‚ïê */
let storeCache=null,encyStoreCache=null,storeMode='dk';

function storeTab(mode){
  storeMode=mode;
  $('st-tab-dk').classList.toggle('on',mode==='dk');
  $('st-tab-en').classList.toggle('on',mode==='en');
  rStore();
}

async function rStore(){
  $('store-load').style.display='block';$('store-list').innerHTML='';
  
  if(storeMode==='dk'){
    // --- DECK STORE ---
    if(!storeCache){
      try{const r=await fetch('decks/index.json');if(r.ok)storeCache=await r.json()}catch(e){}
    }
    if(!storeCache){
      storeCache={decks:BUILTIN_DECKS.map(d=>({file:null,id:d.id,name:d.name,author:d.author,difficulty:d.difficulty,count:d.cards.length,description:d.description,tags:d.tags,icon:d.icon,version:d.version||1,_embedded:true}))};
    }
    const installed=new Map((await getAll('decks')).map(d=>[d.id,d.version||0]));
    $('store-load').style.display='none';
    if(!storeCache.decks.length){$('store-list').innerHTML='<div class="sr-empty"><div class="sr-e-ico">üì¶</div>Aucun deck disponible</div>';return}
    $('store-list').innerHTML=storeCache.decks.map(d=>{
      const hasIt=installed.has(d.id);
      const canUpdate=hasIt&&d.version>(installed.get(d.id)||0);
      return `<div class="sti"><div class="sti-ico">${d.icon||'üì¶'}</div><div style="flex:1;min-width:0"><div class="sti-t">${esc(d.name)}</div><div class="sti-d">${esc(d.description||'')}</div><div class="sti-meta"><span class="dd d${d.difficulty}"></span>${d.count||'?'} cartes ¬∑ ${esc(d.author||'')}</div><button class="sti-btn ${hasIt&&!canUpdate?'done':''}" onclick="${hasIt&&!canUpdate?'':`storeInstallDk('${d.id}','${d.file||''}')`}">${canUpdate?'‚¨Ü Maj':hasIt?'‚úì Install√©':'Installer'}</button></div></div>`;
    }).join('');
  } else {
    // --- ENCYCLOPEDIA STORE ---
    if(!encyStoreCache){
      try{const r=await fetch('ency/index.json');if(r.ok)encyStoreCache=await r.json()}catch(e){}
    }
    if(!encyStoreCache){
      // Fallback: generate from embedded EN
      encyStoreCache={entries:EN.map(e=>({id:e.id,title:e.t,cat:e.cat,xp:e.xp,short:e.sh,tags:e.tags,file:null,_embedded:true}))};
    }
    $('store-load').style.display='none';
    if(!encyStoreCache.entries.length){$('store-list').innerHTML='<div class="sr-empty"><div class="sr-e-ico">‚óà</div>Aucune entr√©e disponible</div>';return}
    const installedIds=EN.map(e=>e.id);
    $('store-list').innerHTML=encyStoreCache.entries.map(e=>{
      const hasIt=installedIds.includes(e.id);
      return `<div class="sti"><div class="sti-ico">‚óà</div><div style="flex:1;min-width:0"><div class="sti-t">${esc(e.title)}</div><div class="sti-d">${esc(e.short||'')}</div><div class="sti-meta">${esc(e.cat)} ¬∑ ${e.tags?.join(', ')||''} ¬∑ +${e.xp} XP</div><button class="sti-btn ${hasIt?'done':''}" onclick="${hasIt?'':`storeInstallEn('${e.id}','${e.file||''}')`}">${hasIt?'‚úì Int√©gr√©':'Installer'}</button></div></div>`;
    }).join('');
  }
}

async function storeInstallDk(id,file){
  toast('Installation du deck...');
  try{
    let data;
    if(file){const r=await fetch('decks/'+file);if(!r.ok)throw new Error('Fichier introuvable');data=await r.json()}
    else{data=BUILTIN_DECKS.find(d=>d.id===id);if(!data)throw new Error('Deck introuvable')}
    await put('decks',{...data,id:data.id||id,source:'store',installed:Date.now()});
    toast(`"${data.name}" install√©! (${data.cards.length} cartes)`,'ach');rStore();rHome();
  }catch(e){toast('Erreur: '+e.message,'err')}
}

async function storeInstallEn(id,file){
  toast('Installation entr√©e...');
  try{
    let data;
    if(file){const r=await fetch('ency/'+file);if(!r.ok)throw new Error('Fichier introuvable');data=await r.json()}
    else{data=EN.find(e=>e.id===id);if(data){toast('D√©j√† int√©gr√©e','err');return}throw new Error('Entr√©e introuvable')}
    // Add to runtime EN array
    const entry={id:data.id,t:data.title,cat:data.cat,tags:data.tags,xp:data.xp,sh:data.short,b:data.body};
    if(!EN.find(e=>e.id===entry.id)){EN.push(entry)}
    // Persist custom entries
    await put('meta',{k:'custom_ency',v:EN.filter(e=>!BUILTIN_EN_IDS.includes(e.id))});
    rTags();rEN(EN);rStore();
    toast(`"${data.title}" install√©e!`,'ach');
  }catch(e){toast('Erreur: '+e.message,'err')}
}

// Track which entries are builtin vs user-installed
let BUILTIN_EN_IDS=[];

async function loadCustomEncy(){
  const custom=await get('meta','custom_ency');
  if(custom&&custom.v){
    for(const e of custom.v){
      if(!EN.find(x=>x.id===e.id))EN.push(e);
    }
  }
}

/* ‚ïê‚ïê‚ïê ENCYCLOPEDIA ‚ïê‚ïê‚ïê */
const EN=[
  {id:'gc',t:'Guerre Cognitive',cat:'Fondamental',tags:['doctrine','fondamentaux'],xp:25,sh:'Strat√©gie ciblant le cerveau pour alt√©rer le traitement de l\'information.',b:'<h3>D√©finition</h3><p>Utilise les technologies pour influencer ou perturber la cognition. Cible les processus subconscients.</p><h3>Distinction</h3><p>Info = contr√¥le des donn√©es. Cognitive = alt√©ration du <em>processing</em>.</p><h3>Trois piliers</h3><ul><li><strong>Effets cognitifs</strong> (biais)</li><li><strong>Hostilit√© asym√©trique</strong> (zone grise)</li><li><strong>Amplification techno</strong> (IA/Big Data)</li></ul>'},
  {id:'6d',t:'Le Sixi√®me Domaine',cat:'Fondamental',tags:['doctrine','otan'],xp:25,sh:'Le cerveau comme 6·µâ domaine de la guerre (OTAN NWCC 2021).',b:'<h3>Concept</h3><p>L\'OTAN identifie l\'esprit humain comme <strong>sixi√®me domaine</strong>. La souverainet√© d√©pend de l\'int√©grit√© cognitive.</p>'},
  {id:'ooda',t:'Boucle OODA',cat:'M√©canisme',tags:['d√©cision','strat√©gie'],xp:30,sh:'Observation, Orientation, D√©cision, Action ‚Äî cycle sabot√©.',b:'<ul><li><strong>Observation</strong> satur√©e</li><li><strong>Orientation</strong> biais√©e</li><li><strong>D√©cision</strong> paralys√©e</li><li><strong>Action</strong> d√©sordonn√©e</li></ul>'},
  {id:'se',t:'Signal d\'Erreur',cat:'Neurobiologie',tags:['neurosciences','cerveau'],xp:30,sh:'Alerte neuronale exploit√©e pour stress ou soumission.',b:'<h3>Deux modes</h3><ul><li><strong>Sous le seuil :</strong> Doute diffus</li><li><strong>Saturation :</strong> Stress ‚Üí d√©cision d√©grad√©e</li></ul><table><tr><th>Zone</th><th>Agression</th><th>Effet</th></tr><tr><td>Cortex Pr√©frontal</td><td>Inhibition</td><td>Paralysie</td></tr><tr><td>Amygdale</td><td>Hyper-activation</td><td>Impulsivit√©</td></tr></table>'},
  {id:'sr',t:'Stimulation R√©p√©t√©e',cat:'Neurobiologie',tags:['neurosciences'],xp:20,sh:'Le faux devient familier par exposition it√©rative.',b:'<p>Exposition it√©rative ‚Üí r√©duction du co√ªt m√©tabolique ‚Üí acceptation par <strong>√©conomie d\'√©nergie cognitive</strong>.</p>'},
  {id:'sir',t:'Mod√®le SIR',cat:'Mod√©lisation',tags:['math√©matiques','propagation'],xp:35,sh:'Ignorants ‚Üí Propagateurs ‚Üí √âtouffeurs. R‚ÇÄ > 1 = contagion.',b:'<div class="formula">R‚ÇÄ = (Œ≤ √ó N) / (Œ± + Œ≥ + Œº)</div><p>R‚ÇÄ > 1 ‚Üí contagion exponentielle.</p>'},
  {id:'ch',t:'Th√©orie du Chaos',cat:'Asym√©trie',tags:['chaos','math√©matiques'],xp:35,sh:'Effet papillon informationnel.',b:'<div class="formula">dx/dt = œÉ(y ‚àí x) ¬∑ dy/dt = x(œÅ ‚àí z) ‚àí y</div><p>Variation infime de œÅ (m√©fiance) ‚Üí basculement vers le chaos.</p>'},
  {id:'sc',t:'Strat√®ge du Chaos',cat:'Asym√©trie',tags:['chaos','asym√©trie'],xp:25,sh:'Rendre le syst√®me adverse ingouvernable.',b:'<p>Ne pas vaincre mais <strong>paralyser</strong>. Convaincre qu\'aucune solution stable n\'existe.</p>'},
  {id:'otan',t:'Doctrine OTAN',cat:'G√©opolitique',tags:['doctrine','otan'],xp:25,sh:'Out-think et out-pace l\'adversaire.',b:'<p><strong>Cognitive Superiority</strong> : prot√©ger les processus d√©cisionnels d√©mocratiques (NWCC 2021).</p>'},
  {id:'ru',t:'Contr√¥le R√©flexif',cat:'G√©opolitique',tags:['doctrine','russie'],xp:25,sh:'D√©cision ¬´ libre ¬ª pr√©-d√©termin√©e par Moscou.',b:'<p>Transmettre des infos pour que l\'adversaire d√©cide <strong>de plein gr√©</strong> selon la volont√© russe.</p>'},
  {id:'cn',t:'Domination Algorithmique',cat:'G√©opolitique',tags:['doctrine','chine','ia'],xp:30,sh:'6 √©tapes chinoises du Big Data au verrouillage.',b:'<ul><li>Portrait ‚Üí Attraction ‚Üí Suggestion ‚Üí Induction ‚Üí Intervention ‚Üí Supervision</li></ul>'},
  {id:'mc',t:'Micro-ciblage',cat:'Technologies',tags:['ia','manipulation'],xp:25,sh:'Big Data + IA = exploitation des failles individuelles.',b:'<ul><li>Instabilit√© √©motionnelle (pr√©dicteur n¬∞1)</li><li>Biais de confirmation</li><li>Besoin d\'appartenance</li></ul>'},
  {id:'rd',t:'R√©silience Dynamique',cat:'D√©fense',tags:['d√©fense','r√©silience'],xp:25,sh:'Combattre √† travers la perturbation.',b:'<ul><li><strong>Extensibilit√© gracieuse</strong></li><li><strong>Adaptabilit√© soutenue</strong></li></ul>'},
  {id:'im',t:'Immunisation Cognitive',cat:'D√©fense',tags:['d√©fense','√©ducation'],xp:25,sh:'Vaccination contre la capture motivationnelle.',b:'<p>√âducation aux biais, esprit critique, jeux de guerre. <strong>Projet Gecko</strong> (Inalco/ENSC/IRSEM).</p>'},
  {id:'rq',t:'√âquation du Risque',cat:'Mod√©lisation',tags:['math√©matiques','d√©fense'],xp:30,sh:'Risque = (Menace √ó Vuln√©rabilit√©) / Capacit√©.',b:'<div class="formula">Risque = (Menace √ó Vuln√©rabilit√©) / Capacit√©</div>'},
  {id:'ce',t:'Chambre d\'√âcho',cat:'Propagation',tags:['propagation','r√©seaux'],xp:20,sh:'Bulle algorithmique ‚Üí polarisation.',b:'<p>Algorithmes ne montrant que du contenu align√© ‚Üí cocons s√©mantiques ‚Üí fermeture √©pist√©mique.</p>'},
  {id:'fe',t:'Fermeture √âpist√©mique',cat:'Propagation',tags:['propagation'],xp:20,sh:'Rejet syst√©matique de toute info contradictoire.',b:'<p>M√™me le fact-checking peut engendrer m√©fiance ‚Üí rejet de toute autorit√©.</p>'},
  {id:'zg',t:'Zone Grise',cat:'Asym√©trie',tags:['strat√©gie','asym√©trie'],xp:20,sh:'Conflit sous le seuil militaire.',b:'<p>Libert√©s d√©mocratiques deviennent vuln√©rabilit√©s. Riposte conventionnelle inadapt√©e.</p>'},
  {id:'hv',t:'Syndrome de La Havane',cat:'Neurobiologie',tags:['neurosciences'],xp:20,sh:'Cerveau physiquement vuln√©rable.',b:'<p>2016 : alt√©rations neurobiologiques via √©nergie dirig√©e.</p>'},
  {id:'df',t:'Defend Forward',cat:'D√©fense',tags:['d√©fense','cyber'],xp:20,sh:'Engager l\'adversaire dans ses r√©seaux.',b:'<p>Engagement proactif sur les r√©seaux adverses <strong>avant</strong> les attaques.</p>'},
  {id:'cs',t:'Cocon S√©mantique',cat:'Propagation',tags:['propagation','ia','r√©seaux'],xp:25,sh:'Enfermement algorithmique dans un flux confirmant uniquement les pr√©jug√©s de la cible.',b:'<h3>M√©canisme</h3><p>Les algorithmes de recommandation cr√©ent des <strong>cocons s√©mantiques</strong> : flux d\'informations qui confirment uniquement les croyances existantes.</p><h3>Exploitation</h3><ul><li>L\'individu ne voit que du contenu align√© avec ses biais.</li><li>Le sentiment de consensus artificiel renforce la conviction.</li><li>Toute information contradictoire est filtr√©e ou rejet√©e.</li></ul><p>Ce m√©canisme est l\'√©tape 4 du protocole chinois de domination algorithmique.</p>'},
  {id:'po',t:'PSYOPS vs Guerre Cognitive',cat:'Fondamental',tags:['fondamentaux','strat√©gie'],xp:30,sh:'De ¬´ convaincre ¬ª √† ¬´ alt√©rer ¬ª : la rupture entre op√©rations psychologiques et manipulation cognitive.',b:'<h3>La rupture</h3><table><tr><th>Dimension</th><th>PSYOPS</th><th>Guerre Cognitive</th></tr><tr><td>Vecteurs</td><td>M√©dias, tracts</td><td>Algorithmes, IA, neurotech</td></tr><tr><td>Cibles</td><td>Opinion (conscient)</td><td>Processus subconscients</td></tr><tr><td>Objectif</td><td>Ce que les gens pensent</td><td>Comment ils pensent</td></tr><tr><td>Temporalit√©</td><td>Ponctuelle</td><td>Permanente, bas bruit</td></tr></table>'},
  {id:'ic',t:'Inflexibilit√© Cognitive',cat:'Neurobiologie',tags:['neurosciences','m√©canismes'],xp:20,sh:'Incapacit√© √† r√©viser ses sch√©mas face aux faits ‚Äî vuln√©rabilit√© micro-individuelle n¬∞1.',b:'<h3>D√©clencheurs de vuln√©rabilit√©</h3><ul><li><strong>Inflexibilit√© cognitive :</strong> Refus de mettre √† jour ses croyances malgr√© des donn√©es contraires.</li><li><strong>Besoin d\'appartenance sociale :</strong> Validation de narratifs de groupe au prix de la v√©rit√©.</li><li><strong>Excitation √©motionnelle :</strong> Court-circuitage des filtres rationnels par la col√®re ou l\'indignation.</li></ul><p>L\'instabilit√© √©motionnelle est le pr√©dicteur n¬∞1 de la r√©ceptivit√© algorithmique.</p>'},
  {id:'ce2',t:'Court-circuitage √âmotionnel',cat:'Neurobiologie',tags:['neurosciences','m√©canismes','cerveau'],xp:25,sh:'Amygdale vs Cortex Pr√©frontal : quand l\'√©motion prend le contr√¥le de la d√©cision.',b:'<h3>Cortex vs Amygdale</h3><table><tr><th>Zone</th><th>Fonction</th><th>Effet de l\'agression</th></tr><tr><td>Cortex Pr√©frontal</td><td>Analyse, rationalit√©</td><td>Inhibition par stress</td></tr><tr><td>Amygdale</td><td>√âmotions, survie</td><td>Hyper-activation</td></tr></table><p>L\'utilisation de narratifs charg√©s de <strong>peur ou de col√®re</strong> vise √† privil√©gier l\'amygdale, favorisant des r√©actions impulsives et pr√©visibles.</p>'},
  {id:'cy',t:'Cadre Cynefin',cat:'Mod√©lisation',tags:['mod√©lisation','strat√©gie'],xp:30,sh:'Framework de Snowden : Simple ‚Üí Compliqu√© ‚Üí Complexe ‚Üí Chaotique ‚Üí D√©sordonn√©.',b:'<h3>4 domaines</h3><table><tr><th>Domaine</th><th>Action</th><th>Effet d\'attaque</th></tr><tr><td>Simple</td><td>Percevoir-Cat√©goriser-R√©pondre</td><td>Subversion des normes</td></tr><tr><td>Compliqu√©</td><td>Percevoir-Analyser-R√©pondre</td><td>Saturation par le bruit</td></tr><tr><td>Complexe</td><td>Sonder-Percevoir-R√©pondre</td><td>Fausses pistes syst√©miques</td></tr><tr><td>Chaotique</td><td>Agir-Percevoir-R√©pondre</td><td>Paralysie totale</td></tr></table><p>L\'objectif de l\'agresseur : pousser du Compliqu√© vers le <strong>Chaotique</strong> o√π les liens de causalit√© disparaissent.</p>'},
  {id:'dk',t:'Deepfakes & IA G√©n√©rative',cat:'Technologies',tags:['ia','technologies','manipulation'],xp:25,sh:'Subversion de la r√©alit√© par production massive de m√©dias synth√©tiques ind√©tectables.',b:'<h3>Rupture</h3><p>L\'IA g√©n√©rative permet la <strong>subversion de la r√©alit√© partag√©e</strong> par la production massive de m√©dias synth√©tiques ind√©tectables.</p><h3>Utilisations offensives</h3><ul><li>D√©sar√ßonner le cadre cognitif existant de la cible (√©tape 2 du protocole chinois).</li><li>Simuler un faux consensus via manipulation de la viralit√©.</li><li>Cr√©er des ¬´ preuves ¬ª audiovisuelles de faits inexistants.</li></ul>'},
  {id:'na',t:'Neuro-armes',cat:'Technologies',tags:['neurosciences','technologies','neuroarmes'],xp:35,sh:'Vecteurs √©mergents ciblant directement le support biologique de la pens√©e.',b:'<h3>Classification</h3><ul><li><strong>Rayonnements EM :</strong> √ânergie dirig√©e (cf. Syndrome de La Havane).</li><li><strong>Manipulation pharmacologique :</strong> Substances alt√©rant les capacit√©s cognitives.</li><li><strong>Interface cerveau-machine :</strong> Exploitation des neurotechnologies connect√©es.</li></ul><h3>Vecteurs de p√©n√©tration</h3><table><tr><th>Cat√©gorie</th><th>Exemples</th></tr><tr><td>Traditionnels</td><td>Presse, diplomatie publique</td></tr><tr><td>Existants</td><td>Algorithmes, objets connect√©s, r√©seaux sociaux</td></tr><tr><td>√âmergents</td><td>Neuro-armes, m√©tavers, IA massive</td></tr></table>'},
  {id:'cm',t:'Capture Motivationnelle',cat:'Propagation',tags:['propagation','m√©canismes'],xp:25,sh:'Quand l\'individu agit par motivation implant√©e tout en croyant √† sa propre autonomie.',b:'<h3>D√©finition</h3><p>L\'√©rosion de la <strong>souverainet√© cognitive</strong> du d√©cideur : il finit par adopter des comportements dict√©s par l\'agresseur tout en √©tant convaincu de sa propre autonomie de pens√©e.</p><h3>La vaccination</h3><p>L\'immunisation cognitive consiste √† s\'exposer √† des formes ¬´ att√©nu√©es ¬ª de manipulation pour construire des <strong>anticorps cognitifs</strong> ‚Äî exactement ce que COGWAR vous fait vivre.</p>'},
  {id:'lo',t:'Attracteur de Lorenz',cat:'Mod√©lisation',tags:['math√©matiques','mod√©lisation','asym√©trie'],xp:35,sh:'dx/dt = œÉ(y‚àíx) ‚Äî Quand une variation infinit√©simale de œÅ fait basculer une soci√©t√© dans le chaos.',b:'<h3>√âquations</h3><div class="formula">dx/dt = œÉ(y ‚àí x)<br>dy/dt = œÅx ‚àí y ‚àí xz<br>dz/dt = xy ‚àí Œ≤z</div><h3>Param√®tres g√©ostrat√©giques</h3><table><tr><th>Param√®tre</th><th>Signification</th></tr><tr><td>œÉ (sigma)</td><td>V√©locit√© de l\'information</td></tr><tr><td>œÅ (rho)</td><td>Niveau de m√©fiance publique</td></tr><tr><td>Œ≤ (beta)</td><td>Capacit√© d\'absorption du syst√®me</td></tr></table><p>Une variation infinit√©simale de œÅ peut faire basculer une soci√©t√© stable vers un <strong>d√©sordre permanent</strong>.</p>'},
  {id:'bb',t:'Op√©rations √† Bas Bruit',cat:'Asym√©trie',tags:['strat√©gie','asym√©trie','manipulation'],xp:25,sh:'Modification quasi-irr√©versible des habitudes de pens√©e sur le temps long, sans alerte.',b:'<h3>Principe</h3><p>Op√©ration sur le temps long modifiant les habitudes de pens√©e de mani√®re <strong>quasi-irr√©versible</strong>. L\'agression est permanente, diffuse, et op√®re sous le seuil de perception consciente.</p><h3>Caract√©ristiques</h3><ul><li>Pas de signature d\'attaque d√©tectable.</li><li>Effets cumulatifs irr√©versibles.</li><li>La victime ne sait jamais qu\'elle est cibl√©e.</li><li>Exploite la fatigue informationnelle comme vecteur d\'acceptation.</li></ul>'},
];
let meI=-1;
BUILTIN_EN_IDS=EN.map(e=>e.id);
const ETAGS=[...new Set(EN.flatMap(e=>e.tags))].sort();let aTag=null;
function rTags(){$('etg').innerHTML='<div class="et on" onclick="fTg(null,this)">Tout</div>'+ETAGS.map(t=>`<div class="et" onclick="fTg(\'${t}\',this)">${t}</div>`).join('')}
function rEN(l){$('eg').innerHTML=l.map(e=>`<div class="ec" onclick="oEN(${EN.indexOf(e)})"><div class="ecc">${e.cat}</div><div class="ect">${e.t}</div><div class="ecd">${e.sh}</div><div class="ecx ${ST.rd.includes(e.id)?'done':''}">${ST.rd.includes(e.id)?'‚úì':'+'+e.xp}</div></div>`).join('')}
function fTg(t,el){aTag=t;document.querySelectorAll('.et').forEach(x=>x.classList.remove('on'));el?.classList.add('on');fltE()}
function fltE(){const q=$('esr').value.toLowerCase();rEN(EN.filter(e=>(!aTag||e.tags.includes(aTag))&&(!q||e.t.toLowerCase().includes(q)||e.sh.toLowerCase().includes(q))))}
function oEN(i){meI=i;const e=EN[i];$('me-t').textContent=e.t;$('me-bd').innerHTML=e.b;const b=$('me-cl');if(ST.rd.includes(e.id)){b.textContent='‚úì LU';b.disabled=true}else{b.textContent=`+${e.xp} XP`;b.disabled=false}omo('mo-en')}
function meP(){oEN((meI-1+EN.length)%EN.length)}
function meN(){oEN((meI+1)%EN.length)}
function meC(){const e=EN[meI];if(ST.rd.includes(e.id))return;ST.rd.push(e.id);addXP(e.xp,e.t);$('me-cl').textContent='‚úì LU';$('me-cl').disabled=true;if(ST.rd.length>=1)achk('1st');if(ST.rd.length>=5)achk('5rd');if(ST.rd.length>=EN.length)achk('all');rEN(EN);svST()}

/* ‚ïê‚ïê‚ïê PROFILE & CHARACTER SHEET ENGINE ‚ïê‚ïê‚ïê */
let PROF={name:'OP√âRATEUR',bio:'',avatar:'ü§ñ',photo:null,filter:'none',settings:{fs:13,flip:4,compact:false,scan:true,disc:true,notif:true,sp:true,combo:true,loot:true}};
async function ldProf(){const p=await get('meta','profile');if(p)PROF=p.v}
async function svProf(){await put('meta',{k:'profile',v:PROF})}

/* ‚îÄ‚îÄ‚îÄ Classes & Ranks ‚îÄ‚îÄ‚îÄ */
const CLASSES=[
  {min:0,name:'RECRUE',icon:'‚óá',color:'var(--t3)'},
  {min:3,name:'SENTINELLE',icon:'‚óÜ',color:'var(--g1)'},
  {min:7,name:'ANALYSTE',icon:'‚óà',color:'var(--l1)'},
  {min:12,name:'STRAT√àGE',icon:'‚¨°',color:'var(--am)'},
  {min:18,name:'ARCHITECTE',icon:'‚¨¢',color:'#ff6b6b'},
  {min:25,name:'ORACLE',icon:'‚óâ',color:'#c4a8e6'},
  {min:35,name:'GHOST IN THE SHELL',icon:'‚äõ',color:'#ffd700'},
];
function getClass(lv){let c=CLASSES[0];for(const cl of CLASSES)if(lv>=cl.min)c=cl;return c}

/* ‚îÄ‚îÄ‚îÄ Augmentations ‚îÄ‚îÄ‚îÄ */
const AUGS=[
  {id:'neural',name:'Lien Neural',icon:'üß†',req:'LV3',check:()=>ST.lv>=3},
  {id:'firewall',name:'Pare-feu',icon:'üõ°',req:'10 bonnes r√©ponses',check:()=>ST.fO>=10},
  {id:'optic',name:'Optique Augment√©e',icon:'üëÅ',req:'Lire 5 entr√©es',check:()=>ST.rd.length>=5},
  {id:'reflex',name:'R√©flexe Cognitif',icon:'‚ö°',req:'Streak 5',check:()=>ST.bS>=5},
  {id:'crypto',name:'Module Crypto',icon:'üîê',req:'LV7',check:()=>ST.lv>=7},
  {id:'stealth',name:'Protocole Furtif',icon:'ü•∑',req:'50 cartes',check:()=>(ST.fO+ST.fK)>=50},
  {id:'hive',name:'R√©seau Hivemind',icon:'üåê',req:'3 decks install√©s',check:()=>true},
  {id:'chrono',name:'Distorsion Chrono',icon:'‚è±',req:'Streak 7 jours',check:()=>(ST.dayStreak||0)>=7},
  {id:'quantum',name:'Processeur Quantique',icon:'üíé',req:'LV12',check:()=>ST.lv>=12},
  {id:'omega',name:'Protocole Om√©ga',icon:'‚ò†Ô∏è',req:'LV18+100% pr√©cision',check:()=>ST.lv>=18&&ST.fO>0&&ST.fK===0,legendary:true},
  {id:'wopr',name:'WOPR Override',icon:'ü§ñ',req:'LV25',check:()=>ST.lv>=25,legendary:true},
  {id:'ghost',name:'Ghost in the Shell',icon:'üëª',req:'LV35',check:()=>ST.lv>=35,legendary:true},
];

/* ‚îÄ‚îÄ‚îÄ Photo System ‚îÄ‚îÄ‚îÄ */
const FILTERS=[
  {id:'none',name:'Original',css:'none'},
  {id:'cyber',name:'Cyber',css:'saturate(1.4) hue-rotate(120deg) contrast(1.2)'},
  {id:'neon',name:'Neon',css:'saturate(2) brightness(1.1) hue-rotate(270deg)'},
  {id:'ghost',name:'Ghost',css:'grayscale(.7) brightness(1.3) contrast(.9)'},
  {id:'matrix',name:'Matrix',css:'sepia(1) saturate(3) hue-rotate(70deg) brightness(.8)'},
  {id:'redpill',name:'Red Pill',css:'sepia(.6) saturate(2) hue-rotate(320deg) contrast(1.1)'},
  {id:'thermal',name:'Thermal',css:'saturate(3) hue-rotate(180deg) contrast(1.5) brightness(.9)'},
  {id:'glitch',name:'Glitch',css:'contrast(1.8) brightness(.9) saturate(1.5)'},
];

function handlePhoto(e){
  const file=e.target.files[0];if(!file)return;
  if(file.size>5*1024*1024){toast('Max 5 Mo','err');return}
  const reader=new FileReader();
  reader.onload=function(){
    const img=new Image();
    img.onload=function(){
      const c=document.createElement('canvas');c.width=256;c.height=256;
      const ctx=c.getContext('2d');
      const s=Math.min(img.width,img.height);
      const sx=(img.width-s)/2,sy=(img.height-s)/2;
      ctx.drawImage(img,sx,sy,s,s,0,0,256,256);
      PROF.photo=c.toDataURL('image/jpeg',0.85);
      svProf();renderCharCard();
    };
    img.src=reader.result;
  };
  reader.readAsDataURL(file);e.target.value='';
}
function clearPhoto(){PROF.photo=null;PROF.filter='none';svProf();renderCharCard()}
function setFilter(id){PROF.filter=id;svProf();renderCharCard()}
function renderFilterBtns(){
  const el=$('pf-btns');if(!el)return;
  el.innerHTML=FILTERS.map(f=>`<div class="pf-btn ${PROF.filter===f.id?'on':''}" onclick="setFilter('${f.id}')">${f.name}</div>`).join('');
}

/* ‚îÄ‚îÄ‚îÄ Derived Stats ‚îÄ‚îÄ‚îÄ */
function calcStats(){
  const total=ST.fO+ST.fK;const acc=total?Math.round(ST.fO/total*100):0;
  const cog=Math.min(99,Math.floor(Math.log2(ST.xp+1)*6));
  const res=Math.min(99,Math.floor((ST.bS*3)+(ST.dayStreak||0)*5));
  const cri=Math.min(99,Math.floor(ST.rd.length*4+acc*0.3));
  return{cog,res,cri,acc,streak:ST.bS,sessions:ST.sessions};
}

/* ‚îÄ‚îÄ‚îÄ Render Character Card ‚îÄ‚îÄ‚îÄ */
function renderCharCard(){
  const cl=getClass(ST.lv);const stats=calcStats();
  $('ch-class').textContent=`${cl.icon} ${cl.name}`;$('ch-class').style.borderColor=cl.color;$('ch-class').style.color=cl.color;
  $('ch-name').textContent=PROF.name;$('ch-glitch').textContent=PROF.name;
  $('ch-title').textContent=PROF.bio||classTitle(cl.name);
  $('ch-serial').textContent=`WOPR-${String(Math.abs(hashStr(PROF.name))).slice(0,4).padStart(4,'0')} ¬∑ COGWAR DIVISION`;
  const phEl=$('ph-img'),plEl=$('ph-ph');
  if(PROF.photo){
    phEl.src=PROF.photo;phEl.style.display='block';
    phEl.style.filter=FILTERS.find(f=>f.id===PROF.filter)?.css||'none';
    plEl.style.display='none';$('photo-settings').style.display='';renderFilterBtns();
  }else{phEl.style.display='none';plEl.style.display='';plEl.textContent=PROF.avatar;$('photo-settings').style.display='none'}
  const avBtn=$('av-btn');
  if(PROF.photo){avBtn.innerHTML=`<img src="${PROF.photo}" style="filter:${FILTERS.find(f=>f.id===PROF.filter)?.css||'none'}"><div class="notif" id="notif-dot" style="display:${hasNotif&&PROF.settings.notif?'':'none'}"></div>`}
  else{avBtn.innerHTML=`<span id="av-ico">${PROF.avatar}</span><div class="notif" id="notif-dot" style="display:${hasNotif&&PROF.settings.notif?'':'none'}"></div>`}
  const xpInLv=ST.xp%100;$('ch-lv').textContent=ST.lv;$('ch-lv').style.borderColor=cl.color;$('ch-lv').style.color=cl.color;
  $('ch-nxlv').textContent=ST.lv+1;$('ch-xpf').style.width=(xpInLv)+'%';$('ch-xp').textContent=xpInLv;$('ch-xpmax').textContent=100;
  $('cs-cog').textContent=stats.cog;$('csb-cog').style.width=stats.cog+'%';
  $('cs-res').textContent=stats.res;$('csb-res').style.width=Math.min(100,stats.res)+'%';
  $('cs-cri').textContent=stats.cri;$('csb-cri').style.width=Math.min(100,stats.cri)+'%';
  $('cs-pre').textContent=stats.acc+'%';$('csb-pre').style.width=stats.acc+'%';
  $('cs-str').textContent=stats.streak;$('csb-str').style.width=Math.min(100,stats.streak*3)+'%';
  $('cs-ses').textContent=stats.sessions;$('csb-ses').style.width=Math.min(100,stats.sessions*5)+'%';
  $('aug-grid').innerHTML=AUGS.map(a=>{const u=a.check();return`<div class="aug ${u?'active':''} ${a.legendary&&u?'legendary':''}" title="${a.req}">${a.icon} ${a.name}${u?'':' üîí'}</div>`}).join('');
  $('set-name').value=PROF.name;$('set-bio').value=PROF.bio;
}
function classTitle(cls){const t={'RECRUE':'R√©sistant cognitif en formation','SENTINELLE':'Veilleur de l\'espace informationnel','ANALYSTE':'D√©crypteur de patterns','STRAT√àGE':'Architecte de contre-mesures','ARCHITECTE':'Forgeur de r√©silience syst√©mique','ORACLE':'Celui qui voit au-del√† du voile','GHOST IN THE SHELL':'Transcendance cognitive atteinte'};return t[cls]||'Agent COGWAR'}
function hashStr(s){let h=0;for(let i=0;i<s.length;i++)h=((h<<5)-h)+s.charCodeAt(i);return h}
function saveProfile(){PROF.name=$('set-name').value.trim()||'OP√âRATEUR';PROF.bio=$('set-bio').value.trim();svProf();renderCharCard()}

/* ‚îÄ‚îÄ‚îÄ Settings ‚îÄ‚îÄ‚îÄ */
function applyFS(){const v=$('set-fs').value;$('set-fs-val').textContent=v;PROF.settings.fs=+v;document.querySelector('.mn').style.fontSize=v+'px';svProf()}
function applyFlip(){const v=$('set-flip').value;$('set-flip-val').textContent=v;PROF.settings.flip=+v;document.documentElement.style.setProperty('--flip-speed',(v/10)+'s');svProf()}
function toggleSet(key){
  PROF.settings[key]=!PROF.settings[key];
  const el=$('set-'+key);if(el)el.classList.toggle('on',PROF.settings[key]);
  if(key==='compact')document.querySelector('.mn').style.padding=PROF.settings.compact?'50px 8px 66px':'';
  if(key==='scan')document.body.style.setProperty('--sc-opacity',PROF.settings.scan?'.3':'0');
  if(key==='disc')document.querySelectorAll('.disc-btn').forEach(b=>b.style.display=PROF.settings.disc?'':'none');
  if(key==='notif')$('notif-dot').style.display=PROF.settings.notif&&hasNotif?'':'none';
  if(key==='sp')$('social-proof').style.display=PROF.settings.sp?'':'none';
  svProf();
}
function applySettings(){
  const s=PROF.settings;$('set-fs').value=s.fs||13;$('set-fs-val').textContent=s.fs||13;
  $('set-flip').value=s.flip||4;$('set-flip-val').textContent=s.flip||4;
  ['compact','scan','disc','notif','sp','combo','loot'].forEach(k=>{const el=$('set-'+k);if(el)el.classList.toggle('on',s[k]!==false)});
  if(s.fs&&s.fs!==13)document.querySelector('.mn').style.fontSize=s.fs+'px';
  if(s.compact)document.querySelector('.mn').style.padding='50px 8px 66px';
  if(s.disc===false)document.querySelectorAll('.disc-btn').forEach(b=>b.style.display='none');
  if(s.sp===false)$('social-proof').style.display='none';
}

/* ‚îÄ‚îÄ‚îÄ Avatar Picker ‚îÄ‚îÄ‚îÄ */
const AVATARS=['ü§ñ','üß†','üëÅ','üõ°','‚ö°','üî•','üéÆ','üíÄ','üëæ','ü¶ä','üê∫','ü¶Ö','üêô','üåÄ','üíé','üè¥‚Äç‚ò†Ô∏è','üé≠','üß¨','üîÆ','üåô','‚≠ê','üöÄ','üó°','üèÜ','üéØ','üßø','‚ò†Ô∏è','ü§Ø','ü´†','ü•∑','ü¶æ','üëΩ'];
function rAvatars(){$('emoji-grid').innerHTML=AVATARS.map(e=>`<div class="emoji-opt" onclick="pickAv('${e}')">${e}</div>`).join('')}
function pickAv(e){PROF.avatar=e;svProf();renderCharCard()}
function applyProf(){renderCharCard()}


/* ‚ïê‚ïê‚ïê STREAK SYSTEM ‚ïê‚ïê‚ïê */
function updateStreak(){
  const now=new Date();const today=now.toISOString().slice(0,10);
  if(!ST.lastPlay){ST.lastPlay=today;ST.dayStreak=1;svST();rStreak();return}
  const last=new Date(ST.lastPlay);const diff=Math.floor((now-last)/(1000*60*60*24));
  if(diff===0){/* same day */}
  else if(diff===1){ST.dayStreak=(ST.dayStreak||0)+1;ST.lastPlay=today}
  else{ST.dayStreak=1;ST.lastPlay=today}
  svST();rStreak();
}
function rStreak(){
  const s=ST.dayStreak||0;
  $('streak-bar').style.display=s>0?'flex':'none';
  $('streak-num').textContent=s;
  if(s>=7)$('streak-txt').textContent=`${s} jours! Vous √™tes en feu!`;
  else if(s>=3)$('streak-txt').textContent=`${s} jours d'affil√©e!`;
  else $('streak-txt').textContent=`${s} jour${s>1?'s':''} ‚Äî continuez!`;
  // Show warning if streak could be lost (played yesterday)
  const now=new Date();const h=now.getHours();
  if(s>=2&&h>=20)$('streak-warn').style.display='block';
  else $('streak-warn').style.display='none';
}

/* ‚ïê‚ïê‚ïê COMBO SYSTEM ‚ïê‚ïê‚ïê */
let comboCount=0,comboTimer=null;
function triggerCombo(){
  comboCount++;
  if(!PROF.settings.combo)return;
  if(comboCount>=3){
    const mult=Math.min(Math.floor(comboCount/3)+1,5);
    const ov=$('combo-ov');
    ov.textContent=`√ó${mult} COMBO!`;
    ov.classList.remove('show');void ov.offsetWidth;ov.classList.add('show');
    // Bonus XP on combos
    if(comboCount%5===0){
      const bonus=mult*5;ST.xp+=bonus;upXP();svST();
      toast(`üî• COMBO √ó${mult}! +${bonus} XP bonus`,'ach');
    }
    // Show combo disclaimer after first big combo
    if(comboCount===5&&PROF.settings.disc){
      $('disc-combo').classList.add('show');setTimeout(()=>$('disc-combo').classList.remove('show'),8000);
    }
  }
}
function resetCombo(){comboCount=0}

/* ‚ïê‚ïê‚ïê LOOT BOX ‚ïê‚ïê‚ïê */
const LOOT_TABLE=[
  {w:30,label:'+15 XP',xp:15,icon:'‚ö°'},
  {w:25,label:'+25 XP',xp:25,icon:'üíé'},
  {w:15,label:'+50 XP',xp:50,icon:'üî•'},
  {w:10,label:'+100 XP JACKPOT',xp:100,icon:'üèÜ'},
  {w:10,label:'Titre: Hacker',xp:10,icon:'üè¥‚Äç‚ò†Ô∏è',title:'Hacker'},
  {w:5,label:'Titre: Sentinelle',xp:20,icon:'üõ°',title:'Sentinelle'},
  {w:3,label:'Titre: WOPR',xp:50,icon:'ü§ñ',title:'WOPR'},
  {w:2,label:'‚òÖ L√âGENDAIRE +200 XP',xp:200,icon:'üëÅ',title:'Omniscient'},
];
let lootReady=false;
function checkLoot(){
  if(!PROF.settings.loot)return;
  // Award loot box every 10 correct answers
  if(ST.fO>0&&ST.fO%10===0&&!lootReady){
    lootReady=true;$('lootbox').style.display='block';$('lootbox').classList.remove('opened');
    $('loot-ico').textContent='üéÅ';$('loot-result').textContent='';
    if(PROF.settings.notif){hasNotif=true;$('notif-dot').style.display=''}
  }
}
function openLoot(){
  if(!lootReady)return;lootReady=false;
  // Weighted random
  const total=LOOT_TABLE.reduce((s,l)=>s+l.w,0);
  let r=Math.random()*total,pick=LOOT_TABLE[0];
  for(const l of LOOT_TABLE){r-=l.w;if(r<=0){pick=l;break}}
  $('loot-ico').textContent=pick.icon;$('loot-result').textContent=pick.label;
  $('lootbox').classList.add('opened');
  ST.xp+=pick.xp;upXP();svST();
  toast(`üéÅ ${pick.label}`,'ach');
  if(pick.title){PROF.bio=`Titre: ${pick.title}`;svProf();applyProf()}
  hasNotif=false;$('notif-dot').style.display='none';
  // Show disclaimer
  if(PROF.settings.disc){
    setTimeout(()=>{$('disc-loot').classList.add('show');setTimeout(()=>$('disc-loot').classList.remove('show'),8000)},1500);
  }
  setTimeout(()=>{$('lootbox').style.display='none'},5000);
}

/* ‚ïê‚ïê‚ïê DAILY CHALLENGE ‚ïê‚ïê‚ïê */
function updateDaily(){
  const now=new Date();const seed=now.toISOString().slice(0,10);
  // Deterministic card of the day from all embedded cards
  const all=BUILTIN_DECKS.flatMap(d=>d.cards);
  const hash=[...seed].reduce((h,c)=>((h<<5)-h)+c.charCodeAt(0),0);
  const idx=Math.abs(hash)%all.length;
  $('dc-q').textContent=all[idx].q;
  // Timer
  const midnight=new Date(now);midnight.setHours(24,0,0,0);
  const updateTimer=()=>{
    const diff=midnight-new Date();if(diff<=0){updateDaily();return}
    const h=Math.floor(diff/3600000),m=Math.floor((diff%3600000)/60000),s=Math.floor((diff%60000)/1000);
    $('dc-timer').textContent=`${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
  };
  updateTimer();setInterval(updateTimer,1000);
}

/* ‚ïê‚ïê‚ïê SOCIAL PROOF (fake) ‚ïê‚ïê‚ïê */
function updateSP(){
  // Generate believable fake number based on time of day
  const h=new Date().getHours();
  const base=h>=8&&h<=22?200+Math.floor(h*15):40+Math.floor(Math.random()*30);
  const jitter=Math.floor(Math.random()*50);
  $('sp-num').textContent=base+jitter;
  // Slowly increment
  setInterval(()=>{
    const cur=parseInt($('sp-num').textContent)||0;
    if(Math.random()>.6)$('sp-num').textContent=cur+(Math.random()>.5?1:-1);
  },8000);
}

/* ‚ïê‚ïê‚ïê NOTIFICATION DOT ‚ïê‚ïê‚ïê */
let hasNotif=false;

/* ‚ïê‚ïê‚ïê DISCLAIMER TOGGLE ‚ïê‚ïê‚ïê */
function toggleDisc(id){const el=$(id);el.classList.toggle('show')}

/* ‚ïê‚ïê‚ïê SEARCH ENGINE ‚ïê‚ïê‚ïê */
let searchFilter='all';
function openSearch(){$('search-ov').classList.add('show');$('search-in').value='';$('search-in').focus();$('sr-list').innerHTML='<div class="sr-empty"><div class="sr-e-ico">üîç</div>Tapez pour rechercher dans tout COGWAR</div>';$('sr-count').textContent=''}
function closeSearch(){$('search-ov').classList.remove('show')}
function setSF(f,el){searchFilter=f;document.querySelectorAll('.sf-btn').forEach(b=>b.classList.remove('on'));el.classList.add('on');doSearch()}

async function doSearch(){
  const q=$('search-in').value.trim().toLowerCase();
  if(q.length<2){$('sr-list').innerHTML='<div class="sr-empty"><div class="sr-e-ico">üîç</div>Minimum 2 caract√®res</div>';$('sr-count').textContent='';return}
  const results=[];
  const hl=(t,q)=>{const re=new RegExp(`(${q.replace(/[.*+?^${}()|[\]\\]/g,'\\$&')})`,'gi');return t.replace(re,'<mark>$1</mark>')};
  const words=q.split(/\s+/).filter(w=>w.length>=2);
  const match=(text)=>words.every(w=>text.toLowerCase().includes(w));

  // Search flashcards
  if(searchFilter==='all'||searchFilter==='cards'){
    const allDecks=await getAll('decks');
    for(const dk of allDecks){
      for(const card of (dk.cards||[])){
        if(match(card.q+' '+card.a)){
          results.push({type:'FLASHCARD',title:card.q,excerpt:card.a,deck:dk.name,action:()=>{closeSearch();go('play')}});
        }
      }
    }
  }

  // Search encyclopedia
  if(searchFilter==='all'||searchFilter==='ency'){
    for(const e of EN){
      const corpus=e.t+' '+e.sh+' '+e.cat+' '+e.tags.join(' ')+(e.b||'').replace(/<[^>]+>/g,' ');
      if(match(corpus)){
        const idx=EN.indexOf(e);
        results.push({type:'ENCYCLOP√âDIE',title:e.t,excerpt:e.sh,cat:e.cat,action:()=>{closeSearch();oEN(idx)}});
      }
    }
  }

  // Search decks
  if(searchFilter==='all'||searchFilter==='decks'){
    const allDecks=await getAll('decks');
    for(const dk of allDecks){
      if(match(dk.name+' '+(dk.description||'')+' '+(dk.tags||[]).join(' '))){
        results.push({type:'DECK',title:dk.icon+' '+dk.name,excerpt:(dk.description||'')+' ¬∑ '+dk.cards.length+' cartes',action:()=>{closeSearch();go('lib')}});
      }
    }
  }

  $('sr-count').textContent=`${results.length} r√©sultat${results.length!==1?'s':''} pour ¬´ ${q} ¬ª`;
  if(!results.length){
    $('sr-list').innerHTML='<div class="sr-empty"><div class="sr-e-ico">üëÅ</div>Aucun r√©sultat ‚Äî le voile informationnel persiste</div>';
    return;
  }
  $('sr-list').innerHTML=results.slice(0,50).map((r,i)=>`<div class="sr-item" onclick="searchResults[${i}].action()"><div class="sr-type">${r.type}${r.cat?' ¬∑ '+r.cat:''}${r.deck?' ¬∑ '+r.deck:''}</div><div class="sr-title">${hl(r.title,q)}</div><div class="sr-excerpt">${hl(r.excerpt,q)}</div></div>`).join('');
  window.searchResults=results;
}

// Keyboard shortcut: Ctrl+K or / to open search
document.addEventListener('keydown',e=>{
  if((e.ctrlKey&&e.key==='k')||(!e.ctrlKey&&!e.altKey&&e.key==='/'&&document.activeElement.tagName!=='INPUT'&&document.activeElement.tagName!=='TEXTAREA')){
    e.preventDefault();openSearch();
  }
  if(e.key==='Escape'&&$('search-ov').classList.contains('show')){closeSearch()}
});

/* ‚ïê‚ïê‚ïê CONSOLE TERMINAL ‚ïê‚ïê‚ïê */
const conHistory=[];
let conHistIdx=-1;

function conBoot(){
  const out=$('con-out');
  out.innerHTML='';
  cPrint('ascii',`
 ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ïó    ‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó
‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù ‚ñà‚ñà‚ïë    ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó
‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë ‚ñà‚ïó ‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù
‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó
‚ïö‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ïö‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ïö‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ïö‚ñà‚ñà‚ñà‚ïî‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë
 ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù  ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù  ‚ïö‚ïê‚ïê‚ïù‚ïö‚ïê‚ïê‚ïù ‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïù‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïù`);
  cPrint('info','WOPR Cognitive Warfare Terminal ‚Äî ULTIMATE');
  cPrint('out','Tapez <span class="hl">help</span> pour la liste des commandes.');
  cPrint('out','');
}

function cPrint(cls,text){
  const out=$('con-out');
  const d=document.createElement('div');d.className='c-line';
  d.innerHTML=`<span class="${cls}">${text}</span>`;
  out.appendChild(d);out.scrollTop=out.scrollHeight;
}

function conExec(){
  const inp=$('con-in');const raw=inp.value.trim();inp.value='';
  if(!raw)return;
  conHistory.unshift(raw);conHistIdx=-1;
  cPrint('cmd','<span class="prompt">wopr&gt;</span> '+esc(raw));
  const [cmd,...args]=raw.split(/\s+/);
  const arg=args.join(' ');

  switch(cmd.toLowerCase()){
    case 'help':
      cPrint('info','Commandes disponibles :');
      cPrint('out',' <span class="hl">whoami</span>       ‚Äî Fiche agent');
      cPrint('out',' <span class="hl">stats</span>        ‚Äî Statistiques compl√®tes');
      cPrint('out',' <span class="hl">search</span> &lt;q&gt;   ‚Äî Recherche globale');
      cPrint('out',' <span class="hl">ency</span> [index]  ‚Äî Encyclop√©die (liste ou d√©tail)');
      cPrint('out',' <span class="hl">decks</span>        ‚Äî Liste des decks install√©s');
      cPrint('out',' <span class="hl">quiz</span>         ‚Äî Flashcard al√©atoire');
      cPrint('out',' <span class="hl">augs</span>         ‚Äî Augmentations d√©bloqu√©es');
      cPrint('out',' <span class="hl">threats</span>      ‚Äî Niveau de menace');
      cPrint('out',' <span class="hl">matrix</span>       ‚Äî Simulation Matrix');
      cPrint('out',' <span class="hl">ping</span> &lt;cible&gt; ‚Äî Ping r√©seau fictif');
      cPrint('out',' <span class="hl">hack</span>         ‚Äî ???');
      cPrint('out',' <span class="hl">export</span>       ‚Äî Exporter les stats JSON');
      cPrint('out',' <span class="hl">theme</span> &lt;nom&gt;  ‚Äî dark | eighties | disco');
      cPrint('out',' <span class="hl">clear</span>        ‚Äî Effacer la console');
      cPrint('out',' <span class="hl">reboot</span>       ‚Äî Red√©marrer WOPR');
      break;

    case 'whoami':{
      const cl=getClass(ST.lv);const s=calcStats();
      cPrint('hl',`[AGENT: ${PROF.name}]`);
      cPrint('out',`Classe  : ${cl.icon} ${cl.name}`);
      cPrint('out',`Niveau  : ${ST.lv} (${ST.xp} XP)`);
      cPrint('out',`Bio     : ${PROF.bio||classTitle(cl.name)}`);
      cPrint('out',`Serial  : WOPR-${String(Math.abs(hashStr(PROF.name))).slice(0,4).padStart(4,'0')}`);
      cPrint('out',`COG: ${s.cog} | RES: ${s.res} | CRI: ${s.cri} | ACC: ${s.acc}%`);
      break;
    }

    case 'stats':
      cPrint('hl','[STATISTICS]');
      cPrint('out',`XP Total     : ${ST.xp}`);
      cPrint('out',`Niveau       : ${ST.lv}`);
      cPrint('out',`Bonnes r√©p.  : ${ST.fO}`);
      cPrint('out',`Mauvaises    : ${ST.fK}`);
      cPrint('out',`Pr√©cision    : ${ST.fO+ST.fK?Math.round(ST.fO/(ST.fO+ST.fK)*100):0}%`);
      cPrint('out',`Best streak  : ${ST.bS}`);
      cPrint('out',`Day streak   : ${ST.dayStreak||0}`);
      cPrint('out',`Sessions     : ${ST.sessions}`);
      cPrint('out',`Entr√©es lues : ${ST.rd.length}/${EN.length}`);
      break;

    case 'search':
      if(!arg){cPrint('err','Usage: search <terme>');break}
      const sq=arg.toLowerCase();
      let found=[];
      for(const e of EN){if((e.t+e.sh+e.cat).toLowerCase().includes(sq))found.push(`[ENCY] ${e.t} ‚Äî ${e.sh}`)}
      BUILTIN_DECKS.forEach(d=>d.cards.forEach(c=>{if((c.q+c.a).toLowerCase().includes(sq))found.push(`[CARD] ${c.q.slice(0,60)}...`)}));
      if(found.length){cPrint('ok',`${found.length} r√©sultat(s) :`);found.slice(0,15).forEach(f=>cPrint('out',' '+f))}
      else cPrint('err','Aucun r√©sultat pour "'+esc(arg)+'"');
      break;

    case 'ency':
      if(arg){
        const idx=parseInt(arg);
        if(idx>=0&&idx<EN.length){const e=EN[idx];cPrint('hl',`[${e.cat}] ${e.t}`);cPrint('out',e.sh)}
        else{const e=EN.find(x=>x.t.toLowerCase().includes(arg.toLowerCase()));if(e){cPrint('hl',`[${e.cat}] ${e.t}`);cPrint('out',e.sh)}else cPrint('err','Entr√©e non trouv√©e')}
      }else{
        cPrint('info',`Encyclop√©die : ${EN.length} entr√©es`);
        EN.forEach((e,i)=>cPrint('out',` ${String(i).padStart(2,' ')}. [${e.cat}] ${e.t}`));
      }
      break;

    case 'decks':{
      const allDk=BUILTIN_DECKS;
      cPrint('info',`${allDk.length} decks embarqu√©s :`);
      allDk.forEach(d=>cPrint('out',` ${d.icon} ${d.name} ‚Äî ${d.cards.length} cartes`));
      break;
    }

    case 'quiz':{
      const all=BUILTIN_DECKS.flatMap(d=>d.cards);
      const c=all[Math.floor(Math.random()*all.length)];
      cPrint('hl','[QUIZ FLASH]');
      cPrint('out','Q: '+c.q);
      cPrint('info','(tapez "answer" pour la r√©ponse)');
      window._lastQuiz=c;
      break;
    }

    case 'answer':
      if(window._lastQuiz){cPrint('ok','R: '+window._lastQuiz.a);window._lastQuiz=null}
      else cPrint('err','Pas de quiz en cours. Tapez "quiz" d\'abord.');
      break;

    case 'augs':{
      cPrint('hl','[AUGMENTATIONS]');
      AUGS.forEach(a=>{const u=a.check();cPrint(u?'ok':'out',` ${a.icon} ${a.name} ${u?'‚úì ACTIVE':'üîí '+a.req}`)});
      break;
    }

    case 'threats':
      cPrint('hl','[THREAT ANALYSIS]');
      cPrint('err','‚ö† DEFCON 2 ‚Äî COGNITIVE WARFARE ACTIVE');
      cPrint('out','Active vectors detected:');
      cPrint('out',' ‚ñ∫ Algorithmic micro-targeting: <span class="err">HIGH</span>');
      cPrint('out',' ‚ñ∫ Deepfake generation: <span class="err">CRITICAL</span>');
      cPrint('out',' ‚ñ∫ Social proof manipulation: <span class="hl">MODERATE</span>');
      cPrint('out',' ‚ñ∫ Echo chamber density: <span class="err">HIGH</span>');
      cPrint('out',' ‚ñ∫ Epistemic closure risk: <span class="hl">ELEVATED</span>');
      cPrint('out',`Your cognitive resilience: <span class="ok">${calcStats().res}/99</span>`);
      break;

    case 'matrix':
      cPrint('ok','Initializing Matrix simulation...');
      let mIdx=0;
      const mLines=['Wake up, '+PROF.name+'...','The Matrix has you...','Follow the white rabbit.','Knock, knock, '+PROF.name+'.'];
      const mInt=setInterval(()=>{
        if(mIdx<mLines.length){cPrint('hl',mLines[mIdx]);mIdx++}
        else{clearInterval(mInt);cPrint('ok','[Simulation complete. Red pill taken.]')}
      },800);
      break;

    case 'ping':
      if(!arg){cPrint('err','Usage: ping <cible>');break}
      cPrint('out',`PING ${esc(arg)} (${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)})...`);
      let pIdx=0;
      const pInt=setInterval(()=>{
        if(pIdx<4){cPrint('out',`  ${pIdx+1}: time=${Math.floor(Math.random()*200)+10}ms TTL=${64-pIdx*4}`);pIdx++}
        else{clearInterval(pInt);cPrint('ok',`--- ${esc(arg)} statistics: 4 packets sent, 4 received ---`)}
      },400);
      break;

    case 'hack':
      cPrint('err','ACCESS DENIED');
      cPrint('err','Nice try, '+PROF.name+'. La guerre cognitive n\'est pas un jeu.');
      cPrint('out','...ou peut-√™tre que si. Tapez <span class="hl">quiz</span>.');
      break;

    case 'export':
      cPrint('ok','Exporting cognitive state...');
      const expData={agent:PROF.name,class:getClass(ST.lv).name,level:ST.lv,xp:ST.xp,stats:calcStats(),timestamp:new Date().toISOString()};
      cPrint('out',JSON.stringify(expData,null,2));
      break;

    case 'theme':
      if(['dark','eighties','disco'].includes(arg)){setT(arg);cPrint('ok','Theme set to '+arg)}
      else cPrint('err','Th√®mes: dark, eighties, disco');
      break;

    case 'clear':
      $('con-out').innerHTML='';break;

    case 'reboot':
      $('con-out').innerHTML='';
      cPrint('err','SYSTEM REBOOT...');
      setTimeout(conBoot,1000);
      break;

    case 'joshua':
      cPrint('hl','"A STRANGE GAME."');
      cPrint('hl','"THE ONLY WINNING MOVE IS NOT TO PLAY."');
      cPrint('out','‚Äî Joshua / WOPR, WarGames (1983)');
      break;

    case 'sudo':
      cPrint('err',PROF.name+' is not in the sudoers file. This incident will be reported.');
      break;

    case 'rm':
      cPrint('err','Are you trying to destroy the cognitive defense matrix? Denied.');
      break;

    default:
      cPrint('err',`Commande inconnue : "${esc(cmd)}". Tapez <span class="hl">help</span>.`);
  }
}

// Console history navigation (deferred)
document.addEventListener('DOMContentLoaded',()=>{
  const ci=$('con-in');if(ci)ci.addEventListener('keydown',e=>{
    if(e.key==='ArrowUp'){e.preventDefault();if(conHistIdx<conHistory.length-1){conHistIdx++;ci.value=conHistory[conHistIdx]}}
    if(e.key==='ArrowDown'){e.preventDefault();if(conHistIdx>0){conHistIdx--;ci.value=conHistory[conHistIdx]}else{conHistIdx=-1;ci.value=''}}
  });
});

/* ‚ïê‚ïê‚ïê HOOK INTO PLAY ENGINE ‚ïê‚ïê‚ïê */
const _origPans=pans;
pans=function(ok){
  if(ok){triggerCombo();checkLoot()}else{resetCombo()}
  _origPans(ok);
  updateStreak();
};

/* ‚ïê‚ïê‚ïê BOOT ‚ïê‚ïê‚ïê */
const BL=['WOPR ULTIMATE ONLINE...','GREETINGS, PROFESSOR FALKEN.','IndexedDB: READY ¬∑ Store: SYNCED','235 cards ¬∑ 30 entries ¬∑ Console ACTIVE','SHALL WE PLAY A GAME?'];
function boot(){const el=$('boot-l'),bar=$('boot-f');let i=0;const nx=()=>{if(i>=BL.length){bar.style.width='100%';setTimeout(()=>{$('boot').classList.add('done');$('app').classList.add('on');setTimeout(()=>{try{$('boot').remove()}catch(e){}},500)},150);return}el.textContent=BL[i];bar.style.width=((i+1)/BL.length*100)+'%';i++;setTimeout(nx,250)};nx()}

/* ‚ïê‚ïê‚ïê INIT ‚ïê‚ïê‚ïê */
async function init(){
  await idb();
  await installBuiltins();
  await ldST();
  await ldProf();
  await loadCustomEncy();
  const t=localStorage.getItem('cw-t');if(t)setT(t);
  // Rebuild tags after custom ency loaded
  const freshTags=[...new Set(EN.flatMap(e=>e.tags))].sort();
  $('etg').innerHTML='<div class="et on" onclick="fTg(null,this)">Tout</div>'+freshTags.map(t=>`<div class="et" onclick="fTg('${t}',this)">${t}</div>`).join('');
  upXP();rEN(EN);rAch();rAvatars();
  applyProf();applySettings();
  updateStreak();updateDaily();updateSP();
  await rHome();
  boot();
}
if('serviceWorker' in navigator)navigator.serviceWorker.register('sw.js').catch(()=>{});
init();
</script></body></html>
