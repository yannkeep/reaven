<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>LA FORGE â€” ouaisfieu Â· ateliers-dÃ©bats citoyens</title>
<meta name="description" content="15 formats d'ateliers-dÃ©bats citoyens gratuits, testÃ©s, forkables. Intelligence citoyenne belge.">
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--bg:#0f172a;--bg2:#1e293b;--bg3:#334155;--tx:#e2e8f0;--tx2:#94a3b8;--tx3:#64748b;--mint:#34d399;--lila:#8b5cf6;--ora:#f97316;--blu:#3b82f6;--pink:#ec4899;--yel:#eab308;--r:10px}
html{font-size:15px;scroll-behavior:smooth}
body{background:var(--bg);color:var(--tx);font-family:system-ui,-apple-system,sans-serif;min-height:100vh}
a{color:var(--lila);text-decoration:none}a:hover{text-decoration:underline}
button{font-family:inherit;cursor:pointer}

/* HEADER */
.hdr{background:var(--bg2);border-bottom:2px solid var(--bg3);padding:14px 20px;position:sticky;top:0;z-index:50}
.hdr-in{max-width:1200px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:10px}
.logo{display:flex;align-items:center;gap:10px}
.logo-i{font-size:28px}.logo-t{font-size:18px;font-weight:800;color:var(--mint)}
.logo-s{font-size:11px;color:var(--tx3);letter-spacing:1px}
.tabs{display:flex;gap:2px;flex-wrap:wrap}
.tab{padding:8px 16px;border-radius:8px;border:none;font-size:13px;font-weight:600;background:transparent;color:var(--tx2);transition:all .15s}
.tab:hover{color:var(--tx)}.tab.on{background:#34d39920;color:var(--mint)}

/* VIEWS */
.view{display:none;max-width:1200px;margin:0 auto;padding:20px}.view.on{display:block}
#v-liens.on,#v-graph.on{display:block;max-width:none;padding:0}
h1{font-size:22px;font-weight:800;color:var(--mint);text-align:center;margin-bottom:4px}
h2{font-size:18px;font-weight:800;color:var(--mint);margin-bottom:4px}
h3{font-size:14px;font-weight:700;color:var(--lila);margin:16px 0 8px}
.sub{color:var(--tx2);font-size:13px;text-align:center;margin-bottom:16px}

/* FILTERS */
.filters{display:flex;gap:6px;flex-wrap:wrap;align-items:center;margin-bottom:16px}
.search{flex:1 1 180px;background:var(--bg2);border:1px solid var(--bg3);color:var(--tx);padding:8px 14px;border-radius:8px;font-size:13px;outline:none;min-width:150px}
.search:focus{border-color:var(--mint)}
.pill{padding:5px 12px;border-radius:6px;font-size:11px;font-weight:600;border:1px solid var(--bg3);background:transparent;color:var(--tx3);transition:all .15s}
.pill:hover{border-color:var(--tx2);color:var(--tx2)}.pill.on{border-color:var(--mint);background:#34d39920;color:var(--mint)}

/* CARDS */
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(310px,1fr));gap:12px}
.card{background:var(--bg2);border:1px solid var(--bg3);border-radius:var(--r);padding:16px;cursor:pointer;transition:all .2s;border-left:3px solid var(--bg3)}
.card:hover{transform:translateY(-2px);box-shadow:0 8px 24px #0004}
.card-top{display:flex;align-items:start;gap:12px;margin-bottom:10px}
.card-icon{width:44px;height:44px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:22px;flex-shrink:0}
.card-nm{font-size:14px;font-weight:700}.card-tl{font-size:12px;color:var(--tx2);line-height:1.4}
.card-meta{display:flex;gap:6px;flex-wrap:wrap}
.chip{font-size:10px;padding:3px 8px;border-radius:4px}
.card-diff{text-align:right;flex-shrink:0;font-size:10px;color:var(--yel);letter-spacing:1px}

/* MODAL */
.modal-bg{position:fixed;inset:0;background:#000a;backdrop-filter:blur(6px);z-index:100;display:none;align-items:center;justify-content:center;padding:16px}
.modal-bg.on{display:flex}
.modal{width:min(820px,100%);max-height:90vh;background:var(--bg);border:1px solid var(--bg3);border-radius:12px;overflow:hidden;display:flex;flex-direction:column;animation:mup .25s ease}
@keyframes mup{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:none}}
.m-head{padding:16px 20px;border-bottom:1px solid var(--bg2);display:flex;align-items:center;gap:14px}
.m-icon{width:50px;height:50px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:28px;flex-shrink:0}
.m-nm{font-size:18px;font-weight:800}.m-tl{font-size:11px;color:var(--tx3)}
.m-close{background:var(--bg2);border:1px solid var(--bg3);color:var(--tx2);padding:8px 16px;border-radius:8px;font-size:13px;font-weight:600;flex-shrink:0}
.m-close:hover{border-color:var(--mint);color:var(--mint)}
.m-stats{display:flex;border-bottom:1px solid var(--bg2);background:var(--bg2)}
.m-stat{flex:1;text-align:center;padding:12px 8px;border-right:1px solid var(--bg3)}
.m-stat:last-child{border-right:none}
.m-stat-i{font-size:16px}.m-stat-v{font-size:13px;font-weight:700}.m-stat-l{font-size:9px;color:var(--tx3);text-transform:uppercase;letter-spacing:1px}
.m-body{flex:1;overflow-y:auto}
.m-sec{padding:16px 20px;border-bottom:1px solid var(--bg2)}
.m-sec-t{font-size:12px;font-weight:700;color:var(--lila);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:14px;display:flex;align-items:center;gap:8px}
.m-sec-t::after{content:'';flex:1;height:1px;background:var(--bg2)}
.mat-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:8px}
.mat-item{background:var(--bg2);border:1px solid var(--bg3);border-radius:6px;padding:8px 10px;font-size:12px;display:flex;align-items:center;gap:4px}
.mat-free{font-size:9px;color:var(--mint);font-weight:700;margin-left:auto}
.step{display:flex;gap:12px;margin-bottom:16px;align-items:flex-start}
.step-n{width:32px;height:32px;border-radius:50%;background:var(--bg);border:2px solid var(--mint);display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:800;color:var(--mint);flex-shrink:0}
.step-t{font-size:14px;font-weight:700;margin-bottom:2px}.step-d{font-size:12px;color:var(--tx2);line-height:1.7}
.step-u{display:inline-block;margin-top:4px;font-size:10px;padding:2px 8px;border-radius:4px;background:#34d39915;color:var(--mint);font-weight:600}
.hybrid{background:linear-gradient(135deg,#34d39910,#8b5cf610);border:1px solid var(--bg3);border-radius:8px;padding:16px}
.hybrid-l{font-size:10px;color:var(--lila);font-weight:700;text-transform:uppercase;letter-spacing:2px;margin-bottom:6px}
.hybrid p{font-size:13px;line-height:1.7;margin:0}
.fork-box{border:2px dashed var(--mint);border-radius:10px;padding:20px;text-align:center}
.fork-box h4{font-size:16px;font-weight:800;color:var(--mint);margin-bottom:6px}
.fork-box p{font-size:13px;color:var(--tx2);line-height:1.6;max-width:500px;margin:0 auto}
.conn-btn{font-size:12px;padding:8px 14px;border:1px solid var(--bg3);border-radius:8px;background:transparent;color:var(--tx2);transition:all .15s}
.conn-btn:hover{border-color:var(--lila);color:var(--lila)}

/* GRAPH */
#v-graph{height:calc(100vh - 64px);position:relative}
#graph-svg{width:100%;height:100%;background:var(--bg)}
.gn{cursor:pointer}
.g-legend{position:absolute;bottom:12px;left:12px;display:flex;gap:6px;flex-wrap:wrap}
.g-legend span{font-size:10px;padding:3px 8px;border-radius:4px}
.g-info{position:absolute;top:12px;left:12px;background:var(--bg);border:1px solid var(--bg3);border-radius:8px;padding:10px 14px;max-width:260px;pointer-events:none}
.g-zoom{position:absolute;top:12px;right:12px;display:flex;flex-direction:column;gap:4px}
.g-zoom button{width:34px;height:34px;border-radius:8px;background:var(--bg2);border:1px solid var(--bg3);color:var(--tx);font-size:16px;display:flex;align-items:center;justify-content:center}

/* LIEUX */
.venue-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:12px;margin-bottom:24px}
.venue{background:var(--bg2);border:1px solid var(--bg3);border-radius:var(--r);padding:16px;border-left:3px solid var(--mint);transition:all .15s}
.venue:hover{border-color:var(--mint)}
.venue-t{font-size:15px;font-weight:700;margin-bottom:4px}
.venue-n{font-size:12px;color:var(--mint);font-weight:600;margin-bottom:4px}
.venue-d{font-size:12px;color:var(--tx2);line-height:1.5}
.map-btns{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px}
.map-btn{padding:8px 16px;border-radius:8px;background:var(--bg2);border:1px solid var(--bg3);color:var(--tx2);font-size:12px;font-weight:600;transition:all .15s}
.map-btn:hover{border-color:var(--mint);color:var(--mint)}
#map-frame{border-radius:var(--r);overflow:hidden;border:1px solid var(--bg3);height:420px;margin-bottom:12px}
#map-frame iframe{width:100%;height:100%;border:0}
.map-links{display:flex;gap:16px;flex-wrap:wrap;font-size:11px;color:var(--tx3);margin-bottom:20px}

/* GO */
.go-step{display:flex;gap:16px;margin-bottom:24px;align-items:flex-start}
.go-n{width:48px;height:48px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:20px;font-weight:800;flex-shrink:0}
.go-t{font-size:16px;font-weight:700;margin-bottom:4px}
.go-d{font-size:13px;color:var(--tx2);line-height:1.7}
.cta-box{background:var(--bg2);border:2px dashed var(--mint);border-radius:12px;padding:24px;text-align:center;margin-top:8px}
.cta-box h3{font-size:18px;font-weight:800;color:var(--mint);margin-bottom:8px}
.cta-box p{font-size:13px;color:var(--tx2);line-height:1.7;max-width:500px;margin:0 auto 16px}
.btn{padding:10px 20px;border-radius:8px;font-size:13px;font-weight:700;border:none;transition:all .15s}
.btn-mint{background:var(--mint);color:var(--bg)}.btn-lila{background:transparent;color:var(--lila);border:1px solid var(--lila)}

/* FOOTER */
.ftr{border-top:1px solid var(--bg2);padding:12px 20px;text-align:center;font-size:11px;color:var(--tx3)}

@media(max-width:700px){
  .grid{grid-template-columns:1fr}.m-stats{flex-wrap:wrap}.m-stat{flex:1 1 45%}
  .tab{padding:6px 10px;font-size:12px}#v-graph{height:calc(100vh - 60px)}
  #map-frame{height:300px}.venue-grid{grid-template-columns:1fr}
}
</style>
</head>
<body>

<!-- HEADER -->
<div class="hdr"><div class="hdr-in">
  <div class="logo"><span class="logo-i">ğŸ´</span><div><div class="logo-t">LA FORGE</div><div class="logo-s">ouaisfieu Â· ateliers-dÃ©bats citoyens</div></div></div>
  <div class="tabs" id="tabs">
    <button class="tab on" data-t="formats">ğŸ“‹ 15 Formats</button>
    <button class="tab" data-t="graph">ğŸ”— Connexions</button>
    <button class="tab" data-t="lieux">ğŸ“ Trouver un lieu</button>
    <button class="tab" data-t="go">ğŸš€ Lancez-vous</button>
  </div>
</div></div>

<!-- FORMATS -->
<div class="view on" id="v-formats">
  <h1>15 formats d'ateliers-dÃ©bats citoyens</h1>
  <p class="sub">TestÃ©s, documentÃ©s, gratuits. Cliquez sur un format pour le guide complet.</p>
  <div class="filters">
    <input class="search" id="search" placeholder="ğŸ” Chercher un format...">
    <div id="cat-pills"></div>
  </div>
  <div class="grid" id="card-grid"></div>
</div>

<!-- GRAPH -->
<div class="view" id="v-graph">
  <svg id="graph-svg"></svg>
  <div class="g-legend" id="g-legend"></div>
  <div class="g-info" id="g-info" style="display:none"></div>
  <div class="g-zoom">
    <button id="zin">ï¼‹</button>
    <button id="zout">ï¼</button>
    <button id="zreset">âŸ²</button>
  </div>
</div>

<!-- LIEUX -->
<div class="view" id="v-lieux">
  <h2>ğŸ“ OÃ¹ organiser votre atelier ?</h2>
  <p style="color:var(--tx2);font-size:13px;margin-bottom:16px">Des centaines de salles gratuites en Belgique francophone. Cliquez pour accÃ©der aux annuaires.</p>
  <div class="venue-grid" id="venue-grid"></div>
  <h3>ğŸ—ºï¸ Carte â€” cherchez prÃ¨s de chez vous</h3>
  <div class="map-btns" id="map-btns"></div>
  <div id="map-frame"></div>
  <div class="map-links">
    <span>ğŸ—ºï¸ Â© OpenStreetMap</span>
    <a href="https://www.google.com/maps/search/centre+culturel+belgique" target="_blank">â†’ Google Maps</a>
    <a href="https://www.openstreetmap.org/#map=8/50.5/4.5" target="_blank">â†’ OpenStreetMap</a>
    <a href="https://macartonum.be" target="_blank">â†’ Carte des EPN</a>
    <a href="https://centres-culturels.be" target="_blank">â†’ Centres Culturels</a>
  </div>
</div>

<!-- LANCEZ-VOUS -->
<div class="view" id="v-go">
  <div style="max-width:700px;margin:0 auto">
    <h1 style="margin-bottom:4px">ğŸš€ CrÃ©ez votre atelier en 4 Ã©tapes</h1>
    <p class="sub">Pas besoin de formation. Pas besoin de budget. Juste curieux et motivÃ©.</p>
    <div id="go-steps"></div>
    <div class="cta-box">
      <h3>ğŸ´ Le principe du fork</h3>
      <p>Tous les formats sont en licence CC-BY-SA 4.0. Prenez-les, modifiez-les, partagez-les. La seule condition : citez la source et gardez la licence ouverte. L'Ã©ducation populaire appartient au peuple, pas aux diplÃ´mÃ©s.</p>
      <button class="btn btn-mint" onclick="switchTab('formats')">ğŸ“‹ Explorer les formats</button>
      <button class="btn btn-lila" style="margin-left:8px" onclick="openRandom()">ğŸ² Format au hasard</button>
    </div>
  </div>
</div>

<!-- MODAL -->
<div class="modal-bg" id="modal-bg"><div class="modal" id="modal">
  <div class="m-head" id="m-head"></div>
  <div class="m-stats" id="m-stats"></div>
  <div class="m-body" id="m-body"></div>
</div></div>

<!-- FOOTER -->
<div class="ftr">ouaisfieu Â· intelligence citoyenne belge Â· <span style="color:var(--mint);font-weight:700">CC-BY-SA 4.0</span> Â· fork Â· hack Â· spread Â· ğŸ‡§ğŸ‡ª</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• DATA â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const CT={oral:{c:'#34d399',l:'Parole',i:'ğŸ—£ï¸'},visuel:{c:'#8b5cf6',l:'Visuel',i:'ğŸ‘ï¸'},corps:{c:'#f97316',l:'Corps',i:'ğŸƒ'},ecriture:{c:'#3b82f6',l:'Ã‰criture',i:'âœï¸'},methode:{c:'#ec4899',l:'MÃ©thode',i:'ğŸ§­'},terrain:{c:'#eab308',l:'Terrain',i:'ğŸŒ'}};
const DL=['Universel','Facile','IntermÃ©diaire','AvancÃ©'];
const stars=d=>'â˜…'.repeat(Math.max(d,1))+'â˜†'.repeat(3-Math.max(d,1));

const WS=[
{id:'cafe',n:'CafÃ©-DÃ©bat',i:'â˜•',cat:'oral',sz:26,tag:'Le classique. Un cafÃ©, un sujet, on cause.',df:1,pp:'5â€“25',tm:'1h30â€“2h',pl:'Partout',bd:['DÃ©butant','Gratuit'],mt:['â˜• CafÃ© / thÃ©','ğŸ“„ Fiche-sujet (1 page)','ğŸ”Š Votre voix','ğŸ“± TÃ©lÃ©phone'],st:[{t:'Installer le dÃ©cor',d:'Tables en cercle ou en U. Pas d\'estrade. Tout le monde au mÃªme niveau.',u:'10 min'},{t:'Distribuer la fiche-sujet',d:'Un A4 recto : le thÃ¨me, 3 faits-clÃ©s sourcÃ©s, 2-3 questions.',u:'2 min'},{t:'VidÃ©o d\'accroche (optionnel)',d:'3-6 minutes qui posent le sujet. Sinon, lisez l\'accroche Ã  voix haute.',u:'6 min'},{t:'Tour de table',d:'Chaque personne dit en 1 minute ce qui l\'a frappÃ©e. Pas de dÃ©bat encore â€” juste Ã©couter.',u:'15-20 min'},{t:'DÃ©bat ouvert',d:'L\'animateur relance avec les questions. RÃ¨gle d\'or : on ne coupe pas la parole.',u:'40-50 min'},{t:'SynthÃ¨se Ã  chaud',d:'Chacun dit en une phrase ce qu\'il retient. L\'animateur note.',u:'10 min'},{t:'Photo + partage',d:'Si le groupe accepte : photo et post. Le Framapad est partagÃ© pour continuer.',u:'5 min'}],hy:'Le sujet est lancÃ© en ligne avant (vidÃ©o + commentaire Ã©pinglÃ©). Les contributions alimentent le prÃ©sentiel. AprÃ¨s : synthÃ¨se publiÃ©e, dÃ©bat continu.',fk:'TÃ©lÃ©chargez la fiche-sujet, changez le thÃ¨me, imprimez, invitez 5 personnes. C\'est tout.',lk:['world','cercle','cine','mouvant','vpa']},
{id:'cine',n:'CinÃ©-DÃ©bat',i:'ğŸ¬',cat:'visuel',sz:24,tag:'Un film, un choc, un Ã©change.',df:1,pp:'5â€“50',tm:'2h30â€“3h',pl:'Salle, salon, en ligne',bd:['DÃ©butant','Ã‰motion'],mt:['ğŸ“º Ã‰cran / projecteur','ğŸ¬ Film ou docu','ğŸ“„ Fiche de discussion','â˜• De quoi boire'],st:[{t:'Choisir le film',d:'Un documentaire de 30-90 min ou un extrait de 15-20 min.',u:'Avant'},{t:'PrÃ©parer 3 questions',d:'"Qu\'est-ce qui vous a surpris ?", "Ã‡a vous rappelle votre vÃ©cu ?"',u:'Avant'},{t:'Accueil + contexte',d:'"J\'ai vu Ã§a, Ã§a m\'a interpellÃ©." 2 phrases suffisent.',u:'5 min'},{t:'Projection',d:'Regardez ensemble. L\'Ã©motion collective est plus forte que seul.',u:'30-90 min'},{t:'Silence',d:'2 minutes de silence aprÃ¨s le film. Essentiel.',u:'2 min'},{t:'Tour d\'impressions',d:'Chacun partage une Ã©motion, pas une analyse.',u:'15 min'},{t:'DÃ©bat guidÃ©',d:'Alternez fait / opinion / action.',u:'30-40 min'},{t:'Engagement',d:'"Qui veut faire quelque chose ?" MÃªme petit.',u:'10 min'}],hy:'Le film est publiÃ© en ligne avec page de discussion. Ceux qui n\'ont pas pu venir regardent chez eux et contribuent.',fk:'Choisissez un documentaire. Ã‰crivez 3 questions. Invitez des gens. Play.',lk:['cafe','photo','tribunal','lecture','vpa']},
{id:'porteur',n:'Porteur de Paroles',i:'ğŸ“¢',cat:'terrain',sz:24,tag:'Une question gÃ©ante dans la rue. Les passants rÃ©pondent.',df:1,pp:'2â€“5 anim.',tm:'2â€“3h',pl:'Rue, marchÃ©, place',bd:['Impact','Viral'],mt:['ğŸ¨ Grand panneau / drap blanc','ğŸ–Šï¸ Marqueurs Ã©pais','ğŸ“± TÃ©lÃ©phone','ğŸ“‹ Post-it'],st:[{t:'Ã‰crire LA question',d:'En trÃ¨s gros. Une seule, percutante : "C\'est quoi bien vivre ici ?"',u:'30 min'},{t:'Choisir le lieu',d:'Sortie de marchÃ©, place, gare. Pas besoin d\'autorisation sur le trottoir.',u:'Avant'},{t:'S\'installer',d:'Plantez le panneau. Souriants, disponibles.',u:'10 min'},{t:'Recueillir les paroles',d:'Notez sur post-it, collez sur le panneau. Ou filmez 30 sec.',u:'2h'},{t:'Donner la suite',d:'QR code vers la page ouaisfieu du sujet.',u:'Continu'},{t:'Documenter',d:'Photos du panneau rempli, vidÃ©os des tÃ©moignages.',u:'Continu'}],hy:'Les paroles de la rue deviennent le matÃ©riau d\'un atelier en ligne. La rue alimente le numÃ©rique, le numÃ©rique amplifie la rue.',fk:'Un drap, une question, sortez dehors. Le format le moins cher et le plus puissant.',lk:['mouvant','marche','cafe','fresque','vpa']},
{id:'mouvant',n:'DÃ©bat Mouvant',i:'ğŸƒ',cat:'corps',sz:22,tag:'Pour ? Ã€ gauche. Contre ? Ã€ droite. Change d\'avis en direct.',df:1,pp:'8â€“40',tm:'30â€“60 min',pl:'Grande salle ou dehors',bd:['Ã‰nergique','ZÃ©ro matos'],mt:['ğŸ“ Espace de 6m','ğŸ—£ï¸ Votre voix','ğŸ“„ 5-8 affirmations'],st:[{t:'PrÃ©parer les affirmations',d:'Clivantes : "Les manifs ne servent Ã  rien." Ni vrai ni faux.',u:'Avant'},{t:'Tracer la ligne',d:'D\'ACCORD â† â†’ PAS D\'ACCORD.',u:'2 min'},{t:'Lancer l\'affirmation',d:'Les gens se dÃ©placent physiquement.',u:'1 min'},{t:'Argumenter',d:'Chaque camp envoie un porte-parole. On peut changer de cÃ´tÃ© !',u:'5-8 min'},{t:'Observer',d:'Ceux qui changent de cÃ´tÃ© = le plus intÃ©ressant.',u:'Continu'},{t:'DÃ©briefer',d:'"Qu\'est-ce qui vous a fait changer d\'avis ?"',u:'10 min'}],hy:'Sondage en ligne avant avec les mÃªmes affirmations. On compare.',fk:'5 phrases provocantes, un couloir. ZÃ©ro matÃ©riel, zÃ©ro budget.',lk:['cafe','porteur','theatre','jeu','vpa']},
{id:'photo',n:'Photo-Langage',i:'ğŸ–¼ï¸',cat:'visuel',sz:20,tag:'Choisir une image pour dire ce qu\'on ne sait pas formuler.',df:1,pp:'5â€“20',tm:'1hâ€“1h30',pl:'Table + chaises',bd:['Accessible','Inclusion'],mt:['ğŸ–¼ï¸ 20-30 images variÃ©es','ğŸ–¨ï¸ ImprimÃ©es ou tablette','ğŸ“„ Une question ouverte'],st:[{t:'PrÃ©parer les images',d:'20-30 photos diffÃ©rentes. Pas de texte dessus.',u:'15 min'},{t:'Poser LA question',d:'Ouverte : "Pour vous, la dÃ©mocratie Ã§a ressemble Ã  quoi ?"',u:'2 min'},{t:'Choisir en silence',d:'Chacun choisit UNE image. Le silence est important.',u:'5-7 min'},{t:'Tour de parole',d:'Chacun montre et explique. On ne juge pas.',u:'30-40 min'},{t:'Ã‰changes croisÃ©s',d:'"Y a-t-il des images qui se rÃ©pondent ?"',u:'15-20 min'},{t:'Garder une trace',d:'Photo des images choisies + mots-clÃ©s = portrait collectif.',u:'5 min'}],hy:'Images publiÃ©es en ligne avec la question. Chaque internaute choisit et explique.',fk:'20 images, une question sincÃ¨re, une table. Le plus puissant pour ceux qui n\'aiment pas "dÃ©battre".',lk:['cercle','cafe','cine','fresque','ecriture']},
{id:'world',n:'World CafÃ©',i:'ğŸŒ',cat:'oral',sz:22,tag:'3 tables, 3 questions, on tourne. Intelligence collective.',df:2,pp:'12â€“50',tm:'1h30â€“2h',pl:'Salle avec tables',bd:['Collectif','StructurÃ©'],mt:['ğŸª‘ 3-5 tables + chaises','ğŸ“ Nappes papier','ğŸ–Šï¸ Marqueurs couleur','â±ï¸ Minuteur'],st:[{t:'Installer les tables',d:'3-5 tables. Nappes papier + marqueurs. Un "hÃ´te" reste, les autres tournent.',u:'15 min'},{t:'Les 3 questions',d:'Progressives : "Que constatez-vous ?" â†’ "Pourquoi ?" â†’ "Que faire ?"',u:'5 min'},{t:'Premier tour',d:'Discutez et gribouilllez sur la nappe.',u:'20 min'},{t:'Rotation',d:'Tout le monde change. L\'hÃ´te rÃ©sume en 2 min.',u:'2 min'},{t:'Tours 2 et 3',d:'Les idÃ©es s\'enrichissent Ã  chaque passage.',u:'20 min Ã— 2'},{t:'Moisson',d:'Chaque hÃ´te : 3 idÃ©es-forces. Vote par gommettes.',u:'20 min'}],hy:'En ligne : 3 Framapads, 24h par "table". World CafÃ© asynchrone de 3 jours.',fk:'3 tables, 3 questions, des nappes en papier. Vous organisez des dÃ®ners ? Vous savez faire.',lk:['cafe','cercle','fresque','vpa','porteur']},
{id:'cercle',n:'Cercle de Parole',i:'â­•',cat:'oral',sz:20,tag:'Un objet circule. Celui qui l\'a parle. Les autres Ã©coutent.',df:1,pp:'5â€“15',tm:'1hâ€“1h30',pl:'En cercle, n\'importe oÃ¹',bd:['Intime','Ã‰coute'],mt:['ğŸª¨ Objet de parole (caillou...)','ğŸª‘ Chaises en cercle'],st:[{t:'Le cercle',d:'Chaises en cercle, pas de table. Nous sommes Ã©gaux.',u:'5 min'},{t:'Les 3 rÃ¨gles',d:'(1) Objet = parole. (2) Pas d\'objet = Ã©coute. (3) Pas de jugement.',u:'3 min'},{t:'Question d\'ouverture',d:'"Avec quoi vous arrivez ce soir ?"',u:'15 min'},{t:'Question de fond',d:'"Racontez un moment oÃ¹ vous avez senti que Ã§a n\'allait pas."',u:'30-40 min'},{t:'DeuxiÃ¨me tour',d:'"Quelque chose a bougÃ© ?"',u:'20 min'},{t:'ClÃ´ture',d:'Un mot chacun. Le nuage de mots du groupe.',u:'5 min'}],hy:'En ligne : messages vocaux asynchrones (Telegram, Signal). La voix garde l\'intimitÃ©.',fk:'Un caillou, des chaises en rond, une question sincÃ¨re. La plus vieille technologie d\'intelligence collective.',lk:['cafe','photo','world','ecriture','vpa']},
{id:'theatre',n:'ThÃ©Ã¢tre-Forum',i:'ğŸ­',cat:'corps',sz:22,tag:'Une injustice jouÃ©e. Le public intervient et change l\'histoire.',df:3,pp:'8â€“30',tm:'2hâ€“2h30',pl:'Salle dÃ©gagÃ©e',bd:['Puissant','AvancÃ©'],mt:['ğŸ­ Espace de jeu 4Ã—4m','ğŸ“ ScÃ©nario court','ğŸ‘¤ 3-5 comÃ©dienÂ·nes amateurs'],st:[{t:'Ã‰crire la scÃ¨ne',d:'Situation d\'injustice. 3-5 min. Elle doit mal finir.',u:'1h avant'},{t:'RÃ©pÃ©ter',d:'2-3 fois. CrÃ©dible, pas parfait.',u:'30 min'},{t:'PremiÃ¨re lecture',d:'Jouez. Laissez le malaise.',u:'5 min'},{t:'Le Joker',d:'"Quand vous pouvez changer la situation, criez STOP."',u:'3 min'},{t:'Interventions',d:'Le public remplace les personnages et tente d\'autres stratÃ©gies.',u:'40-60 min'},{t:'DÃ©brief',d:'"Qu\'est-ce qui a marchÃ© ? C\'est rÃ©aliste ?"',u:'20 min'}],hy:'ScÃ¨ne filmÃ©e et publiÃ©e. Les internautes proposent des interventions. Les meilleures sont jouÃ©es ensuite.',fk:'Une situation injuste, 10 lignes, 3 potes. Vous avez un thÃ©Ã¢tre-forum.',lk:['mouvant','jeu','cine','porteur','vpa']},
{id:'fresque',n:'Fresque Citoyenne',i:'ğŸ§©',cat:'ecriture',sz:24,tag:'Comme la Fresque du Climat, pour la dÃ©mocratie.',df:2,pp:'6â€“20',tm:'2hâ€“3h',pl:'Grande table ou mur',bd:['Collaboratif','SystÃ©mique'],mt:['ğŸ“° 30-40 cartes-concepts','ğŸ“ Grande surface','ğŸ–Šï¸ Marqueurs + ficelle','ğŸ“ Post-it'],st:[{t:'PrÃ©parer les cartes',d:'Un concept par carte : CPAS, Constitution, Lobbying, MÃ©dias...',u:'Avant'},{t:'Distribution',d:'8-10 cartes par sous-groupe. Discussion interne.',u:'15 min'},{t:'Construction',d:'Placez et reliez : cause â†’ consÃ©quence. Le moment eureka.',u:'40 min'},{t:'Confrontation',d:'Les groupes expliquent. DÃ©bat.',u:'20 min'},{t:'Les trous',d:'Cartes vierges pour ce qui manque.',u:'15 min'},{t:'Prioriser',d:'Gommettes sur les nÅ“uds critiques. Engagement.',u:'15 min'}],hy:'Les cartes deviennent un jeu interactif en ligne. Chaque atelier enrichit la fresque.',fk:'Imprimez les cartes ou utilisez 30 post-it. Un mur. Ã‡a surprend toujours.',lk:['world','photo','ecriture','lecture','vpa']},
{id:'jeu',n:'Jeu de RÃ´le Citoyen',i:'ğŸ²',cat:'corps',sz:18,tag:'Vous Ãªtes le bourgmestre. Que faites-vous ?',df:2,pp:'6â€“15',tm:'1h30â€“2h',pl:'Salle, salon',bd:['Fun','Empathie'],mt:['ğŸ“‡ Fiches personnages','ğŸ“‹ ScÃ©nario de dÃ©part','â±ï¸ Minuteur'],st:[{t:'ScÃ©nario',d:'"Le conseil communal dÃ©cide sur les camÃ©ras de surveillance."',u:'Avant'},{t:'Distribution',d:'Bourgmestre, commerÃ§ant, jeune, militant, policier...',u:'7 min'},{t:'Conseil fictif',d:'2 min par personnage, puis dÃ©bat libre.',u:'30-40 min'},{t:'Vote',d:'Comme dans la vraie vie : frustrant.',u:'5 min'},{t:'Sortie de rÃ´le',d:'"Je ne suis plus le policier." Qu\'est-ce que Ã§a a changÃ© ?',u:'15 min'},{t:'Connexion au rÃ©el',d:'Comment Ã§a se passe dans votre commune ?',u:'15 min'}],hy:'Fiches publiÃ©es en ligne. Jeu de rÃ´le asynchrone en forum.',fk:'Un sujet communal, 5 personnages. Plus efficace que 10 cours de sciences po.',lk:['theatre','mouvant','tribunal','cafe','fresque']},
{id:'tribunal',n:'Tribunal Citoyen',i:'âš–ï¸',cat:'oral',sz:20,tag:'ProcÃ¨s fictif d\'une politique, d\'une loi, d\'un systÃ¨me.',df:2,pp:'10â€“30',tm:'2hâ€“2h30',pl:'Salle en U',bd:['ThÃ©Ã¢tral','Marquant'],mt:['âš–ï¸ Mise en scÃ¨ne','ğŸ“ Dossier accusation + dÃ©fense','ğŸ“‹ Bulletin verdict'],st:[{t:'Choisir l\'accusÃ©',d:'Pas une personne â€” une politique. "Le gouvernement est accusÃ© de..."',u:'Avant'},{t:'Les rÃ´les',d:'Procureur, avocat, tÃ©moins, juge (animateur), jury (public).',u:'10 min'},{t:'RÃ©quisitoire',d:'Faits, chiffres, tÃ©moignages Ã  charge.',u:'10 min'},{t:'Plaidoirie dÃ©fense',d:'DÃ©fendre ce qu\'on combattrait. L\'exercice le plus formateur.',u:'10 min'},{t:'TÃ©moignages',d:'DÃ©positions et contre-interrogatoires.',u:'30 min'},{t:'Verdict',d:'Le jury-public vote. Lecture solennelle.',u:'15 min'},{t:'DÃ©brief',d:'"Le verdict Ã©tait-il juste ?"',u:'15 min'}],hy:'Dossier publiÃ© en ligne une semaine avant. Contributions en ligne. Verdicts comparÃ©s.',fk:'Un acte d\'accusation en une page. PrÃ©parez aussi la dÃ©fense.',lk:['jeu','cine','theatre','lecture','cafe']},
{id:'lecture',n:'Lecture Collective',i:'ğŸ“–',cat:'ecriture',sz:18,tag:'Lire ensemble. S\'arrÃªter. RÃ©agir.',df:1,pp:'4â€“12',tm:'1hâ€“1h30',pl:'Table, canapÃ©s',bd:['Calme','Accessible'],mt:['ğŸ“„ Texte imprimÃ© pour chacun','ğŸ–Šï¸ Surligneurs','â˜• ThÃ© / cafÃ©'],st:[{t:'Choisir le texte',d:'1-3 pages. Article, tÃ©moignage, texte de loi.',u:'Avant'},{t:'Lecture silencieuse',d:'Surligner ce qui frappe. Le silence collectif concentre.',u:'10-15 min'},{t:'Tour de surlignage',d:'Chacun lit SON passage et explique pourquoi.',u:'20 min'},{t:'Discussion',d:'Les passages surlignÃ©s = points d\'entrÃ©e du dÃ©bat.',u:'30 min'},{t:'RÃ©action Ã©crite',d:'"Ce que je retiens / conteste / veux creuser."',u:'5 min'}],hy:'Texte sur plateforme d\'annotation (Hypothesis.is). Annotation collaborative en ligne.',fk:'Un article marquant, 4 personnes, des surligneurs. Lisez. Parlez.',lk:['cafe','cercle','photo','ecriture','cine']},
{id:'ecriture',n:'Ã‰criture Collective',i:'âœï¸',cat:'ecriture',sz:18,tag:'Ã‰crire ensemble : lettre ouverte, manifeste, tÃ©moignage.',df:2,pp:'4â€“15',tm:'1h30â€“2h',pl:'Table + Ã©cran partagÃ©',bd:['CrÃ©atif','Concret'],mt:['ğŸ’» 1 ordi + vidÃ©oproj','ğŸ“ Papier par personne'],st:[{t:'DÃ©finir l\'objet',d:'Lettre ouverte ? Manifeste ? TÃ©moignage ?',u:'10 min'},{t:'Ã‰criture flash',d:'5 min sans s\'arrÃªter. Pas de censure.',u:'5 min'},{t:'Partage',d:'Chacun lit. RepÃ©rer les pÃ©pites.',u:'20 min'},{t:'Ã‰criture collective',d:'Sur Framapad projetÃ©. Chaotique et normal.',u:'30-40 min'},{t:'Relecture',d:'Chaque phrase validÃ©e collectivement.',u:'10 min'},{t:'Publication',d:'SignÃ© collectivement, publiÃ©, envoyÃ©.',u:'5 min'}],hy:'Le Framapad reste ouvert. D\'autres villes contribuent au mÃªme texte.',fk:'Ouvrez un Framapad, partagez le lien, Ã©crivez ensemble.',lk:['lecture','fresque','cercle','photo','cafe']},
{id:'marche',n:'Marche Exploratoire',i:'ğŸš¶',cat:'terrain',sz:18,tag:'Marcher, observer, discuter de ce qu\'on voit.',df:1,pp:'5â€“15',tm:'1h30â€“2h',pl:'Dehors !',bd:['Terrain','Local'],mt:['ğŸ‘Ÿ Chaussures confortables','ğŸ“± TÃ©lÃ©phone','ğŸ“‹ Grille d\'observation'],st:[{t:'Parcours + thÃ¨me',d:'1-2 km. "L\'espace public est-il accueillant pour tous ?"',u:'Avant'},{t:'Grille d\'observation',d:'AccessibilitÃ©, verdure, sÃ©curitÃ©, propretÃ©, services.',u:'5 min'},{t:'Marcher',d:'Lentement. S\'arrÃªter, photographier, discuter.',u:'45-60 min'},{t:'ArrÃªts-dÃ©bat',d:'3-4 points stratÃ©giques.',u:'Inclus'},{t:'SynthÃ¨se',d:'Au cafÃ© : partager grilles et photos.',u:'20 min'},{t:'Lettre au bourgmestre',d:'Courrier collectif avec observations.',u:'15 min'}],hy:'Photos sur carte collaborative (uMap). D\'autres quartiers comparent.',fk:'Imprimez la grille, marchez. Vous redÃ©couvrirez ce que vous croyiez connaÃ®tre.',lk:['porteur','fresque','photo','cafe','ecriture']},
{id:'vpa',n:'Voir Â· Penser Â· Agir',i:'ğŸ§­',cat:'methode',sz:28,tag:'La boussole. Tous les ateliers suivent ce fil rouge.',df:0,pp:'Tous',tm:'Toujours',pl:'Partout',bd:['MÃ©thode','Universel'],mt:['ğŸ§  CuriositÃ©','â¤ï¸ Ã‰coute','âœŠ Envie d\'agir'],st:[{t:'VOIR â€” Observer',d:'DÃ©couvrir le sujet. VidÃ©o, tÃ©moignage, donnÃ©es. Ne pas analyser encore.',u:'Phase 1'},{t:'PENSER â€” Comprendre',d:'Croiser les regards, confronter les idÃ©es, chercher les causes.',u:'Phase 2'},{t:'AGIR â€” DÃ©cider',d:'Transformer en action concrÃ¨te. MÃªme petite.',u:'Phase 3'}],hy:'En ligne : VOIR = vidÃ©o. PENSER = dÃ©bat sur Pol.is. AGIR = co-rÃ©daction.',fk:'3 questions : "Que voit-on ?" â†’ "Qu\'en pense-t-on ?" â†’ "Que fait-on ?" La mÃ©thode.',lk:['cafe','cine','world','fresque','porteur','theatre','mouvant']}
];

const VENUES=[
  {t:'ğŸ“š BibliothÃ¨ques publiques',n:'20+ Ã  Bruxelles',d:'Salles d\'animation, animations citoyennes existantes.',u:'https://www.bibliotheques.be'},
  {t:'ğŸ’» EPN (Espaces Publics NumÃ©riques)',n:'200+ en Wallonie, 30+ Ã  Bruxelles',d:'Aide numÃ©rique incluse. Gratuit.',u:'https://macartonum.be'},
  {t:'ğŸ­ Centres Culturels',n:'122 reconnus en FWB',d:'MandatÃ©s pour la dÃ©mocratie culturelle et la participation.',u:'https://centres-culturels.be'},
  {t:'ğŸ˜ï¸ Maisons de Quartier',n:'18-19 Ã  Bruxelles',d:'GÃ©rÃ©s par les CPAS. Mission : dÃ©bat citoyen.',u:'https://lesmaisonsdequartier.brussels'},
  {t:'ğŸ›ï¸ Espaces Wallonie',n:'LiÃ¨ge, Mons, Nivelles, Verviers, Tournai',d:'Salles gratuites + cafÃ© fourni. Lun-Ven 9h-16h30.',u:'https://wallonie.be/fr/demarches/espaces-wallonie'},
  {t:'ğŸ  Votre salon',n:'Partout',d:'5 chaises, une table, du cafÃ©. C\'est suffisant.',u:null}
];

const MAPS=[
  {l:'ğŸ™ï¸ Bruxelles',bb:'4.25,50.79,4.45,50.89',mk:'50.85,4.35'},
  {l:'ğŸ­ LiÃ¨ge',bb:'5.50,50.60,5.65,50.66',mk:'50.63,5.57'},
  {l:'ğŸ›ï¸ Namur',bb:'4.80,50.43,4.95,50.50',mk:'50.46,4.87'},
  {l:'â›ï¸ Mons',bb:'3.88,50.42,4.02,50.47',mk:'50.45,3.95'},
  {l:'ğŸ‡§ğŸ‡ª Belgique',bb:'2.5,49.5,6.5,51.5',mk:'50.5,4.5'}
];

const STEPS=[
  {n:'1',t:'Choisissez un format',c:'#34d399',d:'Allez dans l\'onglet "15 Formats". Pour commencer : <b>CafÃ©-DÃ©bat â˜•</b> (le plus simple), <b>Cercle de Parole â­•</b> (le plus intime), ou <b>DÃ©bat Mouvant ğŸƒ</b> (zÃ©ro matÃ©riel).'},
  {n:'2',t:'Trouvez un sujet',c:'#8b5cf6',d:'Qu\'est-ce qui vous rÃ©volte ? Interroge ? Touche ? C\'est votre sujet. Les fiches ouaisfieu fournissent des faits sourcÃ©s et des questions prÃªtes.'},
  {n:'3',t:'Invitez 5 personnes',c:'#f97316',d:'Famille, voisins, collÃ¨gues, inconnus. 5 suffit. Un SMS : <em>"Mardi soir chez moi, on discute de [sujet]. Tu viens ?"</em> C\'est tout.'},
  {n:'4',t:'Suivez le guide',c:'#3b82f6',d:'Ouvrez la fiche du format sur votre tÃ©lÃ©phone pendant l\'atelier. Chaque Ã©tape est minutÃ©e. C\'est votre pense-bÃªte.'}
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TABS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let curTab='formats';
document.querySelectorAll('.tab').forEach(b=>b.addEventListener('click',()=>switchTab(b.dataset.t)));
function switchTab(t){
  curTab=t;
  document.querySelectorAll('.tab').forEach(b=>b.classList.toggle('on',b.dataset.t===t));
  document.querySelectorAll('.view').forEach(v=>v.classList.toggle('on',v.id==='v-'+t));
  if(t==='graph'&&!graphReady)initGraph();
  if(t==='lieux'&&!mapReady)initMap();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• CATALOGUE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let curCat='all';
function buildPills(){
  const el=document.getElementById('cat-pills');
  el.innerHTML='<button class="pill on" data-c="all">Tous</button>'+
    Object.entries(CT).map(([k,v])=>`<button class="pill" data-c="${k}">${v.i} ${v.l}</button>`).join('');
  el.querySelectorAll('.pill').forEach(b=>b.addEventListener('click',()=>{
    curCat=b.dataset.c;el.querySelectorAll('.pill').forEach(p=>p.classList.toggle('on',p.dataset.c===curCat));renderCards();
  }));
}
function renderCards(){
  const q=document.getElementById('search').value.toLowerCase();
  let items=WS;
  if(curCat!=='all')items=items.filter(w=>w.cat===curCat);
  if(q)items=items.filter(w=>(w.n+w.tag+w.bd.join(' ')).toLowerCase().includes(q));
  const g=document.getElementById('card-grid');
  g.innerHTML=items.map(w=>{
    const c=CT[w.cat];
    return`<div class="card" style="border-left-color:${c.c}" data-id="${w.id}">
      <div class="card-top">
        <div class="card-icon" style="background:${c.c}18">${w.i}</div>
        <div style="flex:1;min-width:0"><div class="card-nm">${w.n}</div><div class="card-tl">${w.tag}</div></div>
        <div class="card-diff">${stars(w.df)}</div>
      </div>
      <div class="card-meta">
        <span class="chip" style="background:var(--bg);color:var(--tx2)">ğŸ‘¥ ${w.pp}</span>
        <span class="chip" style="background:var(--bg);color:var(--tx2)">â± ${w.tm}</span>
        ${w.bd.slice(0,2).map(b=>`<span class="chip" style="background:${c.c}15;color:${c.c}">${b}</span>`).join('')}
      </div>
    </div>`;
  }).join('');
  if(!items.length)g.innerHTML='<div style="grid-column:1/-1;text-align:center;padding:60px;color:var(--tx3)">Aucun rÃ©sultat.</div>';
  g.querySelectorAll('.card').forEach(c=>c.addEventListener('click',()=>openModal(c.dataset.id)));
}
buildPills();renderCards();
document.getElementById('search').addEventListener('input',renderCards);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• MODAL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openModal(id){
  const w=WS.find(x=>x.id===id);if(!w)return;const c=CT[w.cat];
  document.getElementById('m-head').innerHTML=`
    <div class="m-icon" style="background:${c.c}18;border:1px solid ${c.c}44">${w.i}</div>
    <div style="flex:1"><div class="m-nm">${w.n}</div><div class="m-tl">${w.tag}</div></div>
    <button class="m-close" onclick="closeModal()">âœ• Fermer</button>`;
  document.getElementById('m-stats').innerHTML=[
    {i:'ğŸ‘¥',v:w.pp,l:'Personnes'},{i:'â±ï¸',v:w.tm,l:'DurÃ©e'},{i:'ğŸ“',v:w.pl,l:'Lieu'},{i:'â˜…',v:DL[w.df],l:'DifficultÃ©'}
  ].map((s,i)=>`<div class="m-stat"><div class="m-stat-i">${s.i}</div><div class="m-stat-v" style="color:${i%2===0?'var(--mint)':'var(--lila)'}">${s.v}</div><div class="m-stat-l">${s.l}</div></div>`).join('');
  let h='';
  h+=`<div class="m-sec"><div class="m-sec-t">ğŸ’ Ce qu'il vous faut</div><div class="mat-grid">${w.mt.map(m=>`<div class="mat-item">${m}<span class="mat-free">GRATUIT</span></div>`).join('')}</div></div>`;
  h+=`<div class="m-sec"><div class="m-sec-t">ğŸ“‹ Pas Ã  pas â€” suivez le guide</div>${w.st.map((s,i)=>`<div class="step"><div class="step-n">${i+1}</div><div style="flex:1"><div class="step-t">${s.t}</div><div class="step-d">${s.d}</div>${s.u?`<span class="step-u">â± ${s.u}</span>`:''}</div></div>`).join('')}</div>`;
  h+=`<div class="m-sec"><div class="m-sec-t">ğŸ”— Le pont numÃ©rique</div><div class="hybrid"><div class="hybrid-l">âš¡ Hybridation en ligne / prÃ©sentiel</div><p>${w.hy}</p></div></div>`;
  h+=`<div class="m-sec"><div class="m-sec-t">ğŸ´ Forkez-le</div><div class="fork-box"><h4>C'est Ã  vous.</h4><p>${w.fk}</p></div></div>`;
  h+=`<div class="m-sec"><div class="m-sec-t">ğŸ”€ Ateliers connexes</div><div style="display:flex;gap:6px;flex-wrap:wrap">${(w.lk||[]).map(lid=>{const lw=WS.find(x=>x.id===lid);return lw?`<button class="conn-btn" onclick="openModal('${lid}')">${lw.i} ${lw.n}</button>`:''}).join('')}</div></div>`;
  document.getElementById('m-body').innerHTML=h;
  document.getElementById('modal-bg').classList.add('on');
}
function closeModal(){document.getElementById('modal-bg').classList.remove('on')}
document.getElementById('modal-bg').addEventListener('click',e=>{if(e.target===e.currentTarget)closeModal()});
document.addEventListener('keydown',e=>{if(e.key==='Escape')closeModal()});
function openRandom(){openModal(WS[Math.floor(Math.random()*WS.length)].id)}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• GRAPH â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let graphReady=false;
function initGraph(){
  graphReady=true;
  const svg=document.getElementById('graph-svg');
  const ct=svg.parentElement;
  let W=ct.clientWidth,H=ct.clientHeight;
  svg.setAttribute('width',W);svg.setAttribute('height',H);
  // Positions
  const cx=W/2,cy=H/2,R=Math.min(cx,cy)*0.65;
  const pos={};const vi=WS.findIndex(w=>w.id==='vpa');
  WS.forEach((w,i)=>{
    if(w.id==='vpa'){pos[w.id]={x:cx,y:cy};}
    else{const idx=i>vi?i-1:i;const tot=WS.length-1;const a=(idx/tot)*Math.PI*2-Math.PI/2;pos[w.id]={x:cx+Math.cos(a)*R,y:cy+Math.sin(a)*R};}
  });
  // Links
  const lkSet=new Set(),links=[];
  WS.forEach(w=>(w.lk||[]).forEach(t=>{const k=[w.id,t].sort().join('|');if(!lkSet.has(k)&&WS.find(x=>x.id===t)){lkSet.add(k);links.push({s:w.id,t});}}));
  // Transform
  let ox=0,oy=0,sc=1;
  function tx(){return`translate(${ox},${oy}) scale(${sc})`}
  const g=document.createElementNS('http://www.w3.org/2000/svg','g');
  g.setAttribute('transform',tx());svg.appendChild(g);
  // Draw links
  const lineEls=links.map(l=>{
    const p1=pos[l.s],p2=pos[l.t];
    const el=document.createElementNS('http://www.w3.org/2000/svg','line');
    el.setAttribute('x1',p1.x);el.setAttribute('y1',p1.y);el.setAttribute('x2',p2.x);el.setAttribute('y2',p2.y);
    el.setAttribute('stroke','#334155');el.setAttribute('stroke-width','1');el.setAttribute('opacity','0.2');
    el._s=l.s;el._t=l.t;g.appendChild(el);return el;
  });
  // Draw nodes
  const nodeEls=WS.map(w=>{
    const p=pos[w.id],c=CT[w.cat],r=w.sz/2;
    const ng=document.createElementNS('http://www.w3.org/2000/svg','g');
    ng.setAttribute('class','gn');ng.setAttribute('transform',`translate(${p.x},${p.y})`);
    ng.innerHTML=`<circle r="${r+6}" fill="transparent"/><circle r="${r}" fill="${c.c}22" stroke="${c.c}" stroke-width="1.5" class="gc"/><text text-anchor="middle" dominant-baseline="central" font-size="${r*0.85}" style="pointer-events:none">${w.i}</text><text text-anchor="middle" y="${r+14}" fill="#e2e8f0" font-size="10" font-weight="600" style="pointer-events:none;font-family:system-ui" class="gl">${w.n}</text>`;
    ng._id=w.id;ng._lk=new Set(w.lk||[]);
    ng.addEventListener('click',()=>openModal(w.id));
    ng.addEventListener('mouseenter',()=>highlightNode(w.id,ng._lk));
    ng.addEventListener('mouseleave',()=>clearHighlight());
    g.appendChild(ng);return ng;
  });
  function highlightNode(id,conns){
    lineEls.forEach(el=>{
      const lit=(el._s===id&&conns.has(el._t))||(el._t===id&&conns.has(el._s));
      el.setAttribute('stroke',lit?'#34d399':'#334155');
      el.setAttribute('stroke-width',lit?'2.5':'1');
      el.setAttribute('opacity',lit?'0.8':'0.04');
    });
    nodeEls.forEach(ng=>{
      const isMe=ng._id===id,isCon=conns.has(ng._id),isDim=!isMe&&!isCon;
      ng.querySelector('.gc').setAttribute('opacity',isDim?'0.1':'1');
      ng.querySelector('.gc').setAttribute('stroke-width',isMe?'3':isCon?'2':'1.5');
      ng.querySelector('.gl').setAttribute('opacity',isDim?'0.06':'0.9');
      if(isMe)ng.querySelector('.gc').style.filter=`drop-shadow(0 0 12px ${CT[WS.find(w=>w.id===id).cat].c})`;
    });
    const w=WS.find(x=>x.id===id);
    const info=document.getElementById('g-info');
    info.style.display='block';
    info.innerHTML=`<div style="font-size:13px;font-weight:700;color:#34d399">${w.i} ${w.n}</div><div style="font-size:11px;color:#94a3b8;margin-top:3px">${w.tag}</div><div style="font-size:11px;color:#64748b;margin-top:4px">ğŸ‘¥ ${w.pp} Â· â± ${w.tm} Â· ${DL[w.df]}</div><div style="font-size:10px;color:#64748b;margin-top:6px">Cliquez pour le guide complet â†’</div>`;
  }
  function clearHighlight(){
    lineEls.forEach(el=>{el.setAttribute('stroke','#334155');el.setAttribute('stroke-width','1');el.setAttribute('opacity','0.2');});
    nodeEls.forEach(ng=>{ng.querySelector('.gc').setAttribute('opacity','1');ng.querySelector('.gc').setAttribute('stroke-width','1.5');ng.querySelector('.gc').style.filter='';ng.querySelector('.gl').setAttribute('opacity','0.9');});
    document.getElementById('g-info').style.display='none';
  }
  // Zoom/Pan
  let dragging=false,ds={x:0,y:0};
  svg.addEventListener('wheel',e=>{e.preventDefault();sc=Math.max(0.3,Math.min(3,sc*(e.deltaY>0?0.92:1.08)));g.setAttribute('transform',tx());},{passive:false});
  svg.addEventListener('mousedown',e=>{if(e.target.closest('.gn'))return;dragging=true;ds={x:e.clientX-ox,y:e.clientY-oy};});
  svg.addEventListener('mousemove',e=>{if(!dragging)return;ox=e.clientX-ds.x;oy=e.clientY-ds.y;g.setAttribute('transform',tx());});
  svg.addEventListener('mouseup',()=>dragging=false);
  svg.addEventListener('mouseleave',()=>dragging=false);
  document.getElementById('zin').addEventListener('click',()=>{sc=Math.min(3,sc*1.25);g.setAttribute('transform',tx());});
  document.getElementById('zout').addEventListener('click',()=>{sc=Math.max(0.3,sc*0.8);g.setAttribute('transform',tx());});
  document.getElementById('zreset').addEventListener('click',()=>{sc=1;ox=0;oy=0;g.setAttribute('transform',tx());});
  // Legend
  document.getElementById('g-legend').innerHTML=Object.entries(CT).map(([k,v])=>`<span style="background:${v.c}22;color:${v.c};border:1px solid ${v.c}44">${v.i} ${v.l}</span>`).join('');
  // Resize
  window.addEventListener('resize',()=>{W=ct.clientWidth;H=ct.clientHeight;svg.setAttribute('width',W);svg.setAttribute('height',H);});
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• MAP â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let mapReady=false;
function initMap(){
  mapReady=true;
  document.getElementById('venue-grid').innerHTML=VENUES.map(v=>
    `<${v.u?`a href="${v.u}" target="_blank" rel="noopener"`:'div'} class="venue" style="text-decoration:none;color:inherit">
      <div class="venue-t">${v.t}</div><div class="venue-n">${v.n}</div><div class="venue-d">${v.d}</div>
      ${v.u?`<div style="font-size:10px;color:var(--lila);margin-top:6px">â†’ ${v.u.replace('https://','').replace('www.','')}</div>`:''}
    </${v.u?'a':'div'}>`).join('');
  document.getElementById('map-btns').innerHTML=MAPS.map((m,i)=>
    `<button class="map-btn${i===0?' on':''}" data-i="${i}">${m.l}</button>`).join('');
  setMap(0);
  document.querySelectorAll('#map-btns .map-btn').forEach(b=>b.addEventListener('click',()=>{
    document.querySelectorAll('#map-btns .map-btn').forEach(x=>x.classList.remove('on'));
    b.classList.add('on');setMap(+b.dataset.i);
  }));
}
function setMap(i){
  const m=MAPS[i];
  document.getElementById('map-frame').innerHTML=`<iframe title="Carte" src="https://www.openstreetmap.org/export/embed.html?bbox=${m.bb}&layer=mapnik&marker=${m.mk}"></iframe>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• GO STEPS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
document.getElementById('go-steps').innerHTML=STEPS.map(s=>
  `<div class="go-step"><div class="go-n" style="background:${s.c}15;border:2px solid ${s.c};color:${s.c}">${s.n}</div><div style="flex:1"><div class="go-t">${s.t}</div><div class="go-d">${s.d}</div></div></div>`).join('');
</script>
</body>
</html>
