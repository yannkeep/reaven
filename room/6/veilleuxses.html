<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ouaisfieu Â· LA FORGE â€” Fabriquez votre atelier-dÃ©bat</title>
<meta name="description" content="Catalogue interactif de 16 formats d'ateliers-dÃ©bats citoyens issus de l'Ã©ducation populaire. MÃ©thodologie VoirÂ·PenserÂ·Agir. Open source, zÃ©ro traÃ§age.">
<meta name="author" content="ouaisfieu â€” Intelligence citoyenne belge">
<meta property="og:title" content="LA FORGE â€” Fabriquez votre atelier-dÃ©bat">
<meta property="og:description" content="16 formats d'ateliers-dÃ©bats citoyens. Ã‰ducation populaire + civic tech.">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   VARIABLES & RESET
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root {
  --bg:#0d1117; --bg2:#161b22; --bg3:#1c2129;
  --border:#30363d; --border-hi:#48bb7844;
  --text:#e6edf3; --dim:#7d8590;
  --mint:#48bb78; --mint-lo:#48bb7822; --mint-mid:#48bb7855;
  --lilac:#9f7aea; --lilac-lo:#9f7aea22;
  --orange:#f6ad55; --yellow:#fbd38d;
  --blue:#63b3ed; --rose:#ed64a6; --red:#fc8181;
  --font:'JetBrains Mono','Space Mono',monospace;
  --sidebar-w:270px; --topbar-h:36px; --bottom-h:38px;
}
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
html,body{height:100%;overflow:hidden}
body{font-family:var(--font);background:var(--bg);color:var(--text);font-size:12px;line-height:1.5}
::selection{background:var(--mint);color:var(--bg)}
::-webkit-scrollbar{width:5px}
::-webkit-scrollbar-track{background:var(--bg)}
::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CRT OVERLAY
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
body::before{
  content:'';position:fixed;inset:0;z-index:99999;pointer-events:none;
  background:repeating-linear-gradient(0deg,transparent,transparent 2px,rgba(0,0,0,0.03) 2px,rgba(0,0,0,0.03) 4px);
}
body::after{
  content:'';position:fixed;inset:0;z-index:99998;pointer-events:none;
  background:radial-gradient(ellipse at center,transparent 55%,rgba(0,0,0,0.45) 100%);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PARTICLES CANVAS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#particles{position:fixed;inset:0;z-index:0;pointer-events:none;opacity:0.35}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOPBAR
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#topbar{
  position:fixed;top:0;left:0;right:0;height:var(--topbar-h);
  background:var(--bg2);border-bottom:1px solid var(--border);
  display:flex;align-items:center;padding:0 12px;z-index:1000;gap:10px;
}
.dots{display:flex;gap:5px}
.dots span{width:10px;height:10px;border-radius:50%;display:block}
.d-r{background:#ff5f57}.d-y{background:#febc2e}.d-g{background:#28c840}
.top-title{flex:1;font-size:11px;color:var(--dim);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.top-title b{color:var(--mint);font-weight:700}
.top-status{font-size:9px;color:var(--mint);animation:blink 2s ease infinite}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.3}}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SIDEBAR
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#sidebar{
  position:fixed;top:var(--topbar-h);left:0;width:var(--sidebar-w);
  bottom:var(--bottom-h);background:var(--bg2);border-right:1px solid var(--border);
  z-index:500;display:flex;flex-direction:column;transition:transform .3s ease;
}
#sidebar.collapsed{transform:translateX(calc(-1 * var(--sidebar-w) + 36px))}
.sb-head{
  padding:8px 10px;border-bottom:1px solid var(--border);
  display:flex;align-items:center;gap:6px;
}
.sb-head input{
  flex:1;background:var(--bg);border:1px solid var(--border);
  color:var(--mint);font-family:var(--font);font-size:10px;
  padding:5px 8px;border-radius:3px;outline:none;
}
.sb-head input:focus{border-color:var(--mint);box-shadow:0 0 8px var(--mint-lo)}
.sb-head input::placeholder{color:var(--dim)}
.sb-toggle{
  background:none;border:1px solid var(--border);color:var(--dim);
  cursor:pointer;font-family:var(--font);font-size:10px;
  padding:4px 7px;border-radius:3px;
}
.sb-toggle:hover{border-color:var(--mint);color:var(--mint)}
.sb-list{flex:1;overflow-y:auto;padding:4px 0}
.ws-card{
  padding:7px 10px;cursor:pointer;border-left:2px solid transparent;
  transition:all .15s;display:flex;align-items:center;gap:7px;
}
.ws-card:hover{background:var(--bg);border-left-color:var(--mint)}
.ws-card.active{background:var(--bg);border-left-color:var(--lilac)}
.ws-ico{
  width:26px;height:26px;border-radius:4px;display:flex;
  align-items:center;justify-content:center;font-size:13px;flex-shrink:0;
}
.ws-info{flex:1;min-width:0}
.ws-name{font-size:10px;font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.ws-tags{display:flex;gap:3px;margin-top:1px;flex-wrap:wrap}
.ws-tag{font-size:7px;padding:1px 4px;border-radius:2px;opacity:.85}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   GRAPH AREA
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#graph-area{
  position:fixed;top:var(--topbar-h);left:var(--sidebar-w);right:0;
  bottom:var(--bottom-h);z-index:10;overflow:hidden;transition:left .3s ease;
}
#sidebar.collapsed~#graph-area{left:36px}
#graph-svg{width:100%;height:100%;display:block}
.g-link{stroke:var(--border);stroke-width:1}
.g-link.lit{stroke:var(--mint);stroke-width:2}
.n-label{
  font-family:var(--font);font-size:9px;fill:var(--text);
  text-anchor:middle;pointer-events:none;opacity:.8;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOOLTIP
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#tip{
  position:fixed;background:var(--bg2);border:1px solid var(--mint);
  padding:8px 12px;border-radius:4px;font-size:10px;
  pointer-events:none;z-index:2000;max-width:240px;display:none;
  box-shadow:0 4px 20px rgba(0,0,0,.6);
}
#tip .tn{color:var(--mint);font-weight:700;margin-bottom:2px}
#tip .td{color:var(--dim);font-size:9px}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MODAL
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#modal-bg{
  position:fixed;inset:0;background:rgba(0,0,0,.78);backdrop-filter:blur(5px);
  z-index:5000;display:none;align-items:center;justify-content:center;
}
#modal-bg.open{display:flex}
#modal{
  background:var(--bg2);border:1px solid var(--border);border-radius:6px;
  width:92%;max-width:660px;max-height:82vh;overflow-y:auto;
  box-shadow:0 12px 48px rgba(0,0,0,.7);
}
.m-head{
  padding:14px 18px;border-bottom:1px solid var(--border);
  display:flex;align-items:center;gap:10px;
  position:sticky;top:0;background:var(--bg2);z-index:1;
}
.m-head .m-ico{font-size:22px}
.m-head .m-title{font-size:14px;font-weight:700;color:var(--mint);flex:1}
.m-head .m-close{
  background:none;border:none;color:var(--dim);cursor:pointer;
  font-size:18px;font-family:var(--font);padding:4px 8px;
}
.m-head .m-close:hover{color:var(--red)}
.m-body{padding:18px}
.m-body h3{color:var(--lilac);font-size:11px;text-transform:uppercase;letter-spacing:1px;margin:14px 0 6px}
.m-body h3:first-child{margin-top:0}
.m-body p,.m-body li{color:var(--text);font-size:11px;line-height:1.65}
.m-body ul{padding-left:14px}
.m-body li{margin-bottom:3px}
.m-meta{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:14px}
.m-meta-i{background:var(--bg);padding:8px 10px;border-radius:4px;border-left:2px solid var(--mint)}
.m-meta-l{color:var(--dim);font-size:8px;text-transform:uppercase;letter-spacing:.5px}
.m-meta-v{color:var(--text);font-size:11px;font-weight:500;margin-top:1px}
.m-links{margin-top:14px;display:flex;flex-wrap:wrap;gap:6px}
.m-link-btn{
  background:var(--mint-lo);border:1px solid var(--mint-mid);
  color:var(--mint);font-family:var(--font);font-size:9px;
  padding:3px 8px;border-radius:3px;cursor:pointer;
}
.m-link-btn:hover{background:var(--mint-mid);color:var(--bg)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BOTTOM BAR / CONSOLE
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#bottom{
  position:fixed;bottom:0;left:0;right:0;height:var(--bottom-h);
  background:var(--bg2);border-top:1px solid var(--border);
  display:flex;align-items:center;padding:0 12px;gap:8px;z-index:1000;
}
.cmd-p{color:var(--mint);font-size:10px;white-space:nowrap}
#cmd{
  flex:1;background:transparent;border:none;color:var(--mint);
  font-family:var(--font);font-size:11px;outline:none;caret-color:var(--mint);
}
#cmd::placeholder{color:var(--dim)}
.cmd-h{color:var(--dim);font-size:8px;white-space:nowrap}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOAST
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.toast{
  position:fixed;bottom:52px;left:50%;transform:translateX(-50%);
  background:var(--bg2);border:1px solid var(--mint);color:var(--text);
  padding:8px 16px;border-radius:4px;font-size:10px;z-index:6000;
  max-width:92vw;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
  animation:toast-in .3s ease;box-shadow:0 4px 20px rgba(0,0,0,.6);
}
@keyframes toast-in{from{opacity:0;transform:translateX(-50%) translateY(10px)}to{opacity:1;transform:translateX(-50%) translateY(0)}}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESPONSIVE
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@media(max-width:700px){
  #sidebar{transform:translateX(-100%)}
  #sidebar.mobile-open{transform:translateX(0)}
  #graph-area{left:0!important}
  .cmd-h{display:none}
}
</style>
</head>
<body>

<canvas id="particles"></canvas>

<!-- TOPBAR -->
<div id="topbar">
  <div class="dots"><span class="d-r"></span><span class="d-y"></span><span class="d-g"></span></div>
  <div class="top-title"><b>LA FORGE</b> â€” Fabriquez votre atelier-dÃ©bat Â· ouaisfieu</div>
  <div class="top-status">â— VOIRÂ·PENSERÂ·AGIR</div>
</div>

<!-- SIDEBAR -->
<div id="sidebar">
  <div class="sb-head">
    <input type="text" id="search" placeholder="ğŸ” Chercher un formatâ€¦" />
    <button class="sb-toggle" id="sb-toggle" title="RÃ©duire">â—€</button>
  </div>
  <div class="sb-list" id="sb-list"></div>
</div>

<!-- GRAPH -->
<div id="graph-area"><svg id="graph-svg"></svg></div>

<!-- TOOLTIP -->
<div id="tip"><div class="tn"></div><div class="td"></div></div>

<!-- MODAL -->
<div id="modal-bg">
  <div id="modal">
    <div class="m-head">
      <span class="m-ico" id="m-ico"></span>
      <span class="m-title" id="m-title"></span>
      <button class="m-close" id="m-close">&times;</button>
    </div>
    <div class="m-body" id="m-body"></div>
  </div>
</div>

<!-- BOTTOM BAR -->
<div id="bottom">
  <span class="cmd-p">forge:~$</span>
  <input type="text" id="cmd" placeholder="help Â· go Â· list Â· vpa Â· [nom du format]" autocomplete="off" spellcheck="false" />
  <span class="cmd-h">ENTER pour exÃ©cuter</span>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     JAVASCRIPT â€” Console first, D3 graph second
     Console MUST work even if D3 fails to load
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script>
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// DATA
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const WS=[
{id:'cafe-debat',icon:'â˜•',name:'CafÃ©-DÃ©bat',cat:'agir',color:'#48bb78',r:13,tags:['Convivial','Ouvert'],phase:'AGIR',
desc:'Discussion informelle autour d\'un thÃ¨me, cadre convivial type cafÃ©.',
detail:'<h3>Principe</h3><p>Les participantÂ·es Ã©changent librement autour d\'une question posÃ©e, dans une ambiance dÃ©contractÃ©e. UnÂ·e animateurÂ·rice facilite la parole sans la diriger.</p><h3>DÃ©roulement</h3><ul><li>Accueil cafÃ©/thÃ© (10 min)</li><li>Introduction du thÃ¨me (5 min)</li><li>Discussion libre facilitÃ©e (45 min)</li><li>Tour de table de synthÃ¨se (15 min)</li></ul><h3>Atouts EP</h3><p>Faible barriÃ¨re d\'entrÃ©e. IdÃ©al premier contact. DÃ©veloppe l\'Ã©coute et l\'expression orale.</p>',
participants:'5â€“15',duree:'1h30',diff:'â˜…â˜†â˜†',axe:'CitoyennetÃ© active',
links:['cine-debat','world-cafe','cercle-parole','debat-mouvant','voir-penser-agir']},

{id:'cine-debat',icon:'ğŸ¬',name:'CinÃ©-DÃ©bat',cat:'voir',color:'#9f7aea',r:12,tags:['Audiovisuel','Analyse'],phase:'VOIR',
desc:'Projection d\'un film/documentaire suivie d\'un dÃ©bat structurÃ©.',
detail:'<h3>Principe</h3><p>Un support audiovisuel sert de dÃ©clencheur Ã  la rÃ©flexion collective. Le dÃ©bat qui suit dÃ©passe la simple rÃ©action Ã©motionnelle.</p><h3>DÃ©roulement</h3><ul><li>Contextualisation (10 min)</li><li>Projection (variable)</li><li>Silence de digestion (5 min)</li><li>DÃ©bat en 3 temps : ressenti â†’ analyse â†’ action (45 min)</li></ul><h3>Atouts EP</h3><p>Le support visuel est un Ã©galisateur : mÃªme expÃ©rience partagÃ©e pour tous.</p>',
participants:'5â€“30',duree:'2h30â€“3h',diff:'â˜…â˜†â˜†',axe:'Analyse critique',
links:['cafe-debat','photo-langage','lecture-collective','voir-penser-agir']},

{id:'porteur-paroles',icon:'ğŸ“¢',name:'Porteur de Paroles',cat:'terrain',color:'#fbd38d',r:12,tags:['Rue','Impact','Viral'],phase:'AGIR',
desc:'Installation dans l\'espace public avec question provocatrice, recueil de paroles de passants.',
detail:'<h3>Principe</h3><p>Grande affiche avec question interpellante dans un lieu de passage. Les animateurÂ·rices invitent les passantÂ·es Ã  s\'exprimer. RÃ©ponses affichÃ©es publiquement.</p><h3>DÃ©roulement</h3><ul><li>Choix du lieu et de la question</li><li>Installation du dispositif</li><li>Interpellation bienveillante (2â€“3h)</li><li>Documentation photographique</li><li>Restitution et analyse des rÃ©ponses</li></ul><h3>Atouts EP</h3><p>Touche des publics qui ne viennent jamais en atelier. Renouvelle la parole citoyenne hors des murs.</p>',
participants:'3â€“6 anim.',duree:'3h terrain',diff:'â˜…â˜…â˜†',axe:'Initiative collective',
links:['debat-mouvant','marche-exploratoire','voir-penser-agir']},

{id:'debat-mouvant',icon:'ğŸƒ',name:'DÃ©bat Mouvant',cat:'penser',color:'#f6ad55',r:11,tags:['Corporel','Dynamique'],phase:'PENSER',
desc:'Les participantÂ·es se positionnent physiquement pour/contre une affirmation et argumentent.',
detail:'<h3>Principe</h3><p>Affirmation clivante Ã©noncÃ©e. ParticipantÂ·es d\'un cÃ´tÃ© (d\'accord) ou l\'autre (pas d\'accord). ChacunÂ·e argumente pour faire bouger les autres.</p><h3>DÃ©roulement</h3><ul><li>Explication des rÃ¨gles (5 min)</li><li>Lecture de l\'affirmation</li><li>Positionnement physique</li><li>Argumentation libre (15â€“20 min/affirmation)</li><li>3â€“4 affirmations successives</li></ul><h3>Atouts EP</h3><p>Engage le corps, pas seulement l\'intellect. Rend visible la nuance : on voit les gens bouger.</p>',
participants:'8â€“30',duree:'1h',diff:'â˜…â˜†â˜†',axe:'Analyse critique',
links:['cafe-debat','tribunal-citoyen','theatre-forum','voir-penser-agir']},

{id:'photo-langage',icon:'ğŸ–¼ï¸',name:'Photo-Langage',cat:'voir',color:'#9f7aea',r:10,tags:['Visuel','Intuitif','Inclusif'],phase:'VOIR',
desc:'Choisir une photo pour exprimer son ressenti sur un thÃ¨me, puis expliquer son choix.',
detail:'<h3>Principe</h3><p>Corpus de photos variÃ©es disposÃ©. Chaque participantÂ·e choisit celle qui rÃ©sonne avec la question, puis partage son interprÃ©tation.</p><h3>DÃ©roulement</h3><ul><li>Disposition des photos (20â€“30 images)</li><li>Ã‰noncÃ© de la question</li><li>Choix silencieux (5 min)</li><li>Tour de parole explicatif</li><li>Discussion collective</li></ul><h3>Atouts EP</h3><p>Contourne les barriÃ¨res de l\'Ã©crit. Permet l\'expression Ã©motionnelle et symbolique.</p>',
participants:'5â€“15',duree:'1hâ€“1h30',diff:'â˜…â˜†â˜†',axe:'Expression culturelle',
links:['cine-debat','cafe-debat','cercle-parole','voir-penser-agir']},

{id:'world-cafe',icon:'ğŸŒ',name:'World CafÃ©',cat:'agir',color:'#48bb78',r:11,tags:['Rotatif','Intelligence collective'],phase:'AGIR',
desc:'Tables tournantes oÃ¹ les participantÂ·es pollinisent les idÃ©es en changeant de table.',
detail:'<h3>Principe</h3><p>Plusieurs tables traitent chacune une sous-question. Les participantÂ·es changent de table Ã  intervalles rÃ©guliers, sauf unÂ·e Â« hÃ´te Â» qui fait le lien.</p><h3>DÃ©roulement</h3><ul><li>3â€“5 tables, 4â€“5 personnes/table</li><li>3 rotations de 20 minutes</li><li>Nappes en papier pour Ã©crire/dessiner</li><li>Restitution plÃ©niÃ¨re par les hÃ´tes</li></ul><h3>Atouts EP</h3><p>Maximise la pollinisation des idÃ©es. Chaque personne contribue Ã  chaque sous-thÃ¨me.</p>',
participants:'12â€“50',duree:'1h30â€“2h',diff:'â˜…â˜…â˜†',axe:'Initiative collective',
links:['cafe-debat','fresque-citoyenne','porteur-paroles','voir-penser-agir']},

{id:'cercle-parole',icon:'â­•',name:'Cercle de Parole',cat:'agir',color:'#48bb78',r:10,tags:['Ã‰coute','Rituel'],phase:'AGIR',
desc:'La parole circule en cercle avec bÃ¢ton de parole. Ã‰coute sans interruption.',
detail:'<h3>Principe</h3><p>Assis en cercle, les participantÂ·es s\'expriment Ã  tour de rÃ´le avec un objet-symbole. Pas d\'interruption, on parle en Â« je Â».</p><h3>DÃ©roulement</h3><ul><li>Installation en cercle</li><li>Rappel des rÃ¨gles</li><li>1er tour : partage libre</li><li>2e tour : approfondissement</li><li>Tour de clÃ´ture</li></ul><h3>Atouts EP</h3><p>Espace de parole sÃ©curisÃ©. Ã‰galise radicalement le temps de parole.</p>',
participants:'5â€“12',duree:'1hâ€“1h30',diff:'â˜…â˜†â˜†',axe:'Expression culturelle',
links:['cafe-debat','photo-langage','theatre-forum','voir-penser-agir']},

{id:'theatre-forum',icon:'ğŸ­',name:'ThÃ©Ã¢tre-Forum',cat:'penser',color:'#f6ad55',r:11,tags:['Augusto Boal','Corporel'],phase:'PENSER',
desc:'ScÃ¨ne d\'oppression jouÃ©e. Les spect-acteurÂ·rices remplacent un personnage pour changer l\'issue.',
detail:'<h3>Principe</h3><p>InspirÃ© d\'Augusto Boal. Courte scÃ¨ne d\'oppression. AprÃ¨s premiÃ¨re lecture, les spectateurÂ·rices crient Â« Stop ! Â», remplacent un personnage et tentent de changer l\'issue.</p><h3>DÃ©roulement</h3><ul><li>Ã‰chauffement corporel (15 min)</li><li>ScÃ¨ne modÃ¨le (10 min)</li><li>Interventions des spect-acteurÂ·rices (45 min)</li><li>Debriefing collectif (20 min)</li></ul><h3>Atouts EP</h3><p>Â« RÃ©pÃ©ter Â» des stratÃ©gies de rÃ©sistance. L\'oppression vÃ©cue corporellement.</p>',
participants:'8â€“25',duree:'2h',diff:'â˜…â˜…â˜…',axe:'Analyse critique',
links:['debat-mouvant','jeu-role-citoyen','cercle-parole','voir-penser-agir']},

{id:'fresque-citoyenne',icon:'ğŸ§©',name:'Fresque Citoyenne',cat:'voir',color:'#63b3ed',r:12,tags:['SystÃ©mique','Collaboratif'],phase:'VOIR',
desc:'Construction collective d\'une carte visuelle des enjeux d\'un territoire ou d\'une problÃ©matique.',
detail:'<h3>Principe</h3><p>InspirÃ© de la Fresque du Climat. Construction collective d\'une carte visuelle des causes et consÃ©quences d\'un enjeu citoyen.</p><h3>DÃ©roulement</h3><ul><li>Distribution des cartes-enjeux</li><li>Placement et discussion (45 min)</li><li>Liens causaux (20 min)</li><li>Illustration crÃ©ative (20 min)</li><li>Restitution et engagement (15 min)</li></ul><h3>Atouts EP</h3><p>Rend visible la complexitÃ© systÃ©mique. Produit un livrable collectif tangible.</p>',
participants:'6â€“16',duree:'2hâ€“3h',diff:'â˜…â˜…â˜†',axe:'Analyse critique',
links:['world-cafe','lecture-collective','ecriture-collective','voir-penser-agir']},

{id:'jeu-role-citoyen',icon:'ğŸ²',name:'Jeu de RÃ´le Citoyen',cat:'penser',color:'#f6ad55',r:9,tags:['Simulation','Empathie'],phase:'PENSER',
desc:'Simulation oÃ¹ chacunÂ·e incarne un rÃ´le (Ã©lu, citoyen, lobby) dans un scÃ©nario politique.',
detail:'<h3>Principe</h3><p>Fiche-personnage avec objectifs et contraintes. Le groupe nÃ©gocie une dÃ©cision collective en restant dans son rÃ´le.</p><h3>DÃ©roulement</h3><ul><li>Distribution des rÃ´les (15 min)</li><li>NÃ©gociation en sous-groupes (30 min)</li><li>PlÃ©niÃ¨re de dÃ©cision (30 min)</li><li>Debriefing hors personnage (30 min)</li></ul><h3>Atouts EP</h3><p>DÃ©veloppe l\'empathie. RÃ©vÃ¨le les rapports de force.</p>',
participants:'8â€“20',duree:'2hâ€“3h',diff:'â˜…â˜…â˜…',axe:'CitoyennetÃ© active',
links:['theatre-forum','tribunal-citoyen','debat-mouvant','voir-penser-agir']},

{id:'tribunal-citoyen',icon:'âš–ï¸',name:'Tribunal Citoyen',cat:'agir',color:'#48bb78',r:10,tags:['Juridique','Argumentation'],phase:'AGIR',
desc:'ProcÃ¨s fictif d\'un enjeu de sociÃ©tÃ© : avocatÂ·es, procureur, tÃ©moins, jury citoyen.',
detail:'<h3>Principe</h3><p>Un enjeu de sociÃ©tÃ© Â« jugÃ© Â» dans un format thÃ©Ã¢tral. DÃ©fense, accusation, tÃ©moins expertÂ·es. Le reste du groupe est jury.</p><h3>DÃ©roulement</h3><ul><li>PrÃ©paration des rÃ´les (30 min)</li><li>Ouverture du procÃ¨s (5 min)</li><li>Plaidoiries et tÃ©moignages (40 min)</li><li>DÃ©libÃ©ration du jury (20 min)</li><li>Verdict et debriefing (15 min)</li></ul><h3>Atouts EP</h3><p>Argumentation structurÃ©e. Format spectaculaire et mÃ©morable.</p>',
participants:'10â€“30',duree:'2h',diff:'â˜…â˜…â˜…',axe:'CitoyennetÃ© active',
links:['jeu-role-citoyen','debat-mouvant','cafe-debat','voir-penser-agir']},

{id:'lecture-collective',icon:'ğŸ“–',name:'Lecture Collective CommentÃ©e',cat:'voir',color:'#63b3ed',r:9,tags:['Arpentage','Texte'],phase:'VOIR',
desc:'Document dÃ©coupÃ© et rÃ©parti entre participantÂ·es. ChacunÂ·e lit sa partie et la restitue (arpentage).',
detail:'<h3>Principe</h3><p>MÃ©thode d\'arpentage de l\'Ã©ducation ouvriÃ¨re. Document long dÃ©coupÃ© en parties Ã©gales. ChacunÂ·e lit sa portion, puis restitue les points clÃ©s.</p><h3>DÃ©roulement</h3><ul><li>PrÃ©sentation du texte et dÃ©coupage (10 min)</li><li>Lecture individuelle (20â€“30 min)</li><li>Restitution tour Ã  tour (30â€“40 min)</li><li>Discussion et mise en perspective (20 min)</li></ul><h3>Atouts EP</h3><p>Â« Lire Â» un document de 100 pages en 1h30. DÃ©mystifie les textes complexes.</p>',
participants:'5â€“12',duree:'1h30â€“2h',diff:'â˜…â˜…â˜†',axe:'Analyse critique',
links:['cine-debat','fresque-citoyenne','ecriture-collective','voir-penser-agir']},

{id:'ecriture-collective',icon:'âœï¸',name:'Atelier d\'Ã‰criture Collective',cat:'voir',color:'#63b3ed',r:9,tags:['CrÃ©ation','Ã‰mancipation'],phase:'VOIR',
desc:'Production collective d\'un texte (tract, lettre ouverte, charteâ€¦) par itÃ©rations et consensus.',
detail:'<h3>Principe</h3><p>Le groupe produit un texte commun par Ã©tapes : brainstorm, structuration, rÃ©daction en sous-groupes, assemblage, rÃ©vision collective.</p><h3>DÃ©roulement</h3><ul><li>Choix du format et de l\'intention (15 min)</li><li>Brainstorm d\'idÃ©es clÃ©s (15 min)</li><li>RÃ©daction en binÃ´mes (30 min)</li><li>Lecture croisÃ©e et assemblage (20 min)</li><li>Polissage collectif (20 min)</li></ul><h3>Atouts EP</h3><p>Livrable tangible. DÃ©veloppe la capacitÃ© d\'expression Ã©crite collective.</p>',
participants:'5â€“12',duree:'2h',diff:'â˜…â˜…â˜†',axe:'Expression culturelle',
links:['lecture-collective','fresque-citoyenne','cercle-parole','voir-penser-agir']},

{id:'marche-exploratoire',icon:'ğŸš¶',name:'Marche Exploratoire',cat:'terrain',color:'#fbd38d',r:9,tags:['Terrain','Sensoriel'],phase:'VOIR',
desc:'DÃ©ambulation collective dans un quartier avec grille d\'observation. Le territoire = support du dÃ©bat.',
detail:'<h3>Principe</h3><p>Le groupe marche dans un quartier avec une grille d\'observation (sÃ©curitÃ©, propretÃ©, accessibilitÃ©â€¦). Les constats deviennent la matiÃ¨re du dÃ©bat.</p><h3>DÃ©roulement</h3><ul><li>Briefing et distribution des grilles (15 min)</li><li>Marche avec arrÃªts commentÃ©s (1hâ€“1h30)</li><li>Retour en salle pour mise en commun (30 min)</li><li>Priorisation des constats et pistes d\'action (30 min)</li></ul><h3>Atouts EP</h3><p>Ancre le dÃ©bat dans le rÃ©el vÃ©cu. Touche les publics Ã©loignÃ©s de l\'Ã©crit.</p>',
participants:'5â€“15',duree:'2h30â€“3h',diff:'â˜…â˜…â˜†',axe:'Initiative collective',
links:['porteur-paroles','fresque-citoyenne','voir-penser-agir']},

{id:'voir-penser-agir',icon:'ğŸ§­',name:'Voir Â· Penser Â· Agir',cat:'hub',color:'#ed64a6',r:16,tags:['MÃ©thodologie','VPA','Cadre'],phase:'HUB',
desc:'Cadre mÃ©thodologique central. Structure tout atelier en 3 phases.',
detail:'<h3>Le cadre VoirÂ·PenserÂ·Agir</h3><p>Chaque atelier-dÃ©bat suit ce cycle en 3 phases, inspirÃ© de la mÃ©thode Voir-Juger-Agir de l\'Ã©ducation populaire (Joseph Cardijn, JOC, 1925).</p><h3>ğŸ‘ï¸ VOIR â€” Observer, s\'informer</h3><p>Phase de collecte. On regarde, on lit, on Ã©coute. Pas encore de jugement.<br>Formats : CinÃ©-DÃ©bat, Photo-Langage, Fresque, Lecture Collective, Ã‰criture Collective, Marche Exploratoire.</p><h3>ğŸ§  PENSER â€” Analyser, confronter</h3><p>Phase de rÃ©flexion critique. On dÃ©bat, on argumente, on change de perspective.<br>Formats : DÃ©bat Mouvant, ThÃ©Ã¢tre-Forum, Jeu de RÃ´le Citoyen.</p><h3>âœŠ AGIR â€” DÃ©cider, produire, agir</h3><p>Phase d\'engagement. On produit, on dÃ©cide, on s\'organise.<br>Formats : CafÃ©-DÃ©bat, World CafÃ©, Cercle de Parole, Tribunal Citoyen, Porteur de Paroles.</p><h3>Contraintes Ã‰ducation Permanente</h3><ul><li>Min. 5 participants publics (hors employÃ©s)</li><li>Max. 9 participants pour un dialogue de qualitÃ©</li><li>Phase asynchrone : 7 jours de maturation</li><li>Debrief synchrone : dans les 48h</li><li>Alignement sur les 4 axes EP : analyse critique, initiative collective, citoyennetÃ© active, expression culturelle</li></ul>',
participants:'â€”',duree:'â€”',diff:'â€”',axe:'Transversal',
links:['cafe-debat','cine-debat','debat-mouvant','theatre-forum','fresque-citoyenne','porteur-paroles','guide-animateur']},

{id:'guide-animateur',icon:'ğŸ¯',name:'Guide de l\'AnimateurÂ·rice',cat:'hub',color:'#ed64a6',r:11,tags:['Formation','Posture'],phase:'HUB',
desc:'Fiche ressource : posture et techniques d\'animation pour un atelier-dÃ©bat citoyen.',
detail:'<h3>Posture de l\'animateurÂ·rice</h3><p>Pas unÂ·e expertÂ·e qui transmet, mais unÂ·e facilitateurÂ·rice. Posture basse, questions ouvertes, reformulation.</p><h3>Techniques clÃ©s</h3><ul><li><b>Reformulation</b> : Â« Si je comprends bien, tu dis queâ€¦ Â»</li><li><b>Relance</b> : Â« Quelqu\'un voit les choses autrement ? Â»</li><li><b>Recadrage</b> : Â« On s\'Ã©loigne du sujet, revenons Ã â€¦ Â»</li><li><b>Gestion du silence</b> : attendre 7 secondes avant de relancer</li><li><b>Ã‰quilibrage</b> : Â« On n\'a pas encore entendu ce cÃ´tÃ© de la salle Â»</li></ul><h3>Check-list avant l\'atelier</h3><ul><li>â˜ Lieu accessible et neutre</li><li>â˜ MatÃ©riel (marqueurs, post-its, paperboard)</li><li>â˜ Cadre posÃ© (rÃ¨gles de parole)</li><li>â˜ Question formulÃ©e (ouverte, pas orientÃ©e)</li><li>â˜ Plan B si moins de 5 participantÂ·es</li></ul><h3>Attestation EP</h3><p>Si â‰¥5 participants publics : gÃ©nÃ©rer fiche atelier valorisable EP (thÃ©matique, mÃ©thodologie, durÃ©e, axe EP, liste anonymisable).</p>',
participants:'â€”',duree:'â€”',diff:'â€”',axe:'Transversal',
links:['voir-penser-agir','cafe-debat','cercle-parole','theatre-forum']}
];

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// CONSOLE â€” 100% independent of D3
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const cmdEl=document.getElementById('cmd');

// Prevent propagation so D3 zoom/drag never steals focus
['keydown','keyup','keypress','mousedown','click'].forEach(ev=>{
  cmdEl.addEventListener(ev,e=>e.stopPropagation());
});

cmdEl.addEventListener('keydown',function(e){
  if(e.key!=='Enter')return;
  const v=this.value.trim().toLowerCase();
  this.value='';
  if(!v)return;
  handleCmd(v);
});

function handleCmd(v){
  if(v==='help'){
    toast('ğŸ“‹ Commandes : help Â· go Â· list Â· vpa Â· about Â· fork Â· korben Â· [nom du format]');return;
  }
  if(v==='go'){
    const r=WS[Math.floor(Math.random()*WS.length)];
    openModal(r.id);toast('ğŸ² Tirage au sort : '+r.name);return;
  }
  if(v==='list'){
    toast(WS.map(w=>w.icon+' '+w.name).join(' Â· '));return;
  }
  if(v==='vpa'||v==='voir-penser-agir'){openModal('voir-penser-agir');return;}
  if(v==='about'){toast('ğŸ”§ LA FORGE v2.0 â€” ouaisfieu Â· CC BY-NC 4.0 Â· github.com/ouaisfieu');return;}
  if(v==='fork'){toast('ğŸ´ Fork the system â†’ github.com/ouaisfieu/la-forge â€” CC BY-NC 4.0');return;}
  if(v==='korben'){toast('ğŸ¤– Pas de node_modules. Pas de build step. Pas de framework. Juste du HTML qui envoie du bois. Comme en 1999, mais en mieux.');return;}
  // fuzzy search
  const found=WS.find(w=>w.id===v||w.name.toLowerCase()===v||w.id.includes(v)||w.name.toLowerCase().includes(v));
  if(found){openModal(found.id);}
  else{toast('âš  Format "'+v+'" non trouvÃ©. Tapez "list" ou "go".');}
}

function toast(msg){
  document.querySelectorAll('.toast').forEach(t=>t.remove());
  const t=document.createElement('div');t.className='toast';t.textContent=msg;
  document.body.appendChild(t);setTimeout(()=>t.remove(),5500);
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// MODAL
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openModal(id){
  const w=WS.find(x=>x.id===id);if(!w)return;
  document.getElementById('m-ico').textContent=w.icon;
  document.getElementById('m-title').textContent=w.name;
  let h=w.detail;
  if(w.participants!=='â€”'){
    h+='<div class="m-meta">';
    h+='<div class="m-meta-i"><div class="m-meta-l">Participants</div><div class="m-meta-v">'+w.participants+'</div></div>';
    h+='<div class="m-meta-i"><div class="m-meta-l">DurÃ©e</div><div class="m-meta-v">'+w.duree+'</div></div>';
    h+='<div class="m-meta-i"><div class="m-meta-l">DifficultÃ©</div><div class="m-meta-v">'+w.diff+'</div></div>';
    h+='<div class="m-meta-i"><div class="m-meta-l">Axe EP</div><div class="m-meta-v">'+w.axe+'</div></div>';
    h+='</div>';
  }
  // Related formats
  if(w.links&&w.links.length){
    h+='<div class="m-links">';
    w.links.forEach(lid=>{
      const lw=WS.find(x=>x.id===lid);
      if(lw) h+='<button class="m-link-btn" onclick="openModal(\''+lid+'\')">'+lw.icon+' '+lw.name+'</button>';
    });
    h+='</div>';
  }
  document.getElementById('m-body').innerHTML=h;
  document.getElementById('modal-bg').classList.add('open');
  // Sidebar highlight
  document.querySelectorAll('.ws-card').forEach(c=>c.classList.remove('active'));
  const card=document.querySelector('.ws-card[data-id="'+id+'"]');
  if(card){card.classList.add('active');card.scrollIntoView({behavior:'smooth',block:'nearest'});}
  // Graph highlight
  if(typeof hlNode==='function')hlNode(id);
}
function closeModal(){
  document.getElementById('modal-bg').classList.remove('open');
  if(typeof unhl==='function')unhl();
}
document.getElementById('m-close').addEventListener('click',closeModal);
document.getElementById('modal-bg').addEventListener('click',function(e){if(e.target===this)closeModal()});
document.addEventListener('keydown',e=>{if(e.key==='Escape')closeModal()});

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// SIDEBAR
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildSidebar(f){
  const list=document.getElementById('sb-list');list.innerHTML='';
  const q=(f||'').toLowerCase();
  WS.forEach(w=>{
    if(q&&!w.name.toLowerCase().includes(q)&&!w.id.includes(q)&&!w.tags.some(t=>t.toLowerCase().includes(q)))return;
    const card=document.createElement('div');card.className='ws-card';card.dataset.id=w.id;
    card.onclick=()=>openModal(w.id);
    const ico=document.createElement('div');ico.className='ws-ico';
    ico.style.background=w.color+'18';ico.style.border='1px solid '+w.color+'33';ico.textContent=w.icon;
    const info=document.createElement('div');info.className='ws-info';
    const nm=document.createElement('div');nm.className='ws-name';nm.textContent=w.name;
    const tags=document.createElement('div');tags.className='ws-tags';
    w.tags.forEach(t=>{const s=document.createElement('span');s.className='ws-tag';s.style.background=w.color+'18';s.style.color=w.color;s.textContent=t;tags.appendChild(s)});
    info.appendChild(nm);info.appendChild(tags);card.appendChild(ico);card.appendChild(info);list.appendChild(card);
  });
}
buildSidebar('');
document.getElementById('search').addEventListener('input',function(){buildSidebar(this.value)});
document.getElementById('sb-toggle').addEventListener('click',function(){
  const sb=document.getElementById('sidebar');sb.classList.toggle('collapsed');
  this.textContent=sb.classList.contains('collapsed')?'â–¶':'â—€';
});

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// PARTICLES
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(function(){
  const c=document.getElementById('particles'),ctx=c.getContext('2d');
  let W,H,pts=[];
  function resize(){W=c.width=innerWidth;H=c.height=innerHeight}
  resize();addEventListener('resize',resize);
  const cols=['#48bb78','#9f7aea','#63b3ed','#f6ad55'];
  for(let i=0;i<55;i++)pts.push({x:Math.random()*W,y:Math.random()*H,vx:(Math.random()-.5)*.25,vy:(Math.random()-.5)*.25,r:Math.random()*1.3+.4,c:cols[i%4]});
  function draw(){
    ctx.clearRect(0,0,W,H);
    pts.forEach(p=>{p.x+=p.vx;p.y+=p.vy;if(p.x<0)p.x=W;if(p.x>W)p.x=0;if(p.y<0)p.y=H;if(p.y>H)p.y=0;
    ctx.beginPath();ctx.arc(p.x,p.y,p.r,0,Math.PI*2);ctx.fillStyle=p.c;ctx.globalAlpha=.45;ctx.fill()});
    ctx.globalAlpha=.06;ctx.strokeStyle='#48bb78';ctx.lineWidth=.5;
    for(let i=0;i<pts.length;i++)for(let j=i+1;j<pts.length;j++){
      const dx=pts[i].x-pts[j].x,dy=pts[i].y-pts[j].y;
      if(dx*dx+dy*dy<14000){ctx.beginPath();ctx.moveTo(pts[i].x,pts[i].y);ctx.lineTo(pts[j].x,pts[j].y);ctx.stroke();}
    }
    ctx.globalAlpha=1;requestAnimationFrame(draw);
  }
  draw();
})();

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// D3 GRAPH â€” loaded separately, fails gracefully
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var hlNode=function(){};
var unhl=function(){};
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.9.0/d3.min.js"></script>
<script>
(function(){
  if(typeof d3==='undefined'){console.warn('D3 unavailable â€” console still functional');return;}
  const svg=d3.select('#graph-svg'),box=document.getElementById('graph-area');
  let W=box.clientWidth,H=box.clientHeight;
  const g=svg.append('g');
  const zoom=d3.zoom().scaleExtent([.2,4]).filter(e=>e.target.tagName!=='INPUT').on('zoom',e=>g.attr('transform',e.transform));
  svg.call(zoom);

  // Build unique links
  const links=[];
  WS.forEach(w=>(w.links||[]).forEach(tid=>{
    if(WS.find(x=>x.id===tid)&&!links.find(l=>(l.source===w.id&&l.target===tid)||(l.source===tid&&l.target===w.id)))
      links.push({source:w.id,target:tid});
  }));

  const linkSel=g.append('g').selectAll('line').data(links).join('line').attr('class','g-link').attr('opacity',.25);
  const nodeSel=g.append('g').selectAll('g').data(WS).join('g').style('cursor','pointer')
    .call(d3.drag()
      .on('start',(e,d)=>{if(!e.active)sim.alphaTarget(.3).restart();d.fx=d.x;d.fy=d.y})
      .on('drag',(e,d)=>{d.fx=e.x;d.fy=e.y})
      .on('end',(e,d)=>{if(!e.active)sim.alphaTarget(0);d.fx=null;d.fy=null}));

  // Glow ring
  nodeSel.append('circle').attr('r',d=>d.r+6).attr('fill','none').attr('stroke',d=>d.color).attr('stroke-width',.8).attr('opacity',.15)
    .style('animation','node-glow 3.5s ease infinite').style('animation-delay',()=>Math.random()*3+'s');
  // Main circle
  nodeSel.append('circle').attr('r',d=>d.r).attr('fill',d=>d.color+'22').attr('stroke',d=>d.color).attr('stroke-width',1.5);
  // Icon
  nodeSel.append('text').attr('text-anchor','middle').attr('dy','.35em').style('font-size',d=>(d.r*.85)+'px').style('pointer-events','none').text(d=>d.icon);
  // Label
  nodeSel.append('text').attr('class','n-label').attr('dy',d=>d.r+12).text(d=>d.name);

  // Style for glow animation
  const style=document.createElement('style');
  style.textContent='@keyframes node-glow{0%,100%{opacity:.15}50%{opacity:.4}}';
  document.head.appendChild(style);

  // Click
  nodeSel.on('click',(e,d)=>{e.stopPropagation();openModal(d.id)});

  // Tooltip
  const tip=document.getElementById('tip');
  nodeSel.on('mouseenter',(e,d)=>{
    tip.querySelector('.tn').textContent=d.icon+' '+d.name;
    tip.querySelector('.td').textContent=d.phase+' â€” '+d.desc;
    tip.style.display='block';tip.style.left=(e.clientX+14)+'px';tip.style.top=(e.clientY-12)+'px';
  });
  nodeSel.on('mousemove',e=>{tip.style.left=(e.clientX+14)+'px';tip.style.top=(e.clientY-12)+'px'});
  nodeSel.on('mouseleave',()=>{tip.style.display='none'});

  // Simulation
  const sim=d3.forceSimulation(WS)
    .force('link',d3.forceLink(links).id(d=>d.id).distance(105).strength(.3))
    .force('charge',d3.forceManyBody().strength(-380))
    .force('center',d3.forceCenter(W/2,H/2))
    .force('collide',d3.forceCollide().radius(d=>d.r+10))
    .on('tick',()=>{
      linkSel.attr('x1',d=>d.source.x).attr('y1',d=>d.source.y).attr('x2',d=>d.target.x).attr('y2',d=>d.target.y);
      nodeSel.attr('transform',d=>'translate('+d.x+','+d.y+')');
    });

  addEventListener('resize',()=>{W=box.clientWidth;H=box.clientHeight;sim.force('center',d3.forceCenter(W/2,H/2)).alpha(.3).restart()});

  // Highlight / unhighlight
  hlNode=function(id){
    const connected=new Set([id]);
    links.forEach(l=>{
      const s=typeof l.source==='object'?l.source.id:l.source;
      const t=typeof l.target==='object'?l.target.id:l.target;
      if(s===id)connected.add(t);if(t===id)connected.add(s);
    });
    nodeSel.selectAll('circle:nth-child(2)').attr('opacity',d=>connected.has(d.id)?1:.12);
    nodeSel.selectAll('.n-label').attr('opacity',d=>connected.has(d.id)?1:.12);
    linkSel.each(function(l){
      const s=typeof l.source==='object'?l.source.id:l.source;
      const t=typeof l.target==='object'?l.target.id:l.target;
      const lit=(s===id||t===id);
      d3.select(this).attr('class',lit?'g-link lit':'g-link').attr('opacity',lit?.65:.04);
    });
    // Zoom to node
    const nd=WS.find(w=>w.id===id);
    if(nd&&nd.x!==undefined){
      svg.transition().duration(700).call(zoom.transform,d3.zoomIdentity.translate(W/2-nd.x*1.15,H/2-nd.y*1.15).scale(1.15));
    }
  };
  unhl=function(){
    nodeSel.selectAll('circle:nth-child(2)').attr('opacity',1);
    nodeSel.selectAll('.n-label').attr('opacity',.8);
    linkSel.attr('class','g-link').attr('opacity',.25);
  };

  setTimeout(()=>toast('âš¡ La Forge est ouverte â€” cliquez un nÅ“ud ou tapez "go" dans la console'),1200);
})();
</script>
</body>
</html>
