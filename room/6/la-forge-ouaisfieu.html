<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ouaisfieu :: LA FORGE ‚Äî Fabriquez votre atelier-d√©bat</title>
<link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300;400;500;600;700&family=JetBrains+Mono:wght@300;400;500;700&display=swap" rel="stylesheet">
<style>
:root {
  --mint: #48bb78;
  --mint-dim: #48bb7830;
  --mint-glow: #48bb78bb;
  --lilac: #9f7aea;
  --lilac-dim: #9f7aea30;
  --lilac-glow: #9f7aeabb;
  --bg: #0a0e14;
  --bg-panel: #0d1117;
  --bg-modal: #111820;
  --bg-card: #161b22;
  --text: #c9d1d9;
  --text-dim: #6e7681;
  --border: #21262d;
  --danger: #f85149;
  --warning: #d29922;
  --success: #3fb950;
  --orange: #f6ad55;
  --blue: #63b3ed;
  --pink: #ed64a6;
  --yellow: #fbd38d;
}

* { margin:0; padding:0; box-sizing:border-box; }

html, body {
  width:100%; height:100%;
  background: var(--bg);
  color: var(--text);
  font-family: 'JetBrains Mono', 'Fira Code', monospace;
  overflow: hidden;
}

/* === TEXTURE === */
body::before {
  content:'';
  position:fixed; top:0; left:0; right:0; bottom:0;
  background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,0,0,0.06) 2px, rgba(0,0,0,0.06) 4px);
  pointer-events:none; z-index:9999;
}
body::after {
  content:'';
  position:fixed; top:0; left:0; right:0; bottom:0;
  background: radial-gradient(ellipse at center, transparent 55%, rgba(0,0,0,0.35) 100%);
  pointer-events:none; z-index:9998;
}

/* === AMBIENT PARTICLES === */
#particles { position:fixed; top:0; left:0; width:100%; height:100%; z-index:0; pointer-events:none; }

/* === TOPBAR === */
#topbar {
  position:fixed; top:0; left:0; right:0; height:44px;
  background: var(--bg-panel);
  border-bottom: 1px solid var(--border);
  display:flex; align-items:center; padding:0 16px; z-index:10000; gap:12px;
}
.dots { display:flex; gap:6px; }
.dots span { width:12px; height:12px; border-radius:50%; }
.dot-r { background:var(--danger); }
.dot-y { background:var(--warning); }
.dot-g { background:var(--success); }

.topbar-center {
  flex:1; text-align:center;
  font-size:11px; color:var(--text-dim); letter-spacing:1px;
}
.topbar-center .brand { color:var(--mint); font-weight:700; }
.topbar-center .sep { color:var(--border); margin:0 6px; }
.topbar-center .blink { animation: blink 1.2s infinite; color:var(--lilac); }
@keyframes blink { 0%,49%{opacity:1} 50%,100%{opacity:0} }

.topbar-right {
  font-size:10px; color:var(--text-dim); display:flex; gap:14px; align-items:center;
}
.topbar-right .v { color:var(--mint); font-weight:600; }
.topbar-right .v2 { color:var(--lilac); font-weight:600; }

/* === LAYOUT === */
#main {
  position:fixed; top:44px; left:0; right:0; bottom:38px;
  display:flex; z-index:10;
}

/* === LEFT: CATALOG === */
#catalog {
  width:340px; flex-shrink:0;
  background:var(--bg-panel);
  border-right:1px solid var(--border);
  display:flex; flex-direction:column;
  overflow:hidden;
  transition: width 0.3s ease;
}
#catalog.collapsed { width:44px; }
#catalog.collapsed .catalog-inner { opacity:0; pointer-events:none; }
#catalog.collapsed .collapse-icon { transform:rotate(180deg); }

.catalog-header {
  padding:14px 16px;
  border-bottom:1px solid var(--border);
  display:flex; align-items:center; justify-content:space-between;
}
.catalog-header h2 {
  font-size:10px; letter-spacing:2px; text-transform:uppercase; color:var(--lilac);
  font-weight:600;
}
.collapse-btn {
  background:none; border:1px solid var(--border);
  color:var(--text-dim); font-family:inherit; font-size:14px;
  width:26px; height:26px; display:flex; align-items:center; justify-content:center;
  cursor:pointer; border-radius:4px; transition:all 0.2s;
}
.collapse-btn:hover { border-color:var(--mint); color:var(--mint); }
.collapse-icon { transition:transform 0.3s; display:inline-block; }

.catalog-inner { transition:opacity 0.2s; }

/* ASCII banner */
.ascii-banner {
  padding:10px 16px; font-size:7px; line-height:1.15;
  color:var(--mint); white-space:pre; opacity:0.6;
  border-bottom:1px solid var(--border);
}

/* Search */
.search-box {
  padding:10px 16px; border-bottom:1px solid var(--border);
}
.search-input {
  width:100%; background:var(--bg); border:1px solid var(--border);
  color:var(--text); font-family:inherit; font-size:11px;
  padding:7px 10px; border-radius:4px; outline:none;
}
.search-input:focus { border-color:var(--mint); }
.search-input::placeholder { color:var(--text-dim); }

/* Quick filters */
.filters {
  padding:8px 16px; display:flex; flex-wrap:wrap; gap:4px;
  border-bottom:1px solid var(--border);
}
.filter-tag {
  font-size:9px; padding:3px 8px; border-radius:3px;
  border:1px solid var(--border); background:transparent;
  color:var(--text-dim); cursor:pointer; font-family:inherit;
  transition:all 0.15s; letter-spacing:0.3px;
}
.filter-tag:hover, .filter-tag.active { border-color:var(--mint); color:var(--mint); background:var(--mint-dim); }
.filter-tag[data-cat="all"].active { border-color:var(--lilac); color:var(--lilac); background:var(--lilac-dim); }

/* Workshop list */
.workshop-list {
  flex:1; overflow-y:auto;
  scrollbar-width:thin; scrollbar-color:var(--mint-dim) transparent;
}
.workshop-list::-webkit-scrollbar { width:4px; }
.workshop-list::-webkit-scrollbar-thumb { background:var(--mint-dim); border-radius:2px; }

.ws-item {
  padding:10px 16px; cursor:pointer;
  border-bottom:1px solid var(--border);
  border-left:3px solid transparent;
  transition:all 0.15s;
  display:grid; grid-template-columns:36px 1fr auto; gap:10px;
  align-items:center;
}
.ws-item:hover { background:var(--mint-dim); border-left-color:var(--mint); }
.ws-item.active { background:var(--lilac-dim); border-left-color:var(--lilac); }

.ws-icon {
  width:36px; height:36px; border-radius:8px;
  display:flex; align-items:center; justify-content:center;
  font-size:18px; flex-shrink:0;
}
.ws-info {}
.ws-name { font-size:11px; font-weight:600; color:var(--text); }
.ws-tagline { font-size:9px; color:var(--text-dim); margin-top:2px; }
.ws-meta { display:flex; gap:4px; margin-top:4px; }
.ws-badge {
  font-size:8px; padding:1px 5px; border-radius:2px;
  letter-spacing:0.3px;
}
.ws-diff {
  font-size:9px; color:var(--text-dim); text-align:right;
  display:flex; flex-direction:column; align-items:flex-end; gap:2px;
}
.ws-diff .stars { color:var(--warning); letter-spacing:1px; font-size:8px; }

/* === CENTER: GRAPH === */
#graph-area {
  flex:1; position:relative; overflow:hidden;
}
#graph-area svg { width:100%; height:100%; }

.graph-link { stroke:var(--border); stroke-width:1; opacity:0.3; transition:all 0.3s; }
.graph-link.lit { stroke:var(--mint); stroke-width:2; opacity:0.7; }
.graph-link.lit-lilac { stroke:var(--lilac); stroke-width:2; opacity:0.7; }

.graph-node { cursor:pointer; }
.node-ring { transition:all 0.3s; }
.graph-node:hover .node-ring { filter:drop-shadow(0 0 10px currentColor); }

.node-lbl {
  font-family:'JetBrains Mono',monospace;
  font-size:8.5px; fill:var(--text); text-anchor:middle;
  pointer-events:none; opacity:0.85;
}

.node-pulse-ring { animation:npulse 3s ease-out infinite; }
@keyframes npulse { 0%{r:0;opacity:0.5} 100%{r:28;opacity:0} }

/* === TOOLTIP === */
.tip {
  position:fixed; background:var(--bg-modal); border:1px solid var(--border);
  border-radius:4px; padding:8px 12px; font-size:10px;
  z-index:10100; pointer-events:none; display:none;
  box-shadow:0 4px 16px rgba(0,0,0,0.4);
  max-width:220px;
}
.tip.on { display:block; }
.tip-name { color:var(--mint); font-weight:600; margin-bottom:2px; }
.tip-desc { color:var(--text-dim); line-height:1.4; }
.tip-badges { display:flex; gap:4px; margin-top:4px; }

/* === BOTTOMBAR === */
#bottombar {
  position:fixed; bottom:0; left:0; right:0; height:38px;
  background:var(--bg-panel); border-top:1px solid var(--border);
  display:flex; align-items:center; padding:0 16px; z-index:10000;
  font-size:10px; color:var(--text-dim); gap:16px;
}
.pulse-dot {
  width:8px; height:8px; border-radius:50%; background:var(--success);
  display:inline-block; margin-right:6px;
  animation:pdot 2s infinite;
}
@keyframes pdot { 0%,100%{opacity:1} 50%{opacity:0.3} }

.cmd {
  flex:1; max-width:420px; background:var(--bg);
  border:1px solid var(--border); color:var(--mint);
  font-family:inherit; font-size:10px; padding:5px 10px;
  border-radius:3px; outline:none;
  position:relative; z-index:110;
  cursor:text;
}
.cmd:focus { border-color:var(--mint); box-shadow:0 0 8px var(--mint-dim); }
.cmd::placeholder { color:var(--text-dim); }

/* === MODAL === */
.modal-bg {
  position:fixed; top:0; left:0; right:0; bottom:0;
  background:rgba(0,0,0,0.7); backdrop-filter:blur(6px);
  z-index:10500; display:none; align-items:center; justify-content:center;
}
.modal-bg.open { display:flex; }

.modal {
  width:min(880px,92vw); max-height:85vh;
  background:var(--bg-modal); border:1px solid var(--border);
  border-radius:8px; overflow:hidden;
  animation:mslide 0.3s cubic-bezier(0.16,1,0.3,1);
  box-shadow: 0 0 0 1px var(--border), 0 0 60px rgba(72,187,120,0.06), 0 0 120px rgba(159,122,234,0.04);
  display:flex; flex-direction:column;
}
@keyframes mslide { from{transform:translateY(16px) scale(0.97);opacity:0} to{transform:translateY(0) scale(1);opacity:1} }

.modal-head {
  padding:16px 20px; border-bottom:1px solid var(--border);
  display:flex; align-items:center; gap:14px;
}
.mh-icon {
  width:44px; height:44px; border-radius:10px;
  display:flex; align-items:center; justify-content:center;
  font-size:22px; flex-shrink:0;
}
.mh-info { flex:1; }
.mh-title { font-size:15px; font-weight:700; color:var(--text); }
.mh-sub { font-size:10px; color:var(--text-dim); letter-spacing:1px; text-transform:uppercase; margin-top:2px; }
.mh-close {
  background:none; border:1px solid var(--border); color:var(--text-dim);
  font-family:inherit; font-size:11px; padding:5px 12px;
  cursor:pointer; border-radius:4px; transition:all 0.15s;
}
.mh-close:hover { border-color:var(--danger); color:var(--danger); }

/* Quick stats bar */
.modal-stats {
  padding:12px 20px; border-bottom:1px solid var(--border);
  display:flex; gap:0; background:var(--bg-card);
}
.mstat {
  flex:1; text-align:center; padding:6px 8px;
  border-right:1px solid var(--border);
}
.mstat:last-child { border-right:none; }
.mstat-icon { font-size:16px; margin-bottom:2px; }
.mstat-val { font-size:13px; font-weight:700; color:var(--mint); }
.mstat-val.lilac { color:var(--lilac); }
.mstat-label { font-size:8px; text-transform:uppercase; letter-spacing:1px; color:var(--text-dim); margin-top:1px; }

.modal-scroll {
  flex:1; overflow-y:auto; padding:0;
  scrollbar-width:thin; scrollbar-color:var(--mint-dim) transparent;
}

/* Sections inside modal */
.msec {
  padding:16px 20px; border-bottom:1px solid var(--border);
}
.msec:last-child { border-bottom:none; }

.msec-title {
  font-size:10px; letter-spacing:2px; text-transform:uppercase;
  color:var(--lilac); font-weight:600; margin-bottom:10px;
  display:flex; align-items:center; gap:8px;
}
.msec-title::after {
  content:''; flex:1; height:1px; background:var(--border);
}

.msec p { font-size:12px; line-height:1.7; margin-bottom:8px; }
.msec .hl { color:var(--mint); font-weight:600; }
.msec .hl2 { color:var(--lilac); font-weight:600; }

/* Step-by-step */
.steps { counter-reset:step; }
.step {
  counter-increment:step;
  padding:10px 0 10px 44px; position:relative;
  font-size:12px; line-height:1.6;
  border-left:2px solid var(--border);
  margin-left:14px;
}
.step::before {
  content:counter(step);
  position:absolute; left:-14px; top:8px;
  width:28px; height:28px; border-radius:50%;
  background:var(--bg); border:2px solid var(--mint);
  color:var(--mint); font-size:11px; font-weight:700;
  display:flex; align-items:center; justify-content:center;
}
.step:last-child { border-left-color:transparent; }
.step-title { font-weight:600; color:var(--text); margin-bottom:2px; }
.step-detail { color:var(--text-dim); font-size:11px; }
.step-time {
  display:inline-block; font-size:9px; padding:2px 6px;
  background:var(--mint-dim); color:var(--mint); border-radius:3px;
  margin-top:4px;
}

/* Material list */
.mat-grid {
  display:grid; grid-template-columns:repeat(auto-fill, minmax(140px,1fr));
  gap:8px; margin:8px 0;
}
.mat-item {
  background:var(--bg); border:1px solid var(--border);
  border-radius:4px; padding:8px 10px;
  font-size:10px; display:flex; align-items:center; gap:6px;
}
.mat-icon { font-size:14px; }
.mat-free { color:var(--success); font-size:8px; font-weight:700; letter-spacing:0.5px; }

/* Hybrid bridge */
.hybrid-box {
  background: linear-gradient(135deg, var(--mint-dim), var(--lilac-dim));
  border:1px solid var(--border); border-radius:6px;
  padding:14px 16px; margin:8px 0;
}
.hybrid-box .hybrid-label {
  font-size:9px; text-transform:uppercase; letter-spacing:2px;
  color:var(--lilac); font-weight:700; margin-bottom:6px;
  display:flex; align-items:center; gap:6px;
}
.hybrid-box p { font-size:11px; line-height:1.6; }

/* Fork section */
.fork-box {
  background:var(--bg); border:2px dashed var(--mint);
  border-radius:6px; padding:14px 16px; margin:8px 0;
  text-align:center;
}
.fork-box .fork-title {
  font-size:12px; color:var(--mint); font-weight:700; margin-bottom:4px;
}
.fork-box p { font-size:11px; color:var(--text-dim); }
.fork-box .fork-cmd {
  display:inline-block; margin-top:8px; padding:6px 16px;
  background:var(--mint-dim); border:1px solid var(--mint);
  border-radius:4px; color:var(--mint); font-family:inherit;
  font-size:11px; cursor:pointer; transition:all 0.2s;
}
.fork-box .fork-cmd:hover { background:var(--mint); color:var(--bg); }

/* Connected workshops */
.conn-list {
  display:flex; flex-wrap:wrap; gap:6px; margin-top:8px;
}
.conn-tag {
  font-size:10px; padding:4px 10px; border:1px solid var(--border);
  border-radius:3px; color:var(--text-dim); cursor:pointer;
  transition:all 0.15s; font-family:inherit; background:transparent;
}
.conn-tag:hover { border-color:var(--lilac); color:var(--lilac); }

/* tags */
.tags { display:flex; flex-wrap:wrap; gap:4px; margin:6px 0; }
.t { font-size:9px; padding:2px 7px; border-radius:3px; letter-spacing:0.3px; }
.t-mint { background:var(--mint-dim); color:var(--mint); }
.t-lilac { background:var(--lilac-dim); color:var(--lilac); }
.t-orange { background:rgba(246,173,85,0.15); color:var(--orange); }
.t-blue { background:rgba(99,179,237,0.15); color:var(--blue); }
.t-pink { background:rgba(237,100,166,0.15); color:var(--pink); }

/* Toast */
.toast {
  position:fixed; top:58px; right:16px;
  background:var(--bg-modal); border:1px solid var(--mint);
  border-radius:4px; padding:10px 16px; font-size:11px;
  color:var(--mint); z-index:10600;
  animation:tin 0.3s ease, tout 0.3s ease 3.5s forwards;
  box-shadow:0 0 20px var(--mint-dim);
  max-width:400px;
}
@keyframes tin { from{transform:translateX(100px);opacity:0} }
@keyframes tout { to{transform:translateX(100px);opacity:0} }

/* responsive */
@media(max-width:900px) {
  #catalog { width:260px; }
}
@media(max-width:600px) {
  #catalog { position:absolute; z-index:50; width:300px; transform:translateX(-300px); }
  #catalog.mob-open { transform:translateX(0); }
}
</style>
</head>
<body>

<canvas id="particles"></canvas>

<!-- TOP BAR -->
<div id="topbar">
  <div class="dots"><span class="dot-r"></span><span class="dot-y"></span><span class="dot-g"></span></div>
  <div class="topbar-center">
    <span class="brand">ouaisfieu</span><span class="sep">::</span>LA FORGE<span class="sep">‚Äî</span>fabriquez votre atelier-d√©bat<span class="sep">‚Äî</span><span class="blink">‚ñã</span>
  </div>
  <div class="topbar-right">
    <span>FORMATS <span class="v" id="stat-n">0</span></span>
    <span>LIENS <span class="v2" id="stat-l">0</span></span>
    <span id="clock"></span>
  </div>
</div>

<!-- MAIN -->
<div id="main">

  <!-- CATALOG -->
  <div id="catalog">
    <div class="catalog-header">
      <h2>‚ö° Catalogue des formats</h2>
      <button class="collapse-btn" onclick="toggleCatalog()"><span class="collapse-icon">‚óÄ</span></button>
    </div>
    <div class="catalog-inner">
      <div class="ascii-banner">
 ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
 ‚îÇ  üç¥ FORKEZ. ADAPTEZ. LANCEZ.‚îÇ
 ‚îÇ  Pas besoin d'√™tre expert.  ‚îÇ
 ‚îÇ  Juste curieux.             ‚îÇ
 ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</div>
      <div class="search-box">
        <input class="search-input" id="search" placeholder="üîç Chercher un format..." oninput="filterList()">
      </div>
      <div class="filters" id="filters"></div>
      <div class="workshop-list" id="ws-list"></div>
    </div>
  </div>

  <!-- GRAPH -->
  <div id="graph-area">
    <svg id="svg"></svg>
  </div>
</div>

<!-- BOTTOM BAR -->
<div id="bottombar">
  <span><span class="pulse-dot"></span>LA FORGE EST OUVERTE</span>
  <span>üáßüá™ CC-BY-SA 4.0</span>
  <input class="cmd" id="cmd" placeholder="Tapez un format, 'go' pour lancer au hasard, ou 'help'..." onkeydown="handleCmd(event)">
  <span>fork ¬∑ hack ¬∑ spread</span>
</div>

<!-- TOOLTIP -->
<div class="tip" id="tip">
  <div class="tip-name" id="tip-name"></div>
  <div class="tip-desc" id="tip-desc"></div>
  <div class="tip-badges" id="tip-badges"></div>
</div>

<!-- MODAL -->
<div class="modal-bg" id="modal-bg" onclick="closeModal(event)">
  <div class="modal" id="modal" onclick="event.stopPropagation()">
    <div class="modal-head" id="modal-head"></div>
    <div class="modal-stats" id="modal-stats"></div>
    <div class="modal-scroll" id="modal-scroll"></div>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
<script>
// ====================================================
// DATA
// ====================================================
const CATS = {
  oral: { color:'#48bb78', label:'Parole', icon:'üó£Ô∏è' },
  visuel: { color:'#9f7aea', label:'Visuel', icon:'üëÅÔ∏è' },
  corps: { color:'#f6ad55', label:'Corps', icon:'üèÉ' },
  ecriture: { color:'#63b3ed', label:'√âcriture', icon:'‚úçÔ∏è' },
  methode: { color:'#ed64a6', label:'M√©thode', icon:'üß≠' },
  terrain: { color:'#fbd38d', label:'Terrain', icon:'üåç' }
};

const WS = [
  {
    id:'cafe-debat', name:'Caf√©-D√©bat', icon:'‚òï', cat:'oral', size:26,
    tagline:'Le classique. Un caf√©, un sujet, on cause.',
    diff:1, people:'5-25', time:'1h30-2h', place:'Pr√©sentiel ou visio',
    badges:['D√©butant','Gratuit','Partout'],
    mat:[
      {i:'‚òï',t:'Caf√© / th√© / jus',free:true},
      {i:'üìÑ',t:'Fiche-sujet imprim√©e',free:true},
      {i:'üîä',t:'Voix (pas de micro)',free:true},
      {i:'üì±',t:'T√©l√©phone (pour la vid√©o)',free:true}
    ],
    steps:[
      {t:'Installer le d√©cor',d:'Tables en cercle ou en U. Pas de sc√®ne, pas d\'estrade. Tout le monde au m√™me niveau. Si c\'est chez vous : la table de cuisine suffit.',dur:'10 min'},
      {t:'Distribuer la fiche-sujet',d:'Un A4 recto avec le th√®me, 3 faits-cl√©s sourc√©s, et 2-3 questions pour lancer la discussion. T√©l√©chargez-la sur ouaisfieu ou fabriquez la v√¥tre.',dur:'2 min'},
      {t:'Projeter ou lire la vid√©o d\'accroche',d:'La vid√©o ouaisfieu de 3-6 minutes qui pose le sujet. Pas de vid√©o ? Lisez l\'accroche de la fiche √† voix haute, c\'est tout aussi bien.',dur:'6 min'},
      {t:'Tour de table : premi√®re r√©action',d:'Chaque personne dit en 1 minute ce qui l\'a frapp√©e. Pas de d√©bat encore ‚Äî juste √©couter. Si quelqu\'un ne veut pas parler, c\'est OK.',dur:'15-20 min'},
      {t:'D√©bat ouvert',d:'L\'animateur relance avec les questions de la fiche. R√®gle d\'or : on ne coupe pas la parole. On l√®ve la main. L\'animateur veille √† ce que personne ne monopolise.',dur:'40-50 min'},
      {t:'Synth√®se √† chaud',d:'Chacun dit en une phrase ce qu\'il retient. L\'animateur note sur un Framapad ou une feuille. C\'est le "proc√®s-verbal citoyen".',dur:'10 min'},
      {t:'Photo + partage',d:'Si le groupe est d\'accord : une photo, un post sur les r√©seaux avec le hashtag du sujet. Le Framapad est partag√© en ligne pour continuer le d√©bat.',dur:'5 min'}
    ],
    hybrid:`Avant l'atelier, le sujet est lanc√© en ligne (vid√©o YouTube + commentaire √©pingl√© avec les questions). Les contributions en ligne alimentent la discussion pr√©sentielle. Apr√®s l'atelier, la synth√®se Framapad est publi√©e et le d√©bat continue dans les commentaires. Les gens qui n'ont pas pu venir participent quand m√™me.`,
    fork:`T√©l√©chargez la fiche-sujet sur ouaisfieu.github.io, changez le th√®me, imprimez, invitez 5 personnes. C'est tout. Vous venez de cr√©er un caf√©-d√©bat citoyen.`,
    links:['world-cafe','cercle-parole','cine-debat','debat-mouvant','voir-penser-agir']
  },
  {
    id:'cine-debat', name:'Cin√©-D√©bat', icon:'üé¨', cat:'visuel', size:24,
    tagline:'Un film, un choc, un √©change.',
    diff:1, people:'5-50', time:'2h30-3h', place:'Salle, salon, ou en ligne',
    badges:['D√©butant','Puissant','√âmotion'],
    mat:[
      {i:'üì∫',t:'√âcran / TV / projecteur',free:true},
      {i:'üé¨',t:'Film, docu ou extrait',free:true},
      {i:'üìÑ',t:'Fiche de discussion',free:true},
      {i:'‚òï',t:'De quoi boire',free:true}
    ],
    steps:[
      {t:'Choisir le film',d:'Un documentaire de 30-90 min ou un extrait de 15-20 min. Les docus ouaisfieu sont con√ßus pour √ßa. Vous pouvez aussi utiliser n\'importe quel film qui vous a marqu√©.',dur:'Avant'},
      {t:'Pr√©parer la fiche',d:'3 questions de discussion li√©es au film. La fiche ouaisfieu en propose, mais vous pouvez √©crire les v√¥tres : "Qu\'est-ce qui vous a surpris ?", "Est-ce que √ßa vous rappelle quelque chose de votre v√©cu ?"',dur:'Avant'},
      {t:'Accueil et contexte',d:'Expliquez en 2 phrases pourquoi vous avez choisi ce film. Pas besoin d\'√™tre expert ‚Äî "j\'ai vu √ßa, √ßa m\'a interpell√©" suffit.',dur:'5 min'},
      {t:'Projection',d:'Regardez ensemble. L\'√©motion collective est plus forte que seul devant son √©cran.',dur:'30-90 min'},
      {t:'Silence de digestion',d:'Apr√®s le film, laissez 2 minutes de silence. Les gens ont besoin de revenir √† eux.',dur:'2 min'},
      {t:'Tour d\'impressions',d:'Chacun partage une √©motion, pas une analyse. "J\'ai ressenti de la col√®re quand..." ‚Äî pas de bonne ou mauvaise r√©ponse.',dur:'15 min'},
      {t:'D√©bat guid√©',d:'Utilisez les questions de la fiche. Alternez fait/opinion/action : "Saviez-vous que... ?", "Qu\'en pensez-vous ?", "Que pourrait-on faire ?"',dur:'30-40 min'},
      {t:'Engagement concret',d:'Finir par : "Qui veut faire quelque chose suite √† ce d√©bat ?" M√™me petit : signer une p√©tition, en parler √† quelqu\'un, revenir au prochain cin√©-d√©bat.',dur:'10 min'}
    ],
    hybrid:`Le film est publi√© ou r√©f√©renc√© en ligne avec une page de discussion. Les personnes qui ne peuvent pas venir le regardent chez elles et contribuent en commentaires. Apr√®s le pr√©sentiel, la synth√®se est ajout√©e √† la page. Le film peut √™tre rediscut√© en boucle ‚Äî chaque groupe apporte sa lecture.`,
    fork:`Choisissez un documentaire qui vous parle. √âcrivez 3 questions. Invitez des gens. Appuyez sur play. Le reste vient tout seul.`,
    links:['cafe-debat','photo-langage','tribunal-citoyen','lecture-collective','voir-penser-agir']
  },
  {
    id:'porteur-paroles', name:'Porteur de Paroles', icon:'üì¢', cat:'terrain', size:24,
    tagline:'Une question g√©ante dans la rue. Les passants r√©pondent.',
    diff:1, people:'2-5 animateurs', time:'2-3h', place:'Rue, march√©, place',
    badges:['Impact','Rue','Viral'],
    mat:[
      {i:'üé®',t:'Grand panneau / drap blanc',free:true},
      {i:'üñäÔ∏è',t:'Marqueurs √©pais',free:true},
      {i:'üì±',t:'T√©l√©phone (photos)',free:true},
      {i:'üìã',t:'Post-it ou √©tiquettes',free:true}
    ],
    steps:[
      {t:'√âcrire LA question',d:'En tr√®s gros, sur un drap ou un carton de 2m. Une seule question, percutante. Ex: "C\'est quoi bien vivre dans ce quartier ?" ou "La politique, √ßa sert √† quoi pour vous ?" Simple, ouvert, pas pi√©geant.',dur:'30 min avant'},
      {t:'Choisir le lieu',d:'L√† o√π les gens passent : sortie de march√©, place de village, devant une gare, entr√©e de supermarch√©. Pas besoin d\'autorisation si vous √™tes sur le trottoir et que vous ne bloquez personne.',dur:'Avant'},
      {t:'S\'installer et attendre',d:'Plantez le panneau. Restez √† c√¥t√©, souriants, disponibles. Ne harcelez personne. Les gens curieux viendront d\'eux-m√™mes. √áa prend 5-10 minutes.',dur:'10 min'},
      {t:'Recueillir les paroles',d:'Quand quelqu\'un s\'arr√™te : "On recueille les paroles des gens sur cette question. Vous voulez dire quelque chose ?" Notez sur un post-it, collez sur le panneau. Ou demandez si vous pouvez filmer 30 secondes.',dur:'2h'},
      {t:'Remercier et donner la suite',d:'Un petit flyer ou QR code vers la page ouaisfieu du sujet. "Si vous voulez continuer la discussion, c\'est l√†."',dur:'En continu'},
      {t:'Documenter',d:'Photos du panneau rempli, petites vid√©os des t√©moignages (avec accord). C\'est le mat√©riau brut pour l\'atelier en ligne.',dur:'En continu'}
    ],
    hybrid:`Les paroles recueillies dans la rue deviennent le mat√©riau de base d'un atelier en ligne. Publiez les photos et vid√©os, demandez aux internautes de r√©agir et de voter sur les propositions. La rue alimente le num√©rique, le num√©rique amplifie la rue.`,
    fork:`Prenez un drap, √©crivez une question, sortez dehors. C'est litt√©ralement le format le moins cher et le plus puissant de l'√©ducation populaire.`,
    links:['debat-mouvant','marche-exploratoire','cafe-debat','fresque-citoyenne','animation']
  },
  {
    id:'debat-mouvant', name:'D√©bat Mouvant', icon:'üèÉ', cat:'corps', size:22,
    tagline:'Tu es pour ? Va √† gauche. Contre ? √Ä droite. Change d\'avis en live.',
    diff:1, people:'8-40', time:'30-60 min', place:'Grande salle ou ext√©rieur',
    badges:['√ânergique','Z√©ro matos','Ludique'],
    mat:[
      {i:'üìè',t:'Un espace (6m minimum)',free:true},
      {i:'üó£Ô∏è',t:'Votre voix',free:true},
      {i:'üìÑ',t:'Affirmations controvers√©es',free:true}
    ],
    steps:[
      {t:'Pr√©parer les affirmations',d:'5-8 phrases volontairement clivantes : "Les manifestations ne servent √† rien", "On devrait voter d√®s 16 ans", "Les r√©seaux sociaux tuent la d√©mocratie". Ni vrai ni faux ‚Äî c\'est fait pour forcer la r√©flexion.',dur:'Avant'},
      {t:'Tracer la ligne',d:'D\'un c√¥t√© : "D\'ACCORD". De l\'autre : "PAS D\'ACCORD". Le milieu existe, mais on encourage √† choisir un camp.',dur:'2 min'},
      {t:'Lancer l\'affirmation',d:'Lisez la phrase. Les gens se d√©placent physiquement d\'un c√¥t√© ou l\'autre. Le mouvement du corps change tout ‚Äî on s\'engage autrement qu\'assis.',dur:'1 min'},
      {t:'Argumenter',d:'Chaque camp envoie un¬∑e porte-parole. 1 minute chacun. Les gens peuvent changer de c√¥t√© √† tout moment pendant les arguments ‚Äî et c\'est le but !',dur:'5-8 min par affirmation'},
      {t:'Observer les mouvements',d:'Le plus int√©ressant : les gens qui changent de c√¥t√©. Demandez-leur pourquoi. C\'est l√† que le vrai d√©bat a lieu.',dur:'En continu'},
      {t:'D√©briefer',d:'Apr√®s 4-5 affirmations, rassemblez tout le monde : "Qu\'est-ce qui vous a fait changer d\'avis ?" C\'est la question la plus pr√©cieuse.',dur:'10 min'}
    ],
    hybrid:`Avant le pr√©sentiel, un sondage en ligne (Framaforms ou commentaire YouTube) pose les m√™mes affirmations. On compare les r√©sultats num√©riques avec le v√©cu physique. Apr√®s : les gens qui ont chang√© d'avis racontent pourquoi dans un commentaire. √áa cr√©e un contenu d'une richesse folle.`,
    fork:`√âcrivez 5 phrases provocantes sur votre sujet. Trouvez un couloir ou une cour. Invitez des gens. Z√©ro mat√©riel, z√©ro budget, 100% impact.`,
    links:['cafe-debat','porteur-paroles','theatre-forum','jeu-role','animation']
  },
  {
    id:'photo-langage', name:'Photo-Langage', icon:'üñºÔ∏è', cat:'visuel', size:20,
    tagline:'Choisir une image pour dire ce qu\'on n\'arrive pas √† formuler.',
    diff:1, people:'5-20', time:'1h-1h30', place:'Table + chaises',
    badges:['Accessible','√âmotion','Inclusion'],
    mat:[
      {i:'üñºÔ∏è',t:'20-30 images vari√©es',free:true},
      {i:'üñ®Ô∏è',t:'Imprim√©es ou sur tablette',free:true},
      {i:'üìÑ',t:'Une question ouverte',free:true}
    ],
    steps:[
      {t:'Pr√©parer les images',d:'Imprimez 20-30 photos tr√®s diff√©rentes : paysages, visages, objets, sc√®nes de vie, abstractions. Pas de texte sur les images. Les banques d\'images libres (Unsplash, Pixabay) suffisent. √âtalez-les sur une table.',dur:'15 min avant'},
      {t:'Poser LA question',d:'Une seule, ouverte : "Pour vous, la d√©mocratie √ßa ressemble √† quoi ?", "Qu\'est-ce qui vous inqui√®te dans le monde d\'aujourd\'hui ?", "C\'est quoi la solidarit√© ?"',dur:'2 min'},
      {t:'Choisir en silence',d:'Chacun¬∑e se l√®ve, observe les images, et en choisit UNE qui "lui parle" par rapport √† la question. Pas de discussion pendant ce temps. Le silence est important.',dur:'5-7 min'},
      {t:'Tour de parole',d:'Chacun¬∑e montre son image et explique pourquoi elle l\'a choisie. On ne commente pas, on ne juge pas. On √©coute. C\'est souvent tr√®s √©mouvant ‚Äî les images lib√®rent des choses que les mots seuls ne permettent pas.',dur:'30-40 min'},
      {t:'√âchanges crois√©s',d:'Apr√®s le tour complet, ouvrir la discussion : "Y a-t-il des images qui se r√©pondent ?", "Quelqu\'un veut rebondir sur ce qui a √©t√© dit ?"',dur:'15-20 min'},
      {t:'Garder une trace',d:'Photographiez les images choisies avec les mots-cl√©s de chacun. √áa devient un "portrait collectif" du groupe sur le sujet.',dur:'5 min'}
    ],
    hybrid:`Les images sont publi√©es en ligne avec la question. Chaque internaute choisit une image et explique son choix en commentaire. On cr√©e une galerie collaborative qui s'enrichit avec chaque contribution ‚Äî le "portrait collectif" devient une ≈ìuvre ouverte.`,
    fork:`Imprimez 20 images, posez une question, invitez des gens autour d'une table. Le format le plus puissant pour les personnes qui n'aiment pas "d√©battre" ‚Äî ici, on partage √† travers les images.`,
    links:['cercle-parole','cafe-debat','cine-debat','fresque-citoyenne','atelier-ecriture']
  },
  {
    id:'world-cafe', name:'World Caf√©', icon:'üåç', cat:'oral', size:22,
    tagline:'3 tables, 3 questions, on tourne. L\'intelligence collective en action.',
    diff:2, people:'12-50', time:'1h30-2h', place:'Salle avec 3-5 tables',
    badges:['Collectif','Structur√©','Riche'],
    mat:[
      {i:'ü™ë',t:'3-5 tables + chaises',free:true},
      {i:'üìù',t:'Grandes feuilles (nappes)',free:true},
      {i:'üñäÔ∏è',t:'Marqueurs couleurs',free:true},
      {i:'‚è±Ô∏è',t:'Minuteur',free:true}
    ],
    steps:[
      {t:'Installer les tables',d:'3 √† 5 tables de 4-6 personnes. Sur chaque table : une grande feuille (ou nappe en papier) et des marqueurs. Un¬∑e "h√¥te de table" reste en place, les autres tournent.',dur:'15 min'},
      {t:'Annoncer les questions',d:'Chaque table a sa question, de plus en plus profonde : Table 1 = "Que constatez-vous ?", Table 2 = "Pourquoi c\'est comme √ßa ?", Table 3 = "Que pourrait-on faire ?"',dur:'5 min'},
      {t:'Premier tour',d:'Les groupes discutent et gribouillent sur la nappe ‚Äî mots-cl√©s, dessins, fl√®ches. L\'h√¥te facilite et note les id√©es-cl√©s.',dur:'20 min'},
      {t:'Rotation',d:'Au signal, tout le monde change de table (sauf l\'h√¥te). L\'h√¥te r√©sume en 2 minutes ce que le groupe pr√©c√©dent a dit. Le nouveau groupe enrichit.',dur:'2 min de transition'},
      {t:'Deuxi√®me et troisi√®me tours',d:'M√™me principe. Les id√©es s\'enrichissent √† chaque passage. Les nappes se remplissent. Les connexions √©mergent.',dur:'20 min √ó 2'},
      {t:'Moisson collective',d:'Chaque h√¥te pr√©sente les 3 id√©es-forces de sa table (2 min). L\'animateur les note sur un tableau visible par tous. Votez avec des gommettes sur les id√©es prioritaires.',dur:'20 min'}
    ],
    hybrid:`En ligne, les 3 "tables" deviennent 3 Framapads ou 3 threads. Les gens tournent entre les documents selon un calendrier (24h par table). L'h√¥te virtuel r√©sume avant chaque rotation. R√©sultat : un World Caf√© asynchrone qui dure 3 jours au lieu de 2 heures, avec une richesse d√©multipli√©e.`,
    fork:`3 tables, 3 questions de plus en plus profondes, des nappes en papier. Vous organisez d√©j√† des d√Æners ? Vous savez faire un World Caf√©.`,
    links:['cafe-debat','cercle-parole','fresque-citoyenne','voir-penser-agir','porteur-paroles']
  },
  {
    id:'cercle-parole', name:'Cercle de Parole', icon:'‚≠ï', cat:'oral', size:20,
    tagline:'Un objet qui circule. Celui qui l\'a parle. Les autres √©coutent.',
    diff:1, people:'5-15', time:'1h-1h30', place:'N\'importe o√π en cercle',
    badges:['Intime','√âcoute','Z√©ro matos'],
    mat:[
      {i:'ü™®',t:'Objet de parole (caillou, b√¢ton...)',free:true},
      {i:'ü™ë',t:'Chaises en cercle',free:true}
    ],
    steps:[
      {t:'Installer le cercle',d:'Des chaises en cercle, pas de table entre les gens. Rien au centre (ou une bougie, un objet symbolique). Le cercle dit : nous sommes √©gaux.',dur:'5 min'},
      {t:'Pr√©senter les r√®gles',d:'Trois r√®gles simples : (1) Quand on a l\'objet de parole, on parle. (2) Quand on ne l\'a pas, on √©coute ‚Äî vraiment. (3) On ne juge pas, on ne commente pas ce que l\'autre dit.',dur:'3 min'},
      {t:'Question d\'ouverture',d:'L√©g√®re : "Avec quoi vous arrivez ce soir ?" √áa permet √† chacun¬∑e de se poser et de s\'entendre parler dans le groupe.',dur:'15 min'},
      {t:'Question de fond',d:'L\'objet circule √† nouveau avec la vraie question : "Qu\'est-ce qui vous emp√™che de dormir concernant [le sujet] ?" ou "Racontez un moment o√π vous avez senti que √ßa ne tournait pas rond."',dur:'30-40 min'},
      {t:'Deuxi√®me tour (optionnel)',d:'"Apr√®s avoir entendu les autres, est-ce que quelque chose a boug√© en vous ?" Ce tour est souvent le plus riche.',dur:'20 min'},
      {t:'Cl√¥ture',d:'Chacun¬∑e dit un mot ‚Äî un seul mot ‚Äî qui r√©sume ce qu\'il/elle emporte. L\'animateur les note. C\'est le "nuage de mots" du groupe.',dur:'5 min'}
    ],
    hybrid:`Le cercle de parole en ligne se fait par messages vocaux asynchrones (Telegram, Signal). Chaque participant envoie son "tour de parole" en audio. L'√©coute de la voix garde l'intimit√© que le texte perd. Le "nuage de mots" final est publi√© et partag√©.`,
    fork:`Trouvez un caillou joli. Mettez des chaises en rond. Posez une question sinc√®re. Le cercle de parole est la plus vieille technologie d'intelligence collective de l'humanit√©.`,
    links:['cafe-debat','photo-langage','world-cafe','atelier-ecriture','animation']
  },
  {
    id:'theatre-forum', name:'Th√©√¢tre-Forum', icon:'üé≠', cat:'corps', size:22,
    tagline:'Une sc√®ne d\'injustice jou√©e. Le public intervient et change l\'histoire.',
    diff:3, people:'8-30', time:'2h-2h30', place:'Salle d√©gag√©e',
    badges:['Puissant','Augusto Boal','Transformateur'],
    mat:[
      {i:'üé≠',t:'Espace de jeu (4√ó4m)',free:true},
      {i:'üìù',t:'Sc√©nario court',free:true},
      {i:'üë§',t:'3-5 com√©dien¬∑nes amateur¬∑es',free:true}
    ],
    steps:[
      {t:'√âcrire la sc√®ne',d:'Une situation d\'injustice ou d\'oppression tir√©e du v√©cu r√©el ‚Äî au travail, au guichet, dans la famille. Court : 3-5 minutes. Elle doit mal finir. C\'est important.',dur:'Avant (1h)'},
      {t:'R√©p√©ter',d:'Les com√©dien¬∑nes (b√©n√©voles, pas besoin de talent) jouent la sc√®ne 2-3 fois. Le but : que ce soit cr√©dible, pas parfait.',dur:'30 min avant'},
      {t:'Premi√®re lecture',d:'Jouez la sc√®ne devant le public. Laissez le malaise s\'installer. C\'est normal.',dur:'5 min'},
      {t:'Le Joker explique',d:'L\'animateur (appel√© "Joker" chez Boal) dit : "Vous avez vu cette sc√®ne. Quelque chose ne va pas. Nous allons la rejouer. Cette fois, quand vous pensez pouvoir changer la situation, criez STOP, venez remplacer un personnage et essayez."',dur:'3 min'},
      {t:'Les interventions',d:'On rejoue. Un¬∑e spectateur¬∑rice crie STOP, prend la place du personnage opprim√©, et tente une autre strat√©gie. √áa marche ? √áa √©choue ? On essaie une autre intervention. C\'est le c≈ìur du format.',dur:'40-60 min'},
      {t:'D√©brief collectif',d:'"Qu\'est-ce qui a march√© ? Pourquoi ? Est-ce que √ßa marcherait dans la vraie vie ? Quels obstacles ?" Le th√©√¢tre-forum ne donne pas de solutions ‚Äî il les fait chercher ensemble.',dur:'20 min'}
    ],
    hybrid:`La sc√®ne est film√©e et publi√©e en ligne. Les internautes proposent des "interventions" en commentaires : "√Ä ce moment-l√†, j'aurais dit/fait..." Les meilleures interventions sont jou√©es lors du prochain atelier pr√©sentiel et film√©es √† nouveau. Boucle infinie de cr√©ativit√© collective.`,
    fork:`Pensez √† une situation injuste que vous avez v√©cue. √âcrivez-la en 10 lignes. Trouvez 3 potes qui veulent la jouer. Vous avez un th√©√¢tre-forum.`,
    links:['debat-mouvant','jeu-role','cine-debat','porteur-paroles','animation']
  },
  {
    id:'fresque-citoyenne', name:'Fresque Citoyenne', icon:'üß©', cat:'ecriture', size:24,
    tagline:'Comme la Fresque du Climat, mais pour la d√©mocratie.',
    diff:2, people:'6-20', time:'2h-3h', place:'Grande table ou mur',
    badges:['Collaboratif','Visuel','Syst√©mique'],
    mat:[
      {i:'üì∞',t:'Cartes-concepts (30-40)',free:true},
      {i:'üìè',t:'Grande surface (table/mur)',free:true},
      {i:'üñäÔ∏è',t:'Marqueurs + ficelle',free:true},
      {i:'üìé',t:'Post-it',free:true}
    ],
    steps:[
      {t:'Pr√©parer les cartes',d:'30-40 cartes cartonn√©es avec un concept, un fait ou un acteur par carte. Ex: "CPAS", "Constitution", "Droit de vote", "Lobbying", "Allocations", "M√©dias", chiffres-cl√©s... T√©l√©chargeables sur ouaisfieu.',dur:'Avant'},
      {t:'Distribution par lots',d:'Donnez 8-10 cartes par sous-groupe de 4-5 personnes. Ils lisent, discutent entre eux : "C\'est quoi ce truc ? Tu connaissais ?"',dur:'15 min'},
      {t:'Construction collective',d:'Les groupes placent leurs cartes sur la grande surface et les relient par des fl√®ches : cause ‚Üí cons√©quence. "Le lobbying influence le parlement qui vote les lois qui affectent le CPAS." C\'est le moment eureka.',dur:'40 min'},
      {t:'Confrontation',d:'Les groupes expliquent leurs liens aux autres. D√©bat sur les connexions : "Non, c\'est pas le lobbying le probl√®me principal, c\'est le cumul des mandats !" On r√©organise ensemble.',dur:'20 min'},
      {t:'Les trous',d:'Qu\'est-ce qui manque ? Les participants cr√©ent des cartes vierges avec ce qui n\'a pas √©t√© dit. Souvent les trucs les plus importants.',dur:'15 min'},
      {t:'Prioriser et agir',d:'Gommettes sur les n≈ìuds les plus critiques. "Par quoi on commence ?" Chaque personne s\'engage sur une action concr√®te li√©e √† un n≈ìud.',dur:'15 min'}
    ],
    hybrid:`Les cartes sont publi√©es comme un jeu interactif en ligne (H5P ou simple page web). Les internautes cr√©ent de nouvelles cartes et proposent de nouvelles connexions. La fresque grandit avec chaque atelier. Objectif : cr√©er LA fresque citoyenne de r√©f√©rence, open source, forkable par th√®me.`,
    fork:`Imprimez les cartes ouaisfieu ou fabriquez les v√¥tres avec 30 post-it. Trouvez un mur ou une grande table. Le r√©sultat surprend toujours ‚Äî m√™me les gens qui pensaient "tout savoir".`,
    links:['world-cafe','photo-langage','atelier-ecriture','lecture-collective','voir-penser-agir']
  },
  {
    id:'jeu-role', name:'Jeu de R√¥le Citoyen', icon:'üé≤', cat:'corps', size:18,
    tagline:'Vous √™tes le bourgmestre. Que faites-vous ?',
    diff:2, people:'6-15', time:'1h30-2h', place:'Salle, salon',
    badges:['Fun','Empathie','Surprenant'],
    mat:[
      {i:'üìá',t:'Fiches personnages',free:true},
      {i:'üìã',t:'Sc√©nario de d√©part',free:true},
      {i:'‚è±Ô∏è',t:'Minuteur',free:true}
    ],
    steps:[
      {t:'Cr√©er le sc√©nario',d:'Une situation r√©elle simplifi√©e : "Le conseil communal doit d√©cider si on installe des cam√©ras de surveillance." Chaque joueur re√ßoit un r√¥le : bourgmestre, commer√ßant, jeune du quartier, militant vie priv√©e, policier...',dur:'Avant'},
      {t:'Distribuer les r√¥les',d:'Chaque personne re√ßoit une fiche : son personnage, ses int√©r√™ts, ses arguments. Donnez 5 minutes pour "entrer dans le r√¥le". Pas besoin d\'acting ‚Äî juste d√©fendre la position.',dur:'7 min'},
      {t:'Conseil communal fictif',d:'Le "bourgmestre" ouvre la s√©ance. Chaque personnage a 2 minutes pour exposer sa position. Puis d√©bat libre : alliances, conflits, compromis.',dur:'30-40 min'},
      {t:'Le vote',d:'Le conseil vote. Comme dans la vraie vie : c\'est souvent frustrant, rarement unanime.',dur:'5 min'},
      {t:'Sortie de r√¥le',d:'IMPORTANT : tout le monde "enl√®ve" son personnage. "Je ne suis plus le policier, je suis moi." Expliquez en quoi jouer ce r√¥le a chang√© votre regard.',dur:'15 min'},
      {t:'Connexion au r√©el',d:'Comment √ßa se passe vraiment dans votre commune ? Quelqu\'un sait ? Souvent personne ne sait ‚Äî et c\'est le d√©but de l\'int√©r√™t pour la politique locale.',dur:'15 min'}
    ],
    hybrid:`Les fiches personnages sont publi√©es en ligne. Les internautes peuvent jouer le jeu de r√¥le en forum asynchrone : chaque personnage poste ses arguments, les alliances se forment, le vote a lieu. Puis on compare avec la d√©cision r√©elle du conseil communal. L'√©cart entre le jeu et la r√©alit√© est toujours √©difiant.`,
    fork:`Prenez un sujet de votre commune. Inventez 5 personnages. Distribuez les r√¥les. Vous venez de cr√©er un outil de compr√©hension politique plus efficace que 10 cours de sciences po.`,
    links:['theatre-forum','debat-mouvant','tribunal-citoyen','cafe-debat','fresque-citoyenne']
  },
  {
    id:'tribunal-citoyen', name:'Tribunal Citoyen', icon:'‚öñÔ∏è', cat:'oral', size:20,
    tagline:'Proc√®s fictif d\'une politique, d\'une loi ou d\'un discours.',
    diff:2, people:'10-30', time:'2h-2h30', place:'Salle en U',
    badges:['Th√©√¢tral','Rigoureux','Marquant'],
    mat:[
      {i:'‚öñÔ∏è',t:'Mise en sc√®ne tribunal',free:true},
      {i:'üìÅ',t:'Dossier d\'accusation',free:true},
      {i:'üìÅ',t:'Dossier de d√©fense',free:true},
      {i:'üìã',t:'Bulletin de verdict',free:true}
    ],
    steps:[
      {t:'Choisir "l\'accus√©"',d:'Pas une personne ‚Äî une politique, une loi, un discours, un syst√®me. Ex: "Le gouvernement Arizona est accus√© de d√©manteler la s√©curit√© sociale." L\'accus√© est abstrait, le d√©bat est concret.',dur:'Avant'},
      {t:'Constituer les r√¥les',d:'Procureur (accusation), avocat¬∑e de la d√©fense, 3 t√©moins de chaque c√¥t√©, un¬∑e juge (l\'animateur¬∑rice), un jury (tout le public).',dur:'10 min'},
      {t:'R√©quisitoire',d:'Le procureur pr√©sente l\'accusation avec faits, chiffres et t√©moignages. Les fiches ouaisfieu fournissent le dossier sourc√©.',dur:'10 min'},
      {t:'Plaidoirie de la d√©fense',d:'L\'avocat¬∑e d√©fend la politique accus√©e. M√™me si personne dans la salle n\'est d\'accord ‚Äî c\'est l\'exercice le plus formateur : d√©fendre ce qu\'on combattrait.',dur:'10 min'},
      {t:'T√©moignages et contre-interrogatoires',d:'Les t√©moins d√©posent, l\'autre partie les interroge. Le public peut poser des questions via le juge.',dur:'30 min'},
      {t:'D√©lib√©ration du jury',d:'Le public-jury se retire (ou discute sur place) et vote : coupable ou non coupable, avec justification. Le verdict est lu solennellement.',dur:'15 min'},
      {t:'D√©brief hors-r√¥le',d:'"Le verdict √©tait-il juste ? Qu\'est-ce qui a manqu√© ? Qu\'est-ce qu\'on ferait dans la vraie vie ?" Souvent, le d√©bat le plus riche arrive apr√®s le verdict.',dur:'15 min'}
    ],
    hybrid:`Le dossier d'accusation et de d√©fense est publi√© en ligne une semaine avant. Les internautes contribuent des "preuves" suppl√©mentaires. Apr√®s le tribunal pr√©sentiel, le verdict et les arguments sont publi√©s ‚Äî les internautes peuvent voter √† leur tour. Comparaison des verdicts pr√©sentiels et en ligne.`,
    fork:`√âcrivez un "acte d'accusation" en une page contre une politique qui vous r√©volte. Pr√©parez aussi la d√©fense ‚Äî c'est √ßa le courage intellectuel. Distribuez les r√¥les et jouez.`,
    links:['jeu-role','cine-debat','theatre-forum','lecture-collective','cafe-debat']
  },
  {
    id:'lecture-collective', name:'Lecture Collective\nComment√©e', icon:'üìñ', cat:'ecriture', size:18,
    tagline:'Lire ensemble un texte. S\'arr√™ter. R√©agir.',
    diff:1, people:'4-12', time:'1h-1h30', place:'Table, canap√©s',
    badges:['Calme','Profond','Accessible'],
    mat:[
      {i:'üìÑ',t:'Texte imprim√© pour chacun',free:true},
      {i:'üñäÔ∏è',t:'Surligneurs',free:true},
      {i:'‚òï',t:'Th√© / caf√©',free:true}
    ],
    steps:[
      {t:'Choisir le texte',d:'1-3 pages maximum. Un article, un extrait de rapport, un t√©moignage, un texte de loi, une analyse ouaisfieu. Imprimez-le pour chaque participant¬∑e.',dur:'Avant'},
      {t:'Lecture silencieuse',d:'Chacun¬∑e lit en silence, surligne ce qui l\'interpelle, note des questions dans la marge. Le silence collectif cr√©e une concentration partag√©e.',dur:'10-15 min'},
      {t:'Tour de surlignage',d:'Chacun¬∑e lit √† voix haute LE passage qu\'il/elle a surlign√© et explique en 1-2 phrases pourquoi.',dur:'20 min'},
      {t:'Discussion libre',d:'Les passages surlign√©s deviennent les points d\'entr√©e du d√©bat. L\'animateur n\'a presque rien √† faire ‚Äî le texte travaille pour lui.',dur:'30 min'},
      {t:'√âcriture de r√©action',d:'Chacun¬∑e √©crit 3 phrases de r√©action sur un post-it ou un Framapad. "Ce que je retiens / Ce que je conteste / Ce que je veux creuser."',dur:'5 min'}
    ],
    hybrid:`Le texte est publi√© sur une plateforme d'annotation collaborative (Hypothesis.is, gratuit, open source). Les internautes surlignent et commentent directement dans le texte. Les annotations des ateliers pr√©sentiels sont ajout√©es. Le texte devient un palimpseste d'intelligence collective.`,
    fork:`Imprimez un article qui vous a marqu√©. Invitez 4 personnes. Lisez en silence. Parlez de ce que vous avez surlign√©. C'est un atelier.`,
    links:['cafe-debat','cercle-parole','photo-langage','atelier-ecriture','cine-debat']
  },
  {
    id:'atelier-ecriture', name:'Atelier d\'√âcriture\nCollective', icon:'‚úçÔ∏è', cat:'ecriture', size:18,
    tagline:'√âcrire ensemble un texte, une lettre ouverte, un manifeste.',
    diff:2, people:'4-15', time:'1h30-2h', place:'Table + √©cran partag√©',
    badges:['Cr√©atif','Concret','Trace'],
    mat:[
      {i:'üíª',t:'1 ordi + vid√©oproj (ou Framapad)',free:true},
      {i:'üìù',t:'Papier / cahier par personne',free:true},
      {i:'üìÑ',t:'Texte de d√©part (optionnel)',free:true}
    ],
    steps:[
      {t:'D√©finir l\'objet',d:'"Qu\'√©crit-on ?" Une lettre ouverte au bourgmestre. Un t√©moignage collectif. Un manifeste. Une r√©ponse √† un article. Un tract. La forme donne le ton.',dur:'10 min'},
      {t:'√âcriture individuelle flash',d:'Chacun¬∑e √©crit 5 minutes sans s\'arr√™ter sur le sujet. Pas de censure, pas de style ‚Äî du brut.',dur:'5 min'},
      {t:'Partage et s√©lection',d:'Chacun¬∑e lit son texte. Le groupe rep√®re les formules fortes, les id√©es qui reviennent, les p√©pites.',dur:'20 min'},
      {t:'√âcriture collective',d:'Sur un Framapad projet√©, on construit le texte ensemble. Un¬∑e scribe tape, les autres dictent et corrigent. C\'est chaotique et c\'est normal.',dur:'30-40 min'},
      {t:'Relecture et vote',d:'On relit √† voix haute. Chaque phrase est valid√©e collectivement. "Tout le monde se retrouve l√†-dedans ?"',dur:'10 min'},
      {t:'Publication',d:'Le texte est sign√© collectivement et publi√© : blog ouaisfieu, envoy√© au destinataire, affich√© dans le quartier. Il existe.',dur:'5 min'}
    ],
    hybrid:`Le Framapad reste ouvert apr√®s l'atelier. Les internautes peuvent proposer des modifications, des ajouts, de nouvelles signatures. Le texte vit et √©volue. Chaque atelier dans une ville diff√©rente peut contribuer au m√™me texte-manifeste.`,
    fork:`Ouvrez un Framapad. Partagez le lien. √âcrivez ensemble. Publiez. La plume collective est l'arme la plus sous-estim√©e de l'√©ducation populaire.`,
    links:['lecture-collective','fresque-citoyenne','cercle-parole','photo-langage','cafe-debat']
  },
  {
    id:'marche-exploratoire', name:'Marche\nExploratoire', icon:'üö∂', cat:'terrain', size:18,
    tagline:'Marcher dans un quartier. Observer. Discuter de ce qu\'on voit.',
    diff:1, people:'5-15', time:'1h30-2h', place:'Dehors !',
    badges:['Terrain','Sensoriel','Local'],
    mat:[
      {i:'üëü',t:'Chaussures confortables',free:true},
      {i:'üì±',t:'T√©l√©phone (photos)',free:true},
      {i:'üìã',t:'Grille d\'observation',free:true}
    ],
    steps:[
      {t:'D√©finir le parcours et le th√®me',d:'1-2 km dans un quartier. Un angle d\'observation : "L\'espace public est-il accueillant pour tout le monde ?", "O√π sont les services publics ?", "Qui est visible et qui ne l\'est pas ?"',dur:'Avant'},
      {t:'Distribuer la grille',d:'Un A4 avec 5-6 points d\'attention : accessibilit√©, propret√©, verdure, s√©curit√© ressentie, pr√©sence humaine, services. Simple ‚Äî des cases √† cocher ou des √©toiles.',dur:'5 min'},
      {t:'Marcher et observer',d:'On marche ensemble, lentement. On s\'arr√™te r√©guli√®rement pour observer, photographier, discuter. "Regardez ici ‚Äî vous avez remarqu√© ?"',dur:'45-60 min'},
      {t:'Arr√™ts-d√©bat',d:'√Ä 3-4 points strat√©giques, on s\'arr√™te et on discute : "Qu\'est-ce que vous voyez ? Qu\'est-ce que vous ressentez ? C\'est normal ?"',dur:'Inclus'},
      {t:'Retour et synth√®se',d:'Assis (dans un caf√©, un parc, une salle), on partage les grilles et les photos. Qu\'est-ce qui revient ? Qu\'est-ce qui a surpris ?',dur:'20 min'},
      {t:'Lettre au bourgmestre',d:'Optionnel mais puissant : on r√©dige ensemble un courrier avec les observations et les propositions. Photos √† l\'appui.',dur:'15 min'}
    ],
    hybrid:`Les photos et observations sont publi√©es sur une carte collaborative (uMap, OpenStreetMap). Les internautes d'autres quartiers font la m√™me marche chez eux avec la m√™me grille et ajoutent leurs observations. On compare les quartiers, les villes. La carte devient un outil de plaidoyer.`,
    fork:`Imprimez la grille, choisissez un quartier, marchez. Vous red√©couvrirez un endroit que vous croyiez conna√Ætre.`,
    links:['porteur-paroles','fresque-citoyenne','photo-langage','cafe-debat','atelier-ecriture']
  },
  {
    id:'voir-penser-agir', name:'Voir ¬∑\nPenser ¬∑ Agir', icon:'üß≠', cat:'methode', size:28,
    tagline:'La boussole. Tous les ateliers suivent ce fil rouge.',
    diff:0, people:'Tous', time:'Toujours', place:'Partout',
    badges:['M√©thode','CPCP','Universel'],
    mat:[
      {i:'üß†',t:'Curiosit√©',free:true},
      {i:'‚ù§Ô∏è',t:'√âcoute',free:true},
      {i:'‚úä',t:'Envie d\'agir',free:true}
    ],
    steps:[
      {t:'VOIR ‚Äî Observer et ressentir',d:'D√©couvrir le sujet sans pr√©jug√©. Vid√©o, t√©moignage, donn√©es, sortie terrain. Ne pas analyser tout de suite ‚Äî laisser le sujet entrer. C\'est le moment du film, de la photo, de la marche, de la lecture.',dur:'Phase 1'},
      {t:'PENSER ‚Äî Comprendre et d√©battre',d:'Croiser les regards, confronter les id√©es, chercher les causes. C\'est le moment du caf√©-d√©bat, du World Caf√©, du cercle de parole. Pas de bonne r√©ponse ‚Äî des meilleures questions.',dur:'Phase 2'},
      {t:'AGIR ‚Äî D√©cider et faire',d:'Transformer la r√©flexion en action concr√®te. M√™me petite. √âcrire une lettre, signer une p√©tition, organiser un autre atelier, aller au conseil communal, cr√©er un outil. L\'action ancre l\'apprentissage.',dur:'Phase 3'}
    ],
    hybrid:`La m√©thode VPA est le fil rouge de tout l'√©cosyst√®me ouaisfieu. En ligne : VOIR = vid√©o + document. PENSER = d√©bat en commentaires ou sur Pol.is. AGIR = co-r√©daction, p√©tition, fork d'un atelier. En pr√©sentiel : les m√™mes phases avec les formats de cette forge.`,
    fork:`Posez-vous 3 questions pour n'importe quel sujet : "Que voit-on ?" ‚Üí "Qu'en pense-t-on ?" ‚Üí "Que fait-on ?" Vous avez la m√©thode. Tout le reste n'est que d√©coration.`,
    links:['cafe-debat','cine-debat','world-cafe','fresque-citoyenne','animation','porteur-paroles','theatre-forum']
  },
  {
    id:'animation', name:'Guide de\nl\'Animateur¬∑rice', icon:'üéØ', cat:'methode', size:22,
    tagline:'Vous n\'√™tes pas prof. Vous √™tes facilitateur¬∑rice.',
    diff:0, people:'Vous', time:'5 min de lecture', place:'Avant l\'atelier',
    badges:['Essentiel','Posture','Anti-expert'],
    mat:[
      {i:'üëÇ',t:'√âcoute active',free:true},
      {i:'‚è±Ô∏è',t:'Gestion du temps',free:true},
      {i:'ü§ê',t:'Savoir se taire',free:true}
    ],
    steps:[
      {t:'Vous n\'√™tes pas expert¬∑e',d:'Vous n\'avez pas besoin de tout savoir sur le sujet. Votre r√¥le : poser les questions, distribuer la parole, g√©rer le temps. Le groupe sait des choses que vous ne savez pas.',dur:'Posture'},
      {t:'R√®gle des 80/20',d:'Vous parlez 20% du temps. Le groupe parle 80%. Si vous parlez plus, vous monopolisez. Si quelqu\'un d\'autre monopolise, intervenez gentiment : "Merci ‚Äî quelqu\'un d\'autre veut r√©agir ?"',dur:'Posture'},
      {t:'Le silence est votre ami',d:'Quand personne ne parle, attendez 10 secondes. √áa para√Æt long. Quelqu\'un finira par parler ‚Äî souvent la personne la plus timide, avec la chose la plus int√©ressante √† dire.',dur:'Posture'},
      {t:'Reformulez, ne jugez pas',d:'"Si je comprends bien, vous dites que..." Ne dites jamais "C\'est une bonne r√©ponse" (√ßa implique qu\'il y en a des mauvaises) ni "Oui mais..." (√ßa annule ce qui pr√©c√®de).',dur:'Posture'},
      {t:'Finissez toujours par l\'action',d:'M√™me petite. "Qu\'est-ce qu\'on fait maintenant ?" Un atelier sans suite est un divertissement. Un atelier avec une action, m√™me minuscule, est de l\'√©ducation permanente.',dur:'Posture'},
      {t:'Documentez',d:'Photo de groupe (si accord), synth√®se rapide, publication en ligne. Ce qui n\'est pas document√© n\'existe pas pour ceux qui n\'√©taient pas l√†.',dur:'Apr√®s'}
    ],
    hybrid:`L'animateur¬∑rice en ligne a le m√™me r√¥le : relancer, reformuler, synth√©tiser. La diff√©rence : en asynchrone, vous pouvez prendre votre temps pour formuler les relances. C'est m√™me plus facile que le pr√©sentiel pour les introvertis.`,
    fork:`Lisez ces 6 points. Vous √™tes pr√™t¬∑e √† animer un atelier. Pas besoin de formation de 3 ans. L'√©ducation populaire appartient au peuple, pas aux dipl√¥m√©s.`,
    links:['voir-penser-agir','cafe-debat','debat-mouvant','cercle-parole','porteur-paroles','theatre-forum']
  }
];

// Build links
const allLinks = [];
const linkSet = new Set();
WS.forEach(w => {
  (w.links||[]).forEach(tid => {
    const k = [w.id,tid].sort().join('||');
    if(!linkSet.has(k) && WS.find(x=>x.id===tid)) { linkSet.add(k); allLinks.push({source:w.id,target:tid}); }
  });
});

document.getElementById('stat-n').textContent = WS.length;
document.getElementById('stat-l').textContent = allLinks.length;

// ====================================================
// PARTICLES
// ====================================================
const pc = document.getElementById('particles');
const pctx = pc.getContext('2d');
pc.width = window.innerWidth; pc.height = window.innerHeight;
const parts = Array.from({length:60},()=>({
  x:Math.random()*pc.width, y:Math.random()*pc.height,
  vx:(Math.random()-0.5)*0.3, vy:(Math.random()-0.5)*0.3,
  r:Math.random()*1.5+0.5, c:Math.random()>0.5?'#48bb7830':'#9f7aea20'
}));
function drawParticles(){
  pctx.clearRect(0,0,pc.width,pc.height);
  parts.forEach(p=>{
    p.x+=p.vx; p.y+=p.vy;
    if(p.x<0)p.x=pc.width; if(p.x>pc.width)p.x=0;
    if(p.y<0)p.y=pc.height; if(p.y>pc.height)p.y=0;
    pctx.beginPath(); pctx.arc(p.x,p.y,p.r,0,Math.PI*2);
    pctx.fillStyle=p.c; pctx.fill();
  });
  requestAnimationFrame(drawParticles);
}
drawParticles();

// ====================================================
// CLOCK
// ====================================================
setInterval(()=>{
  document.getElementById('clock').textContent=new Date().toLocaleTimeString('fr-BE',{hour12:false});
},1000);

// ====================================================
// CATALOG
// ====================================================
const cats = ['all',...new Set(WS.map(w=>w.cat))];
let activeFilter = 'all';

function buildFilters(){
  const el = document.getElementById('filters');
  el.innerHTML = '';
  cats.forEach(c=>{
    const b = document.createElement('button');
    b.className = 'filter-tag' + (c===activeFilter?' active':'');
    b.dataset.cat = c;
    b.textContent = c==='all'?'Tous':CATS[c]?CATS[c].icon+' '+CATS[c].label:c;
    b.onclick = ()=>{ activeFilter=c; buildFilters(); filterList(); };
    el.appendChild(b);
  });
}
buildFilters();

function buildList(items){
  const el = document.getElementById('ws-list');
  el.innerHTML='';
  items.forEach(w=>{
    const cat = CATS[w.cat];
    const d = document.createElement('div');
    d.className='ws-item'; d.dataset.id=w.id;
    d.innerHTML=`
      <div class="ws-icon" style="background:${cat.color}18;border:1px solid ${cat.color}33">${w.icon}</div>
      <div class="ws-info">
        <div class="ws-name">${w.name.replace(/\n/g,' ')}</div>
        <div class="ws-tagline">${w.tagline}</div>
        <div class="ws-meta">
          ${w.badges.map(b=>`<span class="ws-badge" style="background:${cat.color}18;color:${cat.color}">${b}</span>`).join('')}
        </div>
      </div>
      <div class="ws-diff">
        <div class="stars">${'‚òÖ'.repeat(w.diff||1)+'‚òÜ'.repeat(3-(w.diff||1))}</div>
        <span>${w.people}</span>
      </div>`;
    d.onclick=()=>openModal(w.id);
    d.onmouseenter=()=>highlightNode(w.id);
    d.onmouseleave=()=>unhighlight();
    el.appendChild(d);
  });
}

function filterList(){
  const q = document.getElementById('search').value.toLowerCase();
  let items = WS;
  if(activeFilter!=='all') items = items.filter(w=>w.cat===activeFilter);
  if(q) items = items.filter(w=>(w.name+w.tagline+w.badges.join(' ')).toLowerCase().includes(q));
  buildList(items);
}
filterList();

let catalogCollapsed = false;
function toggleCatalog(){
  catalogCollapsed = !catalogCollapsed;
  document.getElementById('catalog').classList.toggle('collapsed',catalogCollapsed);
  if(sim) sim.alpha(0.3).restart();
}

// ====================================================
// GRAPH
// ====================================================
const svg = d3.select('#svg');
const ga = document.getElementById('graph-area');
let W = ga.clientWidth, H = ga.clientHeight;
const gRoot = svg.append('g');

svg.call(d3.zoom().scaleExtent([0.25,4]).on('zoom',e=>gRoot.attr('transform',e.transform)));

const linkEls = gRoot.append('g').selectAll('line').data(allLinks).join('line')
  .attr('class','graph-link');

const nodeEls = gRoot.append('g').selectAll('g').data(WS).join('g')
  .attr('class','graph-node')
  .call(d3.drag().on('start',(e)=>{if(!e.active)sim.alphaTarget(0.3).restart();e.subject.fx=e.subject.x;e.subject.fy=e.subject.y;})
    .on('drag',(e)=>{e.subject.fx=e.x;e.subject.fy=e.y;})
    .on('end',(e)=>{if(!e.active)sim.alphaTarget(0);e.subject.fx=null;e.subject.fy=null;}));

nodeEls.append('circle').attr('class','node-pulse-ring')
  .attr('r',0).attr('fill','none').attr('stroke',d=>CATS[d.cat].color).attr('stroke-width',1)
  .style('animation-delay',d=>`${Math.random()*3}s`);

nodeEls.append('circle').attr('class','node-ring')
  .attr('r',d=>d.size/2)
  .attr('fill',d=>CATS[d.cat].color+'20')
  .attr('stroke',d=>CATS[d.cat].color)
  .attr('stroke-width',1.5)
  .style('color',d=>CATS[d.cat].color);

nodeEls.append('text').text(d=>d.icon).attr('text-anchor','middle').attr('dy','0.35em')
  .style('font-size',d=>(d.size/2.2)+'px').style('pointer-events','none');

nodeEls.each(function(d){
  const lines = d.name.replace(/\n/g,' ').split(' ');
  const g = d3.select(this);
  // Single line label
  g.append('text').attr('class','node-lbl')
    .attr('dy',d.size/2+12).text(d.name.replace(/\n/g,' '));
});

nodeEls.on('click',(e,d)=>{e.stopPropagation();openModal(d.id);})
  .on('mouseenter',(e,d)=>{
    highlightNode(d.id);
    const tip=document.getElementById('tip');
    document.getElementById('tip-name').textContent=d.name.replace(/\n/g,' ');
    document.getElementById('tip-desc').textContent=d.tagline;
    document.getElementById('tip-badges').innerHTML=d.badges.map(b=>`<span class="t t-mint">${b}</span>`).join('');
    tip.classList.add('on');
    tip.style.left=(e.clientX+16)+'px'; tip.style.top=(e.clientY-10)+'px';
  })
  .on('mousemove',(e)=>{const t=document.getElementById('tip');t.style.left=(e.clientX+16)+'px';t.style.top=(e.clientY-10)+'px';})
  .on('mouseleave',()=>{unhighlight();document.getElementById('tip').classList.remove('on');});

const sim = d3.forceSimulation(WS)
  .force('link',d3.forceLink(allLinks).id(d=>d.id).distance(110).strength(0.35))
  .force('charge',d3.forceManyBody().strength(-350))
  .force('center',d3.forceCenter(W/2,H/2))
  .force('collision',d3.forceCollide().radius(d=>d.size+8))
  .on('tick',()=>{
    linkEls.attr('x1',d=>d.source.x).attr('y1',d=>d.source.y).attr('x2',d=>d.target.x).attr('y2',d=>d.target.y);
    nodeEls.attr('transform',d=>`translate(${d.x},${d.y})`);
  });

window.addEventListener('resize',()=>{
  W=ga.clientWidth; H=ga.clientHeight;
  sim.force('center',d3.forceCenter(W/2,H/2)).alpha(0.3).restart();
  pc.width=window.innerWidth; pc.height=window.innerHeight;
});

// Center after settle
setTimeout(()=>{
  const b=gRoot.node().getBBox();
  const s=Math.min(W/(b.width+80),H/(b.height+80),1.15);
  const tx=W/2-(b.x+b.width/2)*s;
  const ty=H/2-(b.y+b.height/2)*s;
  svg.transition().duration(1000).call(d3.zoom().scaleExtent([0.25,4]).on('zoom',e=>gRoot.attr('transform',e.transform)).transform,d3.zoomIdentity.translate(tx,ty).scale(s));
},3000);

// ====================================================
// HIGHLIGHT
// ====================================================
function highlightNode(id){
  const w=WS.find(x=>x.id===id); if(!w)return;
  const conn=new Set(w.links||[]); conn.add(id);
  nodeEls.select('.node-ring').attr('opacity',d=>conn.has(d.id)?1:0.12).attr('stroke-width',d=>d.id===id?3:conn.has(d.id)?2:1);
  nodeEls.selectAll('.node-lbl').attr('opacity',d=>conn.has(d.id)?1:0.08);
  linkEls.each(function(d){
    const s=typeof d.source==='object'?d.source.id:d.source;
    const t=typeof d.target==='object'?d.target.id:d.target;
    const lit=(s===id&&conn.has(t))||(t===id&&conn.has(s));
    d3.select(this).attr('class',lit?'graph-link lit':'graph-link').attr('opacity',lit?0.7:0.06);
  });
  document.querySelectorAll('.ws-item').forEach(el=>el.classList.toggle('active',conn.has(el.dataset.id)));
}
function unhighlight(){
  nodeEls.select('.node-ring').attr('opacity',1).attr('stroke-width',1.5);
  nodeEls.selectAll('.node-lbl').attr('opacity',0.85);
  linkEls.attr('class','graph-link').attr('opacity',0.3);
  document.querySelectorAll('.ws-item').forEach(el=>el.classList.remove('active'));
}

// ====================================================
// MODAL
// ====================================================
function openModal(id){
  const w=WS.find(x=>x.id===id); if(!w)return;
  const cat=CATS[w.cat];

  document.getElementById('modal-head').innerHTML=`
    <div class="mh-icon" style="background:${cat.color}18;border:1px solid ${cat.color}44">${w.icon}</div>
    <div class="mh-info">
      <div class="mh-title">${w.name.replace(/\n/g,' ')}</div>
      <div class="mh-sub">${w.tagline}</div>
    </div>
    <button class="mh-close" onclick="closeModal()">ESC √ó</button>`;

  document.getElementById('modal-stats').innerHTML=`
    <div class="mstat"><div class="mstat-icon">üë•</div><div class="mstat-val">${w.people}</div><div class="mstat-label">Personnes</div></div>
    <div class="mstat"><div class="mstat-icon">‚è±Ô∏è</div><div class="mstat-val lilac">${w.time}</div><div class="mstat-label">Dur√©e</div></div>
    <div class="mstat"><div class="mstat-icon">üìç</div><div class="mstat-val">${w.place.length>18?w.place.slice(0,18)+'‚Ä¶':w.place}</div><div class="mstat-label">Lieu</div></div>
    <div class="mstat"><div class="mstat-icon">${'‚òÖ'.repeat(w.diff||1)}</div><div class="mstat-val lilac">${['Universel','Facile','Interm√©diaire','Avanc√©'][w.diff||0]}</div><div class="mstat-label">Difficult√©</div></div>`;

  let html = '';

  // MAT√âRIEL
  html += `<div class="msec"><div class="msec-title">üéí Ce qu'il vous faut</div>
    <div class="mat-grid">${w.mat.map(m=>`<div class="mat-item"><span class="mat-icon">${m.i}</span><span>${m.t}</span>${m.free?'<span class="mat-free">GRATUIT</span>':''}</div>`).join('')}</div>
  </div>`;

  // √âTAPES
  html += `<div class="msec"><div class="msec-title">üìã Pas √† pas</div><div class="steps">`;
  w.steps.forEach(s=>{
    html += `<div class="step">
      <div class="step-title">${s.t}</div>
      <div class="step-detail">${s.d}</div>
      ${s.dur?`<span class="step-time">‚è± ${s.dur}</span>`:''}
    </div>`;
  });
  html += `</div></div>`;

  // HYBRID
  html += `<div class="msec"><div class="msec-title">üîó Le pont num√©rique</div>
    <div class="hybrid-box">
      <div class="hybrid-label">‚ö° HYBRIDATION OUAISFIEU</div>
      <p>${w.hybrid}</p>
    </div>
  </div>`;

  // FORK
  html += `<div class="msec"><div class="msec-title">üç¥ Forkez-le</div>
    <div class="fork-box">
      <div class="fork-title">Lancez-vous. Maintenant.</div>
      <p>${w.fork}</p>
      <div class="fork-cmd" onclick="toast('üç¥ Kit copi√© ! Allez sur ouaisfieu.github.io/forge pour la fiche compl√®te.')">üìã Copier le kit</div>
    </div>
  </div>`;

  // CONNEXIONS
  html += `<div class="msec"><div class="msec-title">üîÄ Ateliers connexes</div>
    <div class="conn-list">${(w.links||[]).map(lid=>{
      const lw=WS.find(x=>x.id===lid);
      return lw?`<button class="conn-tag" onclick="openModal('${lid}')">${lw.icon} ${lw.name.replace(/\n/g,' ')}</button>`:'';
    }).join('')}</div>
  </div>`;

  document.getElementById('modal-scroll').innerHTML = html;
  document.getElementById('modal-bg').classList.add('open');
  highlightNode(id);
}

function closeModal(e){
  if(e && e.target!==e.currentTarget) return;
  document.getElementById('modal-bg').classList.remove('open');
  unhighlight();
}
document.addEventListener('keydown',e=>{if(e.key==='Escape')closeModal();});

// ====================================================
// COMMAND
// ====================================================
const cmdInput = document.getElementById('cmd');

// Prevent D3 and other listeners from stealing keyboard events
cmdInput.addEventListener('keydown', function(e) { e.stopPropagation(); });
cmdInput.addEventListener('keyup', function(e) { e.stopPropagation(); });
cmdInput.addEventListener('keypress', function(e) { e.stopPropagation(); });
cmdInput.addEventListener('click', function(e) { e.stopPropagation(); this.focus(); });
cmdInput.addEventListener('mousedown', function(e) { e.stopPropagation(); });

function handleCmd(e){
  if(e.key!=='Enter')return;
  const v=document.getElementById('cmd').value.trim().toLowerCase();
  document.getElementById('cmd').value='';
  if(v==='help'){toast('Commandes : help | go | list | vpa | [nom du format]');return;}
  if(v==='go'){const r=WS[Math.floor(Math.random()*WS.length)];openModal(r.id);toast(`üé≤ Format tir√© au sort : ${r.name.replace(/\n/g,' ')}`);return;}
  if(v==='list'){toast(WS.map(w=>w.icon+' '+w.name.replace(/\n/g,' ')).join(' ¬∑ '));return;}
  if(v==='vpa'||v==='voir-penser-agir'){openModal('voir-penser-agir');return;}
  if(v==='korben'){toast('ü§ñ Pas de node_modules, pas de build step, pas de framework. Juste du HTML qui envoie du bois. Comme en 1999, mais en mieux.');return;}
  const found=WS.find(w=>w.id===v||w.name.replace(/\n/g,' ').toLowerCase().includes(v));
  if(found){openModal(found.id);}else{toast(`‚ö† Format "${v}" non trouv√©. Tapez "list" ou "go" pour un tirage au sort.`);}
}

function toast(msg){
  document.querySelectorAll('.toast').forEach(t=>t.remove());
  const t=document.createElement('div');t.className='toast';t.textContent=msg;
  document.body.appendChild(t);setTimeout(()=>t.remove(),4000);
}

setTimeout(()=>toast('‚ö° La Forge est ouverte ‚Äî cliquez un format ou tapez "go" pour commencer'),1500);
</script>
</body>
</html>
