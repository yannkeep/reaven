<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MISSION MEDIA CONTROL â€” Centre de Commandement MultimÃ©dia</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Orbitron:wght@400;700;900&family=Chakra+Petch:wght@300;400;600;700&display=swap');

:root {
  --hud-cyan: #00e5ff;
  --hud-cyan-dim: rgba(0,229,255,0.15);
  --hud-green: #76ff03;
  --hud-green-dim: rgba(118,255,3,0.15);
  --hud-amber: #ffc400;
  --hud-red: #ff1744;
  --hud-red-dim: rgba(255,23,68,0.15);
  --nasa-white: #e8ecf1;
  --bg: #0a0e17;
  --surface: #0f1923;
  --raised: #131f2e;
  --border: #1a2a3a;
  --border-lit: #1e3a5a;
  --grid: rgba(0,229,255,0.04);
  --dim: #4a6a8a;
  --mono: 'Share Tech Mono', monospace;
  --display: 'Orbitron', sans-serif;
  --ui: 'Chakra Petch', sans-serif;
}

*{margin:0;padding:0;box-sizing:border-box}
html{scrollbar-width:thin;scrollbar-color:var(--border-lit) var(--bg)}
::-webkit-scrollbar{width:6px}
::-webkit-scrollbar-track{background:var(--bg)}
::-webkit-scrollbar-thumb{background:var(--border-lit);border-radius:3px}

body{
  background:var(--bg);min-height:100vh;
  display:flex;justify-content:center;padding:20px;
  font-family:var(--mono);color:var(--hud-cyan);position:relative;
}
body::before{
  content:'';position:fixed;inset:0;
  background-image:linear-gradient(var(--grid) 1px,transparent 1px),linear-gradient(90deg,var(--grid) 1px,transparent 1px);
  background-size:40px 40px;pointer-events:none;z-index:0;
}
body::after{
  content:'';position:fixed;inset:0;
  background:radial-gradient(ellipse at 50% 20%,rgba(0,229,255,0.03) 0%,transparent 60%);
  pointer-events:none;z-index:0;
}

.console{width:100%;max-width:780px;position:relative;z-index:1;animation:boot .8s ease-out}
@keyframes boot{0%{opacity:0;transform:translateY(16px);filter:blur(3px)}60%{filter:blur(0)}100%{opacity:1;transform:translateY(0)}}

/* â”€â”€ TOP BAR â”€â”€ */
.top-bar{display:flex;justify-content:space-between;padding:0 4px;margin-bottom:6px;font-size:.55rem;color:var(--dim);letter-spacing:.1em}

/* â”€â”€ HEADER â”€â”€ */
.header{
  background:var(--surface);border:1px solid var(--border);
  padding:14px 18px;display:flex;justify-content:space-between;align-items:center;
  position:relative;overflow:hidden;
}
.header::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent,var(--hud-cyan),transparent);opacity:.5}
.header-left{display:flex;align-items:center;gap:12px}
.nasa-patch{
  width:44px;height:44px;border-radius:50%;border:2px solid var(--hud-cyan);
  display:flex;align-items:center;justify-content:center;
  background:radial-gradient(circle,rgba(0,229,255,.06) 0%,transparent 70%);flex-shrink:0;position:relative;
}
.nasa-patch::after{content:'';position:absolute;inset:3px;border-radius:50%;border:1px dashed rgba(0,229,255,.15)}
.patch-icon{font-size:1.2rem;filter:drop-shadow(0 0 6px var(--hud-cyan))}
.h-title{font-family:var(--display);font-size:clamp(.65rem,2.2vw,.9rem);font-weight:700;letter-spacing:.18em;color:var(--nasa-white)}
.h-sub{font-size:.55rem;color:var(--dim);letter-spacing:.12em;margin-top:2px}
.header-right{text-align:right}
.met-label{font-size:.45rem;color:var(--dim);letter-spacing:.12em}
.met-clock{font-family:var(--display);font-size:1rem;font-weight:700;color:var(--hud-green);text-shadow:0 0 10px rgba(118,255,3,.25);font-variant-numeric:tabular-nums}

/* â”€â”€ STATUS â”€â”€ */
.status-strip{display:flex;gap:1px;margin:5px 0}
.s-cell{flex:1;background:var(--surface);border:1px solid var(--border);padding:6px 8px;text-align:center;min-width:0}
.s-cell .lbl{font-size:.45rem;color:var(--dim);letter-spacing:.1em;margin-bottom:3px}
.s-cell .val{font-family:var(--display);font-size:.7rem;font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.v-green{color:var(--hud-green);text-shadow:0 0 6px rgba(118,255,3,.2)}
.v-cyan{color:var(--hud-cyan);text-shadow:0 0 6px rgba(0,229,255,.2)}
.v-amber{color:var(--hud-amber);text-shadow:0 0 6px rgba(255,196,0,.2)}

/* â”€â”€ VIEWPORT â”€â”€ */
.vp-module{background:var(--surface);border:1px solid var(--border);margin:5px 0;overflow:hidden;position:relative}
.vp-header{display:flex;justify-content:space-between;align-items:center;padding:7px 14px;border-bottom:1px solid var(--border);font-size:.5rem;letter-spacing:.1em;color:var(--dim)}
.live-dot{display:inline-block;width:6px;height:6px;border-radius:50%;background:var(--border);margin-right:5px;transition:all .3s}
.live-dot.on{background:var(--hud-red);box-shadow:0 0 8px var(--hud-red-dim);animation:pulse 1.2s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.4}}

.vp-screen{background:#000;aspect-ratio:16/9;position:relative;overflow:hidden}
.vp-screen iframe,.vp-screen video{width:100%;height:100%;border:none}
.vp-screen.audio-mode{
  aspect-ratio:unset;min-height:160px;display:flex;align-items:center;justify-content:center;
  background:#060c14;position:relative;
}
.vp-screen.audio-mode::before{
  content:'';position:absolute;inset:0;
  background-image:linear-gradient(var(--grid) 1px,transparent 1px),linear-gradient(90deg,var(--grid) 1px,transparent 1px);
  background-size:20px 20px;pointer-events:none;
}
.vp-screen.audio-mode audio{width:85%;height:auto;position:relative;z-index:1}

.vp-empty{
  position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:12px;
  background:#060c14;
  background-image:linear-gradient(var(--grid) 1px,transparent 1px),linear-gradient(90deg,var(--grid) 1px,transparent 1px);
  background-size:40px 40px;
}
.crosshair{width:80px;height:80px;position:relative;opacity:.15}
.crosshair::before,.crosshair::after{content:'';position:absolute;background:var(--hud-cyan)}
.crosshair::before{top:50%;left:10%;right:10%;height:1px;transform:translateY(-50%)}
.crosshair::after{left:50%;top:10%;bottom:10%;width:1px;transform:translateX(-50%)}
.corner{position:absolute;width:16px;height:16px;opacity:.2}
.corner.tl{top:12px;left:12px;border-top:2px solid var(--hud-cyan);border-left:2px solid var(--hud-cyan)}
.corner.tr{top:12px;right:12px;border-top:2px solid var(--hud-cyan);border-right:2px solid var(--hud-cyan)}
.corner.bl{bottom:12px;left:12px;border-bottom:2px solid var(--hud-cyan);border-left:2px solid var(--hud-cyan)}
.corner.br{bottom:12px;right:12px;border-bottom:2px solid var(--hud-cyan);border-right:2px solid var(--hud-cyan)}
.vp-empty p{font-family:var(--display);font-size:.5rem;color:var(--dim);letter-spacing:.15em;animation:blink 2s infinite}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.3}}

/* â”€â”€ INFO BAR â”€â”€ */
.info-bar{
  display:flex;justify-content:space-between;align-items:center;
  padding:8px 14px;background:var(--surface);border:1px solid var(--border);border-top:none;margin-bottom:5px;
}
.now-info{font-size:.7rem;color:var(--dim);max-width:65%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.now-info strong{color:var(--nasa-white);font-weight:400}
.btn-small{
  background:transparent;border:1px solid var(--border-lit);border-radius:3px;
  padding:3px 10px;color:var(--dim);font-family:var(--mono);font-size:.6rem;cursor:pointer;transition:all .2s;
}
.btn-small:hover{border-color:var(--hud-amber);color:var(--hud-amber)}

/* â”€â”€ WAVEFORM â”€â”€ */
.wave-mod{background:var(--surface);border:1px solid var(--border);padding:8px 14px;margin:5px 0}
.wave-top{display:flex;justify-content:space-between;font-size:.45rem;color:var(--dim);letter-spacing:.1em;margin-bottom:5px}
.wave-cv{width:100%;height:40px;background:#060c14;border:1px solid var(--border);border-radius:2px;position:relative;overflow:hidden}
.wave-cv::before{content:'';position:absolute;top:50%;left:0;right:0;height:1px;background:rgba(0,229,255,.08)}
.wbars{display:flex;align-items:center;justify-content:center;height:100%;gap:1px;padding:0 6px}
.wb{flex:1;max-width:5px;background:var(--hud-cyan);border-radius:1px;height:3px;opacity:.4;transition:height .08s ease}

/* â”€â”€ ADD MEDIA (collapsible) â”€â”€ */
.add-module{background:var(--surface);border:1px solid var(--border);margin:5px 0;overflow:hidden}
.add-header{
  display:flex;justify-content:space-between;align-items:center;
  padding:7px 14px;border-bottom:1px solid var(--border);font-size:.5rem;letter-spacing:.1em;color:var(--dim);cursor:pointer;
  transition:background .2s;
}
.add-header:hover{background:rgba(0,229,255,.03)}
.add-header .chevron{transition:transform .3s;font-size:.7rem}
.add-header.open .chevron{transform:rotate(180deg)}
.add-body{max-height:0;overflow:hidden;transition:max-height .3s ease}
.add-body.open{max-height:200px}
.add-inner{padding:12px 14px}
.input-row{display:flex;gap:8px}
.input-row input{
  flex:1;background:#060c14;border:1px solid var(--border-lit);border-radius:3px;
  padding:9px 12px;color:var(--hud-cyan);font-family:var(--mono);font-size:.82rem;outline:none;
  caret-color:var(--hud-green);transition:border-color .3s,box-shadow .3s;
}
.input-row input:focus{border-color:var(--hud-cyan);box-shadow:0 0 12px var(--hud-cyan-dim),inset 0 0 8px rgba(0,229,255,.03)}
.input-row input::placeholder{color:var(--dim);opacity:.5}
.btn-launch{
  background:rgba(0,229,255,.1);border:1px solid var(--hud-cyan);border-radius:3px;
  padding:9px 18px;color:var(--hud-cyan);font-family:var(--display);font-size:.6rem;font-weight:700;
  letter-spacing:.12em;cursor:pointer;white-space:nowrap;transition:all .2s;
}
.btn-launch:hover{background:rgba(0,229,255,.2);box-shadow:0 0 20px var(--hud-cyan-dim);transform:translateY(-1px)}
.btn-launch:active{transform:scale(.97)}

/* â”€â”€ QUEUE â”€â”€ */
.queue-mod{background:var(--surface);border:1px solid var(--border);margin:5px 0;overflow:hidden}
.queue-header{display:flex;justify-content:space-between;align-items:center;padding:7px 14px;border-bottom:1px solid var(--border);font-size:.5rem;letter-spacing:.1em;color:var(--dim)}
.queue-items{max-height:320px;overflow-y:auto}
.qi{display:flex;align-items:center;gap:10px;padding:8px 14px;cursor:pointer;border-bottom:1px solid rgba(26,42,58,.5);transition:all .15s}
.qi:last-child{border-bottom:none}
.qi:hover{background:rgba(0,229,255,.03)}
.qi.active{background:rgba(0,229,255,.06);border-left:2px solid var(--hud-cyan)}
.qi-idx{font-family:var(--display);font-size:.6rem;color:var(--dim);min-width:2rem;font-variant-numeric:tabular-nums}
.qi.active .qi-idx{color:var(--hud-cyan)}
.qi-icon{
  width:24px;height:24px;border:1px solid var(--border-lit);border-radius:3px;
  display:flex;align-items:center;justify-content:center;font-size:.65rem;flex-shrink:0;background:#060c14;
}
.qi-info{flex:1;min-width:0}
.qi-title{font-family:var(--ui);font-size:.8rem;font-weight:600;color:var(--nasa-white);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.qi-src{font-size:.6rem;color:var(--dim);margin-top:1px}
.qi-rm{background:none;border:none;color:var(--dim);cursor:pointer;font-size:.7rem;opacity:0;transition:all .2s;padding:4px}
.qi:hover .qi-rm{opacity:1}
.qi-rm:hover{color:var(--hud-red)}
.q-empty{padding:30px;text-align:center;color:var(--dim);font-size:.7rem;opacity:.4}

/* â”€â”€ FOOTER â”€â”€ */
.footer{display:flex;justify-content:space-between;padding:6px 4px 0;font-size:.45rem;color:var(--dim);letter-spacing:.08em;opacity:.35}

/* â”€â”€ MODAL â”€â”€ */
.modal-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.8);z-index:2000;align-items:center;justify-content:center;backdrop-filter:blur(4px)}
.modal-overlay.open{display:flex}
.modal-box{
  background:var(--surface);border:1px solid var(--hud-cyan);border-radius:4px;padding:18px;width:90%;max-width:560px;
  box-shadow:0 0 40px var(--hud-cyan-dim);animation:boot .3s ease-out;
}
.modal-box .m-title{font-family:var(--display);font-size:.7rem;font-weight:700;letter-spacing:.12em;color:var(--hud-cyan);margin-bottom:12px}
.modal-box textarea{
  width:100%;background:#060c14;border:1px solid var(--border-lit);border-radius:3px;
  padding:10px;color:var(--hud-cyan);font-family:var(--mono);font-size:.75rem;resize:vertical;min-height:100px;outline:none;
}
.modal-box textarea:focus{border-color:var(--hud-cyan)}
.m-actions{display:flex;justify-content:flex-end;gap:8px;margin-top:10px}
.m-actions button{padding:6px 16px;border-radius:3px;font-family:var(--mono);font-size:.7rem;cursor:pointer;transition:all .2s}
.m-btn-cancel{background:none;border:1px solid var(--border-lit);color:var(--dim)}
.m-btn-cancel:hover{border-color:var(--dim)}
.m-btn-copy{background:rgba(0,229,255,.15);border:1px solid var(--hud-cyan);color:var(--hud-cyan)}
.m-btn-copy:hover{background:rgba(0,229,255,.25);box-shadow:0 0 12px var(--hud-cyan-dim)}

/* â”€â”€ RESPONSIVE â”€â”€ */
@media(max-width:580px){
  body{padding:10px}
  .input-row{flex-direction:column}
  .btn-launch{width:100%;text-align:center}
  .status-strip{flex-wrap:wrap}
  .s-cell{min-width:45%}
  .header{flex-direction:column;gap:10px;align-items:flex-start}
  .header-right{text-align:left}
  .info-bar{flex-direction:column;gap:6px;align-items:flex-start}
  .now-info{max-width:100%}
}
</style>
</head>
<body>
<div class="console">

  <div class="top-bar">
    <span>OUAISFIEU AEROSPACE â€” MULTIMEDIA DIVISION</span>
    <span>MISSION MMC-2026</span>
  </div>

  <div class="header">
    <div class="header-left">
      <div class="nasa-patch"><span class="patch-icon">ğŸ›°ï¸</span></div>
      <div>
        <div class="h-title">MISSION MEDIA CONTROL</div>
        <div class="h-sub">UNIVERSAL STREAM COMMAND</div>
      </div>
    </div>
    <div class="header-right">
      <div class="met-label">MET ELAPSED</div>
      <div class="met-clock" id="metClock">00:00:00</div>
    </div>
  </div>

  <div class="status-strip">
    <div class="s-cell"><div class="lbl">SYSTÃˆME</div><div class="val v-green">NOMINAL</div></div>
    <div class="s-cell"><div class="lbl">FLUX</div><div class="val v-cyan" id="sFlux">STANDBY</div></div>
    <div class="s-cell"><div class="lbl">TYPE</div><div class="val v-amber" id="sType">â€”</div></div>
    <div class="s-cell"><div class="lbl">PAYLOAD</div><div class="val v-cyan" id="sCount">0x00</div></div>
  </div>

  <div class="vp-module">
    <div class="vp-header">
      <span><span class="live-dot" id="liveDot"></span>PRIMARY DISPLAY</span>
      <span id="vpLabel">AWAITING SIGNAL</span>
    </div>
    <div class="vp-screen" id="viewport">
      <div class="vp-empty" id="placeholder">
        <div class="corner tl"></div><div class="corner tr"></div>
        <div class="corner bl"></div><div class="corner br"></div>
        <div class="crosshair"></div>
        <p>AWAITING SIGNAL ACQUISITION</p>
      </div>
    </div>
  </div>

  <div class="info-bar">
    <div class="now-info" id="nowInfo">sys:// idle â€” sÃ©lectionnez un payload</div>
    <button class="btn-small" onclick="showEmbed()">&lt;/&gt; EMBED</button>
  </div>

  <div class="wave-mod">
    <div class="wave-top"><span>AUDIO TELEMETRY</span><span id="wfLabel">IDLE</span></div>
    <div class="wave-cv"><div class="wbars" id="wBars"></div></div>
  </div>

  <div class="queue-mod">
    <div class="queue-header">
      <span>MISSION PAYLOAD MANIFEST</span>
      <span id="qCount">0 PAYLOADS</span>
    </div>
    <div class="queue-items" id="qItems"></div>
  </div>

  <!-- Collapsible add -->
  <div class="add-module">
    <div class="add-header" id="addToggle" onclick="toggleAdd()">
      <span>+ AJOUTER UN SIGNAL</span>
      <span class="chevron">â–¼</span>
    </div>
    <div class="add-body" id="addBody">
      <div class="add-inner">
        <div class="input-row">
          <input type="text" id="mediaInput" placeholder="URL ou iframe â€” YouTube, Vimeo, mp4, mp3, SoundCloud..." />
          <button class="btn-launch" onclick="addFromInput()">â–¶ LAUNCH</button>
        </div>
      </div>
    </div>
  </div>

  <div class="footer">
    <span>OUAISFIEU GROUND CONTROL â€” COPYLEFT âˆ</span>
    <span>ALL FORMATS â€” ZERO TRACKING</span>
  </div>
</div>

<div class="modal-overlay" id="embedModal">
  <div class="modal-box">
    <div class="m-title">EMBED CODE â€” EXPORT</div>
    <textarea id="embedCode" readonly></textarea>
    <div class="m-actions">
      <button class="m-btn-cancel" onclick="closeModal()">ABORT</button>
      <button class="m-btn-copy" onclick="copyEmbed()">COPY</button>
    </div>
  </div>
</div>

<script>
/*
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                                  â•‘
â•‘   ğŸ›°ï¸  MISSION PAYLOAD â€” TA PLAYLIST, MODIFIE ICI                â•‘
â•‘                                                                  â•‘
â•‘   Chaque entrÃ©e = un objet avec :                                â•‘
â•‘     title  â†’ nom affichÃ©                                         â•‘
â•‘     url    â†’ lien YouTube, Vimeo, SoundCloud, Spotify,           â•‘
â•‘              Dailymotion, PeerTube, fichier mp4/mp3/m4a/ogg,     â•‘
â•‘              ou code <iframe> brut                               â•‘
â•‘                                                                  â•‘
â•‘   Exemples de formats supportÃ©s :                                â•‘
â•‘     "https://www.youtube.com/watch?v=XXXXX"                      â•‘
â•‘     "https://vimeo.com/123456"                                   â•‘
â•‘     "https://soundcloud.com/artiste/titre"                       â•‘
â•‘     "https://open.spotify.com/track/XXXXX"                       â•‘
â•‘     "https://www.dailymotion.com/video/XXXXX"                    â•‘
â•‘     "https://instance.tube/w/XXXXX"     (PeerTube)               â•‘
â•‘     "https://exemple.com/fichier.mp4"                            â•‘
â•‘     "https://exemple.com/fichier.mp3"                            â•‘
â•‘     "<iframe src='...'></iframe>"       (embed brut)             â•‘
â•‘                                                                  â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
*/

const MISSION_PAYLOAD = [

  // â”€â”€ TES AUDIOS BXL-242 â”€â”€
  {
    title: "Bruxelles ruinÃ©e par 613 jours de blocage",
    url: "https://dl.ouaisfi.eu/bxl-242/Bruxelles_ruin%C3%A9e_par_613_jours_de_blocage.m4a"
  },
  {
    title: "613 jours de faillite politique Ã  Bruxelles",
    url: "https://dl.ouaisfi.eu/bxl-242/613_jours_de_faillite_politique_%C3%A0_Bruxelles.m4a"
  },
  {
    title: "Bruxelles joue sa survie aprÃ¨s 613 jours",
    url: "https://dl.ouaisfi.eu/bxl-242/Bruxelles_joue_sa_survie_apr%C3%A8s_613_jours.m4a"
  },

  // â”€â”€ AJOUTE TES CONTENUS ICI â”€â”€
  // { title: "Mon briefing vidÃ©o", url: "https://www.youtube.com/watch?v=XXXXXXXXX" },
  // { title: "Podcast Ã©pisode 12", url: "https://dl.ouaisfi.eu/podcasts/ep12.mp3" },
  // { title: "Docu Vimeo", url: "https://vimeo.com/123456789" },
  // { title: "Mix SoundCloud", url: "https://soundcloud.com/artiste/mix" },
  // { title: "Embed custom", url: "<iframe src='https://exemple.com/player'></iframe>" },

];

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   Ã€ PARTIR D'ICI TU N'AS RIEN Ã€ TOUCHER
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

let queue = [];
let currentIdx = -1;
let metStart = null;
let isActive = false;
let waveBars = [];

const wC = document.getElementById('wBars');
for(let i=0;i<80;i++){const b=document.createElement('div');b.className='wb';wC.appendChild(b);waveBars.push(b)}

// â”€â”€ Auto-detect media type â”€â”€
function detect(input){
  input = input.trim();

  if(input.startsWith('<iframe')||input.startsWith('<embed')||input.startsWith('<object'))
    return{type:'embed',html:input,label:'CUSTOM EMBED',source:'HTML',icon:'âš¡'};

  let m=input.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([\w-]+)/);
  if(m) return{type:'iframe',url:`https://www.youtube.com/embed/${m[1]}?autoplay=1&rel=0`,label:`YT::${m[1]}`,source:'YouTube',icon:'â–¶'};

  m=input.match(/vimeo\.com\/(\d+)/);
  if(m) return{type:'iframe',url:`https://player.vimeo.com/video/${m[1]}?autoplay=1`,label:`VIM::${m[1]}`,source:'Vimeo',icon:'â–¶'};

  m=input.match(/dailymotion\.com\/video\/([\w]+)/);
  if(m) return{type:'iframe',url:`https://www.dailymotion.com/embed/video/${m[1]}?autoplay=1`,label:`DM::${m[1]}`,source:'Dailymotion',icon:'â–¶'};

  if(input.includes('soundcloud.com'))
    return{type:'iframe',url:`https://w.soundcloud.com/player/?url=${encodeURIComponent(input)}&auto_play=true&color=%2300e5ff`,label:'SOUNDCLOUD',source:'SoundCloud',icon:'â™«',audio:true};

  m=input.match(/open\.spotify\.com\/(track|album|playlist)\/([\w]+)/);
  if(m) return{type:'iframe',url:`https://open.spotify.com/embed/${m[1]}/${m[2]}`,label:`SPOTIFY::${m[1].toUpperCase()}`,source:'Spotify',icon:'â™«',audio:true};

  m=input.match(/(https?:\/\/[^/]+)\/(?:videos\/watch|w)\/([\w-]+)/);
  if(m) return{type:'iframe',url:`${m[1]}/videos/embed/${m[2]}?autoplay=1`,label:`PEER::${m[2].slice(0,8)}`,source:'PeerTube',icon:'âŠ•'};

  if(input.match(/\.(mp4|webm|ogv)(\?|$)/i))
    return{type:'video',url:input,label:decodeURIComponent(input.split('/').pop().split('?')[0]).slice(0,50),source:'VIDEO',icon:'â–¶'};

  if(input.match(/\.(mp3|m4a|ogg|wav|flac|aac)(\?|$)/i))
    return{type:'audio',url:input,label:decodeURIComponent(input.split('/').pop().split('?')[0]).slice(0,50),source:'AUDIO',icon:'â™«',audio:true};

  if(input.startsWith('http'))
    return{type:'iframe',url:input,label:input.slice(0,45),source:'URL',icon:'âŠ•'};

  return null;
}

// â”€â”€ Build queue from payload config â”€â”€
function initPayload(){
  MISSION_PAYLOAD.forEach((item,i)=>{
    const media = detect(item.url);
    if(media){
      media.raw = item.url;
      if(item.title) media.label = item.title;
      queue.push(media);
    }
  });
  renderQueue();
  if(queue.length > 0){
    currentIdx = 0;
    renderViewport(queue[0]);
  }
}

function renderViewport(media){
  const vp = document.getElementById('viewport');
  vp.classList.remove('audio-mode');
  if(media.audio) vp.classList.add('audio-mode');

  if(media.type==='embed') vp.innerHTML=media.html;
  else if(media.type==='iframe') vp.innerHTML=`<iframe src="${media.url}" allow="autoplay; encrypted-media; fullscreen; picture-in-picture" allowfullscreen loading="lazy"></iframe>`;
  else if(media.type==='video') vp.innerHTML=`<video src="${media.url}" controls autoplay></video>`;
  else if(media.type==='audio') vp.innerHTML=`<audio src="${media.url}" controls autoplay style="width:85%"></audio>`;

  document.getElementById('nowInfo').innerHTML=`sys:// <strong>${media.label}</strong> â€” ${media.source}`;
  document.getElementById('sFlux').textContent='STREAMING';
  document.getElementById('sFlux').className='val v-green';
  document.getElementById('sType').textContent=media.source.slice(0,10);
  document.getElementById('vpLabel').textContent=media.audio?'AUDIO FEED':'VIDEO FEED';
  document.getElementById('liveDot').classList.add('on');
  document.getElementById('wfLabel').textContent='ACTIVE';
  isActive=true;
  if(!metStart) metStart=Date.now();
}

function renderQueue(){
  const c=document.getElementById('qItems');
  const n=queue.length;
  document.getElementById('qCount').textContent=`${n} PAYLOAD${n!==1?'S':''}`;
  document.getElementById('sCount').textContent=`0x${n.toString(16).toUpperCase().padStart(2,'0')}`;

  if(n===0){c.innerHTML='<div class="q-empty">[ AUCUN PAYLOAD â€” CONFIGUREZ MISSION_PAYLOAD ]</div>';return}

  c.innerHTML=queue.map((item,i)=>`
    <div class="qi ${i===currentIdx?'active':''}" onclick="playIdx(${i})">
      <span class="qi-idx">${String(i+1).padStart(2,'0')}</span>
      <div class="qi-icon">${item.icon}</div>
      <div class="qi-info">
        <div class="qi-title">${item.label}</div>
        <div class="qi-src">${item.source}</div>
      </div>
      <button class="qi-rm" onclick="event.stopPropagation();removeIdx(${i})">âœ•</button>
    </div>
  `).join('');
}

function playIdx(i){currentIdx=i;renderViewport(queue[i]);renderQueue()}

function removeIdx(i){
  queue.splice(i,1);
  if(currentIdx>=queue.length) currentIdx=queue.length-1;
  if(queue.length===0){currentIdx=-1;resetVP()}
  renderQueue();
}

function resetVP(){
  const vp=document.getElementById('viewport');
  vp.classList.remove('audio-mode');
  vp.innerHTML=`<div class="vp-empty"><div class="corner tl"></div><div class="corner tr"></div><div class="corner bl"></div><div class="corner br"></div><div class="crosshair"></div><p>AWAITING SIGNAL ACQUISITION</p></div>`;
  document.getElementById('nowInfo').innerHTML='sys:// idle â€” aucun payload';
  document.getElementById('sFlux').textContent='STANDBY';document.getElementById('sFlux').className='val v-cyan';
  document.getElementById('sType').textContent='â€”';
  document.getElementById('vpLabel').textContent='AWAITING SIGNAL';
  document.getElementById('liveDot').classList.remove('on');
  document.getElementById('wfLabel').textContent='IDLE';
  isActive=false;
}

// â”€â”€ Add from input â”€â”€
function addFromInput(){
  const input=document.getElementById('mediaInput').value;
  if(!input.trim()) return;
  const media=detect(input);
  if(!media){alert('âš  FORMAT NON RECONNU');return}
  media.raw=input;
  queue.push(media);
  currentIdx=queue.length-1;
  renderViewport(media);
  renderQueue();
  document.getElementById('mediaInput').value='';
}

function toggleAdd(){
  document.getElementById('addToggle').classList.toggle('open');
  document.getElementById('addBody').classList.toggle('open');
}

// â”€â”€ Embed modal â”€â”€
function showEmbed(){
  if(currentIdx<0) return;
  const m=queue[currentIdx];let code='';
  if(m.type==='embed') code=m.html;
  else if(m.type==='iframe') code=`<iframe src="${m.url}" width="780" height="439" frameborder="0" allow="autoplay; encrypted-media; fullscreen" allowfullscreen></iframe>`;
  else if(m.type==='video') code=`<video src="${m.url}" width="780" controls></video>`;
  else if(m.type==='audio') code=`<audio src="${m.url}" controls></audio>`;
  document.getElementById('embedCode').value=code;
  document.getElementById('embedModal').classList.add('open');
}
function closeModal(){document.getElementById('embedModal').classList.remove('open')}
function copyEmbed(){
  const t=document.getElementById('embedCode');t.select();navigator.clipboard.writeText(t.value);
  document.querySelector('.m-btn-copy').textContent='COPIED âœ“';
  setTimeout(()=>document.querySelector('.m-btn-copy').textContent='COPY',1500);
}

document.getElementById('mediaInput').addEventListener('keydown',e=>{if(e.key==='Enter')addFromInput()});
document.getElementById('embedModal').addEventListener('click',e=>{if(e.target===document.getElementById('embedModal'))closeModal()});

// MET clock
setInterval(()=>{
  if(metStart){
    const s=Math.floor((Date.now()-metStart)/1000);
    document.getElementById('metClock').textContent=
      `${String(Math.floor(s/3600)).padStart(2,'0')}:${String(Math.floor((s%3600)/60)).padStart(2,'0')}:${String(s%60).padStart(2,'0')}`;
  }
},1000);

// Waveform
function animW(){
  waveBars.forEach(b=>{
    if(isActive){const h=3+Math.random()*32;b.style.height=h+'px';b.style.opacity=.3+Math.random()*.7;b.style.background=h>24?'var(--hud-green)':'var(--hud-cyan)'}
    else{b.style.height='3px';b.style.opacity='.2';b.style.background='var(--hud-cyan)'}
  });
  requestAnimationFrame(animW);
}
animW();

// â”€â”€ BOOT â”€â”€
initPayload();
</script>
</body>
</html>
