<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>150 Triplets Sémantiques · Résistance Citoyenne · ouaisfieu</title>
<meta name="description" content="150 triplets sémantiques structurant le champ de la résistance citoyenne — intelligence civique, contre-institution numérique, lawfare citoyen, éducation permanente.">
<meta name="keywords" content="triplets sémantiques, résistance citoyenne, intelligence citoyenne, ouaisfieu, contre-institution, particratie belge, éducation permanente, OSINT, lawfare">
<meta name="author" content="ouaisfieu · Contre-Institution Numérique">
<meta name="robots" content="index, follow">
<meta property="og:title" content="150 Triplets Sémantiques · Résistance Citoyenne">
<meta property="og:description" content="Cartographie sémantique de la résistance citoyenne en 150 triplets Sujet·Prédicat·Objet — ouaisfieu">
<meta property="og:type" content="article">
<link rel="canonical" href="https://ouaisfieu.github.io/triplets-resistance/">

<!-- Schema.org structured data -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Dataset",
  "name": "150 Triplets Sémantiques — Résistance Citoyenne",
  "description": "Cartographie sémantique structurée en 150 triplets Sujet·Prédicat·Objet couvrant le champ de la résistance citoyenne, l'intelligence civique et la contre-institution numérique en Belgique.",
  "creator": {
    "@type": "Organization",
    "name": "ouaisfieu",
    "url": "https://ouaisfi.eu"
  },
  "license": "https://creativecommons.org/licenses/by-nc/4.0/",
  "datePublished": "2026-02-14",
  "keywords": ["résistance citoyenne", "triplets sémantiques", "intelligence citoyenne", "particratie", "éducation permanente", "OSINT", "lawfare citoyen"],
  "inLanguage": "fr",
  "distribution": {
    "@type": "DataDownload",
    "encodingFormat": "application/json",
    "contentUrl": "triplets_resistance_150.json"
  }
}
</script>

<style>
/* ═══════════════════════════════════════════════════
   OUAISFIEU · RÉSISTANCE SÉMANTIQUE · STYLE SYSTEM
   CRT Terminal × Data Visualization × Retro-Futurism
   ═══════════════════════════════════════════════════ */

@import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700&family=Space+Grotesk:wght@300;400;500;600;700&family=Instrument+Serif:ital@0;1&display=swap');

:root {
  --green: #48bb78;
  --green-dim: #48bb7833;
  --green-glow: #48bb7866;
  --lilac: #9f7aea;
  --lilac-dim: #9f7aea33;
  --lilac-glow: #9f7aea55;
  --red: #fc8181;
  --amber: #f6ad55;
  --cyan: #63b3ed;
  --bg-0: #0a0a0f;
  --bg-1: #10101a;
  --bg-2: #181825;
  --bg-3: #1e1e30;
  --bg-card: #12121f;
  --text-0: #e2e8f0;
  --text-1: #a0aec0;
  --text-2: #718096;
  --border: #2d2d44;
  --mono: 'JetBrains Mono', monospace;
  --sans: 'Space Grotesk', sans-serif;
  --serif: 'Instrument Serif', serif;
}

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

html {
  scroll-behavior: smooth;
  scrollbar-width: thin;
  scrollbar-color: var(--green-dim) var(--bg-1);
}

body {
  font-family: var(--sans);
  background: var(--bg-0);
  color: var(--text-0);
  min-height: 100vh;
  overflow-x: hidden;
  -webkit-font-smoothing: antialiased;
}

/* CRT scanlines overlay */
body::after {
  content: '';
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 9999;
  background: repeating-linear-gradient(
    0deg,
    transparent,
    transparent 2px,
    rgba(0,0,0,0.03) 2px,
    rgba(0,0,0,0.03) 4px
  );
}

/* CRT vignette */
body::before {
  content: '';
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 9998;
  background: radial-gradient(ellipse at center, transparent 60%, rgba(0,0,0,0.4) 100%);
}

::selection {
  background: var(--green);
  color: var(--bg-0);
}

/* ─── HEADER / HERO ─── */
.hero {
  position: relative;
  padding: 3rem 2rem 2rem;
  border-bottom: 1px solid var(--border);
  overflow: hidden;
}

.hero::before {
  content: '';
  position: absolute;
  top: -50%;
  left: -20%;
  width: 140%;
  height: 200%;
  background:
    radial-gradient(ellipse at 20% 50%, var(--green-dim) 0%, transparent 50%),
    radial-gradient(ellipse at 80% 30%, var(--lilac-dim) 0%, transparent 50%);
  pointer-events: none;
  animation: nebula 20s ease-in-out infinite alternate;
}

@keyframes nebula {
  0% { transform: translate(0, 0) scale(1); }
  100% { transform: translate(-5%, 3%) scale(1.05); }
}

.hero-inner {
  position: relative;
  max-width: 1200px;
  margin: 0 auto;
}

.hero-tag {
  font-family: var(--mono);
  font-size: 0.7rem;
  letter-spacing: 0.15em;
  text-transform: uppercase;
  color: var(--green);
  margin-bottom: 1rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.hero-tag::before {
  content: '●';
  animation: pulse-dot 2s ease-in-out infinite;
}

@keyframes pulse-dot {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.3; }
}

.hero h1 {
  font-family: var(--serif);
  font-size: clamp(2.2rem, 5vw, 3.8rem);
  font-weight: 400;
  font-style: italic;
  line-height: 1.1;
  margin-bottom: 0.5rem;
  background: linear-gradient(135deg, var(--text-0) 0%, var(--green) 50%, var(--lilac) 100%);
  background-size: 200% 200%;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  animation: gradient-shift 8s ease-in-out infinite alternate;
}

@keyframes gradient-shift {
  0% { background-position: 0% 50%; }
  100% { background-position: 100% 50%; }
}

.hero h1 span {
  font-family: var(--mono);
  font-style: normal;
  font-size: 0.45em;
  font-weight: 700;
  -webkit-text-fill-color: var(--green);
  vertical-align: super;
  margin-left: 0.3em;
}

.hero-sub {
  font-family: var(--mono);
  font-size: 0.85rem;
  color: var(--text-2);
  margin-bottom: 1.5rem;
  letter-spacing: 0.02em;
}

.hero-sub em { color: var(--lilac); font-style: normal; }

.hero-stats {
  display: flex;
  gap: 2rem;
  flex-wrap: wrap;
}

.stat {
  display: flex;
  flex-direction: column;
}

.stat-value {
  font-family: var(--mono);
  font-size: 1.8rem;
  font-weight: 700;
  color: var(--green);
  line-height: 1;
  text-shadow: 0 0 20px var(--green-glow);
}

.stat-value.lilac { color: var(--lilac); text-shadow: 0 0 20px var(--lilac-glow); }

.stat-label {
  font-family: var(--mono);
  font-size: 0.65rem;
  text-transform: uppercase;
  letter-spacing: 0.1em;
  color: var(--text-2);
  margin-top: 0.25rem;
}

/* ─── CONTROLS BAR ─── */
.controls {
  position: sticky;
  top: 0;
  z-index: 100;
  background: var(--bg-1);
  border-bottom: 1px solid var(--border);
  padding: 0.75rem 2rem;
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
}

.controls-inner {
  max-width: 1200px;
  margin: 0 auto;
  display: flex;
  gap: 1rem;
  align-items: center;
  flex-wrap: wrap;
}

.search-box {
  flex: 1;
  min-width: 200px;
  position: relative;
}

.search-box input {
  width: 100%;
  background: var(--bg-2);
  border: 1px solid var(--border);
  border-radius: 4px;
  padding: 0.5rem 0.75rem 0.5rem 2rem;
  font-family: var(--mono);
  font-size: 0.8rem;
  color: var(--text-0);
  outline: none;
  transition: border-color 0.3s, box-shadow 0.3s;
}

.search-box input:focus {
  border-color: var(--green);
  box-shadow: 0 0 0 3px var(--green-dim);
}

.search-box input::placeholder { color: var(--text-2); }

.search-box::before {
  content: '⌕';
  position: absolute;
  left: 0.65rem;
  top: 50%;
  transform: translateY(-50%);
  color: var(--text-2);
  font-size: 0.9rem;
  pointer-events: none;
}

.view-toggles {
  display: flex;
  gap: 0;
  border: 1px solid var(--border);
  border-radius: 4px;
  overflow: hidden;
}

.view-btn {
  background: var(--bg-2);
  border: none;
  color: var(--text-2);
  font-family: var(--mono);
  font-size: 0.7rem;
  padding: 0.5rem 0.75rem;
  cursor: pointer;
  transition: all 0.2s;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  border-right: 1px solid var(--border);
}

.view-btn:last-child { border-right: none; }
.view-btn:hover { color: var(--text-0); background: var(--bg-3); }
.view-btn.active { background: var(--green); color: var(--bg-0); }

.counter {
  font-family: var(--mono);
  font-size: 0.75rem;
  color: var(--text-2);
  white-space: nowrap;
}

.counter b { color: var(--green); font-weight: 600; }

/* ─── CLUSTER NAV ─── */
.cluster-nav {
  max-width: 1200px;
  margin: 0 auto;
  padding: 1rem 2rem;
  display: flex;
  gap: 0.5rem;
  flex-wrap: wrap;
}

.cluster-pill {
  font-family: var(--mono);
  font-size: 0.65rem;
  padding: 0.35rem 0.75rem;
  border-radius: 20px;
  border: 1px solid var(--border);
  background: var(--bg-2);
  color: var(--text-2);
  cursor: pointer;
  transition: all 0.25s;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  user-select: none;
}

.cluster-pill:hover {
  border-color: var(--green);
  color: var(--green);
  background: var(--green-dim);
}

.cluster-pill.active {
  border-color: var(--green);
  background: var(--green);
  color: var(--bg-0);
  box-shadow: 0 0 12px var(--green-dim);
}

.cluster-pill[data-cluster="all"].active {
  background: var(--lilac);
  border-color: var(--lilac);
  box-shadow: 0 0 12px var(--lilac-dim);
}

/* ─── MAIN GRID ─── */
.main {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 2rem 4rem;
}

/* ─── CARD VIEW ─── */
.grid-view {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
  gap: 1px;
  background: var(--border);
  border: 1px solid var(--border);
  border-radius: 6px;
  overflow: hidden;
}

.triplet-card {
  background: var(--bg-card);
  padding: 1.25rem;
  position: relative;
  transition: all 0.3s ease;
  animation: card-in 0.4s ease backwards;
  cursor: default;
  overflow: hidden;
}

.triplet-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 3px;
  height: 100%;
  background: var(--green);
  opacity: 0;
  transition: opacity 0.3s;
}

.triplet-card:hover {
  background: var(--bg-2);
}

.triplet-card:hover::before { opacity: 1; }

@keyframes card-in {
  from { opacity: 0; transform: translateY(8px); }
  to { opacity: 1; transform: translateY(0); }
}

.card-id {
  font-family: var(--mono);
  font-size: 0.6rem;
  color: var(--text-2);
  position: absolute;
  top: 0.75rem;
  right: 0.75rem;
  opacity: 0.4;
}

.card-cluster {
  font-family: var(--mono);
  font-size: 0.55rem;
  text-transform: uppercase;
  letter-spacing: 0.1em;
  color: var(--lilac);
  margin-bottom: 0.75rem;
  padding-bottom: 0.5rem;
  border-bottom: 1px solid var(--border);
}

.triplet-flow {
  display: flex;
  flex-direction: column;
  gap: 0.4rem;
}

.triplet-subject {
  font-family: var(--sans);
  font-weight: 600;
  font-size: 0.95rem;
  color: var(--green);
  line-height: 1.3;
}

.triplet-predicate {
  font-family: var(--mono);
  font-size: 0.75rem;
  color: var(--amber);
  padding-left: 1rem;
  position: relative;
}

.triplet-predicate::before {
  content: '→';
  position: absolute;
  left: 0;
  color: var(--text-2);
}

.triplet-object {
  font-family: var(--sans);
  font-weight: 400;
  font-size: 0.9rem;
  color: var(--text-0);
  padding-left: 1rem;
  line-height: 1.4;
}

/* ─── TABLE VIEW ─── */
.table-view {
  display: none;
  width: 100%;
  border-collapse: collapse;
  border: 1px solid var(--border);
  border-radius: 6px;
  overflow: hidden;
}

.table-view thead {
  background: var(--bg-2);
}

.table-view th {
  font-family: var(--mono);
  font-size: 0.65rem;
  text-transform: uppercase;
  letter-spacing: 0.1em;
  color: var(--text-2);
  padding: 0.75rem 1rem;
  text-align: left;
  border-bottom: 1px solid var(--border);
  position: sticky;
  top: 52px;
  background: var(--bg-2);
  z-index: 10;
}

.table-view td {
  padding: 0.6rem 1rem;
  border-bottom: 1px solid var(--border);
  font-size: 0.85rem;
  vertical-align: top;
}

.table-view tr {
  background: var(--bg-card);
  transition: background 0.2s;
}

.table-view tbody tr:hover { background: var(--bg-2); }

.table-view .col-id {
  font-family: var(--mono);
  font-size: 0.7rem;
  color: var(--text-2);
  width: 50px;
}

.table-view .col-cluster {
  font-family: var(--mono);
  font-size: 0.65rem;
  color: var(--lilac);
  width: 60px;
}

.table-view .col-subject { color: var(--green); font-weight: 600; }
.table-view .col-predicate { color: var(--amber); font-family: var(--mono); font-size: 0.8rem; }
.table-view .col-object { color: var(--text-0); }

/* ─── GRAPH VIEW ─── */
.graph-view {
  display: none;
  position: relative;
  width: 100%;
  height: 70vh;
  min-height: 500px;
  border: 1px solid var(--border);
  border-radius: 6px;
  background: var(--bg-card);
  overflow: hidden;
}

.graph-canvas {
  width: 100%;
  height: 100%;
}

.graph-legend {
  position: absolute;
  bottom: 1rem;
  left: 1rem;
  background: var(--bg-1);
  border: 1px solid var(--border);
  border-radius: 4px;
  padding: 0.75rem 1rem;
  font-family: var(--mono);
  font-size: 0.65rem;
  color: var(--text-2);
  display: flex;
  flex-direction: column;
  gap: 0.3rem;
}

.graph-legend-item {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.graph-legend-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
}

/* ─── CLUSTER SECTION HEADERS ─── */
.cluster-header {
  grid-column: 1 / -1;
  background: var(--bg-2) !important;
  padding: 1rem 1.25rem !important;
  display: flex;
  align-items: center;
  gap: 1rem;
  border-bottom: 2px solid var(--green) !important;
}

.cluster-header .ch-id {
  font-family: var(--mono);
  font-size: 0.65rem;
  color: var(--bg-0);
  background: var(--green);
  padding: 0.2rem 0.5rem;
  border-radius: 3px;
  font-weight: 700;
}

.cluster-header .ch-name {
  font-family: var(--sans);
  font-size: 1rem;
  font-weight: 600;
  color: var(--text-0);
}

.cluster-header .ch-count {
  font-family: var(--mono);
  font-size: 0.7rem;
  color: var(--text-2);
  margin-left: auto;
}

/* ─── FOOTER ─── */
.footer {
  max-width: 1200px;
  margin: 0 auto;
  padding: 2rem;
  border-top: 1px solid var(--border);
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap;
  gap: 1rem;
}

.footer-left {
  font-family: var(--mono);
  font-size: 0.7rem;
  color: var(--text-2);
}

.footer-left a {
  color: var(--green);
  text-decoration: none;
}

.footer-left a:hover { text-decoration: underline; }

.footer-right {
  display: flex;
  gap: 0.75rem;
}

.footer-btn {
  font-family: var(--mono);
  font-size: 0.65rem;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  padding: 0.4rem 0.75rem;
  border: 1px solid var(--border);
  border-radius: 4px;
  background: var(--bg-2);
  color: var(--text-2);
  cursor: pointer;
  transition: all 0.2s;
  text-decoration: none;
}

.footer-btn:hover {
  border-color: var(--green);
  color: var(--green);
  background: var(--green-dim);
}

/* ─── RESPONSIVE ─── */
@media (max-width: 768px) {
  .hero { padding: 2rem 1rem 1.5rem; }
  .controls { padding: 0.75rem 1rem; }
  .cluster-nav { padding: 0.75rem 1rem; }
  .main { padding: 0 1rem 3rem; }
  .grid-view { grid-template-columns: 1fr; }
  .hero-stats { gap: 1.5rem; }
  .controls-inner { gap: 0.5rem; }
  .footer { padding: 1.5rem 1rem; }
}

/* ─── UTILITIES ─── */
.hidden { display: none !important; }

.no-results {
  grid-column: 1 / -1;
  text-align: center;
  padding: 4rem 2rem;
  color: var(--text-2);
  font-family: var(--mono);
  font-size: 0.9rem;
}

.no-results span { color: var(--red); }

/* ─── GLOW ACCENTS ─── */
.glow-line {
  height: 1px;
  background: linear-gradient(90deg, transparent, var(--green), var(--lilac), transparent);
  margin: 0;
  opacity: 0.5;
}

/* ─── PRINT ─── */
@media print {
  body::before, body::after { display: none; }
  .controls, .cluster-nav, .footer-right, .graph-view { display: none !important; }
  .grid-view { display: grid !important; }
  .triplet-card { break-inside: avoid; }
  body { background: #fff; color: #000; }
  .triplet-subject { color: #2d6a4f; }
  .triplet-predicate { color: #6c584c; }
  .card-cluster { color: #7b2cbf; }
}
</style>
</head>
<body>

<!-- ═══ HERO ═══ -->
<header class="hero">
  <div class="hero-inner">
    <div class="hero-tag">ouaisfieu · contre-institution numérique · dataset sémantique</div>
    <h1>Résistance Citoyenne<span>150</span></h1>
    <p class="hero-sub">Cartographie sémantique en triplets <em>Sujet · Prédicat · Objet</em> — balisage knowledge graph, Schema.org, SEO/GEO</p>
    <div class="hero-stats">
      <div class="stat">
        <div class="stat-value">150</div>
        <div class="stat-label">Triplets</div>
      </div>
      <div class="stat">
        <div class="stat-value lilac">10</div>
        <div class="stat-label">Clusters</div>
      </div>
      <div class="stat">
        <div class="stat-value">47</div>
        <div class="stat-label">Prédicats uniques</div>
      </div>
      <div class="stat">
        <div class="stat-value lilac">∞</div>
        <div class="stat-label">Connexions</div>
      </div>
    </div>
  </div>
</header>

<div class="glow-line"></div>

<!-- ═══ CONTROLS ═══ -->
<nav class="controls">
  <div class="controls-inner">
    <div class="search-box">
      <input type="text" id="searchInput" placeholder="Rechercher un sujet, prédicat, objet…" autocomplete="off">
    </div>
    <div class="view-toggles">
      <button class="view-btn active" data-view="grid" title="Vue cartes">▦ Cartes</button>
      <button class="view-btn" data-view="table" title="Vue tableau">☰ Table</button>
      <button class="view-btn" data-view="graph" title="Vue graphe">◉ Graphe</button>
    </div>
    <div class="counter"><b id="visibleCount">150</b> / 150</div>
  </div>
</nav>

<!-- ═══ CLUSTER NAV ═══ -->
<div class="cluster-nav" id="clusterNav"></div>

<!-- ═══ CONTENT ═══ -->
<main class="main">
  <div class="grid-view" id="gridView"></div>
  <table class="table-view" id="tableView">
    <thead>
      <tr>
        <th>#</th>
        <th>Cluster</th>
        <th>Sujet</th>
        <th>Prédicat</th>
        <th>Objet</th>
      </tr>
    </thead>
    <tbody id="tableBody"></tbody>
  </table>
  <div class="graph-view" id="graphView">
    <canvas class="graph-canvas" id="graphCanvas"></canvas>
    <div class="graph-legend" id="graphLegend"></div>
  </div>
</main>

<!-- ═══ FOOTER ═══ -->
<footer class="footer">
  <div class="footer-left">
    CC BY-NC 4.0 · <a href="https://ouaisfi.eu" target="_blank" rel="noopener">ouaisfi.eu</a> · 2026-02-14 · Pyramide DICS · Fork·Hack·Spread
  </div>
  <div class="footer-right">
    <button class="footer-btn" id="btnExportJSON" title="Télécharger le JSON">↓ JSON</button>
    <button class="footer-btn" id="btnExportCSV" title="Télécharger en CSV">↓ CSV</button>
    <button class="footer-btn" onclick="window.print()" title="Imprimer">⎙ Print</button>
  </div>
</footer>

<script>
// ═══════════════════════════════════════════════════
// DATA · 150 TRIPLETS SÉMANTIQUES · RÉSISTANCE
// ═══════════════════════════════════════════════════

const CLUSTERS = [
  { id: "C01", nom: "Résistance démocratique & pouvoir citoyen", color: "#48bb78" },
  { id: "C02", nom: "Particratie & dysfonctionnements belges", color: "#fc8181" },
  { id: "C03", nom: "Intelligence citoyenne & OSINT", color: "#63b3ed" },
  { id: "C04", nom: "Éducation permanente & émancipation", color: "#f6ad55" },
  { id: "C05", nom: "Droits sociaux & résistance à l'austérité", color: "#fc8181" },
  { id: "C06", nom: "Contre-institution numérique & infrastructure", color: "#9f7aea" },
  { id: "C07", nom: "Médias, désinformation & guerre narrative", color: "#f687b3" },
  { id: "C08", nom: "Stratégie juridique & lawfare citoyen", color: "#68d391" },
  { id: "C09", nom: "Trois guerres civiques & doctrine stratégique", color: "#fbb6ce" },
  { id: "C10", nom: "Collaboration humain-IA & résistance augmentée", color: "#b794f4" }
];

const TRIPLETS = [
  // C01 — Résistance démocratique & pouvoir citoyen
  {id:1,c:"C01",s:"résistance citoyenne",p:"renforce",o:"démocratie participative"},
  {id:2,c:"C01",s:"citoyen informé",p:"exerce",o:"contre-pouvoir démocratique"},
  {id:3,c:"C01",s:"résistance civique",p:"s'oppose à",o:"recul démocratique"},
  {id:4,c:"C01",s:"pouvoir d'agir citoyen",p:"est menacé par",o:"dépossession institutionnelle"},
  {id:5,c:"C01",s:"mobilisation citoyenne",p:"transforme",o:"indignation en action"},
  {id:6,c:"C01",s:"désobéissance civile",p:"constitue",o:"droit fondamental démocratique"},
  {id:7,c:"C01",s:"contre-démocratie",p:"théorisée par",o:"Pierre Rosanvallon"},
  {id:8,c:"C01",s:"résistance non-violente",p:"utilise",o:"outils juridiques et numériques"},
  {id:9,c:"C01",s:"autodétermination politique",p:"nécessite",o:"accès à l'information"},
  {id:10,c:"C01",s:"souveraineté citoyenne",p:"est limitée par",o:"particratie belge"},
  {id:11,c:"C01",s:"résistance démocratique",p:"passe par",o:"éducation permanente"},
  {id:12,c:"C01",s:"engagement citoyen",p:"requiert",o:"capacité d'analyse critique"},
  {id:13,c:"C01",s:"reconquête démocratique",p:"s'appuie sur",o:"infrastructure citoyenne alternative"},
  {id:14,c:"C01",s:"résistance institutionnelle",p:"combine",o:"droit, numérique et éducation"},
  {id:15,c:"C01",s:"citoyenneté active",p:"dépasse",o:"participation électorale"},
  // C02 — Particratie & dysfonctionnements belges
  {id:16,c:"C02",s:"particratie belge",p:"confisque",o:"souveraineté populaire"},
  {id:17,c:"C02",s:"discipline de parti",p:"neutralise",o:"mandat parlementaire libre"},
  {id:18,c:"C02",s:"pilarisation",p:"structure",o:"verrouillage institutionnel belge"},
  {id:19,c:"C02",s:"lasagne institutionnelle",p:"génère",o:"opacité décisionnelle"},
  {id:20,c:"C02",s:"Belgique",p:"accumule",o:"9 000 décisions de justice non exécutées"},
  {id:21,c:"C02",s:"coalition Arizona",p:"impose",o:"austérité sociale régressive"},
  {id:22,c:"C02",s:"formation gouvernementale",p:"a duré",o:"613 jours sans gouvernement"},
  {id:23,c:"C02",s:"système politique belge",p:"fonctionne comme",o:"dystopie douce"},
  {id:24,c:"C02",s:"parlementaires belges",p:"votent selon",o:"consignes de parti"},
  {id:25,c:"C02",s:"déficit démocratique belge",p:"se manifeste par",o:"absence de référendum contraignant"},
  {id:26,c:"C02",s:"État belge",p:"viole systématiquement",o:"État de droit"},
  {id:27,c:"C02",s:"résistance à la particratie",p:"nécessite",o:"transparence institutionnelle"},
  {id:28,c:"C02",s:"complexité institutionnelle",p:"sert de",o:"paravent à l'irresponsabilité politique"},
  {id:29,c:"C02",s:"système consociatif",p:"empêche",o:"renouvellement démocratique"},
  {id:30,c:"C02",s:"crise de représentation",p:"alimente",o:"abstention et populisme"},
  // C03 — Intelligence citoyenne & OSINT
  {id:31,c:"C03",s:"intelligence citoyenne",p:"transpose",o:"intelligence économique à la société civile"},
  {id:32,c:"C03",s:"OSINT citoyen",p:"permet",o:"contre-enquêtes indépendantes"},
  {id:33,c:"C03",s:"veille citoyenne",p:"surveille",o:"décisions politiques et budgétaires"},
  {id:34,c:"C03",s:"pyramide DICS",p:"transforme",o:"données brutes en sagesse citoyenne"},
  {id:35,c:"C03",s:"renseignement ouvert",p:"utilise",o:"sources publiques vérifiables"},
  {id:36,c:"C03",s:"Bellingcat",p:"prouve",o:"efficacité de l'investigation citoyenne"},
  {id:37,c:"C03",s:"fact-checking citoyen",p:"combat",o:"désinformation politique"},
  {id:38,c:"C03",s:"open data",p:"alimente",o:"capacité d'analyse citoyenne"},
  {id:39,c:"C03",s:"intelligence collective",p:"décuple",o:"capacité d'investigation"},
  {id:40,c:"C03",s:"lead-dexing",p:"documente",o:"actions des décideurs publics"},
  {id:41,c:"C03",s:"veille stratégique citoyenne",p:"anticipe",o:"menaces sur les droits sociaux"},
  {id:42,c:"C03",s:"contre-narratif citoyen",p:"déconstruit",o:"propagande institutionnelle"},
  {id:43,c:"C03",s:"données publiques",p:"fondent",o:"argumentaire citoyen vérifiable"},
  {id:44,c:"C03",s:"intelligence non marchande",p:"produit",o:"effets juridiques et politiques tangibles"},
  {id:45,c:"C03",s:"cycle du renseignement citoyen",p:"structure",o:"collecte, analyse, diffusion"},
  // C04 — Éducation permanente & émancipation
  {id:46,c:"C04",s:"éducation permanente",p:"développe",o:"esprit critique citoyen"},
  {id:47,c:"C04",s:"méthodologie VPA",p:"structure",o:"parcours Voir-Penser-Agir"},
  {id:48,c:"C04",s:"éducation populaire",p:"part de",o:"réalités vécues des participants"},
  {id:49,c:"C04",s:"émancipation citoyenne",p:"passe par",o:"appropriation des outils d'analyse"},
  {id:50,c:"C04",s:"décret 2003 FWB",p:"encadre",o:"reconnaissance en éducation permanente"},
  {id:51,c:"C04",s:"atelier-débat citoyen",p:"transforme",o:"spectateur en acteur politique"},
  {id:52,c:"C04",s:"co-construction",p:"garantit",o:"pertinence de l'action éducative"},
  {id:53,c:"C04",s:"alphabétisation politique",p:"combat",o:"impuissance apprise"},
  {id:54,c:"C04",s:"parcours d'émancipation",p:"progresse de",o:"Observer à Documenter à S'Outiller à Agir"},
  {id:55,c:"C04",s:"formation citoyenne",p:"renforce",o:"autonomie de jugement"},
  {id:56,c:"C04",s:"pédagogie critique",p:"s'inspire de",o:"Paulo Freire"},
  {id:57,c:"C04",s:"éducation aux médias",p:"est un pilier de",o:"résistance informationnelle"},
  {id:58,c:"C04",s:"conscientisation",p:"précède",o:"mobilisation effective"},
  {id:59,c:"C04",s:"savoirs citoyens",p:"complètent",o:"expertise institutionnelle"},
  {id:60,c:"C04",s:"empowerment citoyen",p:"nécessite",o:"accès aux données et aux outils"},
  // C05 — Droits sociaux & résistance à l'austérité
  {id:61,c:"C05",s:"article 23 Constitution belge",p:"garantit",o:"droits économiques et sociaux"},
  {id:62,c:"C05",s:"principe de standstill",p:"interdit",o:"régression des droits acquis"},
  {id:63,c:"C05",s:"budget Arizona",p:"organise",o:"démantèlement de la sécurité sociale"},
  {id:64,c:"C05",s:"chômeurs",p:"sont soumis à",o:"contrôle et surveillance croissants"},
  {id:65,c:"C05",s:"malades longue durée",p:"subissent",o:"politique de pression et de culpabilisation"},
  {id:66,c:"C05",s:"21 milliards d'euros annuels",p:"sont dépensés en",o:"inactivité forcée en Belgique"},
  {id:67,c:"C05",s:"profilage algorithmique",p:"menace",o:"droits des demandeurs d'emploi"},
  {id:68,c:"C05",s:"CPAS",p:"constitue",o:"dernier filet social municipal"},
  {id:69,c:"C05",s:"résistance sociale",p:"s'appuie sur",o:"arsenal juridique constitutionnel"},
  {id:70,c:"C05",s:"grève générale 2025",p:"démontre",o:"capacité de mobilisation massive"},
  {id:71,c:"C05",s:"140 000 manifestants",p:"protestent contre",o:"mesures d'austérité Arizona"},
  {id:72,c:"C05",s:"fracture numérique",p:"exclut",o:"40% de citoyens vulnérables"},
  {id:73,c:"C05",s:"digitalisation des services publics",p:"aggrave",o:"exclusion des plus précaires"},
  {id:74,c:"C05",s:"Comité européen des droits sociaux",p:"examine",o:"plaintes contre régressions belges"},
  {id:75,c:"C05",s:"modèle social belge",p:"est menacé par",o:"logique d'austérité structurelle"},
  // C06 — Contre-institution numérique & infrastructure
  {id:76,c:"C06",s:"contre-institution numérique",p:"construit",o:"alternative aux circuits institutionnels"},
  {id:77,c:"C06",s:"sites statiques",p:"garantissent",o:"résilience et souveraineté technique"},
  {id:78,c:"C06",s:"zéro traçage",p:"protège",o:"vie privée des utilisateurs"},
  {id:79,c:"C06",s:"GitHub Pages",p:"héberge",o:"infrastructure citoyenne gratuite"},
  {id:80,c:"C06",s:"Jamstack",p:"permet",o:"sites performants sans serveur dynamique"},
  {id:81,c:"C06",s:"Creative Commons",p:"assure",o:"partage libre des productions citoyennes"},
  {id:82,c:"C06",s:"Fork·Hack·Spread",p:"encourage",o:"réplication de l'infrastructure"},
  {id:83,c:"C06",s:"low-tech numérique",p:"réduit",o:"dépendance aux plateformes commerciales"},
  {id:84,c:"C06",s:"forkabilité",p:"garantit",o:"continuité du projet au-delà du fondateur"},
  {id:85,c:"C06",s:"29€ par mois",p:"prouve",o:"viabilité de la résistance à coût minimal"},
  {id:86,c:"C06",s:"ouaisfieu",p:"incarne",o:"modèle de contre-institution citoyenne"},
  {id:87,c:"C06",s:"archipel numérique citoyen",p:"fédère",o:"plateformes thématiques spécialisées"},
  {id:88,c:"C06",s:"infrastructure open source",p:"refuse",o:"capitalisme de surveillance"},
  {id:89,c:"C06",s:"indépendance radicale",p:"interdit",o:"publicité et sponsors commerciaux"},
  {id:90,c:"C06",s:"souveraineté numérique citoyenne",p:"est un acte de",o:"résistance politique"},
  // C07 — Médias, désinformation & guerre narrative
  {id:91,c:"C07",s:"guerre narrative",p:"vise à",o:"contrôler le cadrage du débat public"},
  {id:92,c:"C07",s:"affaire Deborsu",p:"illustre",o:"instrumentalisation médiatique des précarisés"},
  {id:93,c:"C07",s:"documentaire Tous Fraudeurs",p:"conditionne",o:"opinion publique avant coupes sociales"},
  {id:94,c:"C07",s:"contre-récit citoyen",p:"déconstruit",o:"cadrage médiatique dominant"},
  {id:95,c:"C07",s:"résistance informationnelle",p:"utilise",o:"sources primaires vérifiables"},
  {id:96,c:"C07",s:"fabrique du consentement",p:"théorisée par",o:"Noam Chomsky"},
  {id:97,c:"C07",s:"propagande d'austérité",p:"désigne",o:"bénéficiaires sociaux comme boucs émissaires"},
  {id:98,c:"C07",s:"ennemi intérieur",p:"est fabriqué par",o:"discours sécuritaire médiatique"},
  {id:99,c:"C07",s:"vérification de l'information",p:"est un acte de",o:"résistance démocratique"},
  {id:100,c:"C07",s:"éducation aux médias",p:"immunise contre",o:"manipulation narrative"},
  {id:101,c:"C07",s:"OSINT",p:"fournit",o:"outils de contre-enquête citoyenne"},
  {id:102,c:"C07",s:"transparence médiatique",p:"exige",o:"déclaration des conflits d'intérêts"},
  {id:103,c:"C07",s:"Fediverse",p:"offre",o:"espace décentralisé de débat citoyen"},
  {id:104,c:"C07",s:"Bluesky",p:"permet",o:"communication sans capitalisme de surveillance"},
  {id:105,c:"C07",s:"de-sideration citoyenne",p:"combat",o:"sidération face aux crises"},
  // C08 — Stratégie juridique & lawfare citoyen
  {id:106,c:"C08",s:"lawfare citoyen",p:"retourne",o:"armes juridiques contre le pouvoir"},
  {id:107,c:"C08",s:"saturation judiciaire",p:"constitue",o:"stratégie de pression institutionnelle"},
  {id:108,c:"C08",s:"recours constitutionnel",p:"conteste",o:"réformes régressives"},
  {id:109,c:"C08",s:"Cour constitutionnelle",p:"peut annuler",o:"lois violant les droits fondamentaux"},
  {id:110,c:"C08",s:"CEDH",p:"sanctionne",o:"violations des droits par les États"},
  {id:111,c:"C08",s:"contentieux stratégique",p:"crée",o:"jurisprudence favorable aux citoyens"},
  {id:112,c:"C08",s:"plainte collective",p:"amplifie",o:"voix individuelle en force juridique"},
  {id:113,c:"C08",s:"lobbying citoyen",p:"influence",o:"processus législatif par le bas"},
  {id:114,c:"C08",s:"droit de pétition",p:"est un outil de",o:"résistance institutionnelle"},
  {id:115,c:"C08",s:"tribunal d'opinion",p:"expose",o:"violations systémiques ignorées"},
  {id:116,c:"C08",s:"arsenal juridique citoyen",p:"inclut",o:"recours administratifs, constitutionnels et européens"},
  {id:117,c:"C08",s:"non-exécution des arrêts",p:"constitue",o:"violation de l'État de droit"},
  {id:118,c:"C08",s:"pression municipale CPAS",p:"cible",o:"maillon faible de la chaîne institutionnelle"},
  {id:119,c:"C08",s:"droit à la résistance",p:"est fondé sur",o:"tradition constitutionnelle européenne"},
  {id:120,c:"C08",s:"documentation juridique citoyenne",p:"prépare",o:"preuves recevables par les tribunaux"},
  // C09 — Trois guerres civiques & doctrine stratégique
  {id:121,c:"C09",s:"trois guerres civiques",p:"adaptent",o:"doctrine chinoise des trois guerres"},
  {id:122,c:"C09",s:"guerre de l'opinion",p:"contrôle",o:"récits et signification politique"},
  {id:123,c:"C09",s:"guerre psychologique citoyenne",p:"brise",o:"résignation et fatalisme"},
  {id:124,c:"C09",s:"guerre du droit",p:"utilise",o:"contentieux stratégique et lobbying"},
  {id:125,c:"C09",s:"résistance stratégique",p:"remplace",o:"protestation spontanée inefficace"},
  {id:126,c:"C09",s:"documentation systématique",p:"est la base de",o:"toute stratégie de résistance"},
  {id:127,c:"C09",s:"approche non combative",p:"privilégie",o:"pression institutionnelle méthodique"},
  {id:128,c:"C09",s:"résilience citoyenne",p:"résiste à",o:"usure et découragement"},
  {id:129,c:"C09",s:"stratégie du faible au fort",p:"exploite",o:"asymétrie informationnelle"},
  {id:130,c:"C09",s:"pensée stratégique citoyenne",p:"planifie",o:"actions à court, moyen et long terme"},
  {id:131,c:"C09",s:"cartographie des pouvoirs",p:"identifie",o:"cibles, alliés et adversaires"},
  {id:132,c:"C09",s:"théorie du changement",p:"relie",o:"actions locales à impact systémique"},
  {id:133,c:"C09",s:"analyse SWOT citoyenne",p:"évalue",o:"forces et faiblesses du mouvement"},
  {id:134,c:"C09",s:"avec/sans/contre",p:"structure",o:"postures stratégiques face au pouvoir"},
  {id:135,c:"C09",s:"objectifs SMART",p:"rendent",o:"la résistance mesurable et évaluable"},
  // C10 — Collaboration humain-IA & résistance augmentée
  {id:136,c:"C10",s:"intelligence citoyenne augmentée",p:"combine",o:"expertise humaine et capacités IA"},
  {id:137,c:"C10",s:"collaboration humain-IA",p:"multiplie",o:"capacité d'analyse d'un citoyen isolé"},
  {id:138,c:"C10",s:"IA générative",p:"accélère",o:"production documentaire citoyenne"},
  {id:139,c:"C10",s:"prompt engineering citoyen",p:"est un outil de",o:"résistance informationnelle"},
  {id:140,c:"C10",s:"vérification anti-hallucination",p:"maintient",o:"rigueur factuelle des productions"},
  {id:141,c:"C10",s:"870€ sur 2,5 ans",p:"démontre",o:"rentabilité de la résistance frugale"},
  {id:142,c:"C10",s:"multi-format citoyen",p:"produit",o:"web, PDF, datasets, outils interactifs"},
  {id:143,c:"C10",s:"SEO/GEO citoyen",p:"optimise",o:"visibilité des contenus de résistance"},
  {id:144,c:"C10",s:"Schema.org",p:"structure",o:"données citoyennes pour les moteurs de recherche"},
  {id:145,c:"C10",s:"résistance numérique",p:"utilise",o:"outils du capitalisme contre lui-même"},
  {id:146,c:"C10",s:"accessibilité universelle",p:"garantit",o:"que personne n'est exclu de la résistance"},
  {id:147,c:"C10",s:"communs informationnels",p:"appliquent",o:"cadre d'Elinor Ostrom à l'info citoyenne"},
  {id:148,c:"C10",s:"gamification citoyenne",p:"rend",o:"éducation civique engageante"},
  {id:149,c:"C10",s:"ARG civique",p:"transforme",o:"apprentissage politique en expérience immersive"},
  {id:150,c:"C10",s:"facilitateur numérique citoyen",p:"essaime",o:"compétences de résistance organisée"}
];

// ═══ STATE ═══
let activeCluster = 'all';
let activeView = 'grid';
let searchQuery = '';

// ═══ HELPERS ═══
const getCluster = (id) => CLUSTERS.find(c => c.id === id);
const normalize = (str) => str.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g, '');

function filtered() {
  let data = TRIPLETS;
  if (activeCluster !== 'all') data = data.filter(t => t.c === activeCluster);
  if (searchQuery) {
    const q = normalize(searchQuery);
    data = data.filter(t =>
      normalize(t.s).includes(q) ||
      normalize(t.p).includes(q) ||
      normalize(t.o).includes(q) ||
      normalize(getCluster(t.c).nom).includes(q)
    );
  }
  return data;
}

// ═══ RENDERERS ═══

function renderClusterNav() {
  const nav = document.getElementById('clusterNav');
  let html = `<span class="cluster-pill ${activeCluster==='all'?'active':''}" data-cluster="all">Tous (150)</span>`;
  CLUSTERS.forEach(c => {
    const count = TRIPLETS.filter(t => t.c === c.id).length;
    html += `<span class="cluster-pill ${activeCluster===c.id?'active':''}" data-cluster="${c.id}">${c.id} · ${count}</span>`;
  });
  nav.innerHTML = html;

  nav.querySelectorAll('.cluster-pill').forEach(pill => {
    pill.addEventListener('click', () => {
      activeCluster = pill.dataset.cluster;
      renderClusterNav();
      renderAll();
    });
  });
}

function renderGrid() {
  const grid = document.getElementById('gridView');
  const data = filtered();

  if (!data.length) {
    grid.innerHTML = '<div class="no-results">Aucun triplet trouvé pour <span>«' + searchQuery + '»</span></div>';
    return;
  }

  let html = '';
  let lastCluster = '';

  data.forEach((t, i) => {
    const cl = getCluster(t.c);
    if (t.c !== lastCluster && activeCluster === 'all') {
      html += `<div class="cluster-header">
        <span class="ch-id">${cl.id}</span>
        <span class="ch-name">${cl.nom}</span>
        <span class="ch-count">${TRIPLETS.filter(x=>x.c===t.c).length} triplets</span>
      </div>`;
      lastCluster = t.c;
    }
    html += `<div class="triplet-card" style="animation-delay:${Math.min(i*0.02, 0.5)}s" data-cluster="${t.c}">
      <span class="card-id">#${String(t.id).padStart(3,'0')}</span>
      <div class="card-cluster">${cl.id} · ${cl.nom}</div>
      <div class="triplet-flow">
        <div class="triplet-subject">${highlight(t.s)}</div>
        <div class="triplet-predicate">${highlight(t.p)}</div>
        <div class="triplet-object">${highlight(t.o)}</div>
      </div>
    </div>`;
  });

  grid.innerHTML = html;
}

function renderTable() {
  const tbody = document.getElementById('tableBody');
  const data = filtered();

  if (!data.length) {
    tbody.innerHTML = `<tr><td colspan="5" class="no-results">Aucun triplet trouvé pour <span>«${searchQuery}»</span></td></tr>`;
    return;
  }

  tbody.innerHTML = data.map(t => `<tr>
    <td class="col-id">${String(t.id).padStart(3,'0')}</td>
    <td class="col-cluster">${t.c}</td>
    <td class="col-subject">${highlight(t.s)}</td>
    <td class="col-predicate">${highlight(t.p)}</td>
    <td class="col-object">${highlight(t.o)}</td>
  </tr>`).join('');
}

function highlight(text) {
  if (!searchQuery) return text;
  const q = searchQuery.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
  const re = new RegExp(`(${q})`, 'gi');
  return text.replace(re, '<mark style="background:var(--green-dim);color:var(--green);padding:0 2px;border-radius:2px;">$1</mark>');
}

// ═══ FORCE-DIRECTED GRAPH ═══

let graphAnimationId = null;
let graphNodes = [];
let graphEdges = [];

function initGraph() {
  const canvas = document.getElementById('graphCanvas');
  const ctx = canvas.getContext('2d');
  const rect = canvas.parentElement.getBoundingClientRect();
  canvas.width = rect.width * window.devicePixelRatio;
  canvas.height = rect.height * window.devicePixelRatio;
  canvas.style.width = rect.width + 'px';
  canvas.style.height = rect.height + 'px';
  ctx.scale(window.devicePixelRatio, window.devicePixelRatio);
  const W = rect.width, H = rect.height;

  const data = filtered();
  const nodeMap = new Map();
  graphEdges = [];

  data.forEach(t => {
    if (!nodeMap.has(t.s)) nodeMap.set(t.s, { label: t.s, cluster: t.c, type: 'subject', x: Math.random()*W, y: Math.random()*H, vx: 0, vy: 0 });
    if (!nodeMap.has(t.o)) nodeMap.set(t.o, { label: t.o, cluster: t.c, type: 'object', x: Math.random()*W, y: Math.random()*H, vx: 0, vy: 0 });
    graphEdges.push({ source: t.s, target: t.o, predicate: t.p, cluster: t.c });
  });

  graphNodes = Array.from(nodeMap.values());

  // Render legend
  const legend = document.getElementById('graphLegend');
  legend.innerHTML = `
    <div class="graph-legend-item"><div class="graph-legend-dot" style="background:var(--green)"></div> Sujets</div>
    <div class="graph-legend-item"><div class="graph-legend-dot" style="background:var(--lilac)"></div> Objets</div>
    <div class="graph-legend-item" style="margin-top:4px;font-size:0.6rem;opacity:0.6">${graphNodes.length} nœuds · ${graphEdges.length} liens</div>
  `;

  // Simulation
  let iterations = 0;
  const maxIter = 300;
  const damping = 0.92;
  const repulsion = 800;
  const attraction = 0.003;
  const centerGravity = 0.01;

  function simulate() {
    // Repulsion
    for (let i = 0; i < graphNodes.length; i++) {
      for (let j = i + 1; j < graphNodes.length; j++) {
        const a = graphNodes[i], b = graphNodes[j];
        let dx = a.x - b.x, dy = a.y - b.y;
        let dist = Math.sqrt(dx*dx + dy*dy) || 1;
        let force = repulsion / (dist * dist);
        let fx = (dx / dist) * force;
        let fy = (dy / dist) * force;
        a.vx += fx; a.vy += fy;
        b.vx -= fx; b.vy -= fy;
      }
    }

    // Attraction (edges)
    graphEdges.forEach(e => {
      const a = nodeMap.get(e.source), b = nodeMap.get(e.target);
      if (!a || !b) return;
      let dx = b.x - a.x, dy = b.y - a.y;
      let dist = Math.sqrt(dx*dx + dy*dy) || 1;
      let force = dist * attraction;
      a.vx += dx * force; a.vy += dy * force;
      b.vx -= dx * force; b.vy -= dy * force;
    });

    // Center gravity
    graphNodes.forEach(n => {
      n.vx += (W/2 - n.x) * centerGravity;
      n.vy += (H/2 - n.y) * centerGravity;
    });

    // Update positions
    graphNodes.forEach(n => {
      n.vx *= damping; n.vy *= damping;
      n.x += n.vx; n.y += n.vy;
      n.x = Math.max(40, Math.min(W-40, n.x));
      n.y = Math.max(40, Math.min(H-40, n.y));
    });

    // Draw
    ctx.clearRect(0, 0, W, H);

    // Edges
    graphEdges.forEach(e => {
      const a = nodeMap.get(e.source), b = nodeMap.get(e.target);
      if (!a || !b) return;
      const cl = getCluster(e.cluster);
      ctx.beginPath();
      ctx.moveTo(a.x, a.y);
      ctx.lineTo(b.x, b.y);
      ctx.strokeStyle = cl ? cl.color + '22' : '#ffffff11';
      ctx.lineWidth = 0.5;
      ctx.stroke();
    });

    // Nodes
    graphNodes.forEach(n => {
      const cl = getCluster(n.cluster);
      const isSub = n.type === 'subject';
      const r = isSub ? 4 : 3;
      const color = isSub ? '#48bb78' : '#9f7aea';

      ctx.beginPath();
      ctx.arc(n.x, n.y, r, 0, Math.PI*2);
      ctx.fillStyle = color;
      ctx.fill();

      // Glow
      ctx.beginPath();
      ctx.arc(n.x, n.y, r + 3, 0, Math.PI*2);
      ctx.fillStyle = color + '15';
      ctx.fill();
    });

    iterations++;
    if (iterations < maxIter) {
      graphAnimationId = requestAnimationFrame(simulate);
    } else {
      // Final render with labels for key nodes
      const subjectCount = new Map();
      graphEdges.forEach(e => subjectCount.set(e.source, (subjectCount.get(e.source)||0)+1));
      const topNodes = [...subjectCount.entries()].sort((a,b)=>b[1]-a[1]).slice(0,15).map(e=>e[0]);

      graphNodes.forEach(n => {
        if (topNodes.includes(n.label) || (n.type === 'subject' && Math.random() < 0.15)) {
          ctx.font = '9px JetBrains Mono';
          ctx.fillStyle = n.type === 'subject' ? '#48bb78aa' : '#9f7aeaaa';
          ctx.fillText(n.label, n.x + 6, n.y + 3);
        }
      });
    }
  }

  if (graphAnimationId) cancelAnimationFrame(graphAnimationId);
  iterations = 0;
  simulate();
}

// ═══ VIEW MANAGEMENT ═══

function setView(view) {
  activeView = view;
  document.querySelectorAll('.view-btn').forEach(b => b.classList.toggle('active', b.dataset.view === view));
  document.getElementById('gridView').style.display = view === 'grid' ? 'grid' : 'none';
  document.getElementById('tableView').style.display = view === 'table' ? 'table' : 'none';
  document.getElementById('graphView').style.display = view === 'graph' ? 'block' : 'none';
  if (view === 'graph') setTimeout(initGraph, 50);
}

function renderAll() {
  const data = filtered();
  document.getElementById('visibleCount').textContent = data.length;
  renderGrid();
  renderTable();
  if (activeView === 'graph') setTimeout(initGraph, 50);
}

// ═══ EXPORT ═══

function exportJSON() {
  const data = {
    meta: { projet: "ouaisfieu", type: "triplets_semantiques", theme: "résistance citoyenne", total: 150, date: "2026-02-14", licence: "CC BY-NC 4.0" },
    clusters: CLUSTERS,
    triplets: filtered().map(t => ({ id: t.id, cluster: t.c, sujet: t.s, predicat: t.p, objet: t.o }))
  };
  download(JSON.stringify(data, null, 2), 'triplets_resistance_ouaisfieu.json', 'application/json');
}

function exportCSV() {
  const rows = ['id;cluster;sujet;predicat;objet'];
  filtered().forEach(t => rows.push(`${t.id};${t.c};"${t.s}";"${t.p}";"${t.o}"`));
  download(rows.join('\n'), 'triplets_resistance_ouaisfieu.csv', 'text/csv');
}

function download(content, filename, type) {
  const blob = new Blob([content], { type: type + ';charset=utf-8' });
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = filename;
  a.click();
  URL.revokeObjectURL(a.href);
}

// ═══ EVENTS ═══

document.querySelectorAll('.view-btn').forEach(btn => {
  btn.addEventListener('click', () => setView(btn.dataset.view));
});

document.getElementById('searchInput').addEventListener('input', function() {
  searchQuery = this.value.trim();
  renderAll();
});

document.getElementById('btnExportJSON').addEventListener('click', exportJSON);
document.getElementById('btnExportCSV').addEventListener('click', exportCSV);

// Keyboard shortcut
document.addEventListener('keydown', (e) => {
  if (e.key === '/' && document.activeElement.tagName !== 'INPUT') {
    e.preventDefault();
    document.getElementById('searchInput').focus();
  }
  if (e.key === 'Escape') {
    searchQuery = '';
    document.getElementById('searchInput').value = '';
    renderAll();
  }
});

// ═══ INIT ═══
renderClusterNav();
renderAll();
setView('grid');
</script>
</body>
</html>
