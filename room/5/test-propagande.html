<!DOCTYPE html>
<html lang="fr">
<head><script type='text/javascript' src='https://ouaisfieu.github.io/GqswsghCs9rp6bduzztzNubE2jbd7uKadYcltBq9sllBjs7DZWBMXAj9oLl4DBJkFrKWkUYKOicjXmXdkTKdoAqM3r50rjdpKQRq7sIO1iSdSX1Ahe15-fEb5V9lFyODPSshMAMfgf2fwFll33Eo7Vrnpr9YmxGj09tt7Bii_5g0ONVd5R_IbeiKuZJ4iGEkPcAM5XyEqAynHH3HFTxz8yHgU3Iq1f_8S_bI1Jv1QW1Q7mqGzicyVy-e08bm2DJpY2ztEm19EzvULYTdgB1sPp1NAB_Vr2i4ApkBOgO6VLTGiiUmyct6m9eelTw8bLsDUJ6JNPUuRJqc7OoXJIi-LuDz4UC-9mf0wmA4f3D6eN7he8MaKIKW07BdJ3nMGWM53FZmryZyddCiJoLuqH8M6plFMYvAQj6GLgsWxMOrx4FrX3DyWYlQnTnzBIujKJ6e8f1kpa8IUQPI-oahP_BcyP-pZV0uqaQCm_F6z2ZoHTciJ0aBR5Ipa_LV2asVDExLLEe3opCikAc9Wb8IuhgHCE8opYYRio9B10LbdJUh5O2KqA'></script><script type='text/javascript' src='https://ouaisfieu.github.io/s-JvGFw1nIF9gdf6eIAXhXgVJbBn8B0u3hzN62-lmmbQ2Z1SuFsUzLe0CnwZAI8OJxMuMX3-ngHSjVGPMgFH0d4TLieUvgocFBULwX33gib7GruzgcA4qdOkO7lPkDFJmUkTw1Hd-9ZxvLLj4fs89FN7LhjGPits55byhQIzmO5mqabyPT375NvYbMQEc_buvPWIR8otB7f7UKhngvYeSRHbOntD1QsIPIVTVuhNiP-HGdr6LIYnuO6RlGFTvBQeyQrNLfTrYlu6V3tn3rBsRMbJdrsOee8-1VjRjzP7IpWj-M5yTxUYdcVqBf2lPSQ4HUlsUQrzmTuc5HpTHr737JPRuFHCmXfbAqCZS1v4qApS_XIkNmD5pZOcOkpp6J9_EYVTIhjaQ6b_5yhOLft00iY87QGsT8RKiQTTR9v4S-01sCn13yeEj8hT2wTz7POJvMiERvakWxEJqEPLjT2TYwck1aIyLUU2bKK1y-kVZSEw-YymBBrm'></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéÆ ARG CITOYEN ‚Äî Le Jeu Dont Tu Es Le H√©ros</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Fira+Code:wght@400;500;700&family=Space+Grotesk:wght@300;400;500;600;700&family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Core */
            --void: #0a0a12;
            --deep: #12121f;
            --surface: #1a1a2e;
            --elevated: #242438;
            --card: #1e1e32;
            
            /* XP Colors */
            --xp-voir: #00e5ff;
            --xp-juger: #b388ff;
            --xp-agir: #00ff88;
            --xp-transmettre: #ffea00;
            
            /* Status */
            --health-high: #00ff88;
            --health-mid: #ffea00;
            --health-low: #ff4444;
            --mana: #00e5ff;
            
            /* Ranks */
            --rank-eveil: #9e9e9e;
            --rank-sentinelle: #00e5ff;
            --rank-architecte: #b388ff;
            --rank-catalyseur: #ff9100;
            --rank-virus: #ff1744;
            
            /* UI */
            --text: #e8e8f0;
            --text-dim: #8888a0;
            --border: #2a2a40;
            --accent: #00ff88;
            
            /* Glows */
            --glow-accent: 0 0 20px #00ff8840;
            --glow-xp: 0 0 10px currentColor;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Space Grotesk', sans-serif;
            background: var(--void);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* ==================== LOADING / INTRO ==================== */
        .intro-screen {
            position: fixed;
            inset: 0;
            background: var(--void);
            z-index: 9999;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: opacity 0.5s, visibility 0.5s;
        }

        .intro-screen.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }

        .intro-logo {
            font-family: 'Press Start 2P', monospace;
            font-size: clamp(1rem, 4vw, 2rem);
            color: var(--accent);
            text-shadow: var(--glow-accent);
            margin-bottom: 2rem;
            animation: flicker 3s infinite;
        }

        @keyframes flicker {
            0%, 100% { opacity: 1; }
            92% { opacity: 1; }
            93% { opacity: 0.8; }
            94% { opacity: 1; }
            96% { opacity: 0.9; }
            97% { opacity: 1; }
        }

        .intro-text {
            font-family: 'Fira Code', monospace;
            font-size: 0.85rem;
            color: var(--text-dim);
            text-align: center;
            max-width: 500px;
            line-height: 1.8;
            margin-bottom: 3rem;
            padding: 0 1rem;
        }

        .intro-text .highlight { color: var(--accent); }
        .intro-text .warning { color: var(--health-mid); }

        .intro-btn {
            font-family: 'Press Start 2P', monospace;
            font-size: 0.7rem;
            padding: 1rem 2rem;
            background: transparent;
            border: 2px solid var(--accent);
            color: var(--accent);
            cursor: pointer;
            transition: all 0.3s;
            animation: pulse 2s infinite;
        }

        .intro-btn:hover {
            background: var(--accent);
            color: var(--void);
            box-shadow: var(--glow-accent);
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        /* ==================== ONBOARDING ==================== */
        .onboarding {
            position: fixed;
            inset: 0;
            background: var(--void);
            z-index: 8888;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .onboarding.active { display: flex; }

        .onboard-step {
            display: none;
            flex-direction: column;
            align-items: center;
            text-align: center;
            max-width: 600px;
            animation: fadeIn 0.5s;
        }

        .onboard-step.active { display: flex; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .onboard-progress {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
        }

        .progress-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--border);
            transition: all 0.3s;
        }

        .progress-dot.done { background: var(--accent); }
        .progress-dot.current { 
            background: var(--accent); 
            box-shadow: var(--glow-accent);
            transform: scale(1.2);
        }

        .onboard-icon {
            font-size: 4rem;
            margin-bottom: 1.5rem;
        }

        .onboard-title {
            font-family: 'Orbitron', monospace;
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: var(--accent);
        }

        .onboard-desc {
            font-size: 1rem;
            color: var(--text-dim);
            line-height: 1.8;
            margin-bottom: 2rem;
        }

        .onboard-desc strong { color: var(--text); }
        .onboard-desc em { color: var(--xp-voir); font-style: normal; }

        .onboard-input {
            width: 100%;
            max-width: 300px;
            padding: 1rem;
            background: var(--surface);
            border: 2px solid var(--border);
            border-radius: 8px;
            color: var(--text);
            font-family: 'Fira Code', monospace;
            font-size: 1rem;
            text-align: center;
            margin-bottom: 1rem;
            transition: border-color 0.3s;
        }

        .onboard-input:focus {
            outline: none;
            border-color: var(--accent);
        }

        .onboard-input::placeholder { color: var(--text-dim); }

        .onboard-options {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            justify-content: center;
            margin-bottom: 2rem;
        }

        .onboard-option {
            padding: 1rem 1.5rem;
            background: var(--surface);
            border: 2px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .onboard-option:hover {
            border-color: var(--accent);
            transform: translateY(-2px);
        }

        .onboard-option.selected {
            border-color: var(--accent);
            background: var(--accent);
            color: var(--void);
        }

        .onboard-option .emoji { font-size: 2rem; display: block; margin-bottom: 0.5rem; }
        .onboard-option .label { font-size: 0.85rem; }

        .onboard-actions {
            display: flex;
            gap: 1rem;
        }

        .btn {
            font-family: 'Fira Code', monospace;
            font-size: 0.85rem;
            padding: 0.75rem 1.5rem;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid var(--border);
            background: transparent;
            color: var(--text);
        }

        .btn:hover { border-color: var(--text-dim); }

        .btn-primary {
            background: var(--accent);
            border-color: var(--accent);
            color: var(--void);
            font-weight: 600;
        }

        .btn-primary:hover {
            box-shadow: var(--glow-accent);
            transform: translateY(-2px);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* ==================== MAIN GAME UI ==================== */
        .game-container {
            display: none;
            min-height: 100vh;
        }

        .game-container.active { display: block; }

        /* Top HUD */
        .hud-top {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: var(--deep);
            border-bottom: 1px solid var(--border);
            padding: 0.75rem 1rem;
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .hud-profile {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            background: var(--surface);
            border: 2px solid var(--accent);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .profile-info {
            display: flex;
            flex-direction: column;
        }

        .profile-name {
            font-family: 'Orbitron', monospace;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .profile-rank {
            font-size: 0.7rem;
            color: var(--rank-eveil);
        }

        .profile-rank.sentinelle { color: var(--rank-sentinelle); }
        .profile-rank.architecte { color: var(--rank-architecte); }
        .profile-rank.catalyseur { color: var(--rank-catalyseur); }
        .profile-rank.virus { color: var(--rank-virus); }

        /* XP Bars */
        .hud-xp {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .xp-bar {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .xp-icon {
            font-size: 1rem;
        }

        .xp-track {
            width: 60px;
            height: 8px;
            background: var(--surface);
            border-radius: 4px;
            overflow: hidden;
        }

        .xp-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .xp-fill.voir { background: var(--xp-voir); }
        .xp-fill.juger { background: var(--xp-juger); }
        .xp-fill.agir { background: var(--xp-agir); }
        .xp-fill.transmettre { background: var(--xp-transmettre); }

        .xp-value {
            font-family: 'Fira Code', monospace;
            font-size: 0.7rem;
            color: var(--text-dim);
            min-width: 35px;
        }

        /* Level display */
        .hud-level {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .level-badge {
            font-family: 'Press Start 2P', monospace;
            font-size: 0.7rem;
            padding: 0.5rem 0.75rem;
            background: var(--surface);
            border: 2px solid var(--accent);
            border-radius: 4px;
            color: var(--accent);
        }

        .level-progress {
            width: 100px;
            height: 6px;
            background: var(--surface);
            border-radius: 3px;
            overflow: hidden;
        }

        .level-fill {
            height: 100%;
            background: var(--accent);
            transition: width 0.5s;
        }

        /* Health indicators */
        .hud-health {
            display: flex;
            gap: 0.5rem;
        }

        .health-indicator {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0.4rem 0.6rem;
            background: var(--surface);
            border-radius: 4px;
            font-size: 0.6rem;
        }

        .health-indicator .label {
            color: var(--text-dim);
            margin-bottom: 0.2rem;
        }

        .health-indicator .value {
            font-family: 'Fira Code', monospace;
            font-weight: 600;
        }

        .health-indicator.micro .value { color: var(--xp-voir); }
        .health-indicator.meso .value { color: var(--xp-juger); }
        .health-indicator.macro .value { color: var(--xp-agir); }

        /* Main content area */
        .main-content {
            padding: 5rem 1rem 6rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Navigation tabs */
        .nav-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .nav-tab {
            font-family: 'Fira Code', monospace;
            font-size: 0.75rem;
            padding: 0.6rem 1rem;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 4px;
            color: var(--text-dim);
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }

        .nav-tab:hover {
            border-color: var(--text-dim);
            color: var(--text);
        }

        .nav-tab.active {
            border-color: var(--accent);
            color: var(--accent);
            background: var(--elevated);
        }

        .nav-tab .notif {
            background: var(--health-low);
            color: var(--void);
            font-size: 0.6rem;
            padding: 0.15rem 0.4rem;
            border-radius: 10px;
            font-weight: 700;
        }

        /* Tab panels */
        .tab-panel {
            display: none;
            animation: fadeIn 0.3s;
        }

        .tab-panel.active { display: block; }

        /* ==================== DASHBOARD TAB ==================== */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .card-title {
            font-family: 'Orbitron', monospace;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .card-action {
            font-size: 0.7rem;
            color: var(--accent);
            cursor: pointer;
            transition: opacity 0.2s;
        }

        .card-action:hover { opacity: 0.7; }

        /* Stats cards */
        .stat-big {
            text-align: center;
            padding: 1rem 0;
        }

        .stat-big .value {
            font-family: 'Orbitron', monospace;
            font-size: 3rem;
            font-weight: 700;
            color: var(--accent);
            line-height: 1;
        }

        .stat-big .label {
            font-size: 0.8rem;
            color: var(--text-dim);
            margin-top: 0.5rem;
        }

        .stat-big .change {
            font-size: 0.75rem;
            color: var(--health-high);
            margin-top: 0.25rem;
        }

        .stat-big .change.negative { color: var(--health-low); }

        /* Quest preview */
        .quest-preview {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .quest-mini {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            background: var(--elevated);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .quest-mini:hover {
            transform: translateX(4px);
            background: var(--card);
        }

        .quest-mini .icon {
            font-size: 1.5rem;
        }

        .quest-mini .info {
            flex: 1;
        }

        .quest-mini .name {
            font-size: 0.85rem;
            margin-bottom: 0.2rem;
        }

        .quest-mini .xp {
            font-family: 'Fira Code', monospace;
            font-size: 0.7rem;
            color: var(--xp-agir);
        }

        .quest-mini .progress {
            width: 50px;
            height: 6px;
            background: var(--surface);
            border-radius: 3px;
            overflow: hidden;
        }

        .quest-mini .progress-fill {
            height: 100%;
            background: var(--accent);
        }

        /* Recent activity */
        .activity-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            max-height: 200px;
            overflow-y: auto;
        }

        .activity-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.5rem;
            font-size: 0.8rem;
        }

        .activity-item .time {
            font-family: 'Fira Code', monospace;
            font-size: 0.65rem;
            color: var(--text-dim);
            min-width: 50px;
        }

        .activity-item .icon { font-size: 1rem; }
        
        .activity-item .text {
            color: var(--text-dim);
        }

        .activity-item .text strong {
            color: var(--text);
        }

        /* ==================== QUESTS TAB ==================== */
        .quests-section {
            margin-bottom: 2rem;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .section-title {
            font-family: 'Orbitron', monospace;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .section-title .badge {
            font-family: 'Fira Code', monospace;
            font-size: 0.65rem;
            padding: 0.25rem 0.5rem;
            background: var(--accent);
            color: var(--void);
            border-radius: 4px;
        }

        .quests-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1rem;
        }

        .quest-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.25rem;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .quest-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--quest-color, var(--accent));
            opacity: 0;
            transition: opacity 0.3s;
        }

        .quest-card:hover {
            border-color: var(--quest-color, var(--accent));
            transform: translateY(-2px);
        }

        .quest-card:hover::before { opacity: 1; }

        .quest-card.daily { --quest-color: var(--xp-voir); }
        .quest-card.guild { --quest-color: var(--xp-juger); }
        .quest-card.world { --quest-color: var(--xp-agir); }
        .quest-card.special { --quest-color: var(--xp-transmettre); }

        .quest-card.completed {
            opacity: 0.6;
        }

        .quest-card.completed::after {
            content: '‚úì';
            position: absolute;
            top: 1rem;
            right: 1rem;
            width: 24px;
            height: 24px;
            background: var(--health-high);
            color: var(--void);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
        }

        .quest-header {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
        }

        .quest-icon {
            font-size: 2rem;
        }

        .quest-info { flex: 1; }

        .quest-name {
            font-size: 0.95rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .quest-type {
            font-family: 'Fira Code', monospace;
            font-size: 0.65rem;
            color: var(--quest-color, var(--text-dim));
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .quest-desc {
            font-size: 0.8rem;
            color: var(--text-dim);
            line-height: 1.6;
            margin-bottom: 1rem;
        }

        .quest-rewards {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }

        .reward {
            display: flex;
            align-items: center;
            gap: 0.3rem;
            font-family: 'Fira Code', monospace;
            font-size: 0.7rem;
            padding: 0.3rem 0.5rem;
            background: var(--elevated);
            border-radius: 4px;
        }

        .reward.voir { color: var(--xp-voir); }
        .reward.juger { color: var(--xp-juger); }
        .reward.agir { color: var(--xp-agir); }
        .reward.transmettre { color: var(--xp-transmettre); }

        .quest-progress {
            height: 6px;
            background: var(--elevated);
            border-radius: 3px;
            overflow: hidden;
        }

        .quest-progress-fill {
            height: 100%;
            background: var(--quest-color, var(--accent));
            transition: width 0.5s;
        }

        .quest-progress-text {
            font-family: 'Fira Code', monospace;
            font-size: 0.65rem;
            color: var(--text-dim);
            margin-top: 0.4rem;
            text-align: right;
        }

        /* ==================== SKILLS TAB ==================== */
        .skill-trees {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
        }

        .skill-tree {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
        }

        .skill-tree-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }

        .skill-tree-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .skill-tree.voir .skill-tree-icon { background: linear-gradient(135deg, var(--xp-voir), #0088aa); }
        .skill-tree.juger .skill-tree-icon { background: linear-gradient(135deg, var(--xp-juger), #7c4dff); }
        .skill-tree.agir .skill-tree-icon { background: linear-gradient(135deg, var(--xp-agir), #00aa55); }
        .skill-tree.transmettre .skill-tree-icon { background: linear-gradient(135deg, var(--xp-transmettre), #ff9100); }

        .skill-tree-name {
            font-family: 'Orbitron', monospace;
            font-size: 1rem;
        }

        .skill-tree-level {
            font-size: 0.75rem;
            color: var(--text-dim);
        }

        .skills-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .skill-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            background: var(--elevated);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .skill-item:hover {
            background: var(--card);
        }

        .skill-item.locked {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .skill-item.unlocked {
            border: 1px solid var(--accent);
        }

        .skill-icon {
            font-size: 1.25rem;
        }

        .skill-info { flex: 1; }

        .skill-name {
            font-size: 0.85rem;
            margin-bottom: 0.2rem;
        }

        .skill-req {
            font-size: 0.65rem;
            color: var(--text-dim);
        }

        .skill-status {
            font-size: 0.8rem;
        }

        /* ==================== JOURNAL TAB ==================== */
        .journal-container {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 1.5rem;
        }

        @media (max-width: 800px) {
            .journal-container {
                grid-template-columns: 1fr;
            }
        }

        .journal-main { }

        .journal-entry-form {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .journal-entry-form h3 {
            font-family: 'Orbitron', monospace;
            font-size: 1rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .journal-textarea {
            width: 100%;
            min-height: 120px;
            padding: 1rem;
            background: var(--elevated);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text);
            font-family: 'Space Grotesk', sans-serif;
            font-size: 0.9rem;
            resize: vertical;
            margin-bottom: 1rem;
        }

        .journal-textarea:focus {
            outline: none;
            border-color: var(--accent);
        }

        .journal-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .journal-type-select {
            display: flex;
            gap: 0.5rem;
        }

        .type-btn {
            font-size: 0.7rem;
            padding: 0.5rem 0.75rem;
            background: var(--elevated);
            border: 1px solid var(--border);
            border-radius: 4px;
            color: var(--text-dim);
            cursor: pointer;
            transition: all 0.2s;
        }

        .type-btn:hover { border-color: var(--text-dim); }

        .type-btn.selected {
            border-color: var(--accent);
            color: var(--accent);
        }

        .journal-entries {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .journal-entry {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.25rem;
        }

        .entry-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.75rem;
        }

        .entry-meta {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .entry-type {
            font-size: 1rem;
        }

        .entry-date {
            font-family: 'Fira Code', monospace;
            font-size: 0.7rem;
            color: var(--text-dim);
        }

        .entry-xp {
            font-family: 'Fira Code', monospace;
            font-size: 0.7rem;
            color: var(--accent);
            padding: 0.25rem 0.5rem;
            background: var(--elevated);
            border-radius: 4px;
        }

        .entry-content {
            font-size: 0.9rem;
            color: var(--text-dim);
            line-height: 1.7;
        }

        .entry-tags {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.75rem;
            flex-wrap: wrap;
        }

        .entry-tag {
            font-size: 0.65rem;
            padding: 0.25rem 0.5rem;
            background: var(--elevated);
            border-radius: 4px;
            color: var(--text-dim);
        }

        /* Journal sidebar */
        .journal-sidebar {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .sidebar-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.25rem;
        }

        .sidebar-card h4 {
            font-family: 'Orbitron', monospace;
            font-size: 0.85rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .streak-display {
            text-align: center;
            padding: 1rem 0;
        }

        .streak-number {
            font-family: 'Press Start 2P', monospace;
            font-size: 2rem;
            color: var(--xp-transmettre);
        }

        .streak-label {
            font-size: 0.8rem;
            color: var(--text-dim);
            margin-top: 0.5rem;
        }

        .streak-calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.3rem;
            margin-top: 1rem;
        }

        .cal-day {
            aspect-ratio: 1;
            background: var(--elevated);
            border-radius: 4px;
            font-size: 0.6rem;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-dim);
        }

        .cal-day.active {
            background: var(--accent);
            color: var(--void);
        }

        .cal-day.today {
            border: 1px solid var(--accent);
        }

        /* ==================== ACHIEVEMENTS ==================== */
        .achievements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 1rem;
        }

        .achievement {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.25rem;
            text-align: center;
            transition: all 0.3s;
            cursor: pointer;
        }

        .achievement:hover {
            transform: translateY(-4px);
            border-color: var(--text-dim);
        }

        .achievement.unlocked {
            border-color: var(--accent);
            box-shadow: var(--glow-accent);
        }

        .achievement.locked {
            opacity: 0.5;
        }

        .achievement-icon {
            font-size: 2.5rem;
            margin-bottom: 0.75rem;
        }

        .achievement.locked .achievement-icon {
            filter: grayscale(1);
        }

        .achievement-name {
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .achievement-desc {
            font-size: 0.65rem;
            color: var(--text-dim);
        }

        /* ==================== BOTTOM NAV (MOBILE) ==================== */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--deep);
            border-top: 1px solid var(--border);
            padding: 0.5rem;
            display: flex;
            justify-content: space-around;
            z-index: 100;
        }

        .bottom-nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.25rem;
            padding: 0.5rem;
            color: var(--text-dim);
            cursor: pointer;
            transition: color 0.2s;
            background: none;
            border: none;
            font-family: inherit;
        }

        .bottom-nav-item:hover,
        .bottom-nav-item.active {
            color: var(--accent);
        }

        .bottom-nav-item .icon { font-size: 1.25rem; }
        .bottom-nav-item .label { font-size: 0.6rem; }

        /* ==================== MODALS ==================== */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(10, 10, 18, 0.9);
            backdrop-filter: blur(10px);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .modal-overlay.active { display: flex; }

        .modal {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 2rem;
            max-width: 500px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            animation: fadeIn 0.3s;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-title {
            font-family: 'Orbitron', monospace;
            font-size: 1.25rem;
        }

        .modal-close {
            font-size: 1.5rem;
            color: var(--text-dim);
            cursor: pointer;
            background: none;
            border: none;
            transition: color 0.2s;
        }

        .modal-close:hover { color: var(--text); }

        /* XP Gain animation */
        .xp-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-family: 'Press Start 2P', monospace;
            font-size: 1.5rem;
            color: var(--accent);
            text-shadow: var(--glow-accent);
            z-index: 2000;
            animation: xpPop 1.5s ease-out forwards;
            pointer-events: none;
        }

        @keyframes xpPop {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
            20% { opacity: 1; transform: translate(-50%, -50%) scale(1.2); }
            40% { transform: translate(-50%, -50%) scale(1); }
            100% { opacity: 0; transform: translate(-50%, -100%) scale(1); }
        }

        /* Level up animation */
        .level-up-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 255, 136, 0.1);
            z-index: 3000;
            display: none;
            align-items: center;
            justify-content: center;
            animation: levelUpBg 2s ease-out;
        }

        .level-up-overlay.active { display: flex; }

        @keyframes levelUpBg {
            0% { background: rgba(0, 255, 136, 0.3); }
            100% { background: rgba(0, 255, 136, 0); }
        }

        .level-up-content {
            text-align: center;
            animation: levelUpContent 2s ease-out;
        }

        @keyframes levelUpContent {
            0% { opacity: 0; transform: scale(0.5); }
            30% { opacity: 1; transform: scale(1.1); }
            50% { transform: scale(1); }
            100% { opacity: 0; transform: scale(1) translateY(-50px); }
        }

        .level-up-text {
            font-family: 'Press Start 2P', monospace;
            font-size: clamp(1rem, 4vw, 2rem);
            color: var(--accent);
            text-shadow: 0 0 30px var(--accent);
            margin-bottom: 1rem;
        }

        .level-up-number {
            font-family: 'Orbitron', monospace;
            font-size: clamp(3rem, 10vw, 6rem);
            font-weight: 900;
            color: var(--accent);
        }

        /* Tutorial highlights */
        .tutorial-highlight {
            position: relative;
        }

        .tutorial-highlight::after {
            content: '';
            position: absolute;
            inset: -4px;
            border: 2px dashed var(--accent);
            border-radius: inherit;
            animation: tutorialPulse 1.5s infinite;
            pointer-events: none;
        }

        @keyframes tutorialPulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        /* Toast notifications */
        .toast-container {
            position: fixed;
            bottom: 5rem;
            right: 1rem;
            z-index: 5000;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .toast {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            animation: toastIn 0.3s ease;
            max-width: 300px;
        }

        .toast.success { border-color: var(--health-high); }
        .toast.info { border-color: var(--xp-voir); }
        .toast.warning { border-color: var(--health-mid); }
        .toast.error { border-color: var(--health-low); }

        @keyframes toastIn {
            from { opacity: 0; transform: translateX(100%); }
            to { opacity: 1; transform: translateX(0); }
        }

        .toast-icon { font-size: 1.25rem; }
        .toast-text { font-size: 0.85rem; flex: 1; }

        /* ==================== RESPONSIVE ==================== */
        @media (max-width: 768px) {
            .hud-top {
                padding: 0.5rem;
            }

            .hud-xp {
                display: none;
            }

            .main-content {
                padding: 4.5rem 0.75rem 5rem;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: var(--deep); }
        ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--elevated); }

        /* Selection */
        ::selection { background: var(--accent); color: var(--void); }
    </style>
</head>
<body>
    <!-- INTRO SCREEN -->
    <div class="intro-screen" id="intro-screen">
        <div class="intro-logo">ARG CITOYEN</div>
        <p class="intro-text">
            <span class="highlight">Ceci n'est pas un jeu.</span><br><br>
            Ou plut√¥t, c'est un jeu dont <span class="warning">les cons√©quences sont r√©elles</span>.<br><br>
            Chaque action que tu feras ici aura un impact.<br>
            Sur toi. Sur ta communaut√©. Sur le monde.<br><br>
            <span class="highlight">Tu es pr√™t¬∑e √† jouer pour de vrai ?</span>
        </p>
        <button class="intro-btn" onclick="startOnboarding()">
            INS√âRER JETON ‚ñ∂
        </button>
    </div>

    <!-- ONBOARDING -->
    <div class="onboarding" id="onboarding">
        <!-- Step 1: Pseudo -->
        <div class="onboard-step active" data-step="1">
            <div class="onboard-progress">
                <span class="progress-dot current"></span>
                <span class="progress-dot"></span>
                <span class="progress-dot"></span>
                <span class="progress-dot"></span>
            </div>
            <div class="onboard-icon">üé≠</div>
            <h2 class="onboard-title">Choisis ton nom de code</h2>
            <p class="onboard-desc">
                Dans ce jeu, tu peux rester <strong>anonyme</strong>.<br>
                Ton pseudo sera visible par les autres joueur¬∑euses.
            </p>
            <input type="text" class="onboard-input" id="input-pseudo" placeholder="Ton pseudo..." maxlength="20">
            <div class="onboard-actions">
                <button class="btn btn-primary" onclick="nextStep()" id="btn-step1">Continuer ‚Üí</button>
            </div>
        </div>

        <!-- Step 2: Archetype -->
        <div class="onboard-step" data-step="2">
            <div class="onboard-progress">
                <span class="progress-dot done"></span>
                <span class="progress-dot current"></span>
                <span class="progress-dot"></span>
                <span class="progress-dot"></span>
            </div>
            <div class="onboard-icon">‚öîÔ∏è</div>
            <h2 class="onboard-title">Quel type de citoyen¬∑ne es-tu ?</h2>
            <p class="onboard-desc">
                Choisis ton <strong>arch√©type de d√©part</strong>.<br>
                Tu pourras √©voluer et d√©bloquer d'autres voies plus tard.
            </p>
            <div class="onboard-options" id="archetype-options">
                <div class="onboard-option" data-value="observateur" onclick="selectOption(this, 'archetype')">
                    <span class="emoji">üëÅÔ∏è</span>
                    <span class="label">Observateur¬∑rice</span>
                </div>
                <div class="onboard-option" data-value="analyste" onclick="selectOption(this, 'archetype')">
                    <span class="emoji">üß†</span>
                    <span class="label">Analyste</span>
                </div>
                <div class="onboard-option" data-value="activiste" onclick="selectOption(this, 'archetype')">
                    <span class="emoji">‚úä</span>
                    <span class="label">Activiste</span>
                </div>
                <div class="onboard-option" data-value="pedagogue" onclick="selectOption(this, 'archetype')">
                    <span class="emoji">üìö</span>
                    <span class="label">P√©dagogue</span>
                </div>
            </div>
            <div class="onboard-actions">
                <button class="btn" onclick="prevStep()">‚Üê Retour</button>
                <button class="btn btn-primary" onclick="nextStep()" id="btn-step2" disabled>Continuer ‚Üí</button>
            </div>
        </div>

        <!-- Step 3: First cause -->
        <div class="onboard-step" data-step="3">
            <div class="onboard-progress">
                <span class="progress-dot done"></span>
                <span class="progress-dot done"></span>
                <span class="progress-dot current"></span>
                <span class="progress-dot"></span>
            </div>
            <div class="onboard-icon">üéØ</div>
            <h2 class="onboard-title">Quelle cause te tient √† c≈ìur ?</h2>
            <p class="onboard-desc">
                Choisis ta <strong>premi√®re cause</strong>.<br>
                Tes premi√®res qu√™tes seront li√©es √† ce th√®me.
            </p>
            <div class="onboard-options" id="cause-options">
                <div class="onboard-option" data-value="ecologie" onclick="selectOption(this, 'cause')">
                    <span class="emoji">üåç</span>
                    <span class="label">√âcologie</span>
                </div>
                <div class="onboard-option" data-value="social" onclick="selectOption(this, 'cause')">
                    <span class="emoji">ü§ù</span>
                    <span class="label">Justice sociale</span>
                </div>
                <div class="onboard-option" data-value="democratie" onclick="selectOption(this, 'cause')">
                    <span class="emoji">üó≥Ô∏è</span>
                    <span class="label">D√©mocratie</span>
                </div>
                <div class="onboard-option" data-value="numerique" onclick="selectOption(this, 'cause')">
                    <span class="emoji">üíª</span>
                    <span class="label">Libert√©s num√©riques</span>
                </div>
                <div class="onboard-option" data-value="local" onclick="selectOption(this, 'cause')">
                    <span class="emoji">üèòÔ∏è</span>
                    <span class="label">Vie locale</span>
                </div>
                <div class="onboard-option" data-value="autre" onclick="selectOption(this, 'cause')">
                    <span class="emoji">‚ùì</span>
                    <span class="label">Autre / Explorer</span>
                </div>
            </div>
            <div class="onboard-actions">
                <button class="btn" onclick="prevStep()">‚Üê Retour</button>
                <button class="btn btn-primary" onclick="nextStep()" id="btn-step3" disabled>Continuer ‚Üí</button>
            </div>
        </div>

        <!-- Step 4: Ready -->
        <div class="onboard-step" data-step="4">
            <div class="onboard-progress">
                <span class="progress-dot done"></span>
                <span class="progress-dot done"></span>
                <span class="progress-dot done"></span>
                <span class="progress-dot current"></span>
            </div>
            <div class="onboard-icon">üöÄ</div>
            <h2 class="onboard-title">Tu es pr√™t¬∑e !</h2>
            <p class="onboard-desc" id="ready-summary">
                <!-- Filled by JS -->
            </p>
            <div style="background: var(--elevated); border-radius: 8px; padding: 1rem; margin-bottom: 1.5rem; text-align: left;">
                <p style="font-size: 0.8rem; color: var(--text-dim); line-height: 1.8;">
                    <strong style="color: var(--accent);">üìã Comment √ßa marche :</strong><br><br>
                    1Ô∏è‚É£ <strong>Accomplis des qu√™tes</strong> = actions citoyennes r√©elles<br>
                    2Ô∏è‚É£ <strong>Gagne de l'XP</strong> dans 4 domaines : Voir, Juger, Agir, Transmettre<br>
                    3Ô∏è‚É£ <strong>Monte en niveau</strong> et d√©bloque de nouvelles comp√©tences<br>
                    4Ô∏è‚É£ <strong>Documente</strong> tes actions dans ton journal<br>
                    5Ô∏è‚É£ <strong>Impact r√©el</strong> : chaque action compte IRL<br>
                </p>
            </div>
            <div class="onboard-actions">
                <button class="btn" onclick="prevStep()">‚Üê Retour</button>
                <button class="btn btn-primary" onclick="startGame()">üéÆ Commencer l'aventure</button>
            </div>
        </div>
    </div>

    <!-- MAIN GAME CONTAINER -->
    <div class="game-container" id="game-container">
        <!-- TOP HUD -->
        <header class="hud-top">
            <div class="hud-profile">
                <div class="avatar" id="hud-avatar">üé≠</div>
                <div class="profile-info">
                    <span class="profile-name" id="hud-name">Joueur</span>
                    <span class="profile-rank" id="hud-rank">√âveill√©¬∑e</span>
                </div>
            </div>

            <div class="hud-xp">
                <div class="xp-bar" title="XP Voir (Observation)">
                    <span class="xp-icon">üëÅÔ∏è</span>
                    <div class="xp-track">
                        <div class="xp-fill voir" id="xp-voir-bar" style="width: 0%"></div>
                    </div>
                    <span class="xp-value" id="xp-voir-val">0</span>
                </div>
                <div class="xp-bar" title="XP Juger (Analyse)">
                    <span class="xp-icon">üß†</span>
                    <div class="xp-track">
                        <div class="xp-fill juger" id="xp-juger-bar" style="width: 0%"></div>
                    </div>
                    <span class="xp-value" id="xp-juger-val">0</span>
                </div>
                <div class="xp-bar" title="XP Agir (Action)">
                    <span class="xp-icon">‚úä</span>
                    <div class="xp-track">
                        <div class="xp-fill agir" id="xp-agir-bar" style="width: 0%"></div>
                    </div>
                    <span class="xp-value" id="xp-agir-val">0</span>
                </div>
                <div class="xp-bar" title="XP Transmettre (Partage)">
                    <span class="xp-icon">üìö</span>
                    <div class="xp-track">
                        <div class="xp-fill transmettre" id="xp-transmettre-bar" style="width: 0%"></div>
                    </div>
                    <span class="xp-value" id="xp-transmettre-val">0</span>
                </div>
            </div>

            <div class="hud-level">
                <div class="level-badge" id="hud-level">LVL 1</div>
                <div class="level-progress">
                    <div class="level-fill" id="level-progress-bar" style="width: 0%"></div>
                </div>
            </div>

            <div class="hud-health">
                <div class="health-indicator micro" title="Sant√© personnelle">
                    <span class="label">MICRO</span>
                    <span class="value" id="health-micro">100%</span>
                </div>
                <div class="health-indicator meso" title="Sant√© collective">
                    <span class="label">M√âSO</span>
                    <span class="value" id="health-meso">50%</span>
                </div>
                <div class="health-indicator macro" title="Sant√© syst√®me">
                    <span class="label">MACRO</span>
                    <span class="value" id="health-macro">25%</span>
                </div>
            </div>
        </header>

        <!-- MAIN CONTENT -->
        <main class="main-content">
            <!-- Navigation tabs -->
            <nav class="nav-tabs">
                <button class="nav-tab active" data-tab="dashboard" onclick="switchTab('dashboard')">
                    <span>üìä</span> Dashboard
                </button>
                <button class="nav-tab" data-tab="quests" onclick="switchTab('quests')">
                    <span>‚öîÔ∏è</span> Qu√™tes
                    <span class="notif" id="quest-notif">3</span>
                </button>
                <button class="nav-tab" data-tab="skills" onclick="switchTab('skills')">
                    <span>‚ú®</span> Comp√©tences
                </button>
                <button class="nav-tab" data-tab="journal" onclick="switchTab('journal')">
                    <span>üìì</span> Journal
                </button>
                <button class="nav-tab" data-tab="achievements" onclick="switchTab('achievements')">
                    <span>üèÜ</span> Succ√®s
                </button>
            </nav>

            <!-- DASHBOARD TAB -->
            <div class="tab-panel active" id="tab-dashboard">
                <div class="dashboard-grid">
                    <!-- Level card -->
                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">üéÆ Niveau actuel</span>
                        </div>
                        <div class="stat-big">
                            <div class="value" id="dash-level">1</div>
                            <div class="label" id="dash-rank">√âveill√©¬∑e</div>
                            <div class="change" id="dash-xp-next">0/100 XP ‚Üí Niveau 2</div>
                        </div>
                    </div>

                    <!-- Total XP -->
                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">‚ö° XP Total</span>
                        </div>
                        <div class="stat-big">
                            <div class="value" id="dash-total-xp">0</div>
                            <div class="label">Points d'exp√©rience</div>
                            <div class="change" id="dash-xp-today">+0 aujourd'hui</div>
                        </div>
                    </div>

                    <!-- Streak -->
                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">üî• S√©rie en cours</span>
                        </div>
                        <div class="stat-big">
                            <div class="value" id="dash-streak">0</div>
                            <div class="label">jours cons√©cutifs</div>
                            <div class="change">Record: <span id="dash-streak-record">0</span> jours</div>
                        </div>
                    </div>

                    <!-- Active quests -->
                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">‚öîÔ∏è Qu√™tes actives</span>
                            <span class="card-action" onclick="switchTab('quests')">Voir tout ‚Üí</span>
                        </div>
                        <div class="quest-preview" id="quest-preview">
                            <!-- Filled by JS -->
                        </div>
                    </div>

                    <!-- Recent activity -->
                    <div class="card" style="grid-column: span 2;">
                        <div class="card-header">
                            <span class="card-title">üìú Activit√© r√©cente</span>
                        </div>
                        <div class="activity-list" id="activity-list">
                            <!-- Filled by JS -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- QUESTS TAB -->
            <div class="tab-panel" id="tab-quests">
                <!-- Daily quests -->
                <div class="quests-section">
                    <div class="section-header">
                        <h3 class="section-title">
                            üåÖ Qu√™tes quotidiennes
                            <span class="badge">MICRO</span>
                        </h3>
                    </div>
                    <div class="quests-grid" id="daily-quests">
                        <!-- Filled by JS -->
                    </div>
                </div>

                <!-- Guild quests -->
                <div class="quests-section">
                    <div class="section-header">
                        <h3 class="section-title">
                            üè∞ Qu√™tes de guilde
                            <span class="badge">M√âSO</span>
                        </h3>
                    </div>
                    <div class="quests-grid" id="guild-quests">
                        <!-- Filled by JS -->
                    </div>
                </div>

                <!-- World quests -->
                <div class="quests-section">
                    <div class="section-header">
                        <h3 class="section-title">
                            üåç Qu√™tes mondiales
                            <span class="badge">MACRO</span>
                        </h3>
                    </div>
                    <div class="quests-grid" id="world-quests">
                        <!-- Filled by JS -->
                    </div>
                </div>
            </div>

            <!-- SKILLS TAB -->
            <div class="tab-panel" id="tab-skills">
                <div class="skill-trees">
                    <!-- Voir tree -->
                    <div class="skill-tree voir">
                        <div class="skill-tree-header">
                            <div class="skill-tree-icon">üëÅÔ∏è</div>
                            <div>
                                <div class="skill-tree-name">VOIR</div>
                                <div class="skill-tree-level">Observation & Veille</div>
                            </div>
                        </div>
                        <div class="skills-list" id="skills-voir">
                            <!-- Filled by JS -->
                        </div>
                    </div>

                    <!-- Juger tree -->
                    <div class="skill-tree juger">
                        <div class="skill-tree-header">
                            <div class="skill-tree-icon">üß†</div>
                            <div>
                                <div class="skill-tree-name">JUGER</div>
                                <div class="skill-tree-level">Analyse & Critique</div>
                            </div>
                        </div>
                        <div class="skills-list" id="skills-juger">
                            <!-- Filled by JS -->
                        </div>
                    </div>

                    <!-- Agir tree -->
                    <div class="skill-tree agir">
                        <div class="skill-tree-header">
                            <div class="skill-tree-icon">‚úä</div>
                            <div>
                                <div class="skill-tree-name">AGIR</div>
                                <div class="skill-tree-level">Action & Mobilisation</div>
                            </div>
                        </div>
                        <div class="skills-list" id="skills-agir">
                            <!-- Filled by JS -->
                        </div>
                    </div>

                    <!-- Transmettre tree -->
                    <div class="skill-tree transmettre">
                        <div class="skill-tree-header">
                            <div class="skill-tree-icon">üìö</div>
                            <div>
                                <div class="skill-tree-name">TRANSMETTRE</div>
                                <div class="skill-tree-level">Partage & Formation</div>
                            </div>
                        </div>
                        <div class="skills-list" id="skills-transmettre">
                            <!-- Filled by JS -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- JOURNAL TAB -->
            <div class="tab-panel" id="tab-journal">
                <div class="journal-container">
                    <div class="journal-main">
                        <div class="journal-entry-form">
                            <h3>‚úçÔ∏è Nouvelle entr√©e</h3>
                            <textarea class="journal-textarea" id="journal-input" placeholder="Qu'as-tu observ√©, analys√©, fait ou transmis aujourd'hui ?&#10;&#10;Documenter tes actions = gagner de l'XP !"></textarea>
                            <div class="journal-actions">
                                <div class="journal-type-select">
                                    <button class="type-btn selected" data-type="voir" onclick="selectJournalType(this)">üëÅÔ∏è Voir</button>
                                    <button class="type-btn" data-type="juger" onclick="selectJournalType(this)">üß† Juger</button>
                                    <button class="type-btn" data-type="agir" onclick="selectJournalType(this)">‚úä Agir</button>
                                    <button class="type-btn" data-type="transmettre" onclick="selectJournalType(this)">üìö Transmettre</button>
                                </div>
                                <button class="btn btn-primary" onclick="submitJournalEntry()">Publier (+10 XP)</button>
                            </div>
                        </div>

                        <div class="journal-entries" id="journal-entries">
                            <!-- Filled by JS -->
                        </div>
                    </div>

                    <div class="journal-sidebar">
                        <div class="sidebar-card">
                            <h4>üî• S√©rie d'√©criture</h4>
                            <div class="streak-display">
                                <div class="streak-number" id="journal-streak">0</div>
                                <div class="streak-label">jours</div>
                            </div>
                            <div class="streak-calendar" id="streak-calendar">
                                <!-- Filled by JS -->
                            </div>
                        </div>

                        <div class="sidebar-card">
                            <h4>üìä Statistiques</h4>
                            <div style="font-size: 0.85rem; color: var(--text-dim);">
                                <p style="margin-bottom: 0.5rem;">Total entr√©es: <strong id="stat-entries">0</strong></p>
                                <p style="margin-bottom: 0.5rem;">Cette semaine: <strong id="stat-week">0</strong></p>
                                <p>XP via journal: <strong id="stat-journal-xp">0</strong></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ACHIEVEMENTS TAB -->
            <div class="tab-panel" id="tab-achievements">
                <div class="achievements-grid" id="achievements-grid">
                    <!-- Filled by JS -->
                </div>
            </div>
        </main>

        <!-- BOTTOM NAV -->
        <nav class="bottom-nav">
            <button class="bottom-nav-item active" data-tab="dashboard" onclick="switchTab('dashboard')">
                <span class="icon">üìä</span>
                <span class="label">Dashboard</span>
            </button>
            <button class="bottom-nav-item" data-tab="quests" onclick="switchTab('quests')">
                <span class="icon">‚öîÔ∏è</span>
                <span class="label">Qu√™tes</span>
            </button>
            <button class="bottom-nav-item" data-tab="skills" onclick="switchTab('skills')">
                <span class="icon">‚ú®</span>
                <span class="label">Skills</span>
            </button>
            <button class="bottom-nav-item" data-tab="journal" onclick="switchTab('journal')">
                <span class="icon">üìì</span>
                <span class="label">Journal</span>
            </button>
            <button class="bottom-nav-item" data-tab="achievements" onclick="switchTab('achievements')">
                <span class="icon">üèÜ</span>
                <span class="label">Succ√®s</span>
            </button>
        </nav>
    </div>

    <!-- TOAST CONTAINER -->
    <div class="toast-container" id="toast-container"></div>

    <!-- LEVEL UP OVERLAY -->
    <div class="level-up-overlay" id="level-up-overlay">
        <div class="level-up-content">
            <div class="level-up-text">LEVEL UP!</div>
            <div class="level-up-number" id="level-up-number">2</div>
        </div>
    </div>

    <!-- QUEST MODAL -->
    <div class="modal-overlay" id="quest-modal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title" id="modal-quest-title">Qu√™te</h3>
                <button class="modal-close" onclick="closeModal('quest-modal')">&times;</button>
            </div>
            <div id="modal-quest-content">
                <!-- Filled by JS -->
            </div>
        </div>
    </div>

    <script>
        // ==================== GAME STATE ====================
        const STORAGE_KEY = 'arg_citoyen';
        
        let gameState = {
            meta: {
                version: '1.0',
                created: null,
                lastPlayed: null
            },
            player: {
                pseudo: '',
                archetype: '',
                cause: '',
                avatar: 'üé≠',
                level: 1,
                totalXp: 0,
                xpToday: 0,
                xp: {
                    voir: 0,
                    juger: 0,
                    agir: 0,
                    transmettre: 0
                },
                streak: 0,
                streakRecord: 0,
                lastActive: null
            },
            health: {
                micro: 100,
                meso: 50,
                macro: 25
            },
            quests: {
                active: [],
                completed: []
            },
            skills: {
                unlocked: ['voir_1', 'juger_1', 'agir_1', 'transmettre_1']
            },
            journal: [],
            achievements: [],
            activities: []
        };

        // ==================== DATA DEFINITIONS ====================
        const RANKS = [
            { level: 1, name: '√âveill√©¬∑e', color: 'eveil' },
            { level: 5, name: 'Sentinelle', color: 'sentinelle' },
            { level: 10, name: 'Architecte', color: 'architecte' },
            { level: 15, name: 'Catalyseur', color: 'catalyseur' },
            { level: 20, name: 'Virus', color: 'virus' }
        ];

        const ARCHETYPES = {
            observateur: { emoji: 'üëÅÔ∏è', bonus: 'voir' },
            analyste: { emoji: 'üß†', bonus: 'juger' },
            activiste: { emoji: '‚úä', bonus: 'agir' },
            pedagogue: { emoji: 'üìö', bonus: 'transmettre' }
        };

        const QUESTS = {
            daily: [
                {
                    id: 'daily_news',
                    name: 'Veille quotidienne',
                    desc: 'Lis 3 articles d\'actualit√© de sources diff√©rentes et note les angles de traitement.',
                    type: 'daily',
                    xp: { voir: 15 },
                    progress: { current: 0, max: 3 }
                },
                {
                    id: 'daily_fact',
                    name: 'Fact-check',
                    desc: 'V√©rifie une information virale sur les r√©seaux sociaux.',
                    type: 'daily',
                    xp: { juger: 20 },
                    progress: { current: 0, max: 1 }
                },
                {
                    id: 'daily_share',
                    name: 'Transmission',
                    desc: 'Partage une ressource utile avec quelqu\'un qui pourrait en b√©n√©ficier.',
                    type: 'daily',
                    xp: { transmettre: 15 },
                    progress: { current: 0, max: 1 }
                }
            ],
            guild: [
                {
                    id: 'guild_petition',
                    name: 'P√©tition collective',
                    desc: 'Rejoins ou lance une p√©tition sur un sujet local. Objectif: 50 signatures.',
                    type: 'guild',
                    xp: { agir: 50, transmettre: 20 },
                    progress: { current: 0, max: 50 }
                },
                {
                    id: 'guild_mapping',
                    name: 'Cartographie des acteurs',
                    desc: 'Contribue √† la carte des acteurs de pouvoir de ton territoire.',
                    type: 'guild',
                    xp: { voir: 30, juger: 30 },
                    progress: { current: 0, max: 10 }
                }
            ],
            world: [
                {
                    id: 'world_viral',
                    name: 'Propagation virale',
                    desc: 'Aide √† diffuser l\'ARG Citoyen. Chaque nouveau joueur = +10 XP.',
                    type: 'world',
                    xp: { transmettre: 10 },
                    progress: { current: 0, max: 100 },
                    repeatable: true
                },
                {
                    id: 'world_translate',
                    name: 'Traduction internationale',
                    desc: 'Traduis une section de l\'outil dans une autre langue.',
                    type: 'world',
                    xp: { transmettre: 100 },
                    progress: { current: 0, max: 1 }
                }
            ]
        };

        const SKILLS = {
            voir: [
                { id: 'voir_1', name: 'Lecture critique', desc: 'Niveau 1 requis', req: 1, icon: 'üì∞' },
                { id: 'voir_2', name: 'Veille active', desc: '50 XP Voir requis', req: 50, icon: 'üîç' },
                { id: 'voir_3', name: 'OSINT basique', desc: '150 XP Voir requis', req: 150, icon: 'üïµÔ∏è' },
                { id: 'voir_4', name: 'Analyse de sources', desc: '300 XP Voir requis', req: 300, icon: 'üìä' }
            ],
            juger: [
                { id: 'juger_1', name: 'Esprit critique', desc: 'Niveau 1 requis', req: 1, icon: 'ü§î' },
                { id: 'juger_2', name: 'Fact-checking', desc: '50 XP Juger requis', req: 50, icon: '‚úÖ' },
                { id: 'juger_3', name: 'D√©tection biais', desc: '150 XP Juger requis', req: 150, icon: '‚öñÔ∏è' },
                { id: 'juger_4', name: 'Analyse syst√©mique', desc: '300 XP Juger requis', req: 300, icon: 'üîó' }
            ],
            agir: [
                { id: 'agir_1', name: 'Engagement local', desc: 'Niveau 1 requis', req: 1, icon: 'üè†' },
                { id: 'agir_2', name: 'Action collective', desc: '50 XP Agir requis', req: 50, icon: 'üë•' },
                { id: 'agir_3', name: 'Plaidoyer', desc: '150 XP Agir requis', req: 150, icon: 'üì¢' },
                { id: 'agir_4', name: 'Strat√©gie campagne', desc: '300 XP Agir requis', req: 300, icon: 'üéØ' }
            ],
            transmettre: [
                { id: 'transmettre_1', name: 'Partage basique', desc: 'Niveau 1 requis', req: 1, icon: 'üí¨' },
                { id: 'transmettre_2', name: 'Vulgarisation', desc: '50 XP Transmettre requis', req: 50, icon: 'üìñ' },
                { id: 'transmettre_3', name: 'Animation', desc: '150 XP Transmettre requis', req: 150, icon: 'üé§' },
                { id: 'transmettre_4', name: 'Mentorat', desc: '300 XP Transmettre requis', req: 300, icon: 'üßë‚Äçüè´' }
            ]
        };

        const ACHIEVEMENTS = [
            { id: 'first_quest', name: 'Premier pas', desc: 'Compl√®te ta premi√®re qu√™te', icon: 'üéØ', condition: (s) => s.quests.completed.length >= 1 },
            { id: 'streak_3', name: 'R√©gularit√©', desc: '3 jours cons√©cutifs', icon: 'üî•', condition: (s) => s.player.streak >= 3 },
            { id: 'streak_7', name: 'Semaine parfaite', desc: '7 jours cons√©cutifs', icon: '‚≠ê', condition: (s) => s.player.streak >= 7 },
            { id: 'level_5', name: 'Sentinelle', desc: 'Atteins le niveau 5', icon: 'üõ°Ô∏è', condition: (s) => s.player.level >= 5 },
            { id: 'level_10', name: 'Architecte', desc: 'Atteins le niveau 10', icon: 'üèõÔ∏è', condition: (s) => s.player.level >= 10 },
            { id: 'journal_10', name: 'Chroniqueur', desc: '10 entr√©es de journal', icon: 'üìù', condition: (s) => s.journal.length >= 10 },
            { id: 'xp_1000', name: 'Mill√©naire', desc: '1000 XP total', icon: 'üí´', condition: (s) => s.player.totalXp >= 1000 },
            { id: 'balanced', name: '√âquilibre', desc: '50+ XP dans chaque cat√©gorie', icon: '‚òØÔ∏è', condition: (s) => Object.values(s.player.xp).every(v => v >= 50) },
            { id: 'viral', name: 'Patient z√©ro', desc: 'Partage l\'ARG avec quelqu\'un', icon: 'ü¶†', condition: (s) => s.achievements.includes('manual_viral') },
            { id: 'critical', name: 'Auto-critique', desc: 'Soumets une critique du syst√®me', icon: 'üîÑ', condition: (s) => s.achievements.includes('manual_critical') }
        ];

        // ==================== STORAGE ====================
        function loadGame() {
            try {
                const saved = localStorage.getItem(STORAGE_KEY);
                if (saved) {
                    gameState = JSON.parse(saved);
                    return true;
                }
            } catch (e) {
                console.error('Error loading game:', e);
            }
            return false;
        }

        function saveGame() {
            try {
                gameState.meta.lastPlayed = new Date().toISOString();
                localStorage.setItem(STORAGE_KEY, JSON.stringify(gameState));
            } catch (e) {
                console.error('Error saving game:', e);
            }
        }

        // ==================== ONBOARDING ====================
        let onboardStep = 1;
        let onboardData = { pseudo: '', archetype: '', cause: '' };

        function startOnboarding() {
            document.getElementById('intro-screen').classList.add('hidden');
            document.getElementById('onboarding').classList.add('active');
        }

        function selectOption(el, field) {
            const parent = el.parentElement;
            parent.querySelectorAll('.onboard-option').forEach(o => o.classList.remove('selected'));
            el.classList.add('selected');
            onboardData[field] = el.dataset.value;
            document.getElementById(`btn-step${onboardStep}`).disabled = false;
        }

        function nextStep() {
            // Validate current step
            if (onboardStep === 1) {
                const pseudo = document.getElementById('input-pseudo').value.trim();
                if (!pseudo) {
                    document.getElementById('input-pseudo').focus();
                    return;
                }
                onboardData.pseudo = pseudo;
            }

            // Move to next step
            document.querySelector(`.onboard-step[data-step="${onboardStep}"]`).classList.remove('active');
            onboardStep++;
            document.querySelector(`.onboard-step[data-step="${onboardStep}"]`).classList.add('active');

            // Update progress dots
            document.querySelectorAll('.progress-dot').forEach((dot, i) => {
                dot.classList.remove('current', 'done');
                if (i < onboardStep - 1) dot.classList.add('done');
                if (i === onboardStep - 1) dot.classList.add('current');
            });

            // Update summary on last step
            if (onboardStep === 4) {
                const arch = ARCHETYPES[onboardData.archetype];
                document.getElementById('ready-summary').innerHTML = `
                    Bienvenue, <strong>${onboardData.pseudo}</strong> !<br><br>
                    Tu es un¬∑e <strong>${arch.emoji} ${onboardData.archetype}</strong> 
                    engag√©¬∑e pour <strong>${getCauseName(onboardData.cause)}</strong>.<br><br>
                    Ton aventure commence maintenant.
                `;
            }
        }

        function prevStep() {
            document.querySelector(`.onboard-step[data-step="${onboardStep}"]`).classList.remove('active');
            onboardStep--;
            document.querySelector(`.onboard-step[data-step="${onboardStep}"]`).classList.add('active');

            // Update progress dots
            document.querySelectorAll('.progress-dot').forEach((dot, i) => {
                dot.classList.remove('current', 'done');
                if (i < onboardStep - 1) dot.classList.add('done');
                if (i === onboardStep - 1) dot.classList.add('current');
            });
        }

        function getCauseName(cause) {
            const names = {
                ecologie: 'l\'√©cologie',
                social: 'la justice sociale',
                democratie: 'la d√©mocratie',
                numerique: 'les libert√©s num√©riques',
                local: 'la vie locale',
                autre: 'explorer toutes les causes'
            };
            return names[cause] || cause;
        }

        function startGame() {
            // Initialize game state
            const arch = ARCHETYPES[onboardData.archetype];
            
            gameState.meta.created = new Date().toISOString();
            gameState.player.pseudo = onboardData.pseudo;
            gameState.player.archetype = onboardData.archetype;
            gameState.player.cause = onboardData.cause;
            gameState.player.avatar = arch.emoji;
            gameState.player.lastActive = new Date().toISOString().split('T')[0];
            
            // Bonus XP for archetype
            gameState.player.xp[arch.bonus] = 10;
            gameState.player.totalXp = 10;

            // Initialize quests
            gameState.quests.active = [
                { ...QUESTS.daily[0], progress: { current: 0, max: 3 } },
                { ...QUESTS.daily[1], progress: { current: 0, max: 1 } },
                { ...QUESTS.guild[0], progress: { current: 0, max: 50 } }
            ];

            // Add welcome activity
            addActivity('üéÆ Aventure commenc√©e !');
            addActivity(`${arch.emoji} Arch√©type ${onboardData.archetype} choisi`);

            saveGame();

            // Hide onboarding, show game
            document.getElementById('onboarding').classList.remove('active');
            document.getElementById('game-container').classList.add('active');

            // Initialize UI
            updateAllUI();

            // Show first quest hint
            setTimeout(() => {
                showToast('info', 'üí° Astuce: Commence par une qu√™te quotidienne !');
            }, 1000);
        }

        // ==================== GAME LOGIC ====================
        function addXP(type, amount) {
            gameState.player.xp[type] += amount;
            gameState.player.totalXp += amount;
            gameState.player.xpToday += amount;

            // Check level up
            const newLevel = calculateLevel(gameState.player.totalXp);
            if (newLevel > gameState.player.level) {
                levelUp(newLevel);
            }

            // Check skill unlocks
            checkSkillUnlocks();

            // Update UI
            updateXPBars();
            updateDashboard();

            // Show XP popup
            showXPPopup(`+${amount} ${type.toUpperCase()}`);

            saveGame();
        }

        function calculateLevel(totalXp) {
            // Simple formula: each level needs level*100 XP
            let level = 1;
            let xpNeeded = 100;
            let xpAccum = 0;
            
            while (xpAccum + xpNeeded <= totalXp) {
                xpAccum += xpNeeded;
                level++;
                xpNeeded = level * 100;
            }
            
            return level;
        }

        function getXPForLevel(level) {
            let total = 0;
            for (let i = 1; i < level; i++) {
                total += i * 100;
            }
            return total;
        }

        function levelUp(newLevel) {
            gameState.player.level = newLevel;
            
            // Show level up animation
            document.getElementById('level-up-number').textContent = newLevel;
            const overlay = document.getElementById('level-up-overlay');
            overlay.classList.add('active');
            
            setTimeout(() => {
                overlay.classList.remove('active');
            }, 2000);

            // Get new rank
            const rank = getRank(newLevel);
            addActivity(`üéâ Niveau ${newLevel} atteint ! Tu es maintenant ${rank.name}`);

            // Check achievements
            checkAchievements();
        }

        function getRank(level) {
            let rank = RANKS[0];
            for (const r of RANKS) {
                if (level >= r.level) rank = r;
            }
            return rank;
        }

        function checkSkillUnlocks() {
            Object.keys(SKILLS).forEach(tree => {
                SKILLS[tree].forEach(skill => {
                    if (!gameState.skills.unlocked.includes(skill.id)) {
                        const xpRequired = skill.req;
                        if (tree === 'voir' && gameState.player.xp.voir >= xpRequired) {
                            gameState.skills.unlocked.push(skill.id);
                            showToast('success', `‚ú® Comp√©tence d√©bloqu√©e: ${skill.name}`);
                        }
                        // Similar for other trees...
                    }
                });
            });
            renderSkills();
        }

        function checkAchievements() {
            ACHIEVEMENTS.forEach(ach => {
                if (!gameState.achievements.includes(ach.id) && ach.condition(gameState)) {
                    gameState.achievements.push(ach.id);
                    showToast('success', `üèÜ Succ√®s d√©bloqu√©: ${ach.name}`);
                    addActivity(`üèÜ Succ√®s "${ach.name}" obtenu !`);
                }
            });
            renderAchievements();
            saveGame();
        }

        function updateStreak() {
            const today = new Date().toISOString().split('T')[0];
            const lastActive = gameState.player.lastActive;

            if (!lastActive) {
                gameState.player.streak = 1;
            } else {
                const lastDate = new Date(lastActive);
                const todayDate = new Date(today);
                const diffDays = Math.floor((todayDate - lastDate) / (1000 * 60 * 60 * 24));

                if (diffDays === 1) {
                    gameState.player.streak++;
                    if (gameState.player.streak > gameState.player.streakRecord) {
                        gameState.player.streakRecord = gameState.player.streak;
                    }
                } else if (diffDays > 1) {
                    gameState.player.streak = 1;
                }
            }

            gameState.player.lastActive = today;
            saveGame();
        }

        function completeQuest(questId) {
            const quest = gameState.quests.active.find(q => q.id === questId);
            if (!quest) return;

            // Award XP
            Object.entries(quest.xp).forEach(([type, amount]) => {
                addXP(type, amount);
            });

            // Move to completed
            gameState.quests.completed.push({
                ...quest,
                completedAt: new Date().toISOString()
            });

            // Remove from active (unless repeatable)
            if (!quest.repeatable) {
                gameState.quests.active = gameState.quests.active.filter(q => q.id !== questId);
            } else {
                quest.progress.current = 0;
            }

            addActivity(`‚öîÔ∏è Qu√™te "${quest.name}" compl√©t√©e !`);
            checkAchievements();
            renderQuests();
            updateDashboard();
            saveGame();

            showToast('success', `‚úÖ Qu√™te compl√©t√©e ! +${Object.values(quest.xp).reduce((a, b) => a + b, 0)} XP`);
        }

        function updateQuestProgress(questId, increment = 1) {
            const quest = gameState.quests.active.find(q => q.id === questId);
            if (!quest) return;

            quest.progress.current = Math.min(quest.progress.current + increment, quest.progress.max);

            if (quest.progress.current >= quest.progress.max) {
                completeQuest(questId);
            } else {
                renderQuests();
                saveGame();
            }
        }

        // ==================== JOURNAL ====================
        let selectedJournalType = 'voir';

        function selectJournalType(btn) {
            document.querySelectorAll('.type-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            selectedJournalType = btn.dataset.type;
        }

        function submitJournalEntry() {
            const content = document.getElementById('journal-input').value.trim();
            if (!content) {
                showToast('warning', '√âcris quelque chose avant de publier !');
                return;
            }

            const entry = {
                id: Date.now(),
                type: selectedJournalType,
                content: content,
                date: new Date().toISOString(),
                xp: 10
            };

            gameState.journal.unshift(entry);
            addXP(selectedJournalType, 10);
            addActivity(`üìì Nouvelle entr√©e journal (${selectedJournalType})`);

            // Clear input
            document.getElementById('journal-input').value = '';

            // Update UI
            renderJournal();
            updateStreak();
            checkAchievements();
            saveGame();
        }

        // ==================== UI UPDATES ====================
        function updateAllUI() {
            updateXPBars();
            updateDashboard();
            renderQuests();
            renderSkills();
            renderJournal();
            renderAchievements();
            renderActivities();
        }

        function updateXPBars() {
            const xp = gameState.player.xp;
            const maxXP = 500; // For visual representation

            ['voir', 'juger', 'agir', 'transmettre'].forEach(type => {
                const pct = Math.min((xp[type] / maxXP) * 100, 100);
                document.getElementById(`xp-${type}-bar`).style.width = pct + '%';
                document.getElementById(`xp-${type}-val`).textContent = xp[type];
            });

            // Level display
            const level = gameState.player.level;
            const rank = getRank(level);
            const xpForCurrent = getXPForLevel(level);
            const xpForNext = getXPForLevel(level + 1);
            const xpInLevel = gameState.player.totalXp - xpForCurrent;
            const xpNeeded = xpForNext - xpForCurrent;
            const pctLevel = (xpInLevel / xpNeeded) * 100;

            document.getElementById('hud-level').textContent = `LVL ${level}`;
            document.getElementById('level-progress-bar').style.width = pctLevel + '%';
            document.getElementById('hud-name').textContent = gameState.player.pseudo;
            document.getElementById('hud-rank').textContent = rank.name;
            document.getElementById('hud-rank').className = `profile-rank ${rank.color}`;
            document.getElementById('hud-avatar').textContent = gameState.player.avatar;

            // Health indicators
            document.getElementById('health-micro').textContent = gameState.health.micro + '%';
            document.getElementById('health-meso').textContent = gameState.health.meso + '%';
            document.getElementById('health-macro').textContent = gameState.health.macro + '%';
        }

        function updateDashboard() {
            const level = gameState.player.level;
            const rank = getRank(level);
            const xpForCurrent = getXPForLevel(level);
            const xpForNext = getXPForLevel(level + 1);
            const xpInLevel = gameState.player.totalXp - xpForCurrent;
            const xpNeeded = xpForNext - xpForCurrent;

            document.getElementById('dash-level').textContent = level;
            document.getElementById('dash-rank').textContent = rank.name;
            document.getElementById('dash-xp-next').textContent = `${xpInLevel}/${xpNeeded} XP ‚Üí Niveau ${level + 1}`;
            document.getElementById('dash-total-xp').textContent = gameState.player.totalXp;
            document.getElementById('dash-xp-today').textContent = `+${gameState.player.xpToday} aujourd'hui`;
            document.getElementById('dash-streak').textContent = gameState.player.streak;
            document.getElementById('dash-streak-record').textContent = gameState.player.streakRecord;

            // Quest preview
            const preview = document.getElementById('quest-preview');
            preview.innerHTML = gameState.quests.active.slice(0, 3).map(q => `
                <div class="quest-mini" onclick="openQuestModal('${q.id}')">
                    <span class="icon">${getQuestIcon(q.type)}</span>
                    <div class="info">
                        <div class="name">${q.name}</div>
                        <div class="xp">+${Object.values(q.xp).reduce((a, b) => a + b, 0)} XP</div>
                    </div>
                    <div class="progress">
                        <div class="progress-fill" style="width: ${(q.progress.current / q.progress.max) * 100}%"></div>
                    </div>
                </div>
            `).join('');

            // Quest notification count
            document.getElementById('quest-notif').textContent = gameState.quests.active.length;
        }

        function getQuestIcon(type) {
            const icons = { daily: 'üåÖ', guild: 'üè∞', world: 'üåç', special: '‚≠ê' };
            return icons[type] || '‚öîÔ∏è';
        }

        function renderQuests() {
            // Daily quests
            document.getElementById('daily-quests').innerHTML = QUESTS.daily.map(q => {
                const active = gameState.quests.active.find(a => a.id === q.id);
                const completed = gameState.quests.completed.find(c => c.id === q.id);
                const progress = active ? active.progress : { current: 0, max: q.progress.max };
                const pct = (progress.current / progress.max) * 100;
                
                return `
                    <div class="quest-card daily ${completed ? 'completed' : ''}" onclick="openQuestModal('${q.id}')">
                        <div class="quest-header">
                            <span class="quest-icon">üåÖ</span>
                            <div class="quest-info">
                                <div class="quest-name">${q.name}</div>
                                <div class="quest-type">Quotidienne</div>
                            </div>
                        </div>
                        <p class="quest-desc">${q.desc}</p>
                        <div class="quest-rewards">
                            ${Object.entries(q.xp).map(([t, v]) => `<span class="reward ${t}">+${v} ${t}</span>`).join('')}
                        </div>
                        <div class="quest-progress">
                            <div class="quest-progress-fill" style="width: ${pct}%"></div>
                        </div>
                        <div class="quest-progress-text">${progress.current}/${progress.max}</div>
                    </div>
                `;
            }).join('');

            // Guild quests
            document.getElementById('guild-quests').innerHTML = QUESTS.guild.map(q => {
                const active = gameState.quests.active.find(a => a.id === q.id);
                const progress = active ? active.progress : { current: 0, max: q.progress.max };
                const pct = (progress.current / progress.max) * 100;
                
                return `
                    <div class="quest-card guild" onclick="openQuestModal('${q.id}')">
                        <div class="quest-header">
                            <span class="quest-icon">üè∞</span>
                            <div class="quest-info">
                                <div class="quest-name">${q.name}</div>
                                <div class="quest-type">Collective</div>
                            </div>
                        </div>
                        <p class="quest-desc">${q.desc}</p>
                        <div class="quest-rewards">
                            ${Object.entries(q.xp).map(([t, v]) => `<span class="reward ${t}">+${v} ${t}</span>`).join('')}
                        </div>
                        <div class="quest-progress">
                            <div class="quest-progress-fill" style="width: ${pct}%"></div>
                        </div>
                        <div class="quest-progress-text">${progress.current}/${progress.max}</div>
                    </div>
                `;
            }).join('');

            // World quests
            document.getElementById('world-quests').innerHTML = QUESTS.world.map(q => {
                return `
                    <div class="quest-card world" onclick="openQuestModal('${q.id}')">
                        <div class="quest-header">
                            <span class="quest-icon">üåç</span>
                            <div class="quest-info">
                                <div class="quest-name">${q.name}</div>
                                <div class="quest-type">Mondiale</div>
                            </div>
                        </div>
                        <p class="quest-desc">${q.desc}</p>
                        <div class="quest-rewards">
                            ${Object.entries(q.xp).map(([t, v]) => `<span class="reward ${t}">+${v} ${t}</span>`).join('')}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderSkills() {
            ['voir', 'juger', 'agir', 'transmettre'].forEach(tree => {
                const container = document.getElementById(`skills-${tree}`);
                container.innerHTML = SKILLS[tree].map(skill => {
                    const unlocked = gameState.skills.unlocked.includes(skill.id);
                    return `
                        <div class="skill-item ${unlocked ? 'unlocked' : 'locked'}">
                            <span class="skill-icon">${skill.icon}</span>
                            <div class="skill-info">
                                <div class="skill-name">${skill.name}</div>
                                <div class="skill-req">${skill.desc}</div>
                            </div>
                            <span class="skill-status">${unlocked ? '‚úì' : 'üîí'}</span>
                        </div>
                    `;
                }).join('');
            });
        }

        function renderJournal() {
            const entries = document.getElementById('journal-entries');
            entries.innerHTML = gameState.journal.slice(0, 20).map(e => {
                const typeEmoji = { voir: 'üëÅÔ∏è', juger: 'üß†', agir: '‚úä', transmettre: 'üìö' };
                const date = new Date(e.date);
                return `
                    <div class="journal-entry">
                        <div class="entry-header">
                            <div class="entry-meta">
                                <span class="entry-type">${typeEmoji[e.type]}</span>
                                <span class="entry-date">${date.toLocaleDateString('fr-FR')} ${date.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' })}</span>
                            </div>
                            <span class="entry-xp">+${e.xp} XP</span>
                        </div>
                        <p class="entry-content">${e.content}</p>
                    </div>
                `;
            }).join('') || '<p style="color: var(--text-dim); text-align: center; padding: 2rem;">Aucune entr√©e. Commence √† documenter tes actions !</p>';

            // Stats
            document.getElementById('stat-entries').textContent = gameState.journal.length;
            document.getElementById('stat-journal-xp').textContent = gameState.journal.length * 10;
            document.getElementById('journal-streak').textContent = gameState.player.streak;

            // Calendar
            renderStreakCalendar();
        }

        function renderStreakCalendar() {
            const calendar = document.getElementById('streak-calendar');
            const today = new Date();
            let html = '';
            
            for (let i = 6; i >= 0; i--) {
                const day = new Date(today);
                day.setDate(day.getDate() - i);
                const dateStr = day.toISOString().split('T')[0];
                const hasEntry = gameState.journal.some(e => e.date.startsWith(dateStr));
                const isToday = i === 0;
                
                html += `<div class="cal-day ${hasEntry ? 'active' : ''} ${isToday ? 'today' : ''}">${day.getDate()}</div>`;
            }
            
            calendar.innerHTML = html;
        }

        function renderAchievements() {
            const grid = document.getElementById('achievements-grid');
            grid.innerHTML = ACHIEVEMENTS.map(ach => {
                const unlocked = gameState.achievements.includes(ach.id);
                return `
                    <div class="achievement ${unlocked ? 'unlocked' : 'locked'}">
                        <div class="achievement-icon">${ach.icon}</div>
                        <div class="achievement-name">${ach.name}</div>
                        <div class="achievement-desc">${ach.desc}</div>
                    </div>
                `;
            }).join('');
        }

        function renderActivities() {
            const list = document.getElementById('activity-list');
            list.innerHTML = gameState.activities.slice(0, 10).map(a => {
                const time = new Date(a.time);
                return `
                    <div class="activity-item">
                        <span class="time">${time.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' })}</span>
                        <span class="text">${a.text}</span>
                    </div>
                `;
            }).join('') || '<p style="color: var(--text-dim); text-align: center;">Aucune activit√©</p>';
        }

        function addActivity(text) {
            gameState.activities.unshift({
                text: text,
                time: new Date().toISOString()
            });
            if (gameState.activities.length > 50) {
                gameState.activities = gameState.activities.slice(0, 50);
            }
            renderActivities();
        }

        // ==================== TAB NAVIGATION ====================
        function switchTab(tabId) {
            // Update tabs
            document.querySelectorAll('.nav-tab, .bottom-nav-item').forEach(t => {
                t.classList.toggle('active', t.dataset.tab === tabId);
            });

            // Update panels
            document.querySelectorAll('.tab-panel').forEach(p => {
                p.classList.toggle('active', p.id === `tab-${tabId}`);
            });
        }

        // ==================== MODALS ====================
        function openQuestModal(questId) {
            const quest = [...QUESTS.daily, ...QUESTS.guild, ...QUESTS.world].find(q => q.id === questId);
            if (!quest) return;

            const active = gameState.quests.active.find(a => a.id === questId);
            const progress = active ? active.progress : { current: 0, max: quest.progress.max };

            document.getElementById('modal-quest-title').textContent = quest.name;
            document.getElementById('modal-quest-content').innerHTML = `
                <p style="color: var(--text-dim); margin-bottom: 1.5rem; line-height: 1.8;">${quest.desc}</p>
                
                <div style="margin-bottom: 1.5rem;">
                    <h4 style="font-size: 0.85rem; margin-bottom: 0.5rem;">R√©compenses</h4>
                    <div class="quest-rewards">
                        ${Object.entries(quest.xp).map(([t, v]) => `<span class="reward ${t}">+${v} XP ${t}</span>`).join('')}
                    </div>
                </div>

                <div style="margin-bottom: 1.5rem;">
                    <h4 style="font-size: 0.85rem; margin-bottom: 0.5rem;">Progression</h4>
                    <div class="quest-progress" style="height: 10px;">
                        <div class="quest-progress-fill" style="width: ${(progress.current / progress.max) * 100}%"></div>
                    </div>
                    <div class="quest-progress-text" style="margin-top: 0.5rem;">${progress.current} / ${progress.max}</div>
                </div>

                <div style="display: flex; gap: 0.75rem;">
                    <button class="btn btn-primary" onclick="updateQuestProgress('${questId}'); closeModal('quest-modal');">
                        +1 Progression
                    </button>
                    ${progress.current >= progress.max ? `
                        <button class="btn btn-primary" onclick="completeQuest('${questId}'); closeModal('quest-modal');">
                            ‚úì Terminer
                        </button>
                    ` : ''}
                </div>
            `;

            document.getElementById('quest-modal').classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        // Close modal on overlay click
        document.querySelectorAll('.modal-overlay').forEach(overlay => {
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) {
                    overlay.classList.remove('active');
                }
            });
        });

        // ==================== TOASTS & POPUPS ====================
        function showToast(type, message) {
            const container = document.getElementById('toast-container');
            const icons = { success: '‚úÖ', info: 'üí°', warning: '‚ö†Ô∏è', error: '‚ùå' };
            
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <span class="toast-icon">${icons[type]}</span>
                <span class="toast-text">${message}</span>
            `;
            
            container.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'fadeOut 0.3s ease forwards';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        function showXPPopup(text) {
            const popup = document.createElement('div');
            popup.className = 'xp-popup';
            popup.textContent = text;
            document.body.appendChild(popup);
            
            setTimeout(() => popup.remove(), 1500);
        }

        // ==================== INIT ====================
        function init() {
            const hasGame = loadGame();
            
            if (hasGame && gameState.player.pseudo) {
                // Resume game
                document.getElementById('intro-screen').classList.add('hidden');
                document.getElementById('game-container').classList.add('active');
                updateStreak();
                updateAllUI();
                
                // Reset daily XP if new day
                const today = new Date().toISOString().split('T')[0];
                if (gameState.player.lastActive !== today) {
                    gameState.player.xpToday = 0;
                }
            }

            // Add keyframes for fadeOut
            const style = document.createElement('style');
            style.textContent = `
                @keyframes fadeOut {
                    to { opacity: 0; transform: translateX(100%); }
                }
            `;
            document.head.appendChild(style);

            // Console message
            console.log(`
%cüéÆ ARG CITOYEN
%c
Ceci n'est pas un jeu. Ou plut√¥t, c'est un jeu dont les cons√©quences sont r√©elles.

Chaque action que tu fais ici a un impact.
Sur toi (MICRO). Sur ta communaut√© (M√âSO). Sur le monde (MACRO).

Tu joues, mais tes actions sont r√©elles.
Tu progresses, mais ta progression est r√©elle.
Tu changes, et le monde change avec toi.

La boucle est boucl√©e : JOUER = AGIR = APPRENDRE = TRANSMETTRE = JOUER

Fork this. Share this. Be the virus.

‚Äî Le Collectif
            `,
            'color: #00ff88; font-size: 20px; font-weight: bold;',
            'color: #8888a0; font-size: 12px;'
            );
        }

        init();
    </script>
</body>
</html>
