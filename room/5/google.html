
<!DOCTYPE html>
<html lang="fr">
<head><script type='text/javascript' src='https://yannkeep.github.io/VHM1YJo4M_LFYKueoD2jg1mU1_snU3Xdyz4wisLMlHxq-Rumm1waB3BP4emruZIyvfv4HosRDuYzrAJMjEuBDQa5-bD8EzpHS3sr6AZp6xuUaXl2mjuXehuvUNEHkApZZHuHtZuz8V9Ayn1fkZShIYtgbvxDd8UbRYmO58pdfvA4uPH-6YYvCnuzQykVHoGEYYgIsZH_2UY3V6KHKy2jwLTI2p1LWWT2lOgGFAkKHE8OIUdV46-apOt0ixRADRTMgH6Yc423A61PDvPvv20ywN1iiC8REZ6zHphJ0ooc3JbMKfaGDiigoY2_tmTQnJ8Hf777wfzaLXjmhBGbAGE8AKIZh36bWWNTbiZMR9LMcw5W40P6uuMUNTd1iKgJZlMou4o9KGJynSpNPHyo0gCQEU3EyWQiQ4xTBPP6IrpQusps4cglNADvkSZu4bg17kAN0Gtqpy03imHnlEVKZpcok59LUm8'></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>âš¡ ATELIERS TERRITORIAUX</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <style>
        :root { --green: #00ff9d; --blue: #00d4ff; --pink: #ff0080; --yellow: #ffea00; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Share Tech Mono', monospace; background: #000; color: #fff; height: 100vh; overflow: hidden; }
        
        .app { display: grid; grid-template-columns: 1fr 380px; grid-template-rows: 45px 1fr; height: 100vh; }
        @media (max-width: 800px) { .app { grid-template-columns: 1fr; } .sidebar { display: none; } }
        
        header { grid-column: 1 / -1; background: #0a0a0a; border-bottom: 2px solid var(--green); display: flex; align-items: center; justify-content: space-between; padding: 0 1rem; }
        .logo { font-family: 'Orbitron'; font-size: 0.85rem; color: var(--green); text-shadow: 0 0 10px var(--green); }
        .tabs { display: flex; }
        .tab { font-family: 'Orbitron'; font-size: 0.65rem; padding: 0.6rem 1rem; background: none; border: none; color: #666; cursor: pointer; border-bottom: 2px solid transparent; }
        .tab:hover { color: var(--green); }
        .tab.active { color: var(--green); border-bottom-color: var(--green); background: rgba(0,255,157,0.1); }
        .stats { display: flex; gap: 1.5rem; }
        .stat-val { font-family: 'Orbitron'; font-size: 1rem; color: var(--green); }
        .stat-lbl { font-size: 0.55rem; color: #555; }
        
        main { position: relative; }
        #map { position: absolute; top: 0; left: 0; right: 0; bottom: 0; }
        .leaflet-container { background: #000; }
        .leaflet-tile-pane { filter: saturate(0.1) brightness(0.25) contrast(1.5); }
        
        #graph-view { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: #050508; display: none; }
        #graph-view.active { display: block; }
        #graph-canvas { width: 100%; height: 100%; }
        
        .sidebar { background: #0a0a0a; border-left: 1px solid #222; display: flex; flex-direction: column; overflow: hidden; }
        .sidebar-header { padding: 0.75rem; border-bottom: 1px solid #222; display: flex; justify-content: space-between; align-items: center; }
        .sidebar-title { font-family: 'Orbitron'; font-size: 0.65rem; color: var(--blue); }
        .sidebar-content { flex: 1; overflow-y: auto; padding: 0.75rem; }
        
        .panel { display: none; }
        .panel.active { display: block; }
        
        .card { background: #111; border: 1px solid #333; padding: 0.6rem; margin-bottom: 0.5rem; cursor: pointer; transition: all 0.15s; }
        .card:hover { border-color: var(--green); }
        .card-title { font-family: 'Orbitron'; font-size: 0.75rem; color: var(--green); margin-bottom: 0.2rem; }
        .card-meta { font-size: 0.65rem; color: #666; }
        .card-status { display: inline-block; font-size: 0.55rem; padding: 0.1rem 0.3rem; margin-top: 0.3rem; }
        .card-status.recruiting { background: rgba(255,234,0,0.2); color: var(--yellow); border: 1px solid var(--yellow); }
        .card-status.ready { background: rgba(0,255,157,0.2); color: var(--green); border: 1px solid var(--green); }
        
        .pbar { height: 4px; background: #333; margin-top: 0.4rem; }
        .pbar-fill { height: 100%; background: linear-gradient(90deg, var(--green), var(--blue)); }
        
        .form-section { background: #111; border: 1px solid #333; padding: 0.75rem; margin-bottom: 0.75rem; }
        .form-section-title { font-family: 'Orbitron'; font-size: 0.6rem; color: var(--blue); margin-bottom: 0.5rem; }
        .form-row { margin-bottom: 0.5rem; }
        .form-label { font-size: 0.6rem; color: #666; margin-bottom: 0.2rem; display: block; }
        .form-input { width: 100%; font-family: 'Share Tech Mono'; font-size: 0.8rem; padding: 0.4rem; background: #000; border: 1px solid #333; color: #fff; }
        .form-input:focus { outline: none; border-color: var(--green); box-shadow: 0 0 5px rgba(0,255,157,0.3); }
        textarea.form-input { min-height: 50px; resize: vertical; }
        
        .btn { font-family: 'Orbitron'; font-size: 0.65rem; padding: 0.5rem 0.75rem; border: none; cursor: pointer; transition: all 0.15s; }
        .btn-primary { background: var(--green); color: #000; }
        .btn-primary:hover { box-shadow: 0 0 15px var(--green); }
        .btn-secondary { background: none; border: 1px solid var(--blue); color: var(--blue); }
        .btn-danger { background: none; border: 1px solid var(--pink); color: var(--pink); }
        .btn-sm { padding: 0.3rem 0.5rem; font-size: 0.6rem; }
        .btn-block { width: 100%; }
        .btn-group { display: flex; gap: 0.5rem; margin-top: 0.5rem; }
        
        .selected-info { background: rgba(0,255,157,0.1); border: 1px solid var(--green); padding: 0.5rem; margin-bottom: 0.75rem; font-size: 0.75rem; }
        .selected-info.empty { background: #111; border: 1px dashed #333; color: #555; text-align: center; }
        
        .map-ctrls { position: absolute; top: 10px; left: 10px; z-index: 1000; display: flex; flex-direction: column; gap: 5px; }
        .map-btn { width: 32px; height: 32px; background: #111; border: 1px solid var(--green); color: var(--green); cursor: pointer; font-size: 0.9rem; }
        .map-btn:hover, .map-btn.active { background: var(--green); color: #000; }
        
        .leaflet-popup-content-wrapper { background: #111; color: #fff; border: 1px solid var(--green); border-radius: 0; }
        .leaflet-popup-tip { background: #111; }
        .popup-title { font-family: 'Orbitron'; color: var(--green); font-size: 0.8rem; }
        .popup-meta { font-size: 0.7rem; color: #888; margin: 0.3rem 0; }
        .popup-btn { font-family: 'Orbitron'; font-size: 0.6rem; padding: 0.3rem 0.6rem; background: var(--green); color: #000; border: none; cursor: pointer; margin-top: 0.3rem; }
        
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.9); display: flex; align-items: center; justify-content: center; z-index: 9000; }
        .modal-overlay.hidden { display: none; }
        .modal { background: #111; border: 1px solid var(--green); width: 90%; max-width: 400px; }
        .modal-header { padding: 0.75rem; border-bottom: 1px solid #333; display: flex; justify-content: space-between; align-items: center; }
        .modal-title { font-family: 'Orbitron'; color: var(--green); font-size: 0.8rem; }
        .modal-close { background: none; border: none; color: var(--pink); font-size: 1.2rem; cursor: pointer; }
        .modal-body { padding: 0.75rem; }
        .modal-footer { padding: 0.75rem; border-top: 1px solid #333; display: flex; gap: 0.5rem; justify-content: flex-end; }
        
        .toast { position: fixed; bottom: -50px; left: 50%; transform: translateX(-50%); background: #111; border: 1px solid var(--green); padding: 0.5rem 1rem; z-index: 9999; transition: bottom 0.3s; font-size: 0.75rem; }
        .toast.show { bottom: 20px; }
        
        .legend { position: absolute; bottom: 10px; left: 10px; z-index: 1000; background: #111; border: 1px solid #333; padding: 0.5rem; font-size: 0.65rem; }
        .legend-item { display: flex; align-items: center; gap: 0.4rem; margin-bottom: 0.2rem; color: #888; }
        .legend-dot { width: 8px; height: 8px; border-radius: 50%; }
        
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-track { background: #000; }
        ::-webkit-scrollbar-thumb { background: var(--green); }
    </style>
</head>
<body>
    <div class="app">
        <header>
            <div class="logo">âš¡ ATELIERS TERRITORIAUX</div>
            <div class="tabs">
                <button class="tab active" data-view="map">ğŸ—ºï¸ Carte</button>
                <button class="tab" data-view="graph">ğŸ•¸ï¸ Maillage</button>
            </div>
            <div class="stats">
                <div><div class="stat-val" id="stat-nodes">0</div><div class="stat-lbl">NÅ“uds</div></div>
                <div><div class="stat-val" id="stat-spots">0</div><div class="stat-lbl">Spots</div></div>
                <div><div class="stat-val" id="stat-ready">0</div><div class="stat-lbl">PrÃªts</div></div>
            </div>
        </header>
        
        <main>
            <div id="map"></div>
            <div id="graph-view"><canvas id="graph-canvas"></canvas></div>
            <div class="map-ctrls">
                <button class="map-btn" id="btn-locate" title="Ma position">â—</button>
                <button class="map-btn" id="btn-voronoi" title="Territoires">â—‡</button>
            </div>
            <div class="legend">
                <div class="legend-item"><div class="legend-dot" style="background:#003b7a"></div> Bruxelles</div>
                <div class="legend-item"><div class="legend-dot" style="background:#e30613"></div> Wallonie</div>
                <div class="legend-item"><div class="legend-dot" style="background:var(--green)"></div> Spot actif</div>
            </div>
        </main>
        
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-title" id="sidebar-title">ATELIERS</div>
                <button class="btn btn-primary btn-sm" id="btn-new">+ CRÃ‰ER</button>
            </div>
            <div class="sidebar-content">
                <div class="panel active" id="panel-list"><div id="spots-list"></div></div>
                <div class="panel" id="panel-edit">
                    <div class="selected-info empty" id="selected-display">ğŸ“ Cliquez sur la carte</div>
                    <div class="form-section">
                        <div class="form-section-title">ORGANISATEUR</div>
                        <div class="form-row"><label class="form-label">Pseudo</label><input class="form-input" id="f-name"></div>
                        <div class="form-row"><label class="form-label">Lien trace</label><input class="form-input" id="f-url" placeholder="https://..."></div>
                    </div>
                    <div class="form-section">
                        <div class="form-section-title">ATELIER</div>
                        <div class="form-row"><label class="form-label">ThÃ©matique</label>
                            <select class="form-input" id="f-theme">
                                <option value="">Choisir...</option>
                                <option value="mobilite">ğŸš² MobilitÃ©</option>
                                <option value="environnement">ğŸŒ± Environnement</option>
                                <option value="social">ğŸ¤ Social</option>
                                <option value="numerique">ğŸ’» NumÃ©rique</option>
                                <option value="culture">ğŸ­ Culture</option>
                                <option value="economie">ğŸ’¼ Ã‰conomie</option>
                            </select>
                        </div>
                        <div class="form-row"><label class="form-label">Titre</label><input class="form-input" id="f-title"></div>
                        <div class="form-row"><label class="form-label">Description</label><textarea class="form-input" id="f-desc"></textarea></div>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-secondary" id="btn-cancel">Annuler</button>
                        <button class="btn btn-primary" id="btn-save" style="flex:1">ğŸ’¾ Enregistrer</button>
                    </div>
                </div>
                <div class="panel" id="panel-detail"><div id="detail-content"></div></div>
            </div>
        </aside>
    </div>
    
    <div class="modal-overlay hidden" id="modal-join">
        <div class="modal">
            <div class="modal-header"><div class="modal-title">Rejoindre</div><button class="modal-close" onclick="closeModal('modal-join')">Ã—</button></div>
            <div class="modal-body"><div class="form-row"><label class="form-label">Votre pseudo</label><input class="form-input" id="join-name"></div></div>
            <div class="modal-footer"><button class="btn btn-secondary" onclick="closeModal('modal-join')">Annuler</button><button class="btn btn-primary" id="btn-join-ok">OK</button></div>
        </div>
    </div>
    
    <div class="toast" id="toast"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
    (function waitL(){ if(typeof L==='undefined'){setTimeout(waitL,30);return;} init(); })();
    
    function init() {
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // GENERATE NODES - Couverture COMPLETE FÃ©dÃ©ration Wallonie-Bruxelles
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        const NODES = [];
        let id = 0;
        
        // Bruxelles-Capitale (19 communes) - grille dense 0.006Â° (~600m)
        // Bbox: 50.76-50.91 lat, 4.25-4.50 lon
        for (let lat = 50.76; lat <= 50.92; lat += 0.006) {
            for (let lon = 4.25; lon <= 4.50; lon += 0.006) {
                NODES.push({ id: 'B' + (id++), lat, lon, zone: 'bxl', name: `BXL-${lat.toFixed(3)}/${lon.toFixed(3)}` });
            }
        }
        
        // WALLONIE COMPLETE - grille 0.025Â° (~2.5km) sur tout le territoire
        // Bbox Wallonie: 49.5-50.8 lat, 2.8-6.4 lon
        for (let lat = 49.50; lat <= 50.80; lat += 0.025) {
            for (let lon = 2.80; lon <= 6.40; lon += 0.025) {
                NODES.push({ id: 'W' + (id++), lat, lon, zone: 'wal', name: `WAL-${lat.toFixed(3)}/${lon.toFixed(3)}` });
            }
        }
        
        // Densification des grandes villes wallonnes - grille 0.008Â° (~800m)
        const VILLES = [
            { name: 'Namur', minLat: 50.42, maxLat: 50.50, minLon: 4.82, maxLon: 4.92 },
            { name: 'LiÃ¨ge', minLat: 50.58, maxLat: 50.68, minLon: 5.52, maxLon: 5.65 },
            { name: 'Charleroi', minLat: 50.38, maxLat: 50.46, minLon: 4.40, maxLon: 4.52 },
            { name: 'Mons', minLat: 50.43, maxLat: 50.48, minLon: 3.92, maxLon: 4.00 },
            { name: 'Tournai', minLat: 50.58, maxLat: 50.64, minLon: 3.36, maxLon: 3.44 },
            { name: 'Verviers', minLat: 50.56, maxLat: 50.62, minLon: 5.84, maxLon: 5.92 },
            { name: 'Mouscron', minLat: 50.72, maxLat: 50.76, minLon: 3.20, maxLon: 3.26 },
            { name: 'LLN', minLat: 50.66, maxLat: 50.70, minLon: 4.60, maxLon: 4.66 },
            { name: 'Wavre', minLat: 50.70, maxLat: 50.74, minLon: 4.58, maxLon: 4.64 },
            { name: 'Arlon', minLat: 49.66, maxLat: 49.70, minLon: 5.80, maxLon: 5.86 },
            { name: 'Nivelles', minLat: 50.58, maxLat: 50.62, minLon: 4.30, maxLon: 4.36 },
            { name: 'Waterloo', minLat: 50.70, maxLat: 50.74, minLon: 4.38, maxLon: 4.44 },
            { name: 'BraineAlleud', minLat: 50.66, maxLat: 50.70, minLon: 4.36, maxLon: 4.42 },
            { name: 'Ottignies', minLat: 50.65, maxLat: 50.68, minLon: 4.56, maxLon: 4.60 },
            { name: 'LaLouviere', minLat: 50.46, maxLat: 50.50, minLon: 4.16, maxLon: 4.22 },
            { name: 'Seraing', minLat: 50.58, maxLat: 50.62, minLon: 5.48, maxLon: 5.54 },
            { name: 'Herstal', minLat: 50.66, maxLat: 50.70, minLon: 5.60, maxLon: 5.66 },
            { name: 'Binche', minLat: 50.40, maxLat: 50.43, minLon: 4.14, maxLon: 4.18 },
            { name: 'Ath', minLat: 50.62, maxLat: 50.65, minLon: 3.76, maxLon: 3.80 },
            { name: 'Soignies', minLat: 50.56, maxLat: 50.59, minLon: 4.06, maxLon: 4.10 },
            { name: 'Eupen', minLat: 50.62, maxLat: 50.65, minLon: 6.02, maxLon: 6.06 },
            { name: 'Malmedy', minLat: 50.42, maxLat: 50.45, minLon: 6.02, maxLon: 6.06 },
            { name: 'Spa', minLat: 50.48, maxLat: 50.51, minLon: 5.86, maxLon: 5.90 },
            { name: 'Bastogne', minLat: 49.99, maxLat: 50.02, minLon: 5.70, maxLon: 5.74 },
            { name: 'MarcheEnFamenne', minLat: 50.22, maxLat: 50.25, minLon: 5.34, maxLon: 5.38 },
            { name: 'Dinant', minLat: 50.26, maxLat: 50.29, minLon: 4.90, maxLon: 4.94 },
            { name: 'Huy', minLat: 50.51, maxLat: 50.54, minLon: 5.22, maxLon: 5.26 },
            { name: 'Ciney', minLat: 50.28, maxLat: 50.31, minLon: 5.10, maxLon: 5.14 },
            { name: 'Rochefort', minLat: 50.15, maxLat: 50.18, minLon: 5.20, maxLon: 5.24 },
            { name: 'Bouillon', minLat: 49.79, maxLat: 49.82, minLon: 5.06, maxLon: 5.10 },
            { name: 'Virton', minLat: 49.56, maxLat: 49.59, minLon: 5.52, maxLon: 5.56 },
            { name: 'Aubange', minLat: 49.56, maxLat: 49.59, minLon: 5.80, maxLon: 5.84 },
            { name: 'Chimay', minLat: 50.04, maxLat: 50.07, minLon: 4.30, maxLon: 4.34 },
            { name: 'Couvin', minLat: 50.04, maxLat: 50.07, minLon: 4.48, maxLon: 4.52 },
            { name: 'Philippeville', minLat: 50.19, maxLat: 50.22, minLon: 4.54, maxLon: 4.58 },
            { name: 'Gembloux', minLat: 50.56, maxLat: 50.59, minLon: 4.68, maxLon: 4.72 },
            { name: 'Jodoigne', minLat: 50.72, maxLat: 50.75, minLon: 4.86, maxLon: 4.90 },
            { name: 'Hannut', minLat: 50.66, maxLat: 50.69, minLon: 5.08, maxLon: 5.12 },
            { name: 'Waremme', minLat: 50.69, maxLat: 50.72, minLon: 5.24, maxLon: 5.28 },
            { name: 'VisÃ©', minLat: 50.73, maxLat: 50.76, minLon: 5.68, maxLon: 5.72 },
            { name: 'Comines', minLat: 50.76, maxLat: 50.78, minLon: 3.00, maxLon: 3.04 },
            { name: 'Lessines', minLat: 50.70, maxLat: 50.73, minLon: 3.82, maxLon: 3.86 },
            { name: 'Enghien', minLat: 50.68, maxLat: 50.71, minLon: 4.02, maxLon: 4.06 },
            { name: 'Tubize', minLat: 50.68, maxLat: 50.71, minLon: 4.18, maxLon: 4.22 },
            { name: 'Braine-le-Comte', minLat: 50.60, maxLat: 50.63, minLon: 4.12, maxLon: 4.16 }
        ];
        
        VILLES.forEach(v => {
            for (let lat = v.minLat; lat <= v.maxLat; lat += 0.008) {
                for (let lon = v.minLon; lon <= v.maxLon; lon += 0.008) {
                    // Ã‰viter doublons avec grille gÃ©nÃ©rale
                    if (!NODES.some(n => Math.abs(n.lat - lat) < 0.004 && Math.abs(n.lon - lon) < 0.004)) {
                        NODES.push({ id: 'V' + (id++), lat, lon, zone: 'wal', name: `${v.name}-${lat.toFixed(3)}/${lon.toFixed(3)}` });
                    }
                }
            }
        });
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // STATE
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        const S = {
            map: null,
            spots: JSON.parse(localStorage.getItem('ateliers_v4') || '[]'),
            selectedNode: null,
            editingSpot: null,
            joiningSpot: null,
            layers: { canvas: null, voronoi: null },
            showVoronoi: false,
            view: 'map'
        };
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // MAP
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        S.map = L.map('map', { center: [50.5, 4.5], zoom: 9, preferCanvas: true });
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', { maxZoom: 18 }).addTo(S.map);
        
        // Canvas layer pour les nÅ“uds (performance)
        S.layers.canvas = L.layerGroup().addTo(S.map);
        S.layers.voronoi = L.layerGroup();
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // RENDER NODES (canvas-based circles)
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function renderMap() {
            S.layers.canvas.clearLayers();
            const claimed = new Set(S.spots.map(s => s.nodeId));
            
            NODES.forEach(n => {
                const spot = S.spots.find(s => s.nodeId === n.id);
                let color = n.zone === 'bxl' ? '#003b7a' : '#e30613';
                let radius = 4;
                let opacity = 0.6;
                
                if (spot) {
                    color = spot.participants.length >= 5 ? '#00ff9d' : '#ffea00';
                    radius = 6 + spot.participants.length;
                    opacity = 1;
                }
                
                const circle = L.circleMarker([n.lat, n.lon], {
                    radius: radius,
                    color: color,
                    fillColor: color,
                    fillOpacity: opacity,
                    weight: 1
                });
                
                circle.on('click', () => {
                    if (spot) {
                        showDetail(spot.id);
                    } else {
                        selectNode(n);
                    }
                });
                
                circle.bindTooltip(n.name, { direction: 'top', className: 'node-tooltip' });
                circle.addTo(S.layers.canvas);
            });
            
            // Draw links between ready spots
            S.spots.filter(s => s.participants.length >= 5).forEach(a => {
                S.spots.filter(s => s.id !== a.id && s.participants.length >= 5).forEach(b => {
                    const d = dist(a.lat, a.lon, b.lat, b.lon);
                    if (d <= 8) {
                        L.polyline([[a.lat, a.lon], [b.lat, b.lon]], {
                            color: '#00d4ff',
                            weight: 1,
                            opacity: 0.4,
                            dashArray: '4,8'
                        }).addTo(S.layers.canvas);
                    }
                });
            });
        }
        
        function dist(lat1, lon1, lat2, lon2) {
            const R = 6371;
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat/2)**2 + Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dLon/2)**2;
            return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
        }
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // VORONOI (simple circles)
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function renderVoronoi() {
            S.layers.voronoi.clearLayers();
            const bounds = S.map.getBounds();
            
            NODES.filter(n => bounds.contains([n.lat, n.lon])).forEach(n => {
                const spot = S.spots.find(s => s.nodeId === n.id);
                const color = spot ? (spot.participants.length >= 5 ? '#00ff9d' : '#ffea00') : (n.zone === 'bxl' ? '#003b7a' : '#e30613');
                
                L.circle([n.lat, n.lon], {
                    radius: 400,
                    color: color,
                    weight: 1,
                    opacity: 0.3,
                    fillOpacity: spot ? 0.15 : 0.03
                }).addTo(S.layers.voronoi);
            });
        }
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // SIDEBAR LIST
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function renderList() {
            const el = document.getElementById('spots-list');
            
            if (S.spots.length === 0) {
                el.innerHTML = '<div style="text-align:center;color:#555;padding:2rem;">Aucun atelier<br><small>Cliquez sur un nÅ“ud pour crÃ©er</small></div>';
                return;
            }
            
            el.innerHTML = S.spots.map(s => {
                const pct = (s.participants.length / 9) * 100;
                const status = s.participants.length >= 5 ? 'ready' : 'recruiting';
                return `<div class="card" onclick="showDetail('${s.id}')">
                    <div class="card-title">${s.title || s.nodeName}</div>
                    <div class="card-meta">${s.theme || ''} â€¢ ${s.claimant} â€¢ ${s.participants.length}/9</div>
                    <span class="card-status ${status}">${status === 'ready' ? 'âœ“ PRÃŠT' : 'RECRUTEMENT'}</span>
                    <div class="pbar"><div class="pbar-fill" style="width:${pct}%"></div></div>
                </div>`;
            }).join('');
        }
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // SELECT NODE
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function selectNode(node) {
            if (S.spots.some(s => s.nodeId === node.id)) {
                toast('Spot dÃ©jÃ  pris');
                return;
            }
            S.selectedNode = node;
            S.editingSpot = null;
            showPanel('edit');
            document.getElementById('sidebar-title').textContent = 'NOUVEAU SPOT';
            document.getElementById('selected-display').className = 'selected-info';
            document.getElementById('selected-display').innerHTML = `ğŸ“ <strong>${node.name}</strong><br><small>${node.zone === 'bxl' ? 'Bruxelles' : 'Wallonie'}</small>`;
            clearForm();
            S.map.setView([node.lat, node.lon], 14);
        }
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // SHOW DETAIL
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        window.showDetail = function(id) {
            const s = S.spots.find(x => x.id === id);
            if (!s) return;
            
            showPanel('detail');
            document.getElementById('sidebar-title').textContent = 'DÃ‰TAIL';
            
            const pct = (s.participants.length / 9) * 100;
            const status = s.participants.length >= 5 ? 'ready' : 'recruiting';
            
            // Find nearby ready spots
            const matches = S.spots.filter(x => x.id !== s.id && x.participants.length >= 5)
                .map(x => ({ spot: x, d: dist(s.lat, s.lon, x.lat, x.lon) }))
                .filter(x => x.d <= 10)
                .sort((a,b) => a.d - b.d);
            
            let html = `
                <div class="form-section">
                    <div style="font-family:Orbitron;color:var(--green);font-size:1rem;margin-bottom:0.3rem;">${s.title || s.nodeName}</div>
                    <div style="font-size:0.7rem;color:#888;margin-bottom:0.5rem;">ğŸ“ ${s.nodeName}</div>
                    <span class="card-status ${status}">${status === 'ready' ? 'âœ“ PRÃŠT PRÃ‰SENTIEL' : 'RECRUTEMENT'}</span>
                    <div style="font-size:0.75rem;color:#666;margin-top:0.5rem;">${s.theme || ''} â€¢ Par ${s.claimant}</div>
                    <p style="font-size:0.75rem;color:#888;margin-top:0.5rem;">${s.description || ''}</p>
                    ${s.traceUrl ? `<a href="${s.traceUrl}" target="_blank" style="color:var(--blue);font-size:0.7rem;">â†’ Trace</a>` : ''}
                </div>
                <div class="form-section">
                    <div class="form-section-title">PARTICIPANTS (${s.participants.length}/9)</div>
                    <div class="pbar" style="margin-bottom:0.5rem;"><div class="pbar-fill" style="width:${pct}%"></div></div>
            `;
            
            s.participants.forEach((p, i) => {
                html += `<div style="display:flex;justify-content:space-between;padding:0.3rem 0;border-bottom:1px solid #222;">
                    <span style="color:${i===0?'var(--green)':'#888'}">${i===0?'ğŸ‘‘ ':''}${p.name}</span>
                    ${i > 0 ? `<button class="btn btn-danger btn-sm" onclick="removeP('${s.id}',${i})">Ã—</button>` : ''}
                </div>`;
            });
            
            if (s.participants.length < 9) {
                html += `<button class="btn btn-secondary btn-block" style="margin-top:0.5rem;" onclick="openJoin('${s.id}')">+ Ajouter</button>`;
            }
            html += '</div>';
            
            if (matches.length > 0) {
                html += '<div class="form-section"><div class="form-section-title">ğŸ”— MATCHES TERRITORIAUX</div>';
                matches.forEach(m => {
                    html += `<div class="card" onclick="showDetail('${m.spot.id}')">
                        <div class="card-title">${m.spot.title || m.spot.nodeName}</div>
                        <div class="card-meta">${m.d.toFixed(1)} km â€¢ ${m.spot.participants.length} participants</div>
                    </div>`;
                });
                html += '</div>';
            }
            
            html += `<div class="btn-group">
                <button class="btn btn-secondary" onclick="showPanel('list');document.getElementById('sidebar-title').textContent='ATELIERS';">â† Retour</button>
                <button class="btn btn-danger" onclick="delSpot('${s.id}')">ğŸ—‘ï¸</button>
                <button class="btn btn-primary" onclick="editSpot('${s.id}')" style="flex:1">âœï¸ Modifier</button>
            </div>`;
            
            document.getElementById('detail-content').innerHTML = html;
            S.map.setView([s.lat, s.lon], 14);
        };
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // EDIT SPOT
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        window.editSpot = function(id) {
            const s = S.spots.find(x => x.id === id);
            if (!s) return;
            S.editingSpot = s;
            S.selectedNode = NODES.find(n => n.id === s.nodeId);
            showPanel('edit');
            document.getElementById('sidebar-title').textContent = 'MODIFIER';
            document.getElementById('selected-display').className = 'selected-info';
            document.getElementById('selected-display').innerHTML = `ğŸ“ <strong>${s.nodeName}</strong>`;
            document.getElementById('f-name').value = s.claimant;
            document.getElementById('f-url').value = s.traceUrl || '';
            document.getElementById('f-theme').value = s.theme || '';
            document.getElementById('f-title').value = s.title || '';
            document.getElementById('f-desc').value = s.description || '';
        };
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // SAVE
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function save() {
            const name = document.getElementById('f-name').value.trim();
            const theme = document.getElementById('f-theme').value;
            const title = document.getElementById('f-title').value.trim();
            
            if (!name) { toast('Pseudo requis'); return; }
            if (!theme) { toast('ThÃ©matique requise'); return; }
            if (!title) { toast('Titre requis'); return; }
            if (!S.selectedNode && !S.editingSpot) { toast('SÃ©lectionnez un nÅ“ud'); return; }
            
            if (S.editingSpot) {
                S.editingSpot.claimant = name;
                S.editingSpot.traceUrl = document.getElementById('f-url').value.trim();
                S.editingSpot.theme = theme;
                S.editingSpot.title = title;
                S.editingSpot.description = document.getElementById('f-desc').value.trim();
                toast('ModifiÃ©');
            } else {
                S.spots.push({
                    id: 'S' + Date.now(),
                    nodeId: S.selectedNode.id,
                    nodeName: S.selectedNode.name,
                    lat: S.selectedNode.lat,
                    lon: S.selectedNode.lon,
                    zone: S.selectedNode.zone,
                    claimant: name,
                    traceUrl: document.getElementById('f-url').value.trim(),
                    theme, title,
                    description: document.getElementById('f-desc').value.trim(),
                    createdAt: new Date().toISOString(),
                    participants: [{ name, joinedAt: new Date().toISOString() }]
                });
                toast('Spot crÃ©Ã© !');
            }
            
            persist();
            renderMap();
            renderList();
            updateStats();
            showPanel('list');
            document.getElementById('sidebar-title').textContent = 'ATELIERS';
        }
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // DELETE
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        window.delSpot = function(id) {
            if (!confirm('Supprimer cet atelier ?')) return;
            S.spots = S.spots.filter(s => s.id !== id);
            persist();
            renderMap();
            renderList();
            updateStats();
            showPanel('list');
            document.getElementById('sidebar-title').textContent = 'ATELIERS';
            toast('SupprimÃ©');
        };
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // PARTICIPANTS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        window.openJoin = function(id) {
            S.joiningSpot = id;
            document.getElementById('join-name').value = '';
            document.getElementById('modal-join').classList.remove('hidden');
        };
        
        window.closeModal = function(id) { document.getElementById(id).classList.add('hidden'); };
        
        function joinSpot() {
            const name = document.getElementById('join-name').value.trim();
            if (!name) { toast('Pseudo requis'); return; }
            const s = S.spots.find(x => x.id === S.joiningSpot);
            if (!s || s.participants.length >= 9) return;
            if (s.participants.some(p => p.name.toLowerCase() === name.toLowerCase())) { toast('Pseudo pris'); return; }
            
            s.participants.push({ name, joinedAt: new Date().toISOString() });
            persist();
            renderMap();
            updateStats();
            closeModal('modal-join');
            showDetail(s.id);
            toast(s.participants.length === 5 ? 'ğŸ‰ Quorum atteint !' : 'AjoutÃ©');
        }
        
        window.removeP = function(id, i) {
            const s = S.spots.find(x => x.id === id);
            if (!s || i === 0) return;
            s.participants.splice(i, 1);
            persist();
            renderMap();
            updateStats();
            showDetail(s.id);
            toast('RetirÃ©');
        };
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // GRAPH VIEW
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function renderGraph() {
            const canvas = document.getElementById('graph-canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
            
            ctx.fillStyle = '#050508';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            if (S.spots.length === 0) {
                ctx.fillStyle = '#444';
                ctx.font = '14px Share Tech Mono';
                ctx.textAlign = 'center';
                ctx.fillText('Aucun atelier', canvas.width/2, canvas.height/2);
                return;
            }
            
            // Position nodes in circle
            const cx = canvas.width / 2, cy = canvas.height / 2;
            const r = Math.min(cx, cy) * 0.7;
            const nodes = S.spots.map((s, i) => ({
                s,
                x: cx + Math.cos(i / S.spots.length * Math.PI * 2 - Math.PI/2) * r,
                y: cy + Math.sin(i / S.spots.length * Math.PI * 2 - Math.PI/2) * r
            }));
            
            // Links
            ctx.strokeStyle = '#00d4ff';
            ctx.lineWidth = 1;
            nodes.forEach((a, i) => {
                nodes.slice(i+1).forEach(b => {
                    if (a.s.participants.length >= 5 && b.s.participants.length >= 5) {
                        const d = dist(a.s.lat, a.s.lon, b.s.lat, b.s.lon);
                        if (d <= 10) {
                            ctx.globalAlpha = 0.3;
                            ctx.beginPath();
                            ctx.moveTo(a.x, a.y);
                            ctx.lineTo(b.x, b.y);
                            ctx.stroke();
                        }
                    }
                });
            });
            ctx.globalAlpha = 1;
            
            // Nodes
            nodes.forEach(n => {
                const ready = n.s.participants.length >= 5;
                const size = 12 + n.s.participants.length * 3;
                
                // Glow
                const g = ctx.createRadialGradient(n.x, n.y, 0, n.x, n.y, size*1.5);
                g.addColorStop(0, ready ? 'rgba(0,255,157,0.4)' : 'rgba(255,234,0,0.4)');
                g.addColorStop(1, 'transparent');
                ctx.fillStyle = g;
                ctx.fillRect(n.x - size*2, n.y - size*2, size*4, size*4);
                
                // Circle
                ctx.beginPath();
                ctx.arc(n.x, n.y, size, 0, Math.PI*2);
                ctx.fillStyle = ready ? '#00ff9d' : '#ffea00';
                ctx.fill();
                
                // Count
                ctx.fillStyle = '#000';
                ctx.font = 'bold 11px Orbitron';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(n.s.participants.length, n.x, n.y);
                
                // Label
                ctx.fillStyle = '#888';
                ctx.font = '10px Share Tech Mono';
                ctx.fillText(n.s.title || n.s.nodeName, n.x, n.y + size + 12);
            });
            
            // Legend
            ctx.fillStyle = '#444';
            ctx.font = '11px Share Tech Mono';
            ctx.textAlign = 'left';
            ctx.fillText('ğŸŸ¢ PrÃªt (â‰¥5)  ğŸŸ¡ Recrutement  â”€â”€â”€ Lien territorial (<10km)', 10, canvas.height - 10);
        }
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // UTILS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function showPanel(name) {
            document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
            document.getElementById('panel-' + name).classList.add('active');
        }
        
        function clearForm() {
            ['f-name','f-url','f-theme','f-title','f-desc'].forEach(id => {
                const el = document.getElementById(id);
                if (el.tagName === 'SELECT') el.selectedIndex = 0;
                else el.value = '';
            });
        }
        
        function persist() { localStorage.setItem('ateliers_v4', JSON.stringify(S.spots)); }
        
        function updateStats() {
            document.getElementById('stat-nodes').textContent = NODES.length;
            document.getElementById('stat-spots').textContent = S.spots.length;
            document.getElementById('stat-ready').textContent = S.spots.filter(s => s.participants.length >= 5).length;
        }
        
        function toast(msg) {
            const el = document.getElementById('toast');
            el.textContent = msg;
            el.classList.add('show');
            setTimeout(() => el.classList.remove('show'), 2500);
        }
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // EVENTS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        document.querySelectorAll('.tab').forEach(t => {
            t.addEventListener('click', function() {
                document.querySelectorAll('.tab').forEach(x => x.classList.remove('active'));
                this.classList.add('active');
                S.view = this.dataset.view;
                if (S.view === 'graph') {
                    document.getElementById('graph-view').classList.add('active');
                    setTimeout(renderGraph, 50);
                } else {
                    document.getElementById('graph-view').classList.remove('active');
                }
            });
        });
        
        document.getElementById('btn-new').addEventListener('click', () => {
            S.selectedNode = null;
            S.editingSpot = null;
            showPanel('edit');
            document.getElementById('sidebar-title').textContent = 'NOUVEAU SPOT';
            document.getElementById('selected-display').className = 'selected-info empty';
            document.getElementById('selected-display').textContent = 'ğŸ“ Cliquez sur la carte';
            clearForm();
        });
        
        document.getElementById('btn-cancel').addEventListener('click', () => {
            showPanel('list');
            document.getElementById('sidebar-title').textContent = 'ATELIERS';
        });
        
        document.getElementById('btn-save').addEventListener('click', save);
        document.getElementById('btn-join-ok').addEventListener('click', joinSpot);
        
        document.getElementById('btn-locate').addEventListener('click', () => {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(p => S.map.setView([p.coords.latitude, p.coords.longitude], 14));
            }
        });
        
        document.getElementById('btn-voronoi').addEventListener('click', function() {
            S.showVoronoi = !S.showVoronoi;
            this.classList.toggle('active', S.showVoronoi);
            if (S.showVoronoi) {
                S.layers.voronoi.addTo(S.map);
                renderVoronoi();
            } else {
                S.map.removeLayer(S.layers.voronoi);
            }
        });
        
        S.map.on('moveend zoomend', () => { if (S.showVoronoi) renderVoronoi(); });
        
        window.addEventListener('resize', () => { if (S.view === 'graph') renderGraph(); });
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // INIT
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        renderMap();
        renderList();
        updateStats();
    }
    </script>
</body>
</html>
